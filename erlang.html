<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- Licensed under the Apache 2.0 License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/open-sans/stylesheet.css" />
    <!-- Licensed under the SIL Open Font License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/source-serif-pro/source-serif-pro.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Makeup Demo</title>
    
    <!--Bootstrap 5-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    
    <link rel="stylesheet" href="static/css/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="static/css/makeup.css" type="text/css" />
  </head>

  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0">
          <a href="#">Makeup Demo</a> &raquo;
        </li> 
      </ul>
    </div>

    <div class="container-wrapper">
      <div id="mobile-toggle">
        <a class="text-logo--mobile"  href="index.html">
          <span>Makeup Demo</span>
        </a>
        <button class="menu-btn" area-label="Menu">
          <img class="menu-icon" src="static/img/menu-line.svg">
        </button>        
      </div>

      <div id="left-column" class="left-column">
        <div class="sphinxsidebar"><a href="index.html" class="text-logo">Makeup Demo</a>

          
            <div class="sidebar-block">
              <div class="sidebar-wrapper">
                <h2>Styles</h2>
              </div>
              <div class="sidebar-toc">
                <ul>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#abap">
                        Abap Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol">
                        Algol Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol_nu">
                        Algol_Nu Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#arduino">
                        Arduino Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#autumn">
                        Autumn Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#borland">
                        Borland Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#bw">
                        BlackWhite Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#colorful">
                        Colorful Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#default">
                        Default Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#emacs">
                        Emacs Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#friendly">
                        Friendly Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#fruity">
                        Fruity Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#igor">
                        Igor Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#lovelace">
                        Lovelace Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#manni">
                        Manni Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#monokai">
                        Monokai Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#murphy">
                        Murphy Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#native">
                        Native Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_dark">
                        ParaisoDark Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_light">
                        ParaisoLight Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#pastie">
                        Pastie Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#perldoc">
                        Perldoc Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rainbow_dash">
                        RainbowDash Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rrt">
                        Rrt Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#tango">
                        Tango Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#trac">
                        Trac Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vim">
                        Vim Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vs">
                        VisualStudio Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#xcode">
                        Xcode Style</a></li>
                  
                </ul>
              </div>
            </div>
          

          <div class="sidebar-block">
            <div class="sidebar-wrapper">
              <h2>Languages</h2>
            </div>
            <div class="sidebar-toc">
              <ul>
                
                <li class="toctree-l1"><a class="reference internal" href="elixir.html">Elixir</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="erlang.html">Erlang</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="c.html">C</a></li>
                
              </ul>
            </div>
          </div>

        </div>
      </div>

      <div id="right-column">
        
        <div class="document clearer body">

          <div class="section">
            <h1 id="heading">
  Erlang Language<a class="headerlink" href="#heading" title="Permalink">¶</a>
</h1>

<p>
  A lexer for the Erlang language.
</p>


<p>
  This page shows examples of source files lexed by the same lexer,
  but rendered into HTML using different styles.
</p>

<p>
  Some styles are richer than others in that they define more different token categories.

  Examples of such richer styles are the <a href="#default">Default</a> style,
  the <a href="#tango">Tango</a> style and the <a href="#colorful">Colorful</a> style.
</p>

<p>
  In all cases the lexer is the same, and the only difference is the colors defined by the styles.
</p>


  <h2 id="abap">
    Abap Style (abap)<a class="headerlink" href="#abap" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-abap"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">abap_style</span><span class="p" data-group-id="5101382259-1">(</span><span class="p" data-group-id="5101382259-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="abap-example.erl">
      example.erl<a class="headerlink" href="#abap-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-abap"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0088421580-1">(</span><span class="ss">test</span><span class="p" data-group-id="0088421580-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0088421580-2">(</span><span class="p" data-group-id="0088421580-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0088421580-3">]</span><span class="p" data-group-id="0088421580-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0088421580-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0088421580-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0088421580-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0088421580-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0088421580-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0088421580-9">}</span><span class="p" data-group-id="0088421580-6">]</span><span class="p" data-group-id="0088421580-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0088421580-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0088421580-11">}</span><span class="p" data-group-id="0088421580-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0088421580-12">(</span><span class="n">Port</span><span class="p" data-group-id="0088421580-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0088421580-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0088421580-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0088421580-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0088421580-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0088421580-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-17">[</span><span class="p" data-group-id="0088421580-18">[</span><span class="p" data-group-id="0088421580-18">]</span><span class="p" data-group-id="0088421580-17">]</span><span class="p" data-group-id="0088421580-16">)</span><span class="p" data-group-id="0088421580-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0088421580-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0088421580-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0088421580-20">(</span><span class="n">Players</span><span class="p" data-group-id="0088421580-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0088421580-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-22">[</span><span class="p" data-group-id="0088421580-22">]</span><span class="p" data-group-id="0088421580-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0088421580-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0088421580-24">(</span><span class="n">P</span><span class="p" data-group-id="0088421580-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0088421580-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-26">[</span><span class="n">P</span><span class="p" data-group-id="0088421580-26">]</span><span class="p" data-group-id="0088421580-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0088421580-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0088421580-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0088421580-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0088421580-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0088421580-29">(</span><span class="n">Player</span><span class="p" data-group-id="0088421580-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0088421580-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-31">[</span><span class="n">Player</span><span class="p" data-group-id="0088421580-31">]</span><span class="p" data-group-id="0088421580-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0088421580-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0088421580-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0088421580-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0088421580-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0088421580-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-36">[</span><span class="n">Player</span><span class="p" data-group-id="0088421580-36">]</span><span class="p" data-group-id="0088421580-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0088421580-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0088421580-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0088421580-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0088421580-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0088421580-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0088421580-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0088421580-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0088421580-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0088421580-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0088421580-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0088421580-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0088421580-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0088421580-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0088421580-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0088421580-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0088421580-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0088421580-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0088421580-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0088421580-49">(</span><span class="n">Player</span><span class="p" data-group-id="0088421580-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0088421580-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0088421580-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0088421580-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0088421580-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0088421580-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0088421580-53">(</span><span class="n">P</span><span class="p" data-group-id="0088421580-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0088421580-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0088421580-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0088421580-55">(</span><span class="n">P</span><span class="p" data-group-id="0088421580-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0088421580-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0088421580-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0088421580-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0088421580-57">(</span><span class="p" data-group-id="0088421580-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-58">{</span><span class="p" data-group-id="0088421580-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0088421580-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0088421580-60">}</span><span class="p" data-group-id="0088421580-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0088421580-61">(</span><span class="p" data-group-id="0088421580-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0088421580-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0088421580-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0088421580-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0088421580-64">]</span><span class="w">
        </span><span class="p" data-group-id="0088421580-63">)</span><span class="w">
    </span><span class="p" data-group-id="0088421580-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0088421580-65">(</span><span class="p" data-group-id="0088421580-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0088421580-66">(</span><span class="p" data-group-id="0088421580-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0088421580-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0088421580-68">]</span><span class="p" data-group-id="0088421580-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0088421580-69">(</span><span class="p" data-group-id="0088421580-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0088421580-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0088421580-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0088421580-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0088421580-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0088421580-72">(</span><span class="p" data-group-id="0088421580-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0088421580-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0088421580-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0088421580-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0088421580-76">]</span><span class="p" data-group-id="0088421580-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0088421580-78">(</span><span class="n">H</span><span class="p" data-group-id="0088421580-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0088421580-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0088421580-79">)</span><span class="p" data-group-id="0088421580-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0088421580-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0088421580-81">[</span><span class="p" data-group-id="0088421580-81">]</span><span class="p" data-group-id="0088421580-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0088421580-82">[</span><span class="p" data-group-id="0088421580-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0088421580-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0088421580-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0088421580-84">(</span><span class="p" data-group-id="0088421580-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0088421580-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0088421580-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0088421580-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0088421580-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0088421580-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0088421580-89">(</span><span class="p" data-group-id="0088421580-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0088421580-90">{</span><span class="nf">self</span><span class="p" data-group-id="0088421580-91">(</span><span class="p" data-group-id="0088421580-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0088421580-92">(</span><span class="n">X</span><span class="p" data-group-id="0088421580-92">)</span><span class="p" data-group-id="0088421580-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0088421580-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0088421580-87">]</span><span class="w">
    </span><span class="p" data-group-id="0088421580-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol">
    Algol Style (algol)<a class="headerlink" href="#algol" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_style</span><span class="p" data-group-id="6765675809-1">(</span><span class="p" data-group-id="6765675809-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="algol-example.erl">
      example.erl<a class="headerlink" href="#algol-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0058348967-1">(</span><span class="ss">test</span><span class="p" data-group-id="0058348967-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0058348967-2">(</span><span class="p" data-group-id="0058348967-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0058348967-3">]</span><span class="p" data-group-id="0058348967-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0058348967-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0058348967-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0058348967-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0058348967-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0058348967-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0058348967-9">}</span><span class="p" data-group-id="0058348967-6">]</span><span class="p" data-group-id="0058348967-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0058348967-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0058348967-11">}</span><span class="p" data-group-id="0058348967-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0058348967-12">(</span><span class="n">Port</span><span class="p" data-group-id="0058348967-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0058348967-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0058348967-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0058348967-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0058348967-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0058348967-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-17">[</span><span class="p" data-group-id="0058348967-18">[</span><span class="p" data-group-id="0058348967-18">]</span><span class="p" data-group-id="0058348967-17">]</span><span class="p" data-group-id="0058348967-16">)</span><span class="p" data-group-id="0058348967-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0058348967-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0058348967-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0058348967-20">(</span><span class="n">Players</span><span class="p" data-group-id="0058348967-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0058348967-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-22">[</span><span class="p" data-group-id="0058348967-22">]</span><span class="p" data-group-id="0058348967-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0058348967-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0058348967-24">(</span><span class="n">P</span><span class="p" data-group-id="0058348967-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0058348967-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-26">[</span><span class="n">P</span><span class="p" data-group-id="0058348967-26">]</span><span class="p" data-group-id="0058348967-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0058348967-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0058348967-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0058348967-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0058348967-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0058348967-29">(</span><span class="n">Player</span><span class="p" data-group-id="0058348967-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0058348967-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-31">[</span><span class="n">Player</span><span class="p" data-group-id="0058348967-31">]</span><span class="p" data-group-id="0058348967-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0058348967-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0058348967-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0058348967-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0058348967-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0058348967-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-36">[</span><span class="n">Player</span><span class="p" data-group-id="0058348967-36">]</span><span class="p" data-group-id="0058348967-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0058348967-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0058348967-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0058348967-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0058348967-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0058348967-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0058348967-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0058348967-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0058348967-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0058348967-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0058348967-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0058348967-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0058348967-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0058348967-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0058348967-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0058348967-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0058348967-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0058348967-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0058348967-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0058348967-49">(</span><span class="n">Player</span><span class="p" data-group-id="0058348967-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0058348967-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0058348967-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0058348967-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0058348967-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0058348967-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0058348967-53">(</span><span class="n">P</span><span class="p" data-group-id="0058348967-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0058348967-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0058348967-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0058348967-55">(</span><span class="n">P</span><span class="p" data-group-id="0058348967-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0058348967-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0058348967-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0058348967-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0058348967-57">(</span><span class="p" data-group-id="0058348967-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-58">{</span><span class="p" data-group-id="0058348967-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0058348967-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0058348967-60">}</span><span class="p" data-group-id="0058348967-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0058348967-61">(</span><span class="p" data-group-id="0058348967-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0058348967-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0058348967-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0058348967-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0058348967-64">]</span><span class="w">
        </span><span class="p" data-group-id="0058348967-63">)</span><span class="w">
    </span><span class="p" data-group-id="0058348967-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0058348967-65">(</span><span class="p" data-group-id="0058348967-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0058348967-66">(</span><span class="p" data-group-id="0058348967-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0058348967-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0058348967-68">]</span><span class="p" data-group-id="0058348967-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0058348967-69">(</span><span class="p" data-group-id="0058348967-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0058348967-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0058348967-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0058348967-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0058348967-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0058348967-72">(</span><span class="p" data-group-id="0058348967-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0058348967-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0058348967-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0058348967-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0058348967-76">]</span><span class="p" data-group-id="0058348967-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0058348967-78">(</span><span class="n">H</span><span class="p" data-group-id="0058348967-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0058348967-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0058348967-79">)</span><span class="p" data-group-id="0058348967-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0058348967-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0058348967-81">[</span><span class="p" data-group-id="0058348967-81">]</span><span class="p" data-group-id="0058348967-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0058348967-82">[</span><span class="p" data-group-id="0058348967-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0058348967-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0058348967-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0058348967-84">(</span><span class="p" data-group-id="0058348967-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0058348967-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0058348967-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0058348967-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0058348967-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0058348967-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0058348967-89">(</span><span class="p" data-group-id="0058348967-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0058348967-90">{</span><span class="nf">self</span><span class="p" data-group-id="0058348967-91">(</span><span class="p" data-group-id="0058348967-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0058348967-92">(</span><span class="n">X</span><span class="p" data-group-id="0058348967-92">)</span><span class="p" data-group-id="0058348967-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0058348967-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0058348967-87">]</span><span class="w">
    </span><span class="p" data-group-id="0058348967-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol_nu">
    Algol_Nu Style (algol_nu)<a class="headerlink" href="#algol_nu" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol_nu"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_nu_style</span><span class="p" data-group-id="8028454460-1">(</span><span class="p" data-group-id="8028454460-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="algol_nu-example.erl">
      example.erl<a class="headerlink" href="#algol_nu-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol_nu"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2491997721-1">(</span><span class="ss">test</span><span class="p" data-group-id="2491997721-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2491997721-2">(</span><span class="p" data-group-id="2491997721-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2491997721-3">]</span><span class="p" data-group-id="2491997721-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2491997721-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2491997721-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2491997721-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2491997721-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2491997721-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2491997721-9">}</span><span class="p" data-group-id="2491997721-6">]</span><span class="p" data-group-id="2491997721-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2491997721-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2491997721-11">}</span><span class="p" data-group-id="2491997721-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2491997721-12">(</span><span class="n">Port</span><span class="p" data-group-id="2491997721-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2491997721-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2491997721-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2491997721-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2491997721-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2491997721-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-17">[</span><span class="p" data-group-id="2491997721-18">[</span><span class="p" data-group-id="2491997721-18">]</span><span class="p" data-group-id="2491997721-17">]</span><span class="p" data-group-id="2491997721-16">)</span><span class="p" data-group-id="2491997721-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2491997721-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2491997721-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2491997721-20">(</span><span class="n">Players</span><span class="p" data-group-id="2491997721-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2491997721-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-22">[</span><span class="p" data-group-id="2491997721-22">]</span><span class="p" data-group-id="2491997721-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2491997721-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2491997721-24">(</span><span class="n">P</span><span class="p" data-group-id="2491997721-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2491997721-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-26">[</span><span class="n">P</span><span class="p" data-group-id="2491997721-26">]</span><span class="p" data-group-id="2491997721-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2491997721-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2491997721-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2491997721-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2491997721-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2491997721-29">(</span><span class="n">Player</span><span class="p" data-group-id="2491997721-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2491997721-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-31">[</span><span class="n">Player</span><span class="p" data-group-id="2491997721-31">]</span><span class="p" data-group-id="2491997721-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2491997721-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2491997721-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2491997721-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2491997721-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2491997721-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-36">[</span><span class="n">Player</span><span class="p" data-group-id="2491997721-36">]</span><span class="p" data-group-id="2491997721-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2491997721-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2491997721-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2491997721-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2491997721-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2491997721-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2491997721-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2491997721-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2491997721-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2491997721-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2491997721-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2491997721-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2491997721-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2491997721-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2491997721-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2491997721-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2491997721-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2491997721-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2491997721-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2491997721-49">(</span><span class="n">Player</span><span class="p" data-group-id="2491997721-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2491997721-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2491997721-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2491997721-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2491997721-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2491997721-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2491997721-53">(</span><span class="n">P</span><span class="p" data-group-id="2491997721-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2491997721-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2491997721-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2491997721-55">(</span><span class="n">P</span><span class="p" data-group-id="2491997721-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2491997721-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2491997721-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2491997721-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2491997721-57">(</span><span class="p" data-group-id="2491997721-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-58">{</span><span class="p" data-group-id="2491997721-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2491997721-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2491997721-60">}</span><span class="p" data-group-id="2491997721-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2491997721-61">(</span><span class="p" data-group-id="2491997721-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2491997721-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2491997721-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2491997721-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2491997721-64">]</span><span class="w">
        </span><span class="p" data-group-id="2491997721-63">)</span><span class="w">
    </span><span class="p" data-group-id="2491997721-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2491997721-65">(</span><span class="p" data-group-id="2491997721-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2491997721-66">(</span><span class="p" data-group-id="2491997721-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2491997721-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2491997721-68">]</span><span class="p" data-group-id="2491997721-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2491997721-69">(</span><span class="p" data-group-id="2491997721-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2491997721-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2491997721-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2491997721-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2491997721-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2491997721-72">(</span><span class="p" data-group-id="2491997721-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2491997721-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2491997721-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2491997721-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2491997721-76">]</span><span class="p" data-group-id="2491997721-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2491997721-78">(</span><span class="n">H</span><span class="p" data-group-id="2491997721-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2491997721-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2491997721-79">)</span><span class="p" data-group-id="2491997721-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2491997721-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2491997721-81">[</span><span class="p" data-group-id="2491997721-81">]</span><span class="p" data-group-id="2491997721-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2491997721-82">[</span><span class="p" data-group-id="2491997721-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2491997721-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2491997721-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2491997721-84">(</span><span class="p" data-group-id="2491997721-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2491997721-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2491997721-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2491997721-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2491997721-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2491997721-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2491997721-89">(</span><span class="p" data-group-id="2491997721-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2491997721-90">{</span><span class="nf">self</span><span class="p" data-group-id="2491997721-91">(</span><span class="p" data-group-id="2491997721-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2491997721-92">(</span><span class="n">X</span><span class="p" data-group-id="2491997721-92">)</span><span class="p" data-group-id="2491997721-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2491997721-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2491997721-87">]</span><span class="w">
    </span><span class="p" data-group-id="2491997721-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="arduino">
    Arduino Style (arduino)<a class="headerlink" href="#arduino" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-arduino"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">arduino_style</span><span class="p" data-group-id="8204168584-1">(</span><span class="p" data-group-id="8204168584-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="arduino-example.erl">
      example.erl<a class="headerlink" href="#arduino-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-arduino"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4188887021-1">(</span><span class="ss">test</span><span class="p" data-group-id="4188887021-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4188887021-2">(</span><span class="p" data-group-id="4188887021-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4188887021-3">]</span><span class="p" data-group-id="4188887021-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4188887021-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4188887021-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4188887021-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4188887021-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4188887021-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4188887021-9">}</span><span class="p" data-group-id="4188887021-6">]</span><span class="p" data-group-id="4188887021-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4188887021-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4188887021-11">}</span><span class="p" data-group-id="4188887021-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4188887021-12">(</span><span class="n">Port</span><span class="p" data-group-id="4188887021-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4188887021-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4188887021-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4188887021-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4188887021-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4188887021-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-17">[</span><span class="p" data-group-id="4188887021-18">[</span><span class="p" data-group-id="4188887021-18">]</span><span class="p" data-group-id="4188887021-17">]</span><span class="p" data-group-id="4188887021-16">)</span><span class="p" data-group-id="4188887021-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4188887021-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4188887021-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4188887021-20">(</span><span class="n">Players</span><span class="p" data-group-id="4188887021-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4188887021-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-22">[</span><span class="p" data-group-id="4188887021-22">]</span><span class="p" data-group-id="4188887021-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4188887021-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4188887021-24">(</span><span class="n">P</span><span class="p" data-group-id="4188887021-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4188887021-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-26">[</span><span class="n">P</span><span class="p" data-group-id="4188887021-26">]</span><span class="p" data-group-id="4188887021-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4188887021-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4188887021-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4188887021-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4188887021-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4188887021-29">(</span><span class="n">Player</span><span class="p" data-group-id="4188887021-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4188887021-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-31">[</span><span class="n">Player</span><span class="p" data-group-id="4188887021-31">]</span><span class="p" data-group-id="4188887021-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4188887021-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4188887021-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4188887021-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4188887021-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4188887021-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-36">[</span><span class="n">Player</span><span class="p" data-group-id="4188887021-36">]</span><span class="p" data-group-id="4188887021-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4188887021-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4188887021-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4188887021-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4188887021-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4188887021-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4188887021-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4188887021-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4188887021-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4188887021-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4188887021-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4188887021-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4188887021-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4188887021-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4188887021-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4188887021-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4188887021-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4188887021-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4188887021-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4188887021-49">(</span><span class="n">Player</span><span class="p" data-group-id="4188887021-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4188887021-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4188887021-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4188887021-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4188887021-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4188887021-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4188887021-53">(</span><span class="n">P</span><span class="p" data-group-id="4188887021-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4188887021-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4188887021-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4188887021-55">(</span><span class="n">P</span><span class="p" data-group-id="4188887021-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4188887021-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4188887021-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4188887021-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4188887021-57">(</span><span class="p" data-group-id="4188887021-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-58">{</span><span class="p" data-group-id="4188887021-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4188887021-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4188887021-60">}</span><span class="p" data-group-id="4188887021-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4188887021-61">(</span><span class="p" data-group-id="4188887021-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4188887021-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4188887021-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4188887021-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4188887021-64">]</span><span class="w">
        </span><span class="p" data-group-id="4188887021-63">)</span><span class="w">
    </span><span class="p" data-group-id="4188887021-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4188887021-65">(</span><span class="p" data-group-id="4188887021-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4188887021-66">(</span><span class="p" data-group-id="4188887021-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4188887021-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4188887021-68">]</span><span class="p" data-group-id="4188887021-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4188887021-69">(</span><span class="p" data-group-id="4188887021-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4188887021-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4188887021-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4188887021-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4188887021-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4188887021-72">(</span><span class="p" data-group-id="4188887021-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4188887021-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4188887021-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4188887021-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4188887021-76">]</span><span class="p" data-group-id="4188887021-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4188887021-78">(</span><span class="n">H</span><span class="p" data-group-id="4188887021-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4188887021-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4188887021-79">)</span><span class="p" data-group-id="4188887021-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4188887021-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4188887021-81">[</span><span class="p" data-group-id="4188887021-81">]</span><span class="p" data-group-id="4188887021-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4188887021-82">[</span><span class="p" data-group-id="4188887021-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4188887021-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4188887021-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4188887021-84">(</span><span class="p" data-group-id="4188887021-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4188887021-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4188887021-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4188887021-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4188887021-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4188887021-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4188887021-89">(</span><span class="p" data-group-id="4188887021-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4188887021-90">{</span><span class="nf">self</span><span class="p" data-group-id="4188887021-91">(</span><span class="p" data-group-id="4188887021-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4188887021-92">(</span><span class="n">X</span><span class="p" data-group-id="4188887021-92">)</span><span class="p" data-group-id="4188887021-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4188887021-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4188887021-87">]</span><span class="w">
    </span><span class="p" data-group-id="4188887021-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="autumn">
    Autumn Style (autumn)<a class="headerlink" href="#autumn" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-autumn"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">autumn_style</span><span class="p" data-group-id="7216364043-1">(</span><span class="p" data-group-id="7216364043-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="autumn-example.erl">
      example.erl<a class="headerlink" href="#autumn-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-autumn"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0502169014-1">(</span><span class="ss">test</span><span class="p" data-group-id="0502169014-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0502169014-2">(</span><span class="p" data-group-id="0502169014-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0502169014-3">]</span><span class="p" data-group-id="0502169014-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0502169014-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0502169014-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0502169014-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0502169014-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0502169014-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0502169014-9">}</span><span class="p" data-group-id="0502169014-6">]</span><span class="p" data-group-id="0502169014-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0502169014-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0502169014-11">}</span><span class="p" data-group-id="0502169014-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0502169014-12">(</span><span class="n">Port</span><span class="p" data-group-id="0502169014-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0502169014-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0502169014-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0502169014-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0502169014-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0502169014-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-17">[</span><span class="p" data-group-id="0502169014-18">[</span><span class="p" data-group-id="0502169014-18">]</span><span class="p" data-group-id="0502169014-17">]</span><span class="p" data-group-id="0502169014-16">)</span><span class="p" data-group-id="0502169014-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0502169014-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0502169014-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0502169014-20">(</span><span class="n">Players</span><span class="p" data-group-id="0502169014-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0502169014-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-22">[</span><span class="p" data-group-id="0502169014-22">]</span><span class="p" data-group-id="0502169014-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0502169014-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0502169014-24">(</span><span class="n">P</span><span class="p" data-group-id="0502169014-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0502169014-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-26">[</span><span class="n">P</span><span class="p" data-group-id="0502169014-26">]</span><span class="p" data-group-id="0502169014-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0502169014-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0502169014-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0502169014-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0502169014-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0502169014-29">(</span><span class="n">Player</span><span class="p" data-group-id="0502169014-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0502169014-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-31">[</span><span class="n">Player</span><span class="p" data-group-id="0502169014-31">]</span><span class="p" data-group-id="0502169014-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0502169014-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0502169014-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0502169014-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0502169014-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0502169014-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-36">[</span><span class="n">Player</span><span class="p" data-group-id="0502169014-36">]</span><span class="p" data-group-id="0502169014-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0502169014-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0502169014-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0502169014-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0502169014-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0502169014-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0502169014-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0502169014-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0502169014-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0502169014-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0502169014-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0502169014-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0502169014-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0502169014-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0502169014-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0502169014-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0502169014-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0502169014-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0502169014-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0502169014-49">(</span><span class="n">Player</span><span class="p" data-group-id="0502169014-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0502169014-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0502169014-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0502169014-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0502169014-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0502169014-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0502169014-53">(</span><span class="n">P</span><span class="p" data-group-id="0502169014-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0502169014-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0502169014-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0502169014-55">(</span><span class="n">P</span><span class="p" data-group-id="0502169014-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0502169014-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0502169014-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0502169014-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0502169014-57">(</span><span class="p" data-group-id="0502169014-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-58">{</span><span class="p" data-group-id="0502169014-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0502169014-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0502169014-60">}</span><span class="p" data-group-id="0502169014-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0502169014-61">(</span><span class="p" data-group-id="0502169014-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0502169014-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0502169014-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0502169014-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0502169014-64">]</span><span class="w">
        </span><span class="p" data-group-id="0502169014-63">)</span><span class="w">
    </span><span class="p" data-group-id="0502169014-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0502169014-65">(</span><span class="p" data-group-id="0502169014-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0502169014-66">(</span><span class="p" data-group-id="0502169014-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0502169014-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0502169014-68">]</span><span class="p" data-group-id="0502169014-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0502169014-69">(</span><span class="p" data-group-id="0502169014-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0502169014-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0502169014-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0502169014-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0502169014-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0502169014-72">(</span><span class="p" data-group-id="0502169014-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0502169014-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0502169014-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0502169014-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0502169014-76">]</span><span class="p" data-group-id="0502169014-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0502169014-78">(</span><span class="n">H</span><span class="p" data-group-id="0502169014-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0502169014-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0502169014-79">)</span><span class="p" data-group-id="0502169014-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0502169014-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0502169014-81">[</span><span class="p" data-group-id="0502169014-81">]</span><span class="p" data-group-id="0502169014-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0502169014-82">[</span><span class="p" data-group-id="0502169014-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0502169014-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0502169014-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0502169014-84">(</span><span class="p" data-group-id="0502169014-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0502169014-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0502169014-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0502169014-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0502169014-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0502169014-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0502169014-89">(</span><span class="p" data-group-id="0502169014-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0502169014-90">{</span><span class="nf">self</span><span class="p" data-group-id="0502169014-91">(</span><span class="p" data-group-id="0502169014-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0502169014-92">(</span><span class="n">X</span><span class="p" data-group-id="0502169014-92">)</span><span class="p" data-group-id="0502169014-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0502169014-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0502169014-87">]</span><span class="w">
    </span><span class="p" data-group-id="0502169014-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="borland">
    Borland Style (borland)<a class="headerlink" href="#borland" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-borland"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">borland_style</span><span class="p" data-group-id="1572109254-1">(</span><span class="p" data-group-id="1572109254-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="borland-example.erl">
      example.erl<a class="headerlink" href="#borland-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-borland"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3621569455-1">(</span><span class="ss">test</span><span class="p" data-group-id="3621569455-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3621569455-2">(</span><span class="p" data-group-id="3621569455-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="3621569455-3">]</span><span class="p" data-group-id="3621569455-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="3621569455-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="3621569455-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="3621569455-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3621569455-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3621569455-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3621569455-9">}</span><span class="p" data-group-id="3621569455-6">]</span><span class="p" data-group-id="3621569455-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="3621569455-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="3621569455-11">}</span><span class="p" data-group-id="3621569455-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="3621569455-12">(</span><span class="n">Port</span><span class="p" data-group-id="3621569455-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="3621569455-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="3621569455-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="3621569455-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="3621569455-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="3621569455-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-17">[</span><span class="p" data-group-id="3621569455-18">[</span><span class="p" data-group-id="3621569455-18">]</span><span class="p" data-group-id="3621569455-17">]</span><span class="p" data-group-id="3621569455-16">)</span><span class="p" data-group-id="3621569455-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="3621569455-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="3621569455-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="3621569455-20">(</span><span class="n">Players</span><span class="p" data-group-id="3621569455-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3621569455-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-22">[</span><span class="p" data-group-id="3621569455-22">]</span><span class="p" data-group-id="3621569455-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3621569455-23">(</span><span class="nf">fun</span><span class="p" data-group-id="3621569455-24">(</span><span class="n">P</span><span class="p" data-group-id="3621569455-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3621569455-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-26">[</span><span class="n">P</span><span class="p" data-group-id="3621569455-26">]</span><span class="p" data-group-id="3621569455-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3621569455-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3621569455-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="3621569455-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="3621569455-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3621569455-29">(</span><span class="n">Player</span><span class="p" data-group-id="3621569455-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3621569455-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-31">[</span><span class="n">Player</span><span class="p" data-group-id="3621569455-31">]</span><span class="p" data-group-id="3621569455-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3621569455-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3621569455-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3621569455-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3621569455-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3621569455-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-36">[</span><span class="n">Player</span><span class="p" data-group-id="3621569455-36">]</span><span class="p" data-group-id="3621569455-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="3621569455-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3621569455-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3621569455-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3621569455-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="3621569455-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3621569455-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3621569455-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="3621569455-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3621569455-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="3621569455-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="3621569455-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="3621569455-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="3621569455-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="3621569455-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="3621569455-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="3621569455-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="3621569455-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3621569455-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="3621569455-49">(</span><span class="n">Player</span><span class="p" data-group-id="3621569455-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3621569455-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="3621569455-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="3621569455-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3621569455-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="3621569455-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3621569455-53">(</span><span class="n">P</span><span class="p" data-group-id="3621569455-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="3621569455-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3621569455-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3621569455-55">(</span><span class="n">P</span><span class="p" data-group-id="3621569455-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3621569455-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3621569455-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="3621569455-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="3621569455-57">(</span><span class="p" data-group-id="3621569455-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-58">{</span><span class="p" data-group-id="3621569455-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="3621569455-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3621569455-60">}</span><span class="p" data-group-id="3621569455-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="3621569455-61">(</span><span class="p" data-group-id="3621569455-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="3621569455-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3621569455-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3621569455-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3621569455-64">]</span><span class="w">
        </span><span class="p" data-group-id="3621569455-63">)</span><span class="w">
    </span><span class="p" data-group-id="3621569455-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="3621569455-65">(</span><span class="p" data-group-id="3621569455-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="3621569455-66">(</span><span class="p" data-group-id="3621569455-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3621569455-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3621569455-68">]</span><span class="p" data-group-id="3621569455-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="3621569455-69">(</span><span class="p" data-group-id="3621569455-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3621569455-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3621569455-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="3621569455-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="3621569455-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="3621569455-72">(</span><span class="p" data-group-id="3621569455-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="3621569455-74">{</span><span class="ss">fff</span><span class="p" data-group-id="3621569455-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="3621569455-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3621569455-76">]</span><span class="p" data-group-id="3621569455-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-77">[</span><span class="n">Fun</span><span class="p" data-group-id="3621569455-78">(</span><span class="n">H</span><span class="p" data-group-id="3621569455-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3621569455-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3621569455-79">)</span><span class="p" data-group-id="3621569455-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="3621569455-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3621569455-81">[</span><span class="p" data-group-id="3621569455-81">]</span><span class="p" data-group-id="3621569455-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3621569455-82">[</span><span class="p" data-group-id="3621569455-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="3621569455-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="3621569455-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="3621569455-84">(</span><span class="p" data-group-id="3621569455-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3621569455-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="3621569455-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="3621569455-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3621569455-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="3621569455-88">(</span><span class="nf">fun</span><span class="p" data-group-id="3621569455-89">(</span><span class="p" data-group-id="3621569455-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3621569455-90">{</span><span class="nf">self</span><span class="p" data-group-id="3621569455-91">(</span><span class="p" data-group-id="3621569455-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="3621569455-92">(</span><span class="n">X</span><span class="p" data-group-id="3621569455-92">)</span><span class="p" data-group-id="3621569455-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="3621569455-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="3621569455-87">]</span><span class="w">
    </span><span class="p" data-group-id="3621569455-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="bw">
    BlackWhite Style (bw)<a class="headerlink" href="#bw" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-bw"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">bw_style</span><span class="p" data-group-id="9426269095-1">(</span><span class="p" data-group-id="9426269095-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="bw-example.erl">
      example.erl<a class="headerlink" href="#bw-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-bw"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6044949592-1">(</span><span class="ss">test</span><span class="p" data-group-id="6044949592-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6044949592-2">(</span><span class="p" data-group-id="6044949592-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6044949592-3">]</span><span class="p" data-group-id="6044949592-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6044949592-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6044949592-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6044949592-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6044949592-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6044949592-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6044949592-9">}</span><span class="p" data-group-id="6044949592-6">]</span><span class="p" data-group-id="6044949592-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6044949592-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6044949592-11">}</span><span class="p" data-group-id="6044949592-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6044949592-12">(</span><span class="n">Port</span><span class="p" data-group-id="6044949592-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6044949592-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6044949592-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6044949592-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6044949592-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6044949592-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-17">[</span><span class="p" data-group-id="6044949592-18">[</span><span class="p" data-group-id="6044949592-18">]</span><span class="p" data-group-id="6044949592-17">]</span><span class="p" data-group-id="6044949592-16">)</span><span class="p" data-group-id="6044949592-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6044949592-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6044949592-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6044949592-20">(</span><span class="n">Players</span><span class="p" data-group-id="6044949592-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6044949592-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-22">[</span><span class="p" data-group-id="6044949592-22">]</span><span class="p" data-group-id="6044949592-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6044949592-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6044949592-24">(</span><span class="n">P</span><span class="p" data-group-id="6044949592-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6044949592-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-26">[</span><span class="n">P</span><span class="p" data-group-id="6044949592-26">]</span><span class="p" data-group-id="6044949592-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6044949592-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6044949592-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6044949592-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6044949592-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6044949592-29">(</span><span class="n">Player</span><span class="p" data-group-id="6044949592-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6044949592-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-31">[</span><span class="n">Player</span><span class="p" data-group-id="6044949592-31">]</span><span class="p" data-group-id="6044949592-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6044949592-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6044949592-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6044949592-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6044949592-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6044949592-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-36">[</span><span class="n">Player</span><span class="p" data-group-id="6044949592-36">]</span><span class="p" data-group-id="6044949592-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6044949592-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6044949592-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6044949592-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6044949592-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6044949592-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6044949592-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6044949592-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6044949592-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6044949592-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6044949592-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6044949592-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6044949592-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6044949592-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6044949592-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6044949592-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6044949592-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6044949592-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6044949592-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6044949592-49">(</span><span class="n">Player</span><span class="p" data-group-id="6044949592-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6044949592-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6044949592-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6044949592-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6044949592-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6044949592-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6044949592-53">(</span><span class="n">P</span><span class="p" data-group-id="6044949592-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6044949592-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6044949592-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6044949592-55">(</span><span class="n">P</span><span class="p" data-group-id="6044949592-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6044949592-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6044949592-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6044949592-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6044949592-57">(</span><span class="p" data-group-id="6044949592-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-58">{</span><span class="p" data-group-id="6044949592-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6044949592-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6044949592-60">}</span><span class="p" data-group-id="6044949592-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6044949592-61">(</span><span class="p" data-group-id="6044949592-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6044949592-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6044949592-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6044949592-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6044949592-64">]</span><span class="w">
        </span><span class="p" data-group-id="6044949592-63">)</span><span class="w">
    </span><span class="p" data-group-id="6044949592-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6044949592-65">(</span><span class="p" data-group-id="6044949592-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6044949592-66">(</span><span class="p" data-group-id="6044949592-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6044949592-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6044949592-68">]</span><span class="p" data-group-id="6044949592-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6044949592-69">(</span><span class="p" data-group-id="6044949592-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6044949592-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6044949592-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6044949592-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6044949592-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6044949592-72">(</span><span class="p" data-group-id="6044949592-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6044949592-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6044949592-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6044949592-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6044949592-76">]</span><span class="p" data-group-id="6044949592-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6044949592-78">(</span><span class="n">H</span><span class="p" data-group-id="6044949592-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6044949592-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6044949592-79">)</span><span class="p" data-group-id="6044949592-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6044949592-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6044949592-81">[</span><span class="p" data-group-id="6044949592-81">]</span><span class="p" data-group-id="6044949592-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6044949592-82">[</span><span class="p" data-group-id="6044949592-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6044949592-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6044949592-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6044949592-84">(</span><span class="p" data-group-id="6044949592-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6044949592-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6044949592-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6044949592-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6044949592-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6044949592-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6044949592-89">(</span><span class="p" data-group-id="6044949592-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6044949592-90">{</span><span class="nf">self</span><span class="p" data-group-id="6044949592-91">(</span><span class="p" data-group-id="6044949592-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6044949592-92">(</span><span class="n">X</span><span class="p" data-group-id="6044949592-92">)</span><span class="p" data-group-id="6044949592-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6044949592-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6044949592-87">]</span><span class="w">
    </span><span class="p" data-group-id="6044949592-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="colorful">
    Colorful Style (colorful)<a class="headerlink" href="#colorful" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-colorful"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">colorful_style</span><span class="p" data-group-id="3707660184-1">(</span><span class="p" data-group-id="3707660184-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="colorful-example.erl">
      example.erl<a class="headerlink" href="#colorful-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-colorful"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1380499312-1">(</span><span class="ss">test</span><span class="p" data-group-id="1380499312-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1380499312-2">(</span><span class="p" data-group-id="1380499312-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1380499312-3">]</span><span class="p" data-group-id="1380499312-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1380499312-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1380499312-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1380499312-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1380499312-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1380499312-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1380499312-9">}</span><span class="p" data-group-id="1380499312-6">]</span><span class="p" data-group-id="1380499312-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1380499312-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1380499312-11">}</span><span class="p" data-group-id="1380499312-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1380499312-12">(</span><span class="n">Port</span><span class="p" data-group-id="1380499312-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1380499312-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1380499312-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1380499312-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1380499312-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1380499312-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-17">[</span><span class="p" data-group-id="1380499312-18">[</span><span class="p" data-group-id="1380499312-18">]</span><span class="p" data-group-id="1380499312-17">]</span><span class="p" data-group-id="1380499312-16">)</span><span class="p" data-group-id="1380499312-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1380499312-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1380499312-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1380499312-20">(</span><span class="n">Players</span><span class="p" data-group-id="1380499312-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1380499312-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-22">[</span><span class="p" data-group-id="1380499312-22">]</span><span class="p" data-group-id="1380499312-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1380499312-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1380499312-24">(</span><span class="n">P</span><span class="p" data-group-id="1380499312-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1380499312-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-26">[</span><span class="n">P</span><span class="p" data-group-id="1380499312-26">]</span><span class="p" data-group-id="1380499312-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1380499312-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1380499312-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1380499312-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1380499312-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1380499312-29">(</span><span class="n">Player</span><span class="p" data-group-id="1380499312-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1380499312-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-31">[</span><span class="n">Player</span><span class="p" data-group-id="1380499312-31">]</span><span class="p" data-group-id="1380499312-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1380499312-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1380499312-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1380499312-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1380499312-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1380499312-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-36">[</span><span class="n">Player</span><span class="p" data-group-id="1380499312-36">]</span><span class="p" data-group-id="1380499312-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1380499312-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1380499312-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1380499312-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1380499312-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1380499312-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1380499312-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1380499312-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1380499312-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1380499312-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1380499312-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1380499312-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1380499312-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1380499312-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1380499312-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1380499312-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1380499312-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1380499312-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1380499312-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1380499312-49">(</span><span class="n">Player</span><span class="p" data-group-id="1380499312-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1380499312-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1380499312-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1380499312-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1380499312-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1380499312-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1380499312-53">(</span><span class="n">P</span><span class="p" data-group-id="1380499312-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1380499312-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1380499312-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1380499312-55">(</span><span class="n">P</span><span class="p" data-group-id="1380499312-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1380499312-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1380499312-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1380499312-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1380499312-57">(</span><span class="p" data-group-id="1380499312-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-58">{</span><span class="p" data-group-id="1380499312-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1380499312-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1380499312-60">}</span><span class="p" data-group-id="1380499312-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1380499312-61">(</span><span class="p" data-group-id="1380499312-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1380499312-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1380499312-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1380499312-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1380499312-64">]</span><span class="w">
        </span><span class="p" data-group-id="1380499312-63">)</span><span class="w">
    </span><span class="p" data-group-id="1380499312-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1380499312-65">(</span><span class="p" data-group-id="1380499312-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1380499312-66">(</span><span class="p" data-group-id="1380499312-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1380499312-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1380499312-68">]</span><span class="p" data-group-id="1380499312-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1380499312-69">(</span><span class="p" data-group-id="1380499312-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1380499312-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1380499312-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1380499312-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1380499312-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1380499312-72">(</span><span class="p" data-group-id="1380499312-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1380499312-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1380499312-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1380499312-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1380499312-76">]</span><span class="p" data-group-id="1380499312-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1380499312-78">(</span><span class="n">H</span><span class="p" data-group-id="1380499312-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1380499312-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1380499312-79">)</span><span class="p" data-group-id="1380499312-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1380499312-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1380499312-81">[</span><span class="p" data-group-id="1380499312-81">]</span><span class="p" data-group-id="1380499312-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1380499312-82">[</span><span class="p" data-group-id="1380499312-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1380499312-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1380499312-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1380499312-84">(</span><span class="p" data-group-id="1380499312-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1380499312-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1380499312-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1380499312-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1380499312-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1380499312-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1380499312-89">(</span><span class="p" data-group-id="1380499312-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1380499312-90">{</span><span class="nf">self</span><span class="p" data-group-id="1380499312-91">(</span><span class="p" data-group-id="1380499312-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1380499312-92">(</span><span class="n">X</span><span class="p" data-group-id="1380499312-92">)</span><span class="p" data-group-id="1380499312-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1380499312-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1380499312-87">]</span><span class="w">
    </span><span class="p" data-group-id="1380499312-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="default">
    Default Style (default)<a class="headerlink" href="#default" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-default"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">default_style</span><span class="p" data-group-id="2741055176-1">(</span><span class="p" data-group-id="2741055176-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="default-example.erl">
      example.erl<a class="headerlink" href="#default-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-default"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6817862167-1">(</span><span class="ss">test</span><span class="p" data-group-id="6817862167-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6817862167-2">(</span><span class="p" data-group-id="6817862167-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6817862167-3">]</span><span class="p" data-group-id="6817862167-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6817862167-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6817862167-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6817862167-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6817862167-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6817862167-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6817862167-9">}</span><span class="p" data-group-id="6817862167-6">]</span><span class="p" data-group-id="6817862167-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6817862167-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6817862167-11">}</span><span class="p" data-group-id="6817862167-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6817862167-12">(</span><span class="n">Port</span><span class="p" data-group-id="6817862167-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6817862167-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6817862167-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6817862167-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6817862167-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6817862167-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-17">[</span><span class="p" data-group-id="6817862167-18">[</span><span class="p" data-group-id="6817862167-18">]</span><span class="p" data-group-id="6817862167-17">]</span><span class="p" data-group-id="6817862167-16">)</span><span class="p" data-group-id="6817862167-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6817862167-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6817862167-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6817862167-20">(</span><span class="n">Players</span><span class="p" data-group-id="6817862167-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6817862167-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-22">[</span><span class="p" data-group-id="6817862167-22">]</span><span class="p" data-group-id="6817862167-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6817862167-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6817862167-24">(</span><span class="n">P</span><span class="p" data-group-id="6817862167-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6817862167-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-26">[</span><span class="n">P</span><span class="p" data-group-id="6817862167-26">]</span><span class="p" data-group-id="6817862167-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6817862167-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6817862167-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6817862167-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6817862167-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6817862167-29">(</span><span class="n">Player</span><span class="p" data-group-id="6817862167-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6817862167-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-31">[</span><span class="n">Player</span><span class="p" data-group-id="6817862167-31">]</span><span class="p" data-group-id="6817862167-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6817862167-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6817862167-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6817862167-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6817862167-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6817862167-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-36">[</span><span class="n">Player</span><span class="p" data-group-id="6817862167-36">]</span><span class="p" data-group-id="6817862167-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6817862167-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6817862167-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6817862167-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6817862167-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6817862167-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6817862167-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6817862167-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6817862167-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6817862167-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6817862167-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6817862167-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6817862167-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6817862167-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6817862167-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6817862167-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6817862167-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6817862167-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6817862167-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6817862167-49">(</span><span class="n">Player</span><span class="p" data-group-id="6817862167-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6817862167-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6817862167-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6817862167-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6817862167-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6817862167-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6817862167-53">(</span><span class="n">P</span><span class="p" data-group-id="6817862167-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6817862167-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6817862167-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6817862167-55">(</span><span class="n">P</span><span class="p" data-group-id="6817862167-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6817862167-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6817862167-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6817862167-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6817862167-57">(</span><span class="p" data-group-id="6817862167-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-58">{</span><span class="p" data-group-id="6817862167-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6817862167-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6817862167-60">}</span><span class="p" data-group-id="6817862167-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6817862167-61">(</span><span class="p" data-group-id="6817862167-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6817862167-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6817862167-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6817862167-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6817862167-64">]</span><span class="w">
        </span><span class="p" data-group-id="6817862167-63">)</span><span class="w">
    </span><span class="p" data-group-id="6817862167-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6817862167-65">(</span><span class="p" data-group-id="6817862167-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6817862167-66">(</span><span class="p" data-group-id="6817862167-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6817862167-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6817862167-68">]</span><span class="p" data-group-id="6817862167-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6817862167-69">(</span><span class="p" data-group-id="6817862167-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6817862167-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6817862167-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6817862167-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6817862167-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6817862167-72">(</span><span class="p" data-group-id="6817862167-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6817862167-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6817862167-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6817862167-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6817862167-76">]</span><span class="p" data-group-id="6817862167-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6817862167-78">(</span><span class="n">H</span><span class="p" data-group-id="6817862167-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6817862167-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6817862167-79">)</span><span class="p" data-group-id="6817862167-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6817862167-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6817862167-81">[</span><span class="p" data-group-id="6817862167-81">]</span><span class="p" data-group-id="6817862167-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6817862167-82">[</span><span class="p" data-group-id="6817862167-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6817862167-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6817862167-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6817862167-84">(</span><span class="p" data-group-id="6817862167-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6817862167-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6817862167-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6817862167-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6817862167-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6817862167-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6817862167-89">(</span><span class="p" data-group-id="6817862167-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6817862167-90">{</span><span class="nf">self</span><span class="p" data-group-id="6817862167-91">(</span><span class="p" data-group-id="6817862167-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6817862167-92">(</span><span class="n">X</span><span class="p" data-group-id="6817862167-92">)</span><span class="p" data-group-id="6817862167-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6817862167-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6817862167-87">]</span><span class="w">
    </span><span class="p" data-group-id="6817862167-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="emacs">
    Emacs Style (emacs)<a class="headerlink" href="#emacs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-emacs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">emacs_style</span><span class="p" data-group-id="6027142673-1">(</span><span class="p" data-group-id="6027142673-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="emacs-example.erl">
      example.erl<a class="headerlink" href="#emacs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-emacs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2492260709-1">(</span><span class="ss">test</span><span class="p" data-group-id="2492260709-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2492260709-2">(</span><span class="p" data-group-id="2492260709-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2492260709-3">]</span><span class="p" data-group-id="2492260709-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2492260709-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2492260709-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2492260709-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2492260709-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2492260709-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2492260709-9">}</span><span class="p" data-group-id="2492260709-6">]</span><span class="p" data-group-id="2492260709-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2492260709-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2492260709-11">}</span><span class="p" data-group-id="2492260709-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2492260709-12">(</span><span class="n">Port</span><span class="p" data-group-id="2492260709-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2492260709-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2492260709-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2492260709-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2492260709-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2492260709-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-17">[</span><span class="p" data-group-id="2492260709-18">[</span><span class="p" data-group-id="2492260709-18">]</span><span class="p" data-group-id="2492260709-17">]</span><span class="p" data-group-id="2492260709-16">)</span><span class="p" data-group-id="2492260709-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2492260709-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2492260709-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2492260709-20">(</span><span class="n">Players</span><span class="p" data-group-id="2492260709-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2492260709-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-22">[</span><span class="p" data-group-id="2492260709-22">]</span><span class="p" data-group-id="2492260709-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2492260709-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2492260709-24">(</span><span class="n">P</span><span class="p" data-group-id="2492260709-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2492260709-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-26">[</span><span class="n">P</span><span class="p" data-group-id="2492260709-26">]</span><span class="p" data-group-id="2492260709-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2492260709-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2492260709-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2492260709-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2492260709-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2492260709-29">(</span><span class="n">Player</span><span class="p" data-group-id="2492260709-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2492260709-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-31">[</span><span class="n">Player</span><span class="p" data-group-id="2492260709-31">]</span><span class="p" data-group-id="2492260709-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2492260709-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2492260709-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2492260709-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2492260709-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2492260709-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-36">[</span><span class="n">Player</span><span class="p" data-group-id="2492260709-36">]</span><span class="p" data-group-id="2492260709-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2492260709-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2492260709-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2492260709-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2492260709-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2492260709-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2492260709-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2492260709-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2492260709-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2492260709-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2492260709-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2492260709-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2492260709-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2492260709-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2492260709-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2492260709-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2492260709-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2492260709-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2492260709-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2492260709-49">(</span><span class="n">Player</span><span class="p" data-group-id="2492260709-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2492260709-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2492260709-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2492260709-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2492260709-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2492260709-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2492260709-53">(</span><span class="n">P</span><span class="p" data-group-id="2492260709-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2492260709-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2492260709-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2492260709-55">(</span><span class="n">P</span><span class="p" data-group-id="2492260709-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2492260709-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2492260709-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2492260709-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2492260709-57">(</span><span class="p" data-group-id="2492260709-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-58">{</span><span class="p" data-group-id="2492260709-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2492260709-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2492260709-60">}</span><span class="p" data-group-id="2492260709-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2492260709-61">(</span><span class="p" data-group-id="2492260709-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2492260709-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2492260709-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2492260709-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2492260709-64">]</span><span class="w">
        </span><span class="p" data-group-id="2492260709-63">)</span><span class="w">
    </span><span class="p" data-group-id="2492260709-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2492260709-65">(</span><span class="p" data-group-id="2492260709-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2492260709-66">(</span><span class="p" data-group-id="2492260709-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2492260709-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2492260709-68">]</span><span class="p" data-group-id="2492260709-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2492260709-69">(</span><span class="p" data-group-id="2492260709-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2492260709-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2492260709-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2492260709-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2492260709-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2492260709-72">(</span><span class="p" data-group-id="2492260709-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2492260709-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2492260709-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2492260709-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2492260709-76">]</span><span class="p" data-group-id="2492260709-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2492260709-78">(</span><span class="n">H</span><span class="p" data-group-id="2492260709-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2492260709-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2492260709-79">)</span><span class="p" data-group-id="2492260709-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2492260709-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2492260709-81">[</span><span class="p" data-group-id="2492260709-81">]</span><span class="p" data-group-id="2492260709-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2492260709-82">[</span><span class="p" data-group-id="2492260709-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2492260709-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2492260709-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2492260709-84">(</span><span class="p" data-group-id="2492260709-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2492260709-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2492260709-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2492260709-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2492260709-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2492260709-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2492260709-89">(</span><span class="p" data-group-id="2492260709-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2492260709-90">{</span><span class="nf">self</span><span class="p" data-group-id="2492260709-91">(</span><span class="p" data-group-id="2492260709-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2492260709-92">(</span><span class="n">X</span><span class="p" data-group-id="2492260709-92">)</span><span class="p" data-group-id="2492260709-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2492260709-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2492260709-87">]</span><span class="w">
    </span><span class="p" data-group-id="2492260709-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="friendly">
    Friendly Style (friendly)<a class="headerlink" href="#friendly" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-friendly"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">friendly_style</span><span class="p" data-group-id="1991533447-1">(</span><span class="p" data-group-id="1991533447-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="friendly-example.erl">
      example.erl<a class="headerlink" href="#friendly-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-friendly"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0007475191-1">(</span><span class="ss">test</span><span class="p" data-group-id="0007475191-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0007475191-2">(</span><span class="p" data-group-id="0007475191-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0007475191-3">]</span><span class="p" data-group-id="0007475191-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0007475191-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0007475191-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0007475191-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0007475191-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0007475191-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0007475191-9">}</span><span class="p" data-group-id="0007475191-6">]</span><span class="p" data-group-id="0007475191-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0007475191-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0007475191-11">}</span><span class="p" data-group-id="0007475191-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0007475191-12">(</span><span class="n">Port</span><span class="p" data-group-id="0007475191-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0007475191-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0007475191-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0007475191-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0007475191-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0007475191-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-17">[</span><span class="p" data-group-id="0007475191-18">[</span><span class="p" data-group-id="0007475191-18">]</span><span class="p" data-group-id="0007475191-17">]</span><span class="p" data-group-id="0007475191-16">)</span><span class="p" data-group-id="0007475191-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0007475191-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0007475191-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0007475191-20">(</span><span class="n">Players</span><span class="p" data-group-id="0007475191-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0007475191-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-22">[</span><span class="p" data-group-id="0007475191-22">]</span><span class="p" data-group-id="0007475191-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0007475191-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0007475191-24">(</span><span class="n">P</span><span class="p" data-group-id="0007475191-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0007475191-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-26">[</span><span class="n">P</span><span class="p" data-group-id="0007475191-26">]</span><span class="p" data-group-id="0007475191-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0007475191-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0007475191-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0007475191-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0007475191-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0007475191-29">(</span><span class="n">Player</span><span class="p" data-group-id="0007475191-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0007475191-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-31">[</span><span class="n">Player</span><span class="p" data-group-id="0007475191-31">]</span><span class="p" data-group-id="0007475191-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0007475191-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0007475191-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0007475191-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0007475191-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0007475191-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-36">[</span><span class="n">Player</span><span class="p" data-group-id="0007475191-36">]</span><span class="p" data-group-id="0007475191-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0007475191-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0007475191-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0007475191-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0007475191-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0007475191-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0007475191-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0007475191-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0007475191-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0007475191-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0007475191-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0007475191-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0007475191-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0007475191-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0007475191-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0007475191-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0007475191-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0007475191-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0007475191-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0007475191-49">(</span><span class="n">Player</span><span class="p" data-group-id="0007475191-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0007475191-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0007475191-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0007475191-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0007475191-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0007475191-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0007475191-53">(</span><span class="n">P</span><span class="p" data-group-id="0007475191-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0007475191-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0007475191-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0007475191-55">(</span><span class="n">P</span><span class="p" data-group-id="0007475191-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0007475191-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0007475191-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0007475191-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0007475191-57">(</span><span class="p" data-group-id="0007475191-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-58">{</span><span class="p" data-group-id="0007475191-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0007475191-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0007475191-60">}</span><span class="p" data-group-id="0007475191-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0007475191-61">(</span><span class="p" data-group-id="0007475191-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0007475191-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0007475191-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0007475191-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0007475191-64">]</span><span class="w">
        </span><span class="p" data-group-id="0007475191-63">)</span><span class="w">
    </span><span class="p" data-group-id="0007475191-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0007475191-65">(</span><span class="p" data-group-id="0007475191-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0007475191-66">(</span><span class="p" data-group-id="0007475191-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0007475191-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0007475191-68">]</span><span class="p" data-group-id="0007475191-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0007475191-69">(</span><span class="p" data-group-id="0007475191-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0007475191-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0007475191-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0007475191-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0007475191-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0007475191-72">(</span><span class="p" data-group-id="0007475191-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0007475191-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0007475191-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0007475191-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0007475191-76">]</span><span class="p" data-group-id="0007475191-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0007475191-78">(</span><span class="n">H</span><span class="p" data-group-id="0007475191-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0007475191-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0007475191-79">)</span><span class="p" data-group-id="0007475191-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0007475191-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0007475191-81">[</span><span class="p" data-group-id="0007475191-81">]</span><span class="p" data-group-id="0007475191-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0007475191-82">[</span><span class="p" data-group-id="0007475191-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0007475191-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0007475191-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0007475191-84">(</span><span class="p" data-group-id="0007475191-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0007475191-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0007475191-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0007475191-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0007475191-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0007475191-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0007475191-89">(</span><span class="p" data-group-id="0007475191-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0007475191-90">{</span><span class="nf">self</span><span class="p" data-group-id="0007475191-91">(</span><span class="p" data-group-id="0007475191-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0007475191-92">(</span><span class="n">X</span><span class="p" data-group-id="0007475191-92">)</span><span class="p" data-group-id="0007475191-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0007475191-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0007475191-87">]</span><span class="w">
    </span><span class="p" data-group-id="0007475191-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="fruity">
    Fruity Style (fruity)<a class="headerlink" href="#fruity" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-fruity"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">fruity_style</span><span class="p" data-group-id="6084246787-1">(</span><span class="p" data-group-id="6084246787-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="fruity-example.erl">
      example.erl<a class="headerlink" href="#fruity-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-fruity"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4088047479-1">(</span><span class="ss">test</span><span class="p" data-group-id="4088047479-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4088047479-2">(</span><span class="p" data-group-id="4088047479-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4088047479-3">]</span><span class="p" data-group-id="4088047479-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4088047479-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4088047479-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4088047479-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4088047479-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4088047479-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4088047479-9">}</span><span class="p" data-group-id="4088047479-6">]</span><span class="p" data-group-id="4088047479-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4088047479-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4088047479-11">}</span><span class="p" data-group-id="4088047479-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4088047479-12">(</span><span class="n">Port</span><span class="p" data-group-id="4088047479-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4088047479-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4088047479-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4088047479-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4088047479-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4088047479-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-17">[</span><span class="p" data-group-id="4088047479-18">[</span><span class="p" data-group-id="4088047479-18">]</span><span class="p" data-group-id="4088047479-17">]</span><span class="p" data-group-id="4088047479-16">)</span><span class="p" data-group-id="4088047479-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4088047479-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4088047479-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4088047479-20">(</span><span class="n">Players</span><span class="p" data-group-id="4088047479-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4088047479-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-22">[</span><span class="p" data-group-id="4088047479-22">]</span><span class="p" data-group-id="4088047479-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4088047479-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4088047479-24">(</span><span class="n">P</span><span class="p" data-group-id="4088047479-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4088047479-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-26">[</span><span class="n">P</span><span class="p" data-group-id="4088047479-26">]</span><span class="p" data-group-id="4088047479-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4088047479-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4088047479-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4088047479-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4088047479-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4088047479-29">(</span><span class="n">Player</span><span class="p" data-group-id="4088047479-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4088047479-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-31">[</span><span class="n">Player</span><span class="p" data-group-id="4088047479-31">]</span><span class="p" data-group-id="4088047479-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4088047479-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4088047479-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4088047479-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4088047479-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4088047479-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-36">[</span><span class="n">Player</span><span class="p" data-group-id="4088047479-36">]</span><span class="p" data-group-id="4088047479-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4088047479-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4088047479-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4088047479-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4088047479-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4088047479-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4088047479-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4088047479-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4088047479-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4088047479-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4088047479-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4088047479-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4088047479-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4088047479-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4088047479-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4088047479-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4088047479-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4088047479-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4088047479-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4088047479-49">(</span><span class="n">Player</span><span class="p" data-group-id="4088047479-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4088047479-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4088047479-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4088047479-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4088047479-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4088047479-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4088047479-53">(</span><span class="n">P</span><span class="p" data-group-id="4088047479-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4088047479-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4088047479-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4088047479-55">(</span><span class="n">P</span><span class="p" data-group-id="4088047479-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4088047479-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4088047479-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4088047479-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4088047479-57">(</span><span class="p" data-group-id="4088047479-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-58">{</span><span class="p" data-group-id="4088047479-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4088047479-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4088047479-60">}</span><span class="p" data-group-id="4088047479-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4088047479-61">(</span><span class="p" data-group-id="4088047479-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4088047479-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4088047479-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4088047479-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4088047479-64">]</span><span class="w">
        </span><span class="p" data-group-id="4088047479-63">)</span><span class="w">
    </span><span class="p" data-group-id="4088047479-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4088047479-65">(</span><span class="p" data-group-id="4088047479-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4088047479-66">(</span><span class="p" data-group-id="4088047479-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4088047479-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4088047479-68">]</span><span class="p" data-group-id="4088047479-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4088047479-69">(</span><span class="p" data-group-id="4088047479-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4088047479-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4088047479-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4088047479-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4088047479-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4088047479-72">(</span><span class="p" data-group-id="4088047479-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4088047479-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4088047479-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4088047479-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4088047479-76">]</span><span class="p" data-group-id="4088047479-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4088047479-78">(</span><span class="n">H</span><span class="p" data-group-id="4088047479-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4088047479-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4088047479-79">)</span><span class="p" data-group-id="4088047479-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4088047479-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4088047479-81">[</span><span class="p" data-group-id="4088047479-81">]</span><span class="p" data-group-id="4088047479-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4088047479-82">[</span><span class="p" data-group-id="4088047479-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4088047479-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4088047479-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4088047479-84">(</span><span class="p" data-group-id="4088047479-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4088047479-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4088047479-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4088047479-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4088047479-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4088047479-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4088047479-89">(</span><span class="p" data-group-id="4088047479-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4088047479-90">{</span><span class="nf">self</span><span class="p" data-group-id="4088047479-91">(</span><span class="p" data-group-id="4088047479-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4088047479-92">(</span><span class="n">X</span><span class="p" data-group-id="4088047479-92">)</span><span class="p" data-group-id="4088047479-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4088047479-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4088047479-87">]</span><span class="w">
    </span><span class="p" data-group-id="4088047479-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="igor">
    Igor Style (igor)<a class="headerlink" href="#igor" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-igor"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">igor_style</span><span class="p" data-group-id="8541985291-1">(</span><span class="p" data-group-id="8541985291-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="igor-example.erl">
      example.erl<a class="headerlink" href="#igor-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-igor"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8585737776-1">(</span><span class="ss">test</span><span class="p" data-group-id="8585737776-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8585737776-2">(</span><span class="p" data-group-id="8585737776-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8585737776-3">]</span><span class="p" data-group-id="8585737776-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8585737776-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8585737776-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8585737776-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8585737776-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8585737776-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8585737776-9">}</span><span class="p" data-group-id="8585737776-6">]</span><span class="p" data-group-id="8585737776-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8585737776-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8585737776-11">}</span><span class="p" data-group-id="8585737776-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8585737776-12">(</span><span class="n">Port</span><span class="p" data-group-id="8585737776-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8585737776-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8585737776-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8585737776-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8585737776-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8585737776-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-17">[</span><span class="p" data-group-id="8585737776-18">[</span><span class="p" data-group-id="8585737776-18">]</span><span class="p" data-group-id="8585737776-17">]</span><span class="p" data-group-id="8585737776-16">)</span><span class="p" data-group-id="8585737776-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8585737776-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8585737776-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8585737776-20">(</span><span class="n">Players</span><span class="p" data-group-id="8585737776-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8585737776-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-22">[</span><span class="p" data-group-id="8585737776-22">]</span><span class="p" data-group-id="8585737776-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8585737776-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8585737776-24">(</span><span class="n">P</span><span class="p" data-group-id="8585737776-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8585737776-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-26">[</span><span class="n">P</span><span class="p" data-group-id="8585737776-26">]</span><span class="p" data-group-id="8585737776-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8585737776-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8585737776-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8585737776-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8585737776-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8585737776-29">(</span><span class="n">Player</span><span class="p" data-group-id="8585737776-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8585737776-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-31">[</span><span class="n">Player</span><span class="p" data-group-id="8585737776-31">]</span><span class="p" data-group-id="8585737776-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8585737776-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8585737776-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8585737776-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8585737776-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8585737776-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-36">[</span><span class="n">Player</span><span class="p" data-group-id="8585737776-36">]</span><span class="p" data-group-id="8585737776-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8585737776-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8585737776-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8585737776-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8585737776-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8585737776-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8585737776-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8585737776-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8585737776-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8585737776-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8585737776-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8585737776-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8585737776-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8585737776-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8585737776-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8585737776-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8585737776-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8585737776-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8585737776-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8585737776-49">(</span><span class="n">Player</span><span class="p" data-group-id="8585737776-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8585737776-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8585737776-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8585737776-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8585737776-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8585737776-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8585737776-53">(</span><span class="n">P</span><span class="p" data-group-id="8585737776-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8585737776-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8585737776-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8585737776-55">(</span><span class="n">P</span><span class="p" data-group-id="8585737776-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8585737776-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8585737776-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8585737776-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8585737776-57">(</span><span class="p" data-group-id="8585737776-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-58">{</span><span class="p" data-group-id="8585737776-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8585737776-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8585737776-60">}</span><span class="p" data-group-id="8585737776-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8585737776-61">(</span><span class="p" data-group-id="8585737776-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8585737776-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8585737776-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8585737776-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8585737776-64">]</span><span class="w">
        </span><span class="p" data-group-id="8585737776-63">)</span><span class="w">
    </span><span class="p" data-group-id="8585737776-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8585737776-65">(</span><span class="p" data-group-id="8585737776-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8585737776-66">(</span><span class="p" data-group-id="8585737776-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8585737776-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8585737776-68">]</span><span class="p" data-group-id="8585737776-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8585737776-69">(</span><span class="p" data-group-id="8585737776-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8585737776-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8585737776-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8585737776-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8585737776-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8585737776-72">(</span><span class="p" data-group-id="8585737776-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8585737776-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8585737776-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8585737776-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8585737776-76">]</span><span class="p" data-group-id="8585737776-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8585737776-78">(</span><span class="n">H</span><span class="p" data-group-id="8585737776-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8585737776-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8585737776-79">)</span><span class="p" data-group-id="8585737776-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8585737776-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8585737776-81">[</span><span class="p" data-group-id="8585737776-81">]</span><span class="p" data-group-id="8585737776-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8585737776-82">[</span><span class="p" data-group-id="8585737776-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8585737776-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8585737776-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8585737776-84">(</span><span class="p" data-group-id="8585737776-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8585737776-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8585737776-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8585737776-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8585737776-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8585737776-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8585737776-89">(</span><span class="p" data-group-id="8585737776-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8585737776-90">{</span><span class="nf">self</span><span class="p" data-group-id="8585737776-91">(</span><span class="p" data-group-id="8585737776-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8585737776-92">(</span><span class="n">X</span><span class="p" data-group-id="8585737776-92">)</span><span class="p" data-group-id="8585737776-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8585737776-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8585737776-87">]</span><span class="w">
    </span><span class="p" data-group-id="8585737776-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="lovelace">
    Lovelace Style (lovelace)<a class="headerlink" href="#lovelace" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-lovelace"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">lovelace_style</span><span class="p" data-group-id="9291338371-1">(</span><span class="p" data-group-id="9291338371-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="lovelace-example.erl">
      example.erl<a class="headerlink" href="#lovelace-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-lovelace"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4938782507-1">(</span><span class="ss">test</span><span class="p" data-group-id="4938782507-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4938782507-2">(</span><span class="p" data-group-id="4938782507-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4938782507-3">]</span><span class="p" data-group-id="4938782507-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4938782507-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4938782507-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4938782507-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4938782507-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4938782507-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4938782507-9">}</span><span class="p" data-group-id="4938782507-6">]</span><span class="p" data-group-id="4938782507-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4938782507-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4938782507-11">}</span><span class="p" data-group-id="4938782507-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4938782507-12">(</span><span class="n">Port</span><span class="p" data-group-id="4938782507-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4938782507-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4938782507-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4938782507-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4938782507-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4938782507-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-17">[</span><span class="p" data-group-id="4938782507-18">[</span><span class="p" data-group-id="4938782507-18">]</span><span class="p" data-group-id="4938782507-17">]</span><span class="p" data-group-id="4938782507-16">)</span><span class="p" data-group-id="4938782507-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4938782507-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4938782507-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4938782507-20">(</span><span class="n">Players</span><span class="p" data-group-id="4938782507-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4938782507-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-22">[</span><span class="p" data-group-id="4938782507-22">]</span><span class="p" data-group-id="4938782507-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4938782507-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4938782507-24">(</span><span class="n">P</span><span class="p" data-group-id="4938782507-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4938782507-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-26">[</span><span class="n">P</span><span class="p" data-group-id="4938782507-26">]</span><span class="p" data-group-id="4938782507-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4938782507-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4938782507-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4938782507-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4938782507-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4938782507-29">(</span><span class="n">Player</span><span class="p" data-group-id="4938782507-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4938782507-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-31">[</span><span class="n">Player</span><span class="p" data-group-id="4938782507-31">]</span><span class="p" data-group-id="4938782507-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4938782507-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4938782507-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4938782507-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4938782507-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4938782507-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-36">[</span><span class="n">Player</span><span class="p" data-group-id="4938782507-36">]</span><span class="p" data-group-id="4938782507-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4938782507-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4938782507-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4938782507-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4938782507-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4938782507-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4938782507-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4938782507-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4938782507-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4938782507-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4938782507-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4938782507-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4938782507-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4938782507-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4938782507-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4938782507-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4938782507-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4938782507-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4938782507-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4938782507-49">(</span><span class="n">Player</span><span class="p" data-group-id="4938782507-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4938782507-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4938782507-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4938782507-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4938782507-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4938782507-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4938782507-53">(</span><span class="n">P</span><span class="p" data-group-id="4938782507-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4938782507-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4938782507-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4938782507-55">(</span><span class="n">P</span><span class="p" data-group-id="4938782507-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4938782507-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4938782507-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4938782507-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4938782507-57">(</span><span class="p" data-group-id="4938782507-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-58">{</span><span class="p" data-group-id="4938782507-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4938782507-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4938782507-60">}</span><span class="p" data-group-id="4938782507-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4938782507-61">(</span><span class="p" data-group-id="4938782507-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4938782507-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4938782507-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4938782507-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4938782507-64">]</span><span class="w">
        </span><span class="p" data-group-id="4938782507-63">)</span><span class="w">
    </span><span class="p" data-group-id="4938782507-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4938782507-65">(</span><span class="p" data-group-id="4938782507-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4938782507-66">(</span><span class="p" data-group-id="4938782507-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4938782507-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4938782507-68">]</span><span class="p" data-group-id="4938782507-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4938782507-69">(</span><span class="p" data-group-id="4938782507-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4938782507-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4938782507-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4938782507-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4938782507-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4938782507-72">(</span><span class="p" data-group-id="4938782507-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4938782507-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4938782507-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4938782507-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4938782507-76">]</span><span class="p" data-group-id="4938782507-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4938782507-78">(</span><span class="n">H</span><span class="p" data-group-id="4938782507-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4938782507-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4938782507-79">)</span><span class="p" data-group-id="4938782507-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4938782507-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4938782507-81">[</span><span class="p" data-group-id="4938782507-81">]</span><span class="p" data-group-id="4938782507-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4938782507-82">[</span><span class="p" data-group-id="4938782507-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4938782507-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4938782507-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4938782507-84">(</span><span class="p" data-group-id="4938782507-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4938782507-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4938782507-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4938782507-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4938782507-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4938782507-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4938782507-89">(</span><span class="p" data-group-id="4938782507-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4938782507-90">{</span><span class="nf">self</span><span class="p" data-group-id="4938782507-91">(</span><span class="p" data-group-id="4938782507-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4938782507-92">(</span><span class="n">X</span><span class="p" data-group-id="4938782507-92">)</span><span class="p" data-group-id="4938782507-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4938782507-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4938782507-87">]</span><span class="w">
    </span><span class="p" data-group-id="4938782507-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="manni">
    Manni Style (manni)<a class="headerlink" href="#manni" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-manni"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">manni_style</span><span class="p" data-group-id="7747314067-1">(</span><span class="p" data-group-id="7747314067-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="manni-example.erl">
      example.erl<a class="headerlink" href="#manni-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-manni"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1631247216-1">(</span><span class="ss">test</span><span class="p" data-group-id="1631247216-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1631247216-2">(</span><span class="p" data-group-id="1631247216-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1631247216-3">]</span><span class="p" data-group-id="1631247216-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1631247216-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1631247216-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1631247216-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1631247216-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1631247216-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1631247216-9">}</span><span class="p" data-group-id="1631247216-6">]</span><span class="p" data-group-id="1631247216-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1631247216-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1631247216-11">}</span><span class="p" data-group-id="1631247216-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1631247216-12">(</span><span class="n">Port</span><span class="p" data-group-id="1631247216-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1631247216-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1631247216-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1631247216-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1631247216-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1631247216-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-17">[</span><span class="p" data-group-id="1631247216-18">[</span><span class="p" data-group-id="1631247216-18">]</span><span class="p" data-group-id="1631247216-17">]</span><span class="p" data-group-id="1631247216-16">)</span><span class="p" data-group-id="1631247216-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1631247216-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1631247216-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1631247216-20">(</span><span class="n">Players</span><span class="p" data-group-id="1631247216-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1631247216-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-22">[</span><span class="p" data-group-id="1631247216-22">]</span><span class="p" data-group-id="1631247216-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1631247216-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1631247216-24">(</span><span class="n">P</span><span class="p" data-group-id="1631247216-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1631247216-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-26">[</span><span class="n">P</span><span class="p" data-group-id="1631247216-26">]</span><span class="p" data-group-id="1631247216-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1631247216-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1631247216-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1631247216-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1631247216-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1631247216-29">(</span><span class="n">Player</span><span class="p" data-group-id="1631247216-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1631247216-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-31">[</span><span class="n">Player</span><span class="p" data-group-id="1631247216-31">]</span><span class="p" data-group-id="1631247216-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1631247216-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1631247216-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1631247216-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1631247216-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1631247216-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-36">[</span><span class="n">Player</span><span class="p" data-group-id="1631247216-36">]</span><span class="p" data-group-id="1631247216-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1631247216-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1631247216-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1631247216-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1631247216-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1631247216-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1631247216-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1631247216-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1631247216-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1631247216-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1631247216-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1631247216-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1631247216-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1631247216-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1631247216-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1631247216-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1631247216-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1631247216-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1631247216-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1631247216-49">(</span><span class="n">Player</span><span class="p" data-group-id="1631247216-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1631247216-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1631247216-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1631247216-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1631247216-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1631247216-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1631247216-53">(</span><span class="n">P</span><span class="p" data-group-id="1631247216-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1631247216-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1631247216-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1631247216-55">(</span><span class="n">P</span><span class="p" data-group-id="1631247216-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1631247216-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1631247216-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1631247216-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1631247216-57">(</span><span class="p" data-group-id="1631247216-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-58">{</span><span class="p" data-group-id="1631247216-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1631247216-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1631247216-60">}</span><span class="p" data-group-id="1631247216-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1631247216-61">(</span><span class="p" data-group-id="1631247216-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1631247216-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1631247216-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1631247216-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1631247216-64">]</span><span class="w">
        </span><span class="p" data-group-id="1631247216-63">)</span><span class="w">
    </span><span class="p" data-group-id="1631247216-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1631247216-65">(</span><span class="p" data-group-id="1631247216-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1631247216-66">(</span><span class="p" data-group-id="1631247216-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1631247216-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1631247216-68">]</span><span class="p" data-group-id="1631247216-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1631247216-69">(</span><span class="p" data-group-id="1631247216-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1631247216-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1631247216-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1631247216-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1631247216-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1631247216-72">(</span><span class="p" data-group-id="1631247216-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1631247216-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1631247216-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1631247216-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1631247216-76">]</span><span class="p" data-group-id="1631247216-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1631247216-78">(</span><span class="n">H</span><span class="p" data-group-id="1631247216-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1631247216-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1631247216-79">)</span><span class="p" data-group-id="1631247216-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1631247216-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1631247216-81">[</span><span class="p" data-group-id="1631247216-81">]</span><span class="p" data-group-id="1631247216-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1631247216-82">[</span><span class="p" data-group-id="1631247216-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1631247216-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1631247216-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1631247216-84">(</span><span class="p" data-group-id="1631247216-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1631247216-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1631247216-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1631247216-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1631247216-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1631247216-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1631247216-89">(</span><span class="p" data-group-id="1631247216-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1631247216-90">{</span><span class="nf">self</span><span class="p" data-group-id="1631247216-91">(</span><span class="p" data-group-id="1631247216-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1631247216-92">(</span><span class="n">X</span><span class="p" data-group-id="1631247216-92">)</span><span class="p" data-group-id="1631247216-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1631247216-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1631247216-87">]</span><span class="w">
    </span><span class="p" data-group-id="1631247216-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="monokai">
    Monokai Style (monokai)<a class="headerlink" href="#monokai" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-monokai"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">monokai_style</span><span class="p" data-group-id="5359755113-1">(</span><span class="p" data-group-id="5359755113-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="monokai-example.erl">
      example.erl<a class="headerlink" href="#monokai-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-monokai"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1356487927-1">(</span><span class="ss">test</span><span class="p" data-group-id="1356487927-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1356487927-2">(</span><span class="p" data-group-id="1356487927-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1356487927-3">]</span><span class="p" data-group-id="1356487927-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1356487927-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1356487927-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1356487927-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1356487927-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1356487927-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1356487927-9">}</span><span class="p" data-group-id="1356487927-6">]</span><span class="p" data-group-id="1356487927-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1356487927-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1356487927-11">}</span><span class="p" data-group-id="1356487927-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1356487927-12">(</span><span class="n">Port</span><span class="p" data-group-id="1356487927-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1356487927-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1356487927-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1356487927-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1356487927-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1356487927-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-17">[</span><span class="p" data-group-id="1356487927-18">[</span><span class="p" data-group-id="1356487927-18">]</span><span class="p" data-group-id="1356487927-17">]</span><span class="p" data-group-id="1356487927-16">)</span><span class="p" data-group-id="1356487927-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1356487927-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1356487927-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1356487927-20">(</span><span class="n">Players</span><span class="p" data-group-id="1356487927-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1356487927-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-22">[</span><span class="p" data-group-id="1356487927-22">]</span><span class="p" data-group-id="1356487927-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1356487927-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1356487927-24">(</span><span class="n">P</span><span class="p" data-group-id="1356487927-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1356487927-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-26">[</span><span class="n">P</span><span class="p" data-group-id="1356487927-26">]</span><span class="p" data-group-id="1356487927-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1356487927-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1356487927-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1356487927-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1356487927-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1356487927-29">(</span><span class="n">Player</span><span class="p" data-group-id="1356487927-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1356487927-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-31">[</span><span class="n">Player</span><span class="p" data-group-id="1356487927-31">]</span><span class="p" data-group-id="1356487927-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1356487927-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1356487927-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1356487927-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1356487927-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1356487927-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-36">[</span><span class="n">Player</span><span class="p" data-group-id="1356487927-36">]</span><span class="p" data-group-id="1356487927-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1356487927-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1356487927-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1356487927-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1356487927-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1356487927-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1356487927-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1356487927-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1356487927-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1356487927-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1356487927-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1356487927-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1356487927-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1356487927-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1356487927-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1356487927-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1356487927-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1356487927-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1356487927-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1356487927-49">(</span><span class="n">Player</span><span class="p" data-group-id="1356487927-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1356487927-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1356487927-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1356487927-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1356487927-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1356487927-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1356487927-53">(</span><span class="n">P</span><span class="p" data-group-id="1356487927-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1356487927-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1356487927-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1356487927-55">(</span><span class="n">P</span><span class="p" data-group-id="1356487927-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1356487927-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1356487927-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1356487927-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1356487927-57">(</span><span class="p" data-group-id="1356487927-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-58">{</span><span class="p" data-group-id="1356487927-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1356487927-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1356487927-60">}</span><span class="p" data-group-id="1356487927-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1356487927-61">(</span><span class="p" data-group-id="1356487927-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1356487927-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1356487927-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1356487927-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1356487927-64">]</span><span class="w">
        </span><span class="p" data-group-id="1356487927-63">)</span><span class="w">
    </span><span class="p" data-group-id="1356487927-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1356487927-65">(</span><span class="p" data-group-id="1356487927-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1356487927-66">(</span><span class="p" data-group-id="1356487927-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1356487927-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1356487927-68">]</span><span class="p" data-group-id="1356487927-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1356487927-69">(</span><span class="p" data-group-id="1356487927-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1356487927-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1356487927-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1356487927-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1356487927-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1356487927-72">(</span><span class="p" data-group-id="1356487927-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1356487927-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1356487927-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1356487927-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1356487927-76">]</span><span class="p" data-group-id="1356487927-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1356487927-78">(</span><span class="n">H</span><span class="p" data-group-id="1356487927-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1356487927-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1356487927-79">)</span><span class="p" data-group-id="1356487927-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1356487927-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1356487927-81">[</span><span class="p" data-group-id="1356487927-81">]</span><span class="p" data-group-id="1356487927-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1356487927-82">[</span><span class="p" data-group-id="1356487927-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1356487927-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1356487927-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1356487927-84">(</span><span class="p" data-group-id="1356487927-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1356487927-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1356487927-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1356487927-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1356487927-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1356487927-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1356487927-89">(</span><span class="p" data-group-id="1356487927-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1356487927-90">{</span><span class="nf">self</span><span class="p" data-group-id="1356487927-91">(</span><span class="p" data-group-id="1356487927-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1356487927-92">(</span><span class="n">X</span><span class="p" data-group-id="1356487927-92">)</span><span class="p" data-group-id="1356487927-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1356487927-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1356487927-87">]</span><span class="w">
    </span><span class="p" data-group-id="1356487927-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="murphy">
    Murphy Style (murphy)<a class="headerlink" href="#murphy" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-murphy"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">murphy_style</span><span class="p" data-group-id="1133081514-1">(</span><span class="p" data-group-id="1133081514-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="murphy-example.erl">
      example.erl<a class="headerlink" href="#murphy-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-murphy"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7855177124-1">(</span><span class="ss">test</span><span class="p" data-group-id="7855177124-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7855177124-2">(</span><span class="p" data-group-id="7855177124-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7855177124-3">]</span><span class="p" data-group-id="7855177124-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7855177124-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7855177124-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7855177124-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7855177124-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7855177124-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7855177124-9">}</span><span class="p" data-group-id="7855177124-6">]</span><span class="p" data-group-id="7855177124-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7855177124-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7855177124-11">}</span><span class="p" data-group-id="7855177124-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7855177124-12">(</span><span class="n">Port</span><span class="p" data-group-id="7855177124-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7855177124-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7855177124-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7855177124-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7855177124-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7855177124-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-17">[</span><span class="p" data-group-id="7855177124-18">[</span><span class="p" data-group-id="7855177124-18">]</span><span class="p" data-group-id="7855177124-17">]</span><span class="p" data-group-id="7855177124-16">)</span><span class="p" data-group-id="7855177124-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7855177124-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7855177124-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7855177124-20">(</span><span class="n">Players</span><span class="p" data-group-id="7855177124-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7855177124-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-22">[</span><span class="p" data-group-id="7855177124-22">]</span><span class="p" data-group-id="7855177124-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7855177124-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7855177124-24">(</span><span class="n">P</span><span class="p" data-group-id="7855177124-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7855177124-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-26">[</span><span class="n">P</span><span class="p" data-group-id="7855177124-26">]</span><span class="p" data-group-id="7855177124-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7855177124-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7855177124-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7855177124-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7855177124-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7855177124-29">(</span><span class="n">Player</span><span class="p" data-group-id="7855177124-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7855177124-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-31">[</span><span class="n">Player</span><span class="p" data-group-id="7855177124-31">]</span><span class="p" data-group-id="7855177124-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7855177124-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7855177124-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7855177124-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7855177124-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7855177124-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-36">[</span><span class="n">Player</span><span class="p" data-group-id="7855177124-36">]</span><span class="p" data-group-id="7855177124-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7855177124-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7855177124-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7855177124-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7855177124-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7855177124-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7855177124-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7855177124-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7855177124-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7855177124-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7855177124-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7855177124-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7855177124-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7855177124-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7855177124-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7855177124-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7855177124-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7855177124-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7855177124-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7855177124-49">(</span><span class="n">Player</span><span class="p" data-group-id="7855177124-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7855177124-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7855177124-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7855177124-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7855177124-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7855177124-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7855177124-53">(</span><span class="n">P</span><span class="p" data-group-id="7855177124-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7855177124-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7855177124-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7855177124-55">(</span><span class="n">P</span><span class="p" data-group-id="7855177124-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7855177124-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7855177124-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7855177124-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7855177124-57">(</span><span class="p" data-group-id="7855177124-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-58">{</span><span class="p" data-group-id="7855177124-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7855177124-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7855177124-60">}</span><span class="p" data-group-id="7855177124-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7855177124-61">(</span><span class="p" data-group-id="7855177124-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7855177124-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7855177124-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7855177124-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7855177124-64">]</span><span class="w">
        </span><span class="p" data-group-id="7855177124-63">)</span><span class="w">
    </span><span class="p" data-group-id="7855177124-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7855177124-65">(</span><span class="p" data-group-id="7855177124-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7855177124-66">(</span><span class="p" data-group-id="7855177124-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7855177124-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7855177124-68">]</span><span class="p" data-group-id="7855177124-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7855177124-69">(</span><span class="p" data-group-id="7855177124-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7855177124-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7855177124-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7855177124-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7855177124-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7855177124-72">(</span><span class="p" data-group-id="7855177124-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7855177124-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7855177124-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7855177124-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7855177124-76">]</span><span class="p" data-group-id="7855177124-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7855177124-78">(</span><span class="n">H</span><span class="p" data-group-id="7855177124-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7855177124-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7855177124-79">)</span><span class="p" data-group-id="7855177124-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7855177124-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7855177124-81">[</span><span class="p" data-group-id="7855177124-81">]</span><span class="p" data-group-id="7855177124-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7855177124-82">[</span><span class="p" data-group-id="7855177124-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7855177124-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7855177124-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7855177124-84">(</span><span class="p" data-group-id="7855177124-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7855177124-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7855177124-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7855177124-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7855177124-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7855177124-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7855177124-89">(</span><span class="p" data-group-id="7855177124-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7855177124-90">{</span><span class="nf">self</span><span class="p" data-group-id="7855177124-91">(</span><span class="p" data-group-id="7855177124-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7855177124-92">(</span><span class="n">X</span><span class="p" data-group-id="7855177124-92">)</span><span class="p" data-group-id="7855177124-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7855177124-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7855177124-87">]</span><span class="w">
    </span><span class="p" data-group-id="7855177124-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="native">
    Native Style (native)<a class="headerlink" href="#native" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-native"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">native_style</span><span class="p" data-group-id="9629076066-1">(</span><span class="p" data-group-id="9629076066-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="native-example.erl">
      example.erl<a class="headerlink" href="#native-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-native"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3802400313-1">(</span><span class="ss">test</span><span class="p" data-group-id="3802400313-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3802400313-2">(</span><span class="p" data-group-id="3802400313-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="3802400313-3">]</span><span class="p" data-group-id="3802400313-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="3802400313-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="3802400313-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="3802400313-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3802400313-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3802400313-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3802400313-9">}</span><span class="p" data-group-id="3802400313-6">]</span><span class="p" data-group-id="3802400313-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="3802400313-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="3802400313-11">}</span><span class="p" data-group-id="3802400313-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="3802400313-12">(</span><span class="n">Port</span><span class="p" data-group-id="3802400313-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="3802400313-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="3802400313-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="3802400313-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="3802400313-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="3802400313-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-17">[</span><span class="p" data-group-id="3802400313-18">[</span><span class="p" data-group-id="3802400313-18">]</span><span class="p" data-group-id="3802400313-17">]</span><span class="p" data-group-id="3802400313-16">)</span><span class="p" data-group-id="3802400313-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="3802400313-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="3802400313-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="3802400313-20">(</span><span class="n">Players</span><span class="p" data-group-id="3802400313-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3802400313-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-22">[</span><span class="p" data-group-id="3802400313-22">]</span><span class="p" data-group-id="3802400313-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3802400313-23">(</span><span class="nf">fun</span><span class="p" data-group-id="3802400313-24">(</span><span class="n">P</span><span class="p" data-group-id="3802400313-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3802400313-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-26">[</span><span class="n">P</span><span class="p" data-group-id="3802400313-26">]</span><span class="p" data-group-id="3802400313-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3802400313-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3802400313-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="3802400313-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="3802400313-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3802400313-29">(</span><span class="n">Player</span><span class="p" data-group-id="3802400313-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3802400313-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-31">[</span><span class="n">Player</span><span class="p" data-group-id="3802400313-31">]</span><span class="p" data-group-id="3802400313-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3802400313-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3802400313-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3802400313-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3802400313-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3802400313-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-36">[</span><span class="n">Player</span><span class="p" data-group-id="3802400313-36">]</span><span class="p" data-group-id="3802400313-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="3802400313-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3802400313-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3802400313-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3802400313-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="3802400313-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3802400313-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3802400313-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="3802400313-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3802400313-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="3802400313-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="3802400313-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="3802400313-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="3802400313-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="3802400313-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="3802400313-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="3802400313-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="3802400313-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3802400313-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="3802400313-49">(</span><span class="n">Player</span><span class="p" data-group-id="3802400313-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3802400313-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="3802400313-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="3802400313-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3802400313-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="3802400313-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3802400313-53">(</span><span class="n">P</span><span class="p" data-group-id="3802400313-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="3802400313-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3802400313-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3802400313-55">(</span><span class="n">P</span><span class="p" data-group-id="3802400313-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3802400313-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3802400313-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="3802400313-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="3802400313-57">(</span><span class="p" data-group-id="3802400313-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-58">{</span><span class="p" data-group-id="3802400313-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="3802400313-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3802400313-60">}</span><span class="p" data-group-id="3802400313-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="3802400313-61">(</span><span class="p" data-group-id="3802400313-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="3802400313-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3802400313-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3802400313-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3802400313-64">]</span><span class="w">
        </span><span class="p" data-group-id="3802400313-63">)</span><span class="w">
    </span><span class="p" data-group-id="3802400313-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="3802400313-65">(</span><span class="p" data-group-id="3802400313-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="3802400313-66">(</span><span class="p" data-group-id="3802400313-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3802400313-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3802400313-68">]</span><span class="p" data-group-id="3802400313-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="3802400313-69">(</span><span class="p" data-group-id="3802400313-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3802400313-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3802400313-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="3802400313-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="3802400313-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="3802400313-72">(</span><span class="p" data-group-id="3802400313-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="3802400313-74">{</span><span class="ss">fff</span><span class="p" data-group-id="3802400313-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="3802400313-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3802400313-76">]</span><span class="p" data-group-id="3802400313-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-77">[</span><span class="n">Fun</span><span class="p" data-group-id="3802400313-78">(</span><span class="n">H</span><span class="p" data-group-id="3802400313-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3802400313-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3802400313-79">)</span><span class="p" data-group-id="3802400313-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="3802400313-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3802400313-81">[</span><span class="p" data-group-id="3802400313-81">]</span><span class="p" data-group-id="3802400313-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3802400313-82">[</span><span class="p" data-group-id="3802400313-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="3802400313-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="3802400313-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="3802400313-84">(</span><span class="p" data-group-id="3802400313-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3802400313-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="3802400313-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="3802400313-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3802400313-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="3802400313-88">(</span><span class="nf">fun</span><span class="p" data-group-id="3802400313-89">(</span><span class="p" data-group-id="3802400313-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3802400313-90">{</span><span class="nf">self</span><span class="p" data-group-id="3802400313-91">(</span><span class="p" data-group-id="3802400313-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="3802400313-92">(</span><span class="n">X</span><span class="p" data-group-id="3802400313-92">)</span><span class="p" data-group-id="3802400313-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="3802400313-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="3802400313-87">]</span><span class="w">
    </span><span class="p" data-group-id="3802400313-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_dark">
    ParaisoDark Style (paraiso_dark)<a class="headerlink" href="#paraiso_dark" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_dark"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_dark_style</span><span class="p" data-group-id="3375796067-1">(</span><span class="p" data-group-id="3375796067-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_dark-example.erl">
      example.erl<a class="headerlink" href="#paraiso_dark-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_dark"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5589758057-1">(</span><span class="ss">test</span><span class="p" data-group-id="5589758057-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5589758057-2">(</span><span class="p" data-group-id="5589758057-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5589758057-3">]</span><span class="p" data-group-id="5589758057-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5589758057-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5589758057-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5589758057-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5589758057-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5589758057-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5589758057-9">}</span><span class="p" data-group-id="5589758057-6">]</span><span class="p" data-group-id="5589758057-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5589758057-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5589758057-11">}</span><span class="p" data-group-id="5589758057-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5589758057-12">(</span><span class="n">Port</span><span class="p" data-group-id="5589758057-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5589758057-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5589758057-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5589758057-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5589758057-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5589758057-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-17">[</span><span class="p" data-group-id="5589758057-18">[</span><span class="p" data-group-id="5589758057-18">]</span><span class="p" data-group-id="5589758057-17">]</span><span class="p" data-group-id="5589758057-16">)</span><span class="p" data-group-id="5589758057-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5589758057-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5589758057-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5589758057-20">(</span><span class="n">Players</span><span class="p" data-group-id="5589758057-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5589758057-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-22">[</span><span class="p" data-group-id="5589758057-22">]</span><span class="p" data-group-id="5589758057-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5589758057-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5589758057-24">(</span><span class="n">P</span><span class="p" data-group-id="5589758057-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5589758057-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-26">[</span><span class="n">P</span><span class="p" data-group-id="5589758057-26">]</span><span class="p" data-group-id="5589758057-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5589758057-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5589758057-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5589758057-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5589758057-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5589758057-29">(</span><span class="n">Player</span><span class="p" data-group-id="5589758057-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5589758057-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-31">[</span><span class="n">Player</span><span class="p" data-group-id="5589758057-31">]</span><span class="p" data-group-id="5589758057-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5589758057-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5589758057-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5589758057-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5589758057-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5589758057-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-36">[</span><span class="n">Player</span><span class="p" data-group-id="5589758057-36">]</span><span class="p" data-group-id="5589758057-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5589758057-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5589758057-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5589758057-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5589758057-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5589758057-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5589758057-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5589758057-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5589758057-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5589758057-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5589758057-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5589758057-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5589758057-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5589758057-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5589758057-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5589758057-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5589758057-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5589758057-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5589758057-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5589758057-49">(</span><span class="n">Player</span><span class="p" data-group-id="5589758057-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5589758057-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5589758057-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5589758057-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5589758057-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5589758057-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5589758057-53">(</span><span class="n">P</span><span class="p" data-group-id="5589758057-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5589758057-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5589758057-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5589758057-55">(</span><span class="n">P</span><span class="p" data-group-id="5589758057-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5589758057-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5589758057-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5589758057-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5589758057-57">(</span><span class="p" data-group-id="5589758057-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-58">{</span><span class="p" data-group-id="5589758057-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5589758057-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5589758057-60">}</span><span class="p" data-group-id="5589758057-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5589758057-61">(</span><span class="p" data-group-id="5589758057-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5589758057-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5589758057-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5589758057-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5589758057-64">]</span><span class="w">
        </span><span class="p" data-group-id="5589758057-63">)</span><span class="w">
    </span><span class="p" data-group-id="5589758057-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5589758057-65">(</span><span class="p" data-group-id="5589758057-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5589758057-66">(</span><span class="p" data-group-id="5589758057-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5589758057-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5589758057-68">]</span><span class="p" data-group-id="5589758057-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5589758057-69">(</span><span class="p" data-group-id="5589758057-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5589758057-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5589758057-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5589758057-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5589758057-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5589758057-72">(</span><span class="p" data-group-id="5589758057-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5589758057-74">{</span><span class="ss">fff</span><span class="p" data-group-id="5589758057-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5589758057-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5589758057-76">]</span><span class="p" data-group-id="5589758057-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-77">[</span><span class="n">Fun</span><span class="p" data-group-id="5589758057-78">(</span><span class="n">H</span><span class="p" data-group-id="5589758057-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5589758057-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5589758057-79">)</span><span class="p" data-group-id="5589758057-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5589758057-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5589758057-81">[</span><span class="p" data-group-id="5589758057-81">]</span><span class="p" data-group-id="5589758057-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5589758057-82">[</span><span class="p" data-group-id="5589758057-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5589758057-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5589758057-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5589758057-84">(</span><span class="p" data-group-id="5589758057-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5589758057-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5589758057-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5589758057-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5589758057-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5589758057-88">(</span><span class="nf">fun</span><span class="p" data-group-id="5589758057-89">(</span><span class="p" data-group-id="5589758057-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5589758057-90">{</span><span class="nf">self</span><span class="p" data-group-id="5589758057-91">(</span><span class="p" data-group-id="5589758057-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5589758057-92">(</span><span class="n">X</span><span class="p" data-group-id="5589758057-92">)</span><span class="p" data-group-id="5589758057-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5589758057-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5589758057-87">]</span><span class="w">
    </span><span class="p" data-group-id="5589758057-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_light">
    ParaisoLight Style (paraiso_light)<a class="headerlink" href="#paraiso_light" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_light"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_light_style</span><span class="p" data-group-id="6958857094-1">(</span><span class="p" data-group-id="6958857094-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_light-example.erl">
      example.erl<a class="headerlink" href="#paraiso_light-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_light"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8261827279-1">(</span><span class="ss">test</span><span class="p" data-group-id="8261827279-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8261827279-2">(</span><span class="p" data-group-id="8261827279-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8261827279-3">]</span><span class="p" data-group-id="8261827279-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8261827279-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8261827279-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8261827279-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8261827279-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8261827279-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8261827279-9">}</span><span class="p" data-group-id="8261827279-6">]</span><span class="p" data-group-id="8261827279-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8261827279-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8261827279-11">}</span><span class="p" data-group-id="8261827279-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8261827279-12">(</span><span class="n">Port</span><span class="p" data-group-id="8261827279-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8261827279-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8261827279-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8261827279-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8261827279-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8261827279-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-17">[</span><span class="p" data-group-id="8261827279-18">[</span><span class="p" data-group-id="8261827279-18">]</span><span class="p" data-group-id="8261827279-17">]</span><span class="p" data-group-id="8261827279-16">)</span><span class="p" data-group-id="8261827279-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8261827279-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8261827279-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8261827279-20">(</span><span class="n">Players</span><span class="p" data-group-id="8261827279-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8261827279-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-22">[</span><span class="p" data-group-id="8261827279-22">]</span><span class="p" data-group-id="8261827279-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8261827279-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8261827279-24">(</span><span class="n">P</span><span class="p" data-group-id="8261827279-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8261827279-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-26">[</span><span class="n">P</span><span class="p" data-group-id="8261827279-26">]</span><span class="p" data-group-id="8261827279-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8261827279-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8261827279-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8261827279-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8261827279-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8261827279-29">(</span><span class="n">Player</span><span class="p" data-group-id="8261827279-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8261827279-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-31">[</span><span class="n">Player</span><span class="p" data-group-id="8261827279-31">]</span><span class="p" data-group-id="8261827279-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8261827279-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8261827279-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8261827279-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8261827279-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8261827279-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-36">[</span><span class="n">Player</span><span class="p" data-group-id="8261827279-36">]</span><span class="p" data-group-id="8261827279-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8261827279-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8261827279-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8261827279-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8261827279-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8261827279-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8261827279-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8261827279-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8261827279-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8261827279-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8261827279-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8261827279-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8261827279-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8261827279-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8261827279-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8261827279-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8261827279-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8261827279-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8261827279-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8261827279-49">(</span><span class="n">Player</span><span class="p" data-group-id="8261827279-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8261827279-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8261827279-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8261827279-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8261827279-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8261827279-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8261827279-53">(</span><span class="n">P</span><span class="p" data-group-id="8261827279-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8261827279-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8261827279-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8261827279-55">(</span><span class="n">P</span><span class="p" data-group-id="8261827279-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8261827279-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8261827279-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8261827279-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8261827279-57">(</span><span class="p" data-group-id="8261827279-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-58">{</span><span class="p" data-group-id="8261827279-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8261827279-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8261827279-60">}</span><span class="p" data-group-id="8261827279-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8261827279-61">(</span><span class="p" data-group-id="8261827279-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8261827279-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8261827279-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8261827279-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8261827279-64">]</span><span class="w">
        </span><span class="p" data-group-id="8261827279-63">)</span><span class="w">
    </span><span class="p" data-group-id="8261827279-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8261827279-65">(</span><span class="p" data-group-id="8261827279-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8261827279-66">(</span><span class="p" data-group-id="8261827279-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8261827279-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8261827279-68">]</span><span class="p" data-group-id="8261827279-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8261827279-69">(</span><span class="p" data-group-id="8261827279-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8261827279-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8261827279-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8261827279-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8261827279-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8261827279-72">(</span><span class="p" data-group-id="8261827279-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8261827279-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8261827279-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8261827279-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8261827279-76">]</span><span class="p" data-group-id="8261827279-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8261827279-78">(</span><span class="n">H</span><span class="p" data-group-id="8261827279-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8261827279-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8261827279-79">)</span><span class="p" data-group-id="8261827279-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8261827279-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8261827279-81">[</span><span class="p" data-group-id="8261827279-81">]</span><span class="p" data-group-id="8261827279-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8261827279-82">[</span><span class="p" data-group-id="8261827279-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8261827279-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8261827279-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8261827279-84">(</span><span class="p" data-group-id="8261827279-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8261827279-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8261827279-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8261827279-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8261827279-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8261827279-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8261827279-89">(</span><span class="p" data-group-id="8261827279-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8261827279-90">{</span><span class="nf">self</span><span class="p" data-group-id="8261827279-91">(</span><span class="p" data-group-id="8261827279-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8261827279-92">(</span><span class="n">X</span><span class="p" data-group-id="8261827279-92">)</span><span class="p" data-group-id="8261827279-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8261827279-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8261827279-87">]</span><span class="w">
    </span><span class="p" data-group-id="8261827279-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="pastie">
    Pastie Style (pastie)<a class="headerlink" href="#pastie" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-pastie"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">pastie_style</span><span class="p" data-group-id="4442722610-1">(</span><span class="p" data-group-id="4442722610-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="pastie-example.erl">
      example.erl<a class="headerlink" href="#pastie-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-pastie"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2674060167-1">(</span><span class="ss">test</span><span class="p" data-group-id="2674060167-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2674060167-2">(</span><span class="p" data-group-id="2674060167-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2674060167-3">]</span><span class="p" data-group-id="2674060167-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2674060167-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2674060167-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2674060167-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2674060167-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2674060167-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2674060167-9">}</span><span class="p" data-group-id="2674060167-6">]</span><span class="p" data-group-id="2674060167-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2674060167-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2674060167-11">}</span><span class="p" data-group-id="2674060167-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2674060167-12">(</span><span class="n">Port</span><span class="p" data-group-id="2674060167-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2674060167-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2674060167-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2674060167-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2674060167-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2674060167-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-17">[</span><span class="p" data-group-id="2674060167-18">[</span><span class="p" data-group-id="2674060167-18">]</span><span class="p" data-group-id="2674060167-17">]</span><span class="p" data-group-id="2674060167-16">)</span><span class="p" data-group-id="2674060167-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2674060167-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2674060167-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2674060167-20">(</span><span class="n">Players</span><span class="p" data-group-id="2674060167-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2674060167-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-22">[</span><span class="p" data-group-id="2674060167-22">]</span><span class="p" data-group-id="2674060167-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2674060167-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2674060167-24">(</span><span class="n">P</span><span class="p" data-group-id="2674060167-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2674060167-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-26">[</span><span class="n">P</span><span class="p" data-group-id="2674060167-26">]</span><span class="p" data-group-id="2674060167-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2674060167-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2674060167-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2674060167-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2674060167-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2674060167-29">(</span><span class="n">Player</span><span class="p" data-group-id="2674060167-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2674060167-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-31">[</span><span class="n">Player</span><span class="p" data-group-id="2674060167-31">]</span><span class="p" data-group-id="2674060167-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2674060167-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2674060167-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2674060167-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2674060167-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2674060167-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-36">[</span><span class="n">Player</span><span class="p" data-group-id="2674060167-36">]</span><span class="p" data-group-id="2674060167-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2674060167-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2674060167-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2674060167-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2674060167-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2674060167-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2674060167-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2674060167-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2674060167-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2674060167-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2674060167-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2674060167-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2674060167-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2674060167-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2674060167-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2674060167-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2674060167-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2674060167-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2674060167-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2674060167-49">(</span><span class="n">Player</span><span class="p" data-group-id="2674060167-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2674060167-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2674060167-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2674060167-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2674060167-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2674060167-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2674060167-53">(</span><span class="n">P</span><span class="p" data-group-id="2674060167-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2674060167-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2674060167-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2674060167-55">(</span><span class="n">P</span><span class="p" data-group-id="2674060167-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2674060167-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2674060167-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2674060167-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2674060167-57">(</span><span class="p" data-group-id="2674060167-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-58">{</span><span class="p" data-group-id="2674060167-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2674060167-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2674060167-60">}</span><span class="p" data-group-id="2674060167-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2674060167-61">(</span><span class="p" data-group-id="2674060167-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2674060167-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2674060167-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2674060167-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2674060167-64">]</span><span class="w">
        </span><span class="p" data-group-id="2674060167-63">)</span><span class="w">
    </span><span class="p" data-group-id="2674060167-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2674060167-65">(</span><span class="p" data-group-id="2674060167-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2674060167-66">(</span><span class="p" data-group-id="2674060167-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2674060167-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2674060167-68">]</span><span class="p" data-group-id="2674060167-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2674060167-69">(</span><span class="p" data-group-id="2674060167-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2674060167-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2674060167-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2674060167-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2674060167-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2674060167-72">(</span><span class="p" data-group-id="2674060167-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2674060167-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2674060167-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2674060167-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2674060167-76">]</span><span class="p" data-group-id="2674060167-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2674060167-78">(</span><span class="n">H</span><span class="p" data-group-id="2674060167-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2674060167-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2674060167-79">)</span><span class="p" data-group-id="2674060167-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2674060167-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2674060167-81">[</span><span class="p" data-group-id="2674060167-81">]</span><span class="p" data-group-id="2674060167-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2674060167-82">[</span><span class="p" data-group-id="2674060167-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2674060167-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2674060167-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2674060167-84">(</span><span class="p" data-group-id="2674060167-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2674060167-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2674060167-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2674060167-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2674060167-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2674060167-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2674060167-89">(</span><span class="p" data-group-id="2674060167-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2674060167-90">{</span><span class="nf">self</span><span class="p" data-group-id="2674060167-91">(</span><span class="p" data-group-id="2674060167-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2674060167-92">(</span><span class="n">X</span><span class="p" data-group-id="2674060167-92">)</span><span class="p" data-group-id="2674060167-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2674060167-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2674060167-87">]</span><span class="w">
    </span><span class="p" data-group-id="2674060167-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="perldoc">
    Perldoc Style (perldoc)<a class="headerlink" href="#perldoc" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-perldoc"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">perldoc_style</span><span class="p" data-group-id="8382973301-1">(</span><span class="p" data-group-id="8382973301-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="perldoc-example.erl">
      example.erl<a class="headerlink" href="#perldoc-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-perldoc"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0315098278-1">(</span><span class="ss">test</span><span class="p" data-group-id="0315098278-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0315098278-2">(</span><span class="p" data-group-id="0315098278-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0315098278-3">]</span><span class="p" data-group-id="0315098278-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0315098278-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0315098278-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0315098278-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0315098278-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0315098278-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0315098278-9">}</span><span class="p" data-group-id="0315098278-6">]</span><span class="p" data-group-id="0315098278-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0315098278-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0315098278-11">}</span><span class="p" data-group-id="0315098278-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0315098278-12">(</span><span class="n">Port</span><span class="p" data-group-id="0315098278-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0315098278-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0315098278-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0315098278-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0315098278-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0315098278-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-17">[</span><span class="p" data-group-id="0315098278-18">[</span><span class="p" data-group-id="0315098278-18">]</span><span class="p" data-group-id="0315098278-17">]</span><span class="p" data-group-id="0315098278-16">)</span><span class="p" data-group-id="0315098278-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0315098278-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0315098278-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0315098278-20">(</span><span class="n">Players</span><span class="p" data-group-id="0315098278-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0315098278-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-22">[</span><span class="p" data-group-id="0315098278-22">]</span><span class="p" data-group-id="0315098278-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0315098278-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0315098278-24">(</span><span class="n">P</span><span class="p" data-group-id="0315098278-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0315098278-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-26">[</span><span class="n">P</span><span class="p" data-group-id="0315098278-26">]</span><span class="p" data-group-id="0315098278-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0315098278-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0315098278-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0315098278-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0315098278-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0315098278-29">(</span><span class="n">Player</span><span class="p" data-group-id="0315098278-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0315098278-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-31">[</span><span class="n">Player</span><span class="p" data-group-id="0315098278-31">]</span><span class="p" data-group-id="0315098278-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0315098278-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0315098278-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0315098278-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0315098278-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0315098278-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-36">[</span><span class="n">Player</span><span class="p" data-group-id="0315098278-36">]</span><span class="p" data-group-id="0315098278-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0315098278-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0315098278-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0315098278-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0315098278-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0315098278-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0315098278-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0315098278-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0315098278-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0315098278-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0315098278-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0315098278-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0315098278-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0315098278-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0315098278-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0315098278-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0315098278-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0315098278-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0315098278-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0315098278-49">(</span><span class="n">Player</span><span class="p" data-group-id="0315098278-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0315098278-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0315098278-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0315098278-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0315098278-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0315098278-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0315098278-53">(</span><span class="n">P</span><span class="p" data-group-id="0315098278-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0315098278-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0315098278-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0315098278-55">(</span><span class="n">P</span><span class="p" data-group-id="0315098278-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0315098278-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0315098278-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0315098278-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0315098278-57">(</span><span class="p" data-group-id="0315098278-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-58">{</span><span class="p" data-group-id="0315098278-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0315098278-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0315098278-60">}</span><span class="p" data-group-id="0315098278-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0315098278-61">(</span><span class="p" data-group-id="0315098278-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0315098278-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0315098278-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0315098278-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0315098278-64">]</span><span class="w">
        </span><span class="p" data-group-id="0315098278-63">)</span><span class="w">
    </span><span class="p" data-group-id="0315098278-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0315098278-65">(</span><span class="p" data-group-id="0315098278-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0315098278-66">(</span><span class="p" data-group-id="0315098278-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0315098278-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0315098278-68">]</span><span class="p" data-group-id="0315098278-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0315098278-69">(</span><span class="p" data-group-id="0315098278-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0315098278-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0315098278-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0315098278-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0315098278-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0315098278-72">(</span><span class="p" data-group-id="0315098278-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0315098278-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0315098278-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0315098278-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0315098278-76">]</span><span class="p" data-group-id="0315098278-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0315098278-78">(</span><span class="n">H</span><span class="p" data-group-id="0315098278-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0315098278-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0315098278-79">)</span><span class="p" data-group-id="0315098278-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0315098278-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0315098278-81">[</span><span class="p" data-group-id="0315098278-81">]</span><span class="p" data-group-id="0315098278-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0315098278-82">[</span><span class="p" data-group-id="0315098278-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0315098278-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0315098278-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0315098278-84">(</span><span class="p" data-group-id="0315098278-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0315098278-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0315098278-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0315098278-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0315098278-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0315098278-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0315098278-89">(</span><span class="p" data-group-id="0315098278-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0315098278-90">{</span><span class="nf">self</span><span class="p" data-group-id="0315098278-91">(</span><span class="p" data-group-id="0315098278-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0315098278-92">(</span><span class="n">X</span><span class="p" data-group-id="0315098278-92">)</span><span class="p" data-group-id="0315098278-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0315098278-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0315098278-87">]</span><span class="w">
    </span><span class="p" data-group-id="0315098278-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rainbow_dash">
    RainbowDash Style (rainbow_dash)<a class="headerlink" href="#rainbow_dash" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rainbow_dash"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rainbow_dash_style</span><span class="p" data-group-id="6670943619-1">(</span><span class="p" data-group-id="6670943619-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="rainbow_dash-example.erl">
      example.erl<a class="headerlink" href="#rainbow_dash-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rainbow_dash"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0906242113-1">(</span><span class="ss">test</span><span class="p" data-group-id="0906242113-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0906242113-2">(</span><span class="p" data-group-id="0906242113-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0906242113-3">]</span><span class="p" data-group-id="0906242113-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0906242113-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0906242113-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0906242113-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0906242113-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0906242113-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0906242113-9">}</span><span class="p" data-group-id="0906242113-6">]</span><span class="p" data-group-id="0906242113-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0906242113-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0906242113-11">}</span><span class="p" data-group-id="0906242113-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0906242113-12">(</span><span class="n">Port</span><span class="p" data-group-id="0906242113-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0906242113-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0906242113-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0906242113-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0906242113-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0906242113-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-17">[</span><span class="p" data-group-id="0906242113-18">[</span><span class="p" data-group-id="0906242113-18">]</span><span class="p" data-group-id="0906242113-17">]</span><span class="p" data-group-id="0906242113-16">)</span><span class="p" data-group-id="0906242113-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0906242113-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0906242113-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0906242113-20">(</span><span class="n">Players</span><span class="p" data-group-id="0906242113-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0906242113-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-22">[</span><span class="p" data-group-id="0906242113-22">]</span><span class="p" data-group-id="0906242113-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0906242113-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0906242113-24">(</span><span class="n">P</span><span class="p" data-group-id="0906242113-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0906242113-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-26">[</span><span class="n">P</span><span class="p" data-group-id="0906242113-26">]</span><span class="p" data-group-id="0906242113-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0906242113-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0906242113-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0906242113-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0906242113-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0906242113-29">(</span><span class="n">Player</span><span class="p" data-group-id="0906242113-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0906242113-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-31">[</span><span class="n">Player</span><span class="p" data-group-id="0906242113-31">]</span><span class="p" data-group-id="0906242113-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0906242113-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0906242113-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0906242113-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0906242113-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0906242113-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-36">[</span><span class="n">Player</span><span class="p" data-group-id="0906242113-36">]</span><span class="p" data-group-id="0906242113-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0906242113-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0906242113-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0906242113-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0906242113-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0906242113-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0906242113-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0906242113-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0906242113-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0906242113-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0906242113-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0906242113-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0906242113-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0906242113-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0906242113-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0906242113-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0906242113-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0906242113-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0906242113-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0906242113-49">(</span><span class="n">Player</span><span class="p" data-group-id="0906242113-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0906242113-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0906242113-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0906242113-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0906242113-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0906242113-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0906242113-53">(</span><span class="n">P</span><span class="p" data-group-id="0906242113-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0906242113-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0906242113-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0906242113-55">(</span><span class="n">P</span><span class="p" data-group-id="0906242113-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0906242113-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0906242113-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0906242113-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0906242113-57">(</span><span class="p" data-group-id="0906242113-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-58">{</span><span class="p" data-group-id="0906242113-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0906242113-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0906242113-60">}</span><span class="p" data-group-id="0906242113-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0906242113-61">(</span><span class="p" data-group-id="0906242113-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0906242113-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0906242113-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0906242113-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0906242113-64">]</span><span class="w">
        </span><span class="p" data-group-id="0906242113-63">)</span><span class="w">
    </span><span class="p" data-group-id="0906242113-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0906242113-65">(</span><span class="p" data-group-id="0906242113-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0906242113-66">(</span><span class="p" data-group-id="0906242113-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0906242113-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0906242113-68">]</span><span class="p" data-group-id="0906242113-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0906242113-69">(</span><span class="p" data-group-id="0906242113-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0906242113-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0906242113-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0906242113-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0906242113-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0906242113-72">(</span><span class="p" data-group-id="0906242113-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0906242113-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0906242113-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0906242113-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0906242113-76">]</span><span class="p" data-group-id="0906242113-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0906242113-78">(</span><span class="n">H</span><span class="p" data-group-id="0906242113-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0906242113-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0906242113-79">)</span><span class="p" data-group-id="0906242113-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0906242113-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0906242113-81">[</span><span class="p" data-group-id="0906242113-81">]</span><span class="p" data-group-id="0906242113-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0906242113-82">[</span><span class="p" data-group-id="0906242113-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0906242113-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0906242113-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0906242113-84">(</span><span class="p" data-group-id="0906242113-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0906242113-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0906242113-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0906242113-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0906242113-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0906242113-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0906242113-89">(</span><span class="p" data-group-id="0906242113-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0906242113-90">{</span><span class="nf">self</span><span class="p" data-group-id="0906242113-91">(</span><span class="p" data-group-id="0906242113-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0906242113-92">(</span><span class="n">X</span><span class="p" data-group-id="0906242113-92">)</span><span class="p" data-group-id="0906242113-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0906242113-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0906242113-87">]</span><span class="w">
    </span><span class="p" data-group-id="0906242113-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rrt">
    Rrt Style (rrt)<a class="headerlink" href="#rrt" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rrt"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rrt_style</span><span class="p" data-group-id="2035392502-1">(</span><span class="p" data-group-id="2035392502-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="rrt-example.erl">
      example.erl<a class="headerlink" href="#rrt-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rrt"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1968944781-1">(</span><span class="ss">test</span><span class="p" data-group-id="1968944781-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1968944781-2">(</span><span class="p" data-group-id="1968944781-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1968944781-3">]</span><span class="p" data-group-id="1968944781-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1968944781-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1968944781-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1968944781-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1968944781-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1968944781-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1968944781-9">}</span><span class="p" data-group-id="1968944781-6">]</span><span class="p" data-group-id="1968944781-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1968944781-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1968944781-11">}</span><span class="p" data-group-id="1968944781-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1968944781-12">(</span><span class="n">Port</span><span class="p" data-group-id="1968944781-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1968944781-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1968944781-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1968944781-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1968944781-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1968944781-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-17">[</span><span class="p" data-group-id="1968944781-18">[</span><span class="p" data-group-id="1968944781-18">]</span><span class="p" data-group-id="1968944781-17">]</span><span class="p" data-group-id="1968944781-16">)</span><span class="p" data-group-id="1968944781-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1968944781-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1968944781-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1968944781-20">(</span><span class="n">Players</span><span class="p" data-group-id="1968944781-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1968944781-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-22">[</span><span class="p" data-group-id="1968944781-22">]</span><span class="p" data-group-id="1968944781-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1968944781-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1968944781-24">(</span><span class="n">P</span><span class="p" data-group-id="1968944781-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1968944781-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-26">[</span><span class="n">P</span><span class="p" data-group-id="1968944781-26">]</span><span class="p" data-group-id="1968944781-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1968944781-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1968944781-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1968944781-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1968944781-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1968944781-29">(</span><span class="n">Player</span><span class="p" data-group-id="1968944781-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1968944781-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-31">[</span><span class="n">Player</span><span class="p" data-group-id="1968944781-31">]</span><span class="p" data-group-id="1968944781-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1968944781-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1968944781-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1968944781-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1968944781-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1968944781-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-36">[</span><span class="n">Player</span><span class="p" data-group-id="1968944781-36">]</span><span class="p" data-group-id="1968944781-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1968944781-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1968944781-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1968944781-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1968944781-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1968944781-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1968944781-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1968944781-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1968944781-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1968944781-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1968944781-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1968944781-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1968944781-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1968944781-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1968944781-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1968944781-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1968944781-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1968944781-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1968944781-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1968944781-49">(</span><span class="n">Player</span><span class="p" data-group-id="1968944781-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1968944781-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1968944781-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1968944781-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1968944781-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1968944781-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1968944781-53">(</span><span class="n">P</span><span class="p" data-group-id="1968944781-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1968944781-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1968944781-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1968944781-55">(</span><span class="n">P</span><span class="p" data-group-id="1968944781-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1968944781-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1968944781-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1968944781-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1968944781-57">(</span><span class="p" data-group-id="1968944781-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-58">{</span><span class="p" data-group-id="1968944781-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1968944781-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1968944781-60">}</span><span class="p" data-group-id="1968944781-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1968944781-61">(</span><span class="p" data-group-id="1968944781-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1968944781-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1968944781-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1968944781-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1968944781-64">]</span><span class="w">
        </span><span class="p" data-group-id="1968944781-63">)</span><span class="w">
    </span><span class="p" data-group-id="1968944781-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1968944781-65">(</span><span class="p" data-group-id="1968944781-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1968944781-66">(</span><span class="p" data-group-id="1968944781-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1968944781-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1968944781-68">]</span><span class="p" data-group-id="1968944781-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1968944781-69">(</span><span class="p" data-group-id="1968944781-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1968944781-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1968944781-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1968944781-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1968944781-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1968944781-72">(</span><span class="p" data-group-id="1968944781-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1968944781-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1968944781-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1968944781-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1968944781-76">]</span><span class="p" data-group-id="1968944781-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1968944781-78">(</span><span class="n">H</span><span class="p" data-group-id="1968944781-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1968944781-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1968944781-79">)</span><span class="p" data-group-id="1968944781-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1968944781-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1968944781-81">[</span><span class="p" data-group-id="1968944781-81">]</span><span class="p" data-group-id="1968944781-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1968944781-82">[</span><span class="p" data-group-id="1968944781-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1968944781-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1968944781-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1968944781-84">(</span><span class="p" data-group-id="1968944781-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1968944781-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1968944781-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1968944781-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1968944781-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1968944781-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1968944781-89">(</span><span class="p" data-group-id="1968944781-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1968944781-90">{</span><span class="nf">self</span><span class="p" data-group-id="1968944781-91">(</span><span class="p" data-group-id="1968944781-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1968944781-92">(</span><span class="n">X</span><span class="p" data-group-id="1968944781-92">)</span><span class="p" data-group-id="1968944781-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1968944781-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1968944781-87">]</span><span class="w">
    </span><span class="p" data-group-id="1968944781-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="tango">
    Tango Style (tango)<a class="headerlink" href="#tango" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-tango"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">tango_style</span><span class="p" data-group-id="8192055502-1">(</span><span class="p" data-group-id="8192055502-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="tango-example.erl">
      example.erl<a class="headerlink" href="#tango-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-tango"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8104132322-1">(</span><span class="ss">test</span><span class="p" data-group-id="8104132322-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8104132322-2">(</span><span class="p" data-group-id="8104132322-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8104132322-3">]</span><span class="p" data-group-id="8104132322-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8104132322-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8104132322-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8104132322-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8104132322-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8104132322-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8104132322-9">}</span><span class="p" data-group-id="8104132322-6">]</span><span class="p" data-group-id="8104132322-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8104132322-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8104132322-11">}</span><span class="p" data-group-id="8104132322-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8104132322-12">(</span><span class="n">Port</span><span class="p" data-group-id="8104132322-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8104132322-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8104132322-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8104132322-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8104132322-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8104132322-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-17">[</span><span class="p" data-group-id="8104132322-18">[</span><span class="p" data-group-id="8104132322-18">]</span><span class="p" data-group-id="8104132322-17">]</span><span class="p" data-group-id="8104132322-16">)</span><span class="p" data-group-id="8104132322-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8104132322-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8104132322-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8104132322-20">(</span><span class="n">Players</span><span class="p" data-group-id="8104132322-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8104132322-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-22">[</span><span class="p" data-group-id="8104132322-22">]</span><span class="p" data-group-id="8104132322-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8104132322-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8104132322-24">(</span><span class="n">P</span><span class="p" data-group-id="8104132322-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8104132322-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-26">[</span><span class="n">P</span><span class="p" data-group-id="8104132322-26">]</span><span class="p" data-group-id="8104132322-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8104132322-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8104132322-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8104132322-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8104132322-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8104132322-29">(</span><span class="n">Player</span><span class="p" data-group-id="8104132322-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8104132322-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-31">[</span><span class="n">Player</span><span class="p" data-group-id="8104132322-31">]</span><span class="p" data-group-id="8104132322-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8104132322-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8104132322-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8104132322-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8104132322-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8104132322-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-36">[</span><span class="n">Player</span><span class="p" data-group-id="8104132322-36">]</span><span class="p" data-group-id="8104132322-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8104132322-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8104132322-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8104132322-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8104132322-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8104132322-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8104132322-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8104132322-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8104132322-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8104132322-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8104132322-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8104132322-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8104132322-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8104132322-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8104132322-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8104132322-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8104132322-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8104132322-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8104132322-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8104132322-49">(</span><span class="n">Player</span><span class="p" data-group-id="8104132322-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8104132322-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8104132322-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8104132322-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8104132322-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8104132322-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8104132322-53">(</span><span class="n">P</span><span class="p" data-group-id="8104132322-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8104132322-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8104132322-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8104132322-55">(</span><span class="n">P</span><span class="p" data-group-id="8104132322-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8104132322-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8104132322-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8104132322-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8104132322-57">(</span><span class="p" data-group-id="8104132322-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-58">{</span><span class="p" data-group-id="8104132322-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8104132322-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8104132322-60">}</span><span class="p" data-group-id="8104132322-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8104132322-61">(</span><span class="p" data-group-id="8104132322-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8104132322-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8104132322-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8104132322-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8104132322-64">]</span><span class="w">
        </span><span class="p" data-group-id="8104132322-63">)</span><span class="w">
    </span><span class="p" data-group-id="8104132322-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8104132322-65">(</span><span class="p" data-group-id="8104132322-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8104132322-66">(</span><span class="p" data-group-id="8104132322-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8104132322-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8104132322-68">]</span><span class="p" data-group-id="8104132322-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8104132322-69">(</span><span class="p" data-group-id="8104132322-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8104132322-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8104132322-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8104132322-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8104132322-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8104132322-72">(</span><span class="p" data-group-id="8104132322-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8104132322-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8104132322-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8104132322-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8104132322-76">]</span><span class="p" data-group-id="8104132322-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8104132322-78">(</span><span class="n">H</span><span class="p" data-group-id="8104132322-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8104132322-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8104132322-79">)</span><span class="p" data-group-id="8104132322-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8104132322-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8104132322-81">[</span><span class="p" data-group-id="8104132322-81">]</span><span class="p" data-group-id="8104132322-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8104132322-82">[</span><span class="p" data-group-id="8104132322-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8104132322-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8104132322-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8104132322-84">(</span><span class="p" data-group-id="8104132322-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8104132322-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8104132322-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8104132322-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8104132322-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8104132322-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8104132322-89">(</span><span class="p" data-group-id="8104132322-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8104132322-90">{</span><span class="nf">self</span><span class="p" data-group-id="8104132322-91">(</span><span class="p" data-group-id="8104132322-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8104132322-92">(</span><span class="n">X</span><span class="p" data-group-id="8104132322-92">)</span><span class="p" data-group-id="8104132322-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8104132322-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8104132322-87">]</span><span class="w">
    </span><span class="p" data-group-id="8104132322-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="trac">
    Trac Style (trac)<a class="headerlink" href="#trac" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-trac"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">trac_style</span><span class="p" data-group-id="2071141630-1">(</span><span class="p" data-group-id="2071141630-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="trac-example.erl">
      example.erl<a class="headerlink" href="#trac-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-trac"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8572177596-1">(</span><span class="ss">test</span><span class="p" data-group-id="8572177596-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8572177596-2">(</span><span class="p" data-group-id="8572177596-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8572177596-3">]</span><span class="p" data-group-id="8572177596-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8572177596-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8572177596-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8572177596-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8572177596-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8572177596-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8572177596-9">}</span><span class="p" data-group-id="8572177596-6">]</span><span class="p" data-group-id="8572177596-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8572177596-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8572177596-11">}</span><span class="p" data-group-id="8572177596-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8572177596-12">(</span><span class="n">Port</span><span class="p" data-group-id="8572177596-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8572177596-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8572177596-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8572177596-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8572177596-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8572177596-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-17">[</span><span class="p" data-group-id="8572177596-18">[</span><span class="p" data-group-id="8572177596-18">]</span><span class="p" data-group-id="8572177596-17">]</span><span class="p" data-group-id="8572177596-16">)</span><span class="p" data-group-id="8572177596-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8572177596-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8572177596-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8572177596-20">(</span><span class="n">Players</span><span class="p" data-group-id="8572177596-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8572177596-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-22">[</span><span class="p" data-group-id="8572177596-22">]</span><span class="p" data-group-id="8572177596-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8572177596-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8572177596-24">(</span><span class="n">P</span><span class="p" data-group-id="8572177596-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8572177596-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-26">[</span><span class="n">P</span><span class="p" data-group-id="8572177596-26">]</span><span class="p" data-group-id="8572177596-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8572177596-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8572177596-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8572177596-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8572177596-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8572177596-29">(</span><span class="n">Player</span><span class="p" data-group-id="8572177596-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8572177596-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-31">[</span><span class="n">Player</span><span class="p" data-group-id="8572177596-31">]</span><span class="p" data-group-id="8572177596-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8572177596-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8572177596-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8572177596-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8572177596-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8572177596-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-36">[</span><span class="n">Player</span><span class="p" data-group-id="8572177596-36">]</span><span class="p" data-group-id="8572177596-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8572177596-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8572177596-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8572177596-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8572177596-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8572177596-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8572177596-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8572177596-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8572177596-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8572177596-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8572177596-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8572177596-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8572177596-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8572177596-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8572177596-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8572177596-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8572177596-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8572177596-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8572177596-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8572177596-49">(</span><span class="n">Player</span><span class="p" data-group-id="8572177596-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8572177596-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8572177596-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8572177596-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8572177596-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8572177596-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8572177596-53">(</span><span class="n">P</span><span class="p" data-group-id="8572177596-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8572177596-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8572177596-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8572177596-55">(</span><span class="n">P</span><span class="p" data-group-id="8572177596-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8572177596-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8572177596-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8572177596-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8572177596-57">(</span><span class="p" data-group-id="8572177596-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-58">{</span><span class="p" data-group-id="8572177596-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8572177596-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8572177596-60">}</span><span class="p" data-group-id="8572177596-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8572177596-61">(</span><span class="p" data-group-id="8572177596-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8572177596-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8572177596-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8572177596-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8572177596-64">]</span><span class="w">
        </span><span class="p" data-group-id="8572177596-63">)</span><span class="w">
    </span><span class="p" data-group-id="8572177596-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8572177596-65">(</span><span class="p" data-group-id="8572177596-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8572177596-66">(</span><span class="p" data-group-id="8572177596-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8572177596-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8572177596-68">]</span><span class="p" data-group-id="8572177596-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8572177596-69">(</span><span class="p" data-group-id="8572177596-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8572177596-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8572177596-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8572177596-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8572177596-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8572177596-72">(</span><span class="p" data-group-id="8572177596-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8572177596-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8572177596-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8572177596-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8572177596-76">]</span><span class="p" data-group-id="8572177596-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8572177596-78">(</span><span class="n">H</span><span class="p" data-group-id="8572177596-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8572177596-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8572177596-79">)</span><span class="p" data-group-id="8572177596-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8572177596-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8572177596-81">[</span><span class="p" data-group-id="8572177596-81">]</span><span class="p" data-group-id="8572177596-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8572177596-82">[</span><span class="p" data-group-id="8572177596-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8572177596-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8572177596-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8572177596-84">(</span><span class="p" data-group-id="8572177596-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8572177596-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8572177596-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8572177596-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8572177596-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8572177596-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8572177596-89">(</span><span class="p" data-group-id="8572177596-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8572177596-90">{</span><span class="nf">self</span><span class="p" data-group-id="8572177596-91">(</span><span class="p" data-group-id="8572177596-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8572177596-92">(</span><span class="n">X</span><span class="p" data-group-id="8572177596-92">)</span><span class="p" data-group-id="8572177596-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8572177596-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8572177596-87">]</span><span class="w">
    </span><span class="p" data-group-id="8572177596-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vim">
    Vim Style (vim)<a class="headerlink" href="#vim" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vim"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vim_style</span><span class="p" data-group-id="9595701964-1">(</span><span class="p" data-group-id="9595701964-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="vim-example.erl">
      example.erl<a class="headerlink" href="#vim-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vim"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2001495521-1">(</span><span class="ss">test</span><span class="p" data-group-id="2001495521-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2001495521-2">(</span><span class="p" data-group-id="2001495521-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2001495521-3">]</span><span class="p" data-group-id="2001495521-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2001495521-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2001495521-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2001495521-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2001495521-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2001495521-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2001495521-9">}</span><span class="p" data-group-id="2001495521-6">]</span><span class="p" data-group-id="2001495521-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2001495521-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2001495521-11">}</span><span class="p" data-group-id="2001495521-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2001495521-12">(</span><span class="n">Port</span><span class="p" data-group-id="2001495521-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2001495521-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2001495521-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2001495521-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2001495521-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2001495521-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-17">[</span><span class="p" data-group-id="2001495521-18">[</span><span class="p" data-group-id="2001495521-18">]</span><span class="p" data-group-id="2001495521-17">]</span><span class="p" data-group-id="2001495521-16">)</span><span class="p" data-group-id="2001495521-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2001495521-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2001495521-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2001495521-20">(</span><span class="n">Players</span><span class="p" data-group-id="2001495521-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2001495521-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-22">[</span><span class="p" data-group-id="2001495521-22">]</span><span class="p" data-group-id="2001495521-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2001495521-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2001495521-24">(</span><span class="n">P</span><span class="p" data-group-id="2001495521-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2001495521-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-26">[</span><span class="n">P</span><span class="p" data-group-id="2001495521-26">]</span><span class="p" data-group-id="2001495521-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2001495521-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2001495521-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2001495521-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2001495521-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2001495521-29">(</span><span class="n">Player</span><span class="p" data-group-id="2001495521-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2001495521-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-31">[</span><span class="n">Player</span><span class="p" data-group-id="2001495521-31">]</span><span class="p" data-group-id="2001495521-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2001495521-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2001495521-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2001495521-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2001495521-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2001495521-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-36">[</span><span class="n">Player</span><span class="p" data-group-id="2001495521-36">]</span><span class="p" data-group-id="2001495521-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2001495521-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2001495521-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2001495521-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2001495521-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2001495521-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2001495521-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2001495521-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2001495521-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2001495521-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2001495521-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2001495521-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2001495521-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2001495521-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2001495521-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2001495521-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2001495521-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2001495521-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2001495521-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2001495521-49">(</span><span class="n">Player</span><span class="p" data-group-id="2001495521-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2001495521-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2001495521-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2001495521-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2001495521-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2001495521-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2001495521-53">(</span><span class="n">P</span><span class="p" data-group-id="2001495521-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2001495521-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2001495521-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2001495521-55">(</span><span class="n">P</span><span class="p" data-group-id="2001495521-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2001495521-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2001495521-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2001495521-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2001495521-57">(</span><span class="p" data-group-id="2001495521-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-58">{</span><span class="p" data-group-id="2001495521-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2001495521-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2001495521-60">}</span><span class="p" data-group-id="2001495521-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2001495521-61">(</span><span class="p" data-group-id="2001495521-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2001495521-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2001495521-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2001495521-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2001495521-64">]</span><span class="w">
        </span><span class="p" data-group-id="2001495521-63">)</span><span class="w">
    </span><span class="p" data-group-id="2001495521-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2001495521-65">(</span><span class="p" data-group-id="2001495521-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2001495521-66">(</span><span class="p" data-group-id="2001495521-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2001495521-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2001495521-68">]</span><span class="p" data-group-id="2001495521-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2001495521-69">(</span><span class="p" data-group-id="2001495521-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2001495521-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2001495521-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2001495521-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2001495521-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2001495521-72">(</span><span class="p" data-group-id="2001495521-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2001495521-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2001495521-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2001495521-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2001495521-76">]</span><span class="p" data-group-id="2001495521-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2001495521-78">(</span><span class="n">H</span><span class="p" data-group-id="2001495521-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2001495521-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2001495521-79">)</span><span class="p" data-group-id="2001495521-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2001495521-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2001495521-81">[</span><span class="p" data-group-id="2001495521-81">]</span><span class="p" data-group-id="2001495521-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2001495521-82">[</span><span class="p" data-group-id="2001495521-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2001495521-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2001495521-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2001495521-84">(</span><span class="p" data-group-id="2001495521-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2001495521-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2001495521-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2001495521-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2001495521-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2001495521-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2001495521-89">(</span><span class="p" data-group-id="2001495521-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2001495521-90">{</span><span class="nf">self</span><span class="p" data-group-id="2001495521-91">(</span><span class="p" data-group-id="2001495521-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2001495521-92">(</span><span class="n">X</span><span class="p" data-group-id="2001495521-92">)</span><span class="p" data-group-id="2001495521-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2001495521-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2001495521-87">]</span><span class="w">
    </span><span class="p" data-group-id="2001495521-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vs">
    VisualStudio Style (vs)<a class="headerlink" href="#vs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vs_style</span><span class="p" data-group-id="0495537451-1">(</span><span class="p" data-group-id="0495537451-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="vs-example.erl">
      example.erl<a class="headerlink" href="#vs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9168580276-1">(</span><span class="ss">test</span><span class="p" data-group-id="9168580276-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9168580276-2">(</span><span class="p" data-group-id="9168580276-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9168580276-3">]</span><span class="p" data-group-id="9168580276-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9168580276-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9168580276-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9168580276-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9168580276-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9168580276-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9168580276-9">}</span><span class="p" data-group-id="9168580276-6">]</span><span class="p" data-group-id="9168580276-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9168580276-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9168580276-11">}</span><span class="p" data-group-id="9168580276-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9168580276-12">(</span><span class="n">Port</span><span class="p" data-group-id="9168580276-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9168580276-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9168580276-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9168580276-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9168580276-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9168580276-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-17">[</span><span class="p" data-group-id="9168580276-18">[</span><span class="p" data-group-id="9168580276-18">]</span><span class="p" data-group-id="9168580276-17">]</span><span class="p" data-group-id="9168580276-16">)</span><span class="p" data-group-id="9168580276-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9168580276-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9168580276-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9168580276-20">(</span><span class="n">Players</span><span class="p" data-group-id="9168580276-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9168580276-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-22">[</span><span class="p" data-group-id="9168580276-22">]</span><span class="p" data-group-id="9168580276-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9168580276-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9168580276-24">(</span><span class="n">P</span><span class="p" data-group-id="9168580276-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9168580276-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-26">[</span><span class="n">P</span><span class="p" data-group-id="9168580276-26">]</span><span class="p" data-group-id="9168580276-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9168580276-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9168580276-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9168580276-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9168580276-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9168580276-29">(</span><span class="n">Player</span><span class="p" data-group-id="9168580276-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9168580276-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-31">[</span><span class="n">Player</span><span class="p" data-group-id="9168580276-31">]</span><span class="p" data-group-id="9168580276-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9168580276-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9168580276-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9168580276-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9168580276-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9168580276-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-36">[</span><span class="n">Player</span><span class="p" data-group-id="9168580276-36">]</span><span class="p" data-group-id="9168580276-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9168580276-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9168580276-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9168580276-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9168580276-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9168580276-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9168580276-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9168580276-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9168580276-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9168580276-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9168580276-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9168580276-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9168580276-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9168580276-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9168580276-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9168580276-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9168580276-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9168580276-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9168580276-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9168580276-49">(</span><span class="n">Player</span><span class="p" data-group-id="9168580276-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9168580276-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9168580276-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9168580276-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9168580276-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9168580276-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9168580276-53">(</span><span class="n">P</span><span class="p" data-group-id="9168580276-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9168580276-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9168580276-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9168580276-55">(</span><span class="n">P</span><span class="p" data-group-id="9168580276-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9168580276-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9168580276-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9168580276-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9168580276-57">(</span><span class="p" data-group-id="9168580276-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-58">{</span><span class="p" data-group-id="9168580276-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9168580276-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9168580276-60">}</span><span class="p" data-group-id="9168580276-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9168580276-61">(</span><span class="p" data-group-id="9168580276-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9168580276-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9168580276-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9168580276-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9168580276-64">]</span><span class="w">
        </span><span class="p" data-group-id="9168580276-63">)</span><span class="w">
    </span><span class="p" data-group-id="9168580276-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9168580276-65">(</span><span class="p" data-group-id="9168580276-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9168580276-66">(</span><span class="p" data-group-id="9168580276-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9168580276-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9168580276-68">]</span><span class="p" data-group-id="9168580276-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9168580276-69">(</span><span class="p" data-group-id="9168580276-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9168580276-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9168580276-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9168580276-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9168580276-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9168580276-72">(</span><span class="p" data-group-id="9168580276-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9168580276-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9168580276-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9168580276-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9168580276-76">]</span><span class="p" data-group-id="9168580276-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9168580276-78">(</span><span class="n">H</span><span class="p" data-group-id="9168580276-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9168580276-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9168580276-79">)</span><span class="p" data-group-id="9168580276-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9168580276-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9168580276-81">[</span><span class="p" data-group-id="9168580276-81">]</span><span class="p" data-group-id="9168580276-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9168580276-82">[</span><span class="p" data-group-id="9168580276-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9168580276-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9168580276-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9168580276-84">(</span><span class="p" data-group-id="9168580276-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9168580276-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9168580276-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9168580276-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9168580276-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9168580276-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9168580276-89">(</span><span class="p" data-group-id="9168580276-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9168580276-90">{</span><span class="nf">self</span><span class="p" data-group-id="9168580276-91">(</span><span class="p" data-group-id="9168580276-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9168580276-92">(</span><span class="n">X</span><span class="p" data-group-id="9168580276-92">)</span><span class="p" data-group-id="9168580276-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9168580276-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9168580276-87">]</span><span class="w">
    </span><span class="p" data-group-id="9168580276-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="xcode">
    Xcode Style (xcode)<a class="headerlink" href="#xcode" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-xcode"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">xcode_style</span><span class="p" data-group-id="8745309097-1">(</span><span class="p" data-group-id="8745309097-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="xcode-example.erl">
      example.erl<a class="headerlink" href="#xcode-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-xcode"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7812450918-1">(</span><span class="ss">test</span><span class="p" data-group-id="7812450918-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7812450918-2">(</span><span class="p" data-group-id="7812450918-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7812450918-3">]</span><span class="p" data-group-id="7812450918-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7812450918-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7812450918-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7812450918-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7812450918-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7812450918-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7812450918-9">}</span><span class="p" data-group-id="7812450918-6">]</span><span class="p" data-group-id="7812450918-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7812450918-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7812450918-11">}</span><span class="p" data-group-id="7812450918-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7812450918-12">(</span><span class="n">Port</span><span class="p" data-group-id="7812450918-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7812450918-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7812450918-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7812450918-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7812450918-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7812450918-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-17">[</span><span class="p" data-group-id="7812450918-18">[</span><span class="p" data-group-id="7812450918-18">]</span><span class="p" data-group-id="7812450918-17">]</span><span class="p" data-group-id="7812450918-16">)</span><span class="p" data-group-id="7812450918-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7812450918-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7812450918-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7812450918-20">(</span><span class="n">Players</span><span class="p" data-group-id="7812450918-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7812450918-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-22">[</span><span class="p" data-group-id="7812450918-22">]</span><span class="p" data-group-id="7812450918-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7812450918-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7812450918-24">(</span><span class="n">P</span><span class="p" data-group-id="7812450918-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7812450918-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-26">[</span><span class="n">P</span><span class="p" data-group-id="7812450918-26">]</span><span class="p" data-group-id="7812450918-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7812450918-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7812450918-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7812450918-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7812450918-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7812450918-29">(</span><span class="n">Player</span><span class="p" data-group-id="7812450918-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7812450918-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-31">[</span><span class="n">Player</span><span class="p" data-group-id="7812450918-31">]</span><span class="p" data-group-id="7812450918-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7812450918-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7812450918-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7812450918-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7812450918-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7812450918-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-36">[</span><span class="n">Player</span><span class="p" data-group-id="7812450918-36">]</span><span class="p" data-group-id="7812450918-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7812450918-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7812450918-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7812450918-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7812450918-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7812450918-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7812450918-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7812450918-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7812450918-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7812450918-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7812450918-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7812450918-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7812450918-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7812450918-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7812450918-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7812450918-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7812450918-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7812450918-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7812450918-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7812450918-49">(</span><span class="n">Player</span><span class="p" data-group-id="7812450918-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7812450918-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7812450918-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7812450918-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7812450918-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7812450918-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7812450918-53">(</span><span class="n">P</span><span class="p" data-group-id="7812450918-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7812450918-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7812450918-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7812450918-55">(</span><span class="n">P</span><span class="p" data-group-id="7812450918-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7812450918-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7812450918-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7812450918-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7812450918-57">(</span><span class="p" data-group-id="7812450918-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-58">{</span><span class="p" data-group-id="7812450918-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7812450918-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7812450918-60">}</span><span class="p" data-group-id="7812450918-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7812450918-61">(</span><span class="p" data-group-id="7812450918-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7812450918-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7812450918-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7812450918-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7812450918-64">]</span><span class="w">
        </span><span class="p" data-group-id="7812450918-63">)</span><span class="w">
    </span><span class="p" data-group-id="7812450918-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7812450918-65">(</span><span class="p" data-group-id="7812450918-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7812450918-66">(</span><span class="p" data-group-id="7812450918-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7812450918-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7812450918-68">]</span><span class="p" data-group-id="7812450918-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7812450918-69">(</span><span class="p" data-group-id="7812450918-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7812450918-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7812450918-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7812450918-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7812450918-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7812450918-72">(</span><span class="p" data-group-id="7812450918-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7812450918-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7812450918-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7812450918-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7812450918-76">]</span><span class="p" data-group-id="7812450918-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7812450918-78">(</span><span class="n">H</span><span class="p" data-group-id="7812450918-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7812450918-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7812450918-79">)</span><span class="p" data-group-id="7812450918-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7812450918-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7812450918-81">[</span><span class="p" data-group-id="7812450918-81">]</span><span class="p" data-group-id="7812450918-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7812450918-82">[</span><span class="p" data-group-id="7812450918-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7812450918-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7812450918-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7812450918-84">(</span><span class="p" data-group-id="7812450918-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7812450918-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7812450918-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7812450918-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7812450918-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7812450918-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7812450918-89">(</span><span class="p" data-group-id="7812450918-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7812450918-90">{</span><span class="nf">self</span><span class="p" data-group-id="7812450918-91">(</span><span class="p" data-group-id="7812450918-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7812450918-92">(</span><span class="n">X</span><span class="p" data-group-id="7812450918-92">)</span><span class="p" data-group-id="7812450918-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7812450918-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7812450918-87">]</span><span class="w">
    </span><span class="p" data-group-id="7812450918-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  


          </div>


        </div>
        
        <div class="clearer"></div>

      </div>

      <div class="clearfix"></div>
    </div>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
              >index</a></li>
        <li class="right" >
          <a href="overview.html" title="Overview"
              >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Makeup Demo</a> &raquo;</li> 
      </ul>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>

    <script type="text/javascript">
      document.querySelector(".menu-btn").addEventListener("click", () => { 
        document.querySelector(".left-column").classList.toggle("left-column--active");
      });
    </script>
  </body>
</html>