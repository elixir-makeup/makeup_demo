<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- Licensed under the Apache 2.0 License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/open-sans/stylesheet.css" />
    <!-- Licensed under the SIL Open Font License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/source-serif-pro/source-serif-pro.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Makeup Demo</title>
    
    <!--Bootstrap 5-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    
    <link rel="stylesheet" href="static/css/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="static/css/makeup.css" type="text/css" />
  </head>

  <body role="document">
    <div class="container-wrapper">
      <div id="mobile-toggle">
        <a class="text-logo--mobile"  href="index.html">
          <span>Makeup Demo</span>
        </a>
        <button class="menu-btn" area-label="Menu">
          <img class="menu-icon" src="static/img/menu-line.svg">
        </button>        
      </div>

      <div id="left-column" class="left-column">
        <div class="makeupsidebar"><a href="index.html" class="text-logo">Makeup Demo</a>

          
            <div class="sidebar-block">
              <div class="sidebar-wrapper">
                <h2>Styles</h2>
              </div>
              <div class="sidebar-toc">
                <ul>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#abap">
                        Abap Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol">
                        Algol Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol_nu">
                        Algol_Nu Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#arduino">
                        Arduino Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#autumn">
                        Autumn Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#borland">
                        Borland Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#bw">
                        BlackWhite Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#colorful">
                        Colorful Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#default">
                        Default Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#emacs">
                        Emacs Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#friendly">
                        Friendly Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#fruity">
                        Fruity Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#igor">
                        Igor Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#lovelace">
                        Lovelace Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#manni">
                        Manni Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#monokai">
                        Monokai Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#murphy">
                        Murphy Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#native">
                        Native Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_dark">
                        ParaisoDark Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_light">
                        ParaisoLight Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#pastie">
                        Pastie Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#perldoc">
                        Perldoc Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rainbow_dash">
                        RainbowDash Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rrt">
                        Rrt Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#tango">
                        Tango Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#trac">
                        Trac Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vim">
                        Vim Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vs">
                        VisualStudio Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#xcode">
                        Xcode Style</a></li>
                  
                </ul>
              </div>
            </div>
          

          <div class="sidebar-block">
            <div class="sidebar-wrapper">
              <h2>Languages</h2>
            </div>
            <div class="sidebar-toc">
              <ul>
                
                <li class="toctree-l1"><a class="reference internal" href="c.html">C</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="elixir.html">Elixir</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="erlang.html">Erlang</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a></li>
                
              </ul>
            </div>
          </div>

        </div>
      </div>

      <div id="right-column">
        
        <div class="document clearer body">

          <div class="section">
            <h1 id="heading">
  Erlang Language<a class="headerlink" href="#heading" title="Permalink">¶</a>
</h1>

<p>
  A lexer for the Erlang language.
</p>


<p>
  This page shows examples of source files lexed by the same lexer,
  but rendered into HTML using different styles.
</p>

<p>
  Some styles are richer than others in that they define more different token categories.

  Examples of such richer styles are the <a href="#default">Default</a> style,
  the <a href="#tango">Tango</a> style and the <a href="#colorful">Colorful</a> style.
</p>

<p>
  In all cases the lexer is the same, and the only difference is the colors defined by the styles.
</p>


  <h2 id="abap">
    Abap Style (abap)<a class="headerlink" href="#abap" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-abap"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">abap_style</span><span class="p" data-group-id="9590272558-1">(</span><span class="p" data-group-id="9590272558-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="abap-example.erl">
      example.erl<a class="headerlink" href="#abap-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-abap"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4633272565-1">(</span><span class="ss">test</span><span class="p" data-group-id="4633272565-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4633272565-2">(</span><span class="p" data-group-id="4633272565-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4633272565-3">]</span><span class="p" data-group-id="4633272565-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4633272565-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4633272565-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4633272565-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4633272565-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4633272565-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4633272565-9">}</span><span class="p" data-group-id="4633272565-6">]</span><span class="p" data-group-id="4633272565-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4633272565-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4633272565-11">}</span><span class="p" data-group-id="4633272565-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4633272565-12">(</span><span class="n">Port</span><span class="p" data-group-id="4633272565-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4633272565-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4633272565-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4633272565-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4633272565-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4633272565-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-17">[</span><span class="p" data-group-id="4633272565-18">[</span><span class="p" data-group-id="4633272565-18">]</span><span class="p" data-group-id="4633272565-17">]</span><span class="p" data-group-id="4633272565-16">)</span><span class="p" data-group-id="4633272565-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4633272565-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4633272565-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4633272565-20">(</span><span class="n">Players</span><span class="p" data-group-id="4633272565-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4633272565-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-22">[</span><span class="p" data-group-id="4633272565-22">]</span><span class="p" data-group-id="4633272565-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4633272565-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4633272565-24">(</span><span class="n">P</span><span class="p" data-group-id="4633272565-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4633272565-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-26">[</span><span class="n">P</span><span class="p" data-group-id="4633272565-26">]</span><span class="p" data-group-id="4633272565-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4633272565-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4633272565-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4633272565-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4633272565-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4633272565-29">(</span><span class="n">Player</span><span class="p" data-group-id="4633272565-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4633272565-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-31">[</span><span class="n">Player</span><span class="p" data-group-id="4633272565-31">]</span><span class="p" data-group-id="4633272565-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4633272565-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4633272565-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4633272565-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4633272565-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4633272565-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-36">[</span><span class="n">Player</span><span class="p" data-group-id="4633272565-36">]</span><span class="p" data-group-id="4633272565-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4633272565-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4633272565-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4633272565-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4633272565-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4633272565-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4633272565-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4633272565-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4633272565-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4633272565-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4633272565-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4633272565-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4633272565-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4633272565-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4633272565-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4633272565-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4633272565-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4633272565-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4633272565-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4633272565-49">(</span><span class="n">Player</span><span class="p" data-group-id="4633272565-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4633272565-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4633272565-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4633272565-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4633272565-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4633272565-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4633272565-53">(</span><span class="n">P</span><span class="p" data-group-id="4633272565-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4633272565-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4633272565-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4633272565-55">(</span><span class="n">P</span><span class="p" data-group-id="4633272565-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4633272565-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4633272565-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4633272565-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4633272565-57">(</span><span class="p" data-group-id="4633272565-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-58">{</span><span class="p" data-group-id="4633272565-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4633272565-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4633272565-60">}</span><span class="p" data-group-id="4633272565-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4633272565-61">(</span><span class="p" data-group-id="4633272565-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4633272565-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4633272565-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4633272565-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4633272565-64">]</span><span class="w">
        </span><span class="p" data-group-id="4633272565-63">)</span><span class="w">
    </span><span class="p" data-group-id="4633272565-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4633272565-65">(</span><span class="p" data-group-id="4633272565-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4633272565-66">(</span><span class="p" data-group-id="4633272565-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4633272565-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4633272565-68">]</span><span class="p" data-group-id="4633272565-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4633272565-69">(</span><span class="p" data-group-id="4633272565-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4633272565-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4633272565-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4633272565-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4633272565-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4633272565-72">(</span><span class="p" data-group-id="4633272565-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4633272565-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4633272565-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4633272565-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4633272565-76">]</span><span class="p" data-group-id="4633272565-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4633272565-78">(</span><span class="n">H</span><span class="p" data-group-id="4633272565-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4633272565-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4633272565-79">)</span><span class="p" data-group-id="4633272565-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4633272565-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4633272565-81">[</span><span class="p" data-group-id="4633272565-81">]</span><span class="p" data-group-id="4633272565-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4633272565-82">[</span><span class="p" data-group-id="4633272565-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4633272565-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4633272565-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4633272565-84">(</span><span class="p" data-group-id="4633272565-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4633272565-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4633272565-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4633272565-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4633272565-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4633272565-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4633272565-89">(</span><span class="p" data-group-id="4633272565-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4633272565-90">{</span><span class="nf">self</span><span class="p" data-group-id="4633272565-91">(</span><span class="p" data-group-id="4633272565-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4633272565-92">(</span><span class="n">X</span><span class="p" data-group-id="4633272565-92">)</span><span class="p" data-group-id="4633272565-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4633272565-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4633272565-87">]</span><span class="w">
    </span><span class="p" data-group-id="4633272565-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol">
    Algol Style (algol)<a class="headerlink" href="#algol" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_style</span><span class="p" data-group-id="4797405416-1">(</span><span class="p" data-group-id="4797405416-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="algol-example.erl">
      example.erl<a class="headerlink" href="#algol-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1779954725-1">(</span><span class="ss">test</span><span class="p" data-group-id="1779954725-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1779954725-2">(</span><span class="p" data-group-id="1779954725-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1779954725-3">]</span><span class="p" data-group-id="1779954725-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1779954725-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1779954725-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1779954725-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1779954725-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1779954725-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1779954725-9">}</span><span class="p" data-group-id="1779954725-6">]</span><span class="p" data-group-id="1779954725-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1779954725-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1779954725-11">}</span><span class="p" data-group-id="1779954725-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1779954725-12">(</span><span class="n">Port</span><span class="p" data-group-id="1779954725-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1779954725-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1779954725-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1779954725-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1779954725-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1779954725-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-17">[</span><span class="p" data-group-id="1779954725-18">[</span><span class="p" data-group-id="1779954725-18">]</span><span class="p" data-group-id="1779954725-17">]</span><span class="p" data-group-id="1779954725-16">)</span><span class="p" data-group-id="1779954725-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1779954725-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1779954725-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1779954725-20">(</span><span class="n">Players</span><span class="p" data-group-id="1779954725-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1779954725-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-22">[</span><span class="p" data-group-id="1779954725-22">]</span><span class="p" data-group-id="1779954725-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1779954725-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1779954725-24">(</span><span class="n">P</span><span class="p" data-group-id="1779954725-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1779954725-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-26">[</span><span class="n">P</span><span class="p" data-group-id="1779954725-26">]</span><span class="p" data-group-id="1779954725-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1779954725-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1779954725-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1779954725-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1779954725-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1779954725-29">(</span><span class="n">Player</span><span class="p" data-group-id="1779954725-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1779954725-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-31">[</span><span class="n">Player</span><span class="p" data-group-id="1779954725-31">]</span><span class="p" data-group-id="1779954725-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1779954725-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1779954725-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1779954725-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1779954725-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1779954725-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-36">[</span><span class="n">Player</span><span class="p" data-group-id="1779954725-36">]</span><span class="p" data-group-id="1779954725-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1779954725-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1779954725-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1779954725-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1779954725-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1779954725-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1779954725-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1779954725-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1779954725-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1779954725-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1779954725-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1779954725-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1779954725-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1779954725-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1779954725-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1779954725-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1779954725-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1779954725-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1779954725-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1779954725-49">(</span><span class="n">Player</span><span class="p" data-group-id="1779954725-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1779954725-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1779954725-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1779954725-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1779954725-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1779954725-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1779954725-53">(</span><span class="n">P</span><span class="p" data-group-id="1779954725-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1779954725-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1779954725-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1779954725-55">(</span><span class="n">P</span><span class="p" data-group-id="1779954725-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1779954725-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1779954725-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1779954725-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1779954725-57">(</span><span class="p" data-group-id="1779954725-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-58">{</span><span class="p" data-group-id="1779954725-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1779954725-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1779954725-60">}</span><span class="p" data-group-id="1779954725-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1779954725-61">(</span><span class="p" data-group-id="1779954725-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1779954725-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1779954725-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1779954725-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1779954725-64">]</span><span class="w">
        </span><span class="p" data-group-id="1779954725-63">)</span><span class="w">
    </span><span class="p" data-group-id="1779954725-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1779954725-65">(</span><span class="p" data-group-id="1779954725-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1779954725-66">(</span><span class="p" data-group-id="1779954725-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1779954725-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1779954725-68">]</span><span class="p" data-group-id="1779954725-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1779954725-69">(</span><span class="p" data-group-id="1779954725-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1779954725-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1779954725-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1779954725-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1779954725-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1779954725-72">(</span><span class="p" data-group-id="1779954725-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1779954725-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1779954725-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1779954725-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1779954725-76">]</span><span class="p" data-group-id="1779954725-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1779954725-78">(</span><span class="n">H</span><span class="p" data-group-id="1779954725-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1779954725-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1779954725-79">)</span><span class="p" data-group-id="1779954725-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1779954725-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1779954725-81">[</span><span class="p" data-group-id="1779954725-81">]</span><span class="p" data-group-id="1779954725-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1779954725-82">[</span><span class="p" data-group-id="1779954725-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1779954725-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1779954725-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1779954725-84">(</span><span class="p" data-group-id="1779954725-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1779954725-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1779954725-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1779954725-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1779954725-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1779954725-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1779954725-89">(</span><span class="p" data-group-id="1779954725-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1779954725-90">{</span><span class="nf">self</span><span class="p" data-group-id="1779954725-91">(</span><span class="p" data-group-id="1779954725-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1779954725-92">(</span><span class="n">X</span><span class="p" data-group-id="1779954725-92">)</span><span class="p" data-group-id="1779954725-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1779954725-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1779954725-87">]</span><span class="w">
    </span><span class="p" data-group-id="1779954725-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol_nu">
    Algol_Nu Style (algol_nu)<a class="headerlink" href="#algol_nu" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol_nu"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_nu_style</span><span class="p" data-group-id="9362391341-1">(</span><span class="p" data-group-id="9362391341-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="algol_nu-example.erl">
      example.erl<a class="headerlink" href="#algol_nu-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol_nu"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9207479045-1">(</span><span class="ss">test</span><span class="p" data-group-id="9207479045-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9207479045-2">(</span><span class="p" data-group-id="9207479045-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9207479045-3">]</span><span class="p" data-group-id="9207479045-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9207479045-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9207479045-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9207479045-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9207479045-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9207479045-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9207479045-9">}</span><span class="p" data-group-id="9207479045-6">]</span><span class="p" data-group-id="9207479045-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9207479045-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9207479045-11">}</span><span class="p" data-group-id="9207479045-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9207479045-12">(</span><span class="n">Port</span><span class="p" data-group-id="9207479045-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9207479045-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9207479045-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9207479045-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9207479045-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9207479045-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-17">[</span><span class="p" data-group-id="9207479045-18">[</span><span class="p" data-group-id="9207479045-18">]</span><span class="p" data-group-id="9207479045-17">]</span><span class="p" data-group-id="9207479045-16">)</span><span class="p" data-group-id="9207479045-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9207479045-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9207479045-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9207479045-20">(</span><span class="n">Players</span><span class="p" data-group-id="9207479045-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9207479045-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-22">[</span><span class="p" data-group-id="9207479045-22">]</span><span class="p" data-group-id="9207479045-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9207479045-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9207479045-24">(</span><span class="n">P</span><span class="p" data-group-id="9207479045-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9207479045-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-26">[</span><span class="n">P</span><span class="p" data-group-id="9207479045-26">]</span><span class="p" data-group-id="9207479045-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9207479045-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9207479045-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9207479045-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9207479045-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9207479045-29">(</span><span class="n">Player</span><span class="p" data-group-id="9207479045-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9207479045-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-31">[</span><span class="n">Player</span><span class="p" data-group-id="9207479045-31">]</span><span class="p" data-group-id="9207479045-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9207479045-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9207479045-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9207479045-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9207479045-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9207479045-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-36">[</span><span class="n">Player</span><span class="p" data-group-id="9207479045-36">]</span><span class="p" data-group-id="9207479045-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9207479045-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9207479045-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9207479045-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9207479045-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9207479045-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9207479045-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9207479045-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9207479045-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9207479045-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9207479045-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9207479045-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9207479045-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9207479045-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9207479045-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9207479045-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9207479045-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9207479045-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9207479045-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9207479045-49">(</span><span class="n">Player</span><span class="p" data-group-id="9207479045-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9207479045-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9207479045-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9207479045-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9207479045-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9207479045-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9207479045-53">(</span><span class="n">P</span><span class="p" data-group-id="9207479045-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9207479045-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9207479045-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9207479045-55">(</span><span class="n">P</span><span class="p" data-group-id="9207479045-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9207479045-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9207479045-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9207479045-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9207479045-57">(</span><span class="p" data-group-id="9207479045-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-58">{</span><span class="p" data-group-id="9207479045-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9207479045-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9207479045-60">}</span><span class="p" data-group-id="9207479045-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9207479045-61">(</span><span class="p" data-group-id="9207479045-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9207479045-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9207479045-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9207479045-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9207479045-64">]</span><span class="w">
        </span><span class="p" data-group-id="9207479045-63">)</span><span class="w">
    </span><span class="p" data-group-id="9207479045-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9207479045-65">(</span><span class="p" data-group-id="9207479045-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9207479045-66">(</span><span class="p" data-group-id="9207479045-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9207479045-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9207479045-68">]</span><span class="p" data-group-id="9207479045-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9207479045-69">(</span><span class="p" data-group-id="9207479045-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9207479045-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9207479045-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9207479045-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9207479045-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9207479045-72">(</span><span class="p" data-group-id="9207479045-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9207479045-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9207479045-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9207479045-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9207479045-76">]</span><span class="p" data-group-id="9207479045-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9207479045-78">(</span><span class="n">H</span><span class="p" data-group-id="9207479045-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9207479045-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9207479045-79">)</span><span class="p" data-group-id="9207479045-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9207479045-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9207479045-81">[</span><span class="p" data-group-id="9207479045-81">]</span><span class="p" data-group-id="9207479045-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9207479045-82">[</span><span class="p" data-group-id="9207479045-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9207479045-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9207479045-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9207479045-84">(</span><span class="p" data-group-id="9207479045-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9207479045-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9207479045-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9207479045-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9207479045-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9207479045-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9207479045-89">(</span><span class="p" data-group-id="9207479045-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9207479045-90">{</span><span class="nf">self</span><span class="p" data-group-id="9207479045-91">(</span><span class="p" data-group-id="9207479045-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9207479045-92">(</span><span class="n">X</span><span class="p" data-group-id="9207479045-92">)</span><span class="p" data-group-id="9207479045-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9207479045-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9207479045-87">]</span><span class="w">
    </span><span class="p" data-group-id="9207479045-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="arduino">
    Arduino Style (arduino)<a class="headerlink" href="#arduino" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-arduino"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">arduino_style</span><span class="p" data-group-id="0261015456-1">(</span><span class="p" data-group-id="0261015456-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="arduino-example.erl">
      example.erl<a class="headerlink" href="#arduino-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-arduino"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5973497553-1">(</span><span class="ss">test</span><span class="p" data-group-id="5973497553-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5973497553-2">(</span><span class="p" data-group-id="5973497553-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5973497553-3">]</span><span class="p" data-group-id="5973497553-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5973497553-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5973497553-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5973497553-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5973497553-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5973497553-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5973497553-9">}</span><span class="p" data-group-id="5973497553-6">]</span><span class="p" data-group-id="5973497553-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5973497553-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5973497553-11">}</span><span class="p" data-group-id="5973497553-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5973497553-12">(</span><span class="n">Port</span><span class="p" data-group-id="5973497553-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5973497553-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5973497553-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5973497553-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5973497553-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5973497553-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-17">[</span><span class="p" data-group-id="5973497553-18">[</span><span class="p" data-group-id="5973497553-18">]</span><span class="p" data-group-id="5973497553-17">]</span><span class="p" data-group-id="5973497553-16">)</span><span class="p" data-group-id="5973497553-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5973497553-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5973497553-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5973497553-20">(</span><span class="n">Players</span><span class="p" data-group-id="5973497553-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5973497553-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-22">[</span><span class="p" data-group-id="5973497553-22">]</span><span class="p" data-group-id="5973497553-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5973497553-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5973497553-24">(</span><span class="n">P</span><span class="p" data-group-id="5973497553-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5973497553-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-26">[</span><span class="n">P</span><span class="p" data-group-id="5973497553-26">]</span><span class="p" data-group-id="5973497553-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5973497553-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5973497553-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5973497553-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5973497553-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5973497553-29">(</span><span class="n">Player</span><span class="p" data-group-id="5973497553-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5973497553-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-31">[</span><span class="n">Player</span><span class="p" data-group-id="5973497553-31">]</span><span class="p" data-group-id="5973497553-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5973497553-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5973497553-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5973497553-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5973497553-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5973497553-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-36">[</span><span class="n">Player</span><span class="p" data-group-id="5973497553-36">]</span><span class="p" data-group-id="5973497553-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5973497553-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5973497553-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5973497553-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5973497553-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5973497553-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5973497553-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5973497553-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5973497553-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5973497553-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5973497553-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5973497553-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5973497553-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5973497553-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5973497553-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5973497553-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5973497553-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5973497553-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5973497553-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5973497553-49">(</span><span class="n">Player</span><span class="p" data-group-id="5973497553-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5973497553-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5973497553-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5973497553-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5973497553-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5973497553-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5973497553-53">(</span><span class="n">P</span><span class="p" data-group-id="5973497553-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5973497553-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5973497553-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5973497553-55">(</span><span class="n">P</span><span class="p" data-group-id="5973497553-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5973497553-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5973497553-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5973497553-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5973497553-57">(</span><span class="p" data-group-id="5973497553-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-58">{</span><span class="p" data-group-id="5973497553-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5973497553-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5973497553-60">}</span><span class="p" data-group-id="5973497553-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5973497553-61">(</span><span class="p" data-group-id="5973497553-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5973497553-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5973497553-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5973497553-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5973497553-64">]</span><span class="w">
        </span><span class="p" data-group-id="5973497553-63">)</span><span class="w">
    </span><span class="p" data-group-id="5973497553-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5973497553-65">(</span><span class="p" data-group-id="5973497553-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5973497553-66">(</span><span class="p" data-group-id="5973497553-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5973497553-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5973497553-68">]</span><span class="p" data-group-id="5973497553-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5973497553-69">(</span><span class="p" data-group-id="5973497553-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5973497553-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5973497553-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5973497553-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5973497553-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5973497553-72">(</span><span class="p" data-group-id="5973497553-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5973497553-74">{</span><span class="ss">fff</span><span class="p" data-group-id="5973497553-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5973497553-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5973497553-76">]</span><span class="p" data-group-id="5973497553-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-77">[</span><span class="n">Fun</span><span class="p" data-group-id="5973497553-78">(</span><span class="n">H</span><span class="p" data-group-id="5973497553-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5973497553-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5973497553-79">)</span><span class="p" data-group-id="5973497553-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5973497553-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5973497553-81">[</span><span class="p" data-group-id="5973497553-81">]</span><span class="p" data-group-id="5973497553-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5973497553-82">[</span><span class="p" data-group-id="5973497553-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5973497553-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5973497553-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5973497553-84">(</span><span class="p" data-group-id="5973497553-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5973497553-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5973497553-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5973497553-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5973497553-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5973497553-88">(</span><span class="nf">fun</span><span class="p" data-group-id="5973497553-89">(</span><span class="p" data-group-id="5973497553-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5973497553-90">{</span><span class="nf">self</span><span class="p" data-group-id="5973497553-91">(</span><span class="p" data-group-id="5973497553-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5973497553-92">(</span><span class="n">X</span><span class="p" data-group-id="5973497553-92">)</span><span class="p" data-group-id="5973497553-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5973497553-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5973497553-87">]</span><span class="w">
    </span><span class="p" data-group-id="5973497553-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="autumn">
    Autumn Style (autumn)<a class="headerlink" href="#autumn" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-autumn"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">autumn_style</span><span class="p" data-group-id="9533858153-1">(</span><span class="p" data-group-id="9533858153-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="autumn-example.erl">
      example.erl<a class="headerlink" href="#autumn-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-autumn"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4506238198-1">(</span><span class="ss">test</span><span class="p" data-group-id="4506238198-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4506238198-2">(</span><span class="p" data-group-id="4506238198-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4506238198-3">]</span><span class="p" data-group-id="4506238198-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4506238198-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4506238198-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4506238198-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4506238198-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4506238198-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4506238198-9">}</span><span class="p" data-group-id="4506238198-6">]</span><span class="p" data-group-id="4506238198-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4506238198-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4506238198-11">}</span><span class="p" data-group-id="4506238198-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4506238198-12">(</span><span class="n">Port</span><span class="p" data-group-id="4506238198-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4506238198-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4506238198-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4506238198-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4506238198-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4506238198-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-17">[</span><span class="p" data-group-id="4506238198-18">[</span><span class="p" data-group-id="4506238198-18">]</span><span class="p" data-group-id="4506238198-17">]</span><span class="p" data-group-id="4506238198-16">)</span><span class="p" data-group-id="4506238198-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4506238198-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4506238198-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4506238198-20">(</span><span class="n">Players</span><span class="p" data-group-id="4506238198-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4506238198-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-22">[</span><span class="p" data-group-id="4506238198-22">]</span><span class="p" data-group-id="4506238198-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4506238198-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4506238198-24">(</span><span class="n">P</span><span class="p" data-group-id="4506238198-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4506238198-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-26">[</span><span class="n">P</span><span class="p" data-group-id="4506238198-26">]</span><span class="p" data-group-id="4506238198-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4506238198-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4506238198-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4506238198-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4506238198-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4506238198-29">(</span><span class="n">Player</span><span class="p" data-group-id="4506238198-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4506238198-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-31">[</span><span class="n">Player</span><span class="p" data-group-id="4506238198-31">]</span><span class="p" data-group-id="4506238198-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4506238198-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4506238198-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4506238198-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4506238198-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4506238198-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-36">[</span><span class="n">Player</span><span class="p" data-group-id="4506238198-36">]</span><span class="p" data-group-id="4506238198-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4506238198-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4506238198-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4506238198-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4506238198-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4506238198-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4506238198-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4506238198-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4506238198-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4506238198-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4506238198-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4506238198-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4506238198-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4506238198-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4506238198-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4506238198-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4506238198-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4506238198-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4506238198-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4506238198-49">(</span><span class="n">Player</span><span class="p" data-group-id="4506238198-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4506238198-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4506238198-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4506238198-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4506238198-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4506238198-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4506238198-53">(</span><span class="n">P</span><span class="p" data-group-id="4506238198-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4506238198-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4506238198-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4506238198-55">(</span><span class="n">P</span><span class="p" data-group-id="4506238198-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4506238198-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4506238198-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4506238198-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4506238198-57">(</span><span class="p" data-group-id="4506238198-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-58">{</span><span class="p" data-group-id="4506238198-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4506238198-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4506238198-60">}</span><span class="p" data-group-id="4506238198-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4506238198-61">(</span><span class="p" data-group-id="4506238198-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4506238198-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4506238198-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4506238198-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4506238198-64">]</span><span class="w">
        </span><span class="p" data-group-id="4506238198-63">)</span><span class="w">
    </span><span class="p" data-group-id="4506238198-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4506238198-65">(</span><span class="p" data-group-id="4506238198-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4506238198-66">(</span><span class="p" data-group-id="4506238198-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4506238198-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4506238198-68">]</span><span class="p" data-group-id="4506238198-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4506238198-69">(</span><span class="p" data-group-id="4506238198-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4506238198-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4506238198-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4506238198-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4506238198-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4506238198-72">(</span><span class="p" data-group-id="4506238198-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4506238198-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4506238198-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4506238198-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4506238198-76">]</span><span class="p" data-group-id="4506238198-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4506238198-78">(</span><span class="n">H</span><span class="p" data-group-id="4506238198-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4506238198-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4506238198-79">)</span><span class="p" data-group-id="4506238198-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4506238198-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4506238198-81">[</span><span class="p" data-group-id="4506238198-81">]</span><span class="p" data-group-id="4506238198-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4506238198-82">[</span><span class="p" data-group-id="4506238198-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4506238198-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4506238198-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4506238198-84">(</span><span class="p" data-group-id="4506238198-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4506238198-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4506238198-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4506238198-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4506238198-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4506238198-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4506238198-89">(</span><span class="p" data-group-id="4506238198-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4506238198-90">{</span><span class="nf">self</span><span class="p" data-group-id="4506238198-91">(</span><span class="p" data-group-id="4506238198-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4506238198-92">(</span><span class="n">X</span><span class="p" data-group-id="4506238198-92">)</span><span class="p" data-group-id="4506238198-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4506238198-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4506238198-87">]</span><span class="w">
    </span><span class="p" data-group-id="4506238198-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="borland">
    Borland Style (borland)<a class="headerlink" href="#borland" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-borland"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">borland_style</span><span class="p" data-group-id="5888585287-1">(</span><span class="p" data-group-id="5888585287-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="borland-example.erl">
      example.erl<a class="headerlink" href="#borland-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-borland"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6076271029-1">(</span><span class="ss">test</span><span class="p" data-group-id="6076271029-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6076271029-2">(</span><span class="p" data-group-id="6076271029-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6076271029-3">]</span><span class="p" data-group-id="6076271029-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6076271029-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6076271029-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6076271029-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6076271029-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6076271029-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6076271029-9">}</span><span class="p" data-group-id="6076271029-6">]</span><span class="p" data-group-id="6076271029-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6076271029-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6076271029-11">}</span><span class="p" data-group-id="6076271029-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6076271029-12">(</span><span class="n">Port</span><span class="p" data-group-id="6076271029-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6076271029-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6076271029-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6076271029-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6076271029-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6076271029-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-17">[</span><span class="p" data-group-id="6076271029-18">[</span><span class="p" data-group-id="6076271029-18">]</span><span class="p" data-group-id="6076271029-17">]</span><span class="p" data-group-id="6076271029-16">)</span><span class="p" data-group-id="6076271029-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6076271029-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6076271029-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6076271029-20">(</span><span class="n">Players</span><span class="p" data-group-id="6076271029-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6076271029-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-22">[</span><span class="p" data-group-id="6076271029-22">]</span><span class="p" data-group-id="6076271029-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6076271029-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6076271029-24">(</span><span class="n">P</span><span class="p" data-group-id="6076271029-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6076271029-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-26">[</span><span class="n">P</span><span class="p" data-group-id="6076271029-26">]</span><span class="p" data-group-id="6076271029-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6076271029-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6076271029-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6076271029-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6076271029-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6076271029-29">(</span><span class="n">Player</span><span class="p" data-group-id="6076271029-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6076271029-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-31">[</span><span class="n">Player</span><span class="p" data-group-id="6076271029-31">]</span><span class="p" data-group-id="6076271029-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6076271029-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6076271029-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6076271029-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6076271029-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6076271029-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-36">[</span><span class="n">Player</span><span class="p" data-group-id="6076271029-36">]</span><span class="p" data-group-id="6076271029-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6076271029-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6076271029-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6076271029-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6076271029-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6076271029-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6076271029-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6076271029-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6076271029-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6076271029-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6076271029-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6076271029-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6076271029-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6076271029-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6076271029-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6076271029-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6076271029-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6076271029-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6076271029-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6076271029-49">(</span><span class="n">Player</span><span class="p" data-group-id="6076271029-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6076271029-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6076271029-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6076271029-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6076271029-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6076271029-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6076271029-53">(</span><span class="n">P</span><span class="p" data-group-id="6076271029-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6076271029-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6076271029-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6076271029-55">(</span><span class="n">P</span><span class="p" data-group-id="6076271029-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6076271029-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6076271029-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6076271029-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6076271029-57">(</span><span class="p" data-group-id="6076271029-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-58">{</span><span class="p" data-group-id="6076271029-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6076271029-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6076271029-60">}</span><span class="p" data-group-id="6076271029-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6076271029-61">(</span><span class="p" data-group-id="6076271029-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6076271029-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6076271029-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6076271029-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6076271029-64">]</span><span class="w">
        </span><span class="p" data-group-id="6076271029-63">)</span><span class="w">
    </span><span class="p" data-group-id="6076271029-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6076271029-65">(</span><span class="p" data-group-id="6076271029-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6076271029-66">(</span><span class="p" data-group-id="6076271029-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6076271029-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6076271029-68">]</span><span class="p" data-group-id="6076271029-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6076271029-69">(</span><span class="p" data-group-id="6076271029-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6076271029-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6076271029-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6076271029-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6076271029-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6076271029-72">(</span><span class="p" data-group-id="6076271029-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6076271029-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6076271029-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6076271029-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6076271029-76">]</span><span class="p" data-group-id="6076271029-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6076271029-78">(</span><span class="n">H</span><span class="p" data-group-id="6076271029-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6076271029-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6076271029-79">)</span><span class="p" data-group-id="6076271029-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6076271029-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6076271029-81">[</span><span class="p" data-group-id="6076271029-81">]</span><span class="p" data-group-id="6076271029-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6076271029-82">[</span><span class="p" data-group-id="6076271029-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6076271029-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6076271029-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6076271029-84">(</span><span class="p" data-group-id="6076271029-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6076271029-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6076271029-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6076271029-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6076271029-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6076271029-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6076271029-89">(</span><span class="p" data-group-id="6076271029-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6076271029-90">{</span><span class="nf">self</span><span class="p" data-group-id="6076271029-91">(</span><span class="p" data-group-id="6076271029-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6076271029-92">(</span><span class="n">X</span><span class="p" data-group-id="6076271029-92">)</span><span class="p" data-group-id="6076271029-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6076271029-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6076271029-87">]</span><span class="w">
    </span><span class="p" data-group-id="6076271029-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="bw">
    BlackWhite Style (bw)<a class="headerlink" href="#bw" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-bw"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">bw_style</span><span class="p" data-group-id="3288896062-1">(</span><span class="p" data-group-id="3288896062-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="bw-example.erl">
      example.erl<a class="headerlink" href="#bw-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-bw"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6014485137-1">(</span><span class="ss">test</span><span class="p" data-group-id="6014485137-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6014485137-2">(</span><span class="p" data-group-id="6014485137-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6014485137-3">]</span><span class="p" data-group-id="6014485137-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6014485137-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6014485137-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6014485137-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6014485137-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6014485137-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6014485137-9">}</span><span class="p" data-group-id="6014485137-6">]</span><span class="p" data-group-id="6014485137-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6014485137-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6014485137-11">}</span><span class="p" data-group-id="6014485137-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6014485137-12">(</span><span class="n">Port</span><span class="p" data-group-id="6014485137-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6014485137-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6014485137-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6014485137-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6014485137-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6014485137-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-17">[</span><span class="p" data-group-id="6014485137-18">[</span><span class="p" data-group-id="6014485137-18">]</span><span class="p" data-group-id="6014485137-17">]</span><span class="p" data-group-id="6014485137-16">)</span><span class="p" data-group-id="6014485137-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6014485137-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6014485137-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6014485137-20">(</span><span class="n">Players</span><span class="p" data-group-id="6014485137-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6014485137-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-22">[</span><span class="p" data-group-id="6014485137-22">]</span><span class="p" data-group-id="6014485137-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6014485137-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6014485137-24">(</span><span class="n">P</span><span class="p" data-group-id="6014485137-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6014485137-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-26">[</span><span class="n">P</span><span class="p" data-group-id="6014485137-26">]</span><span class="p" data-group-id="6014485137-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6014485137-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6014485137-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6014485137-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6014485137-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6014485137-29">(</span><span class="n">Player</span><span class="p" data-group-id="6014485137-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6014485137-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-31">[</span><span class="n">Player</span><span class="p" data-group-id="6014485137-31">]</span><span class="p" data-group-id="6014485137-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6014485137-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6014485137-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6014485137-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6014485137-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6014485137-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-36">[</span><span class="n">Player</span><span class="p" data-group-id="6014485137-36">]</span><span class="p" data-group-id="6014485137-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6014485137-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6014485137-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6014485137-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6014485137-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6014485137-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6014485137-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6014485137-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6014485137-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6014485137-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6014485137-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6014485137-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6014485137-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6014485137-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6014485137-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6014485137-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6014485137-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6014485137-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6014485137-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6014485137-49">(</span><span class="n">Player</span><span class="p" data-group-id="6014485137-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6014485137-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6014485137-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6014485137-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6014485137-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6014485137-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6014485137-53">(</span><span class="n">P</span><span class="p" data-group-id="6014485137-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6014485137-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6014485137-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6014485137-55">(</span><span class="n">P</span><span class="p" data-group-id="6014485137-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6014485137-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6014485137-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6014485137-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6014485137-57">(</span><span class="p" data-group-id="6014485137-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-58">{</span><span class="p" data-group-id="6014485137-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6014485137-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6014485137-60">}</span><span class="p" data-group-id="6014485137-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6014485137-61">(</span><span class="p" data-group-id="6014485137-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6014485137-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6014485137-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6014485137-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6014485137-64">]</span><span class="w">
        </span><span class="p" data-group-id="6014485137-63">)</span><span class="w">
    </span><span class="p" data-group-id="6014485137-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6014485137-65">(</span><span class="p" data-group-id="6014485137-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6014485137-66">(</span><span class="p" data-group-id="6014485137-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6014485137-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6014485137-68">]</span><span class="p" data-group-id="6014485137-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6014485137-69">(</span><span class="p" data-group-id="6014485137-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6014485137-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6014485137-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6014485137-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6014485137-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6014485137-72">(</span><span class="p" data-group-id="6014485137-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6014485137-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6014485137-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6014485137-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6014485137-76">]</span><span class="p" data-group-id="6014485137-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6014485137-78">(</span><span class="n">H</span><span class="p" data-group-id="6014485137-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6014485137-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6014485137-79">)</span><span class="p" data-group-id="6014485137-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6014485137-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6014485137-81">[</span><span class="p" data-group-id="6014485137-81">]</span><span class="p" data-group-id="6014485137-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6014485137-82">[</span><span class="p" data-group-id="6014485137-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6014485137-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6014485137-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6014485137-84">(</span><span class="p" data-group-id="6014485137-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6014485137-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6014485137-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6014485137-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6014485137-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6014485137-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6014485137-89">(</span><span class="p" data-group-id="6014485137-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6014485137-90">{</span><span class="nf">self</span><span class="p" data-group-id="6014485137-91">(</span><span class="p" data-group-id="6014485137-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6014485137-92">(</span><span class="n">X</span><span class="p" data-group-id="6014485137-92">)</span><span class="p" data-group-id="6014485137-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6014485137-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6014485137-87">]</span><span class="w">
    </span><span class="p" data-group-id="6014485137-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="colorful">
    Colorful Style (colorful)<a class="headerlink" href="#colorful" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-colorful"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">colorful_style</span><span class="p" data-group-id="9917252779-1">(</span><span class="p" data-group-id="9917252779-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="colorful-example.erl">
      example.erl<a class="headerlink" href="#colorful-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-colorful"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3101634107-1">(</span><span class="ss">test</span><span class="p" data-group-id="3101634107-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3101634107-2">(</span><span class="p" data-group-id="3101634107-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="3101634107-3">]</span><span class="p" data-group-id="3101634107-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="3101634107-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="3101634107-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="3101634107-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3101634107-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3101634107-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3101634107-9">}</span><span class="p" data-group-id="3101634107-6">]</span><span class="p" data-group-id="3101634107-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="3101634107-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="3101634107-11">}</span><span class="p" data-group-id="3101634107-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="3101634107-12">(</span><span class="n">Port</span><span class="p" data-group-id="3101634107-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="3101634107-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="3101634107-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="3101634107-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="3101634107-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="3101634107-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-17">[</span><span class="p" data-group-id="3101634107-18">[</span><span class="p" data-group-id="3101634107-18">]</span><span class="p" data-group-id="3101634107-17">]</span><span class="p" data-group-id="3101634107-16">)</span><span class="p" data-group-id="3101634107-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="3101634107-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="3101634107-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="3101634107-20">(</span><span class="n">Players</span><span class="p" data-group-id="3101634107-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3101634107-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-22">[</span><span class="p" data-group-id="3101634107-22">]</span><span class="p" data-group-id="3101634107-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3101634107-23">(</span><span class="nf">fun</span><span class="p" data-group-id="3101634107-24">(</span><span class="n">P</span><span class="p" data-group-id="3101634107-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3101634107-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-26">[</span><span class="n">P</span><span class="p" data-group-id="3101634107-26">]</span><span class="p" data-group-id="3101634107-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3101634107-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3101634107-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="3101634107-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="3101634107-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3101634107-29">(</span><span class="n">Player</span><span class="p" data-group-id="3101634107-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3101634107-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-31">[</span><span class="n">Player</span><span class="p" data-group-id="3101634107-31">]</span><span class="p" data-group-id="3101634107-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3101634107-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3101634107-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3101634107-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3101634107-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3101634107-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-36">[</span><span class="n">Player</span><span class="p" data-group-id="3101634107-36">]</span><span class="p" data-group-id="3101634107-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="3101634107-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3101634107-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3101634107-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3101634107-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="3101634107-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3101634107-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3101634107-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="3101634107-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3101634107-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="3101634107-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="3101634107-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="3101634107-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="3101634107-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="3101634107-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="3101634107-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="3101634107-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="3101634107-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3101634107-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="3101634107-49">(</span><span class="n">Player</span><span class="p" data-group-id="3101634107-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3101634107-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="3101634107-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="3101634107-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3101634107-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="3101634107-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3101634107-53">(</span><span class="n">P</span><span class="p" data-group-id="3101634107-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="3101634107-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3101634107-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3101634107-55">(</span><span class="n">P</span><span class="p" data-group-id="3101634107-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3101634107-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3101634107-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="3101634107-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="3101634107-57">(</span><span class="p" data-group-id="3101634107-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-58">{</span><span class="p" data-group-id="3101634107-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="3101634107-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3101634107-60">}</span><span class="p" data-group-id="3101634107-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="3101634107-61">(</span><span class="p" data-group-id="3101634107-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="3101634107-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3101634107-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3101634107-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3101634107-64">]</span><span class="w">
        </span><span class="p" data-group-id="3101634107-63">)</span><span class="w">
    </span><span class="p" data-group-id="3101634107-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="3101634107-65">(</span><span class="p" data-group-id="3101634107-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="3101634107-66">(</span><span class="p" data-group-id="3101634107-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3101634107-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3101634107-68">]</span><span class="p" data-group-id="3101634107-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="3101634107-69">(</span><span class="p" data-group-id="3101634107-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3101634107-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3101634107-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="3101634107-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="3101634107-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="3101634107-72">(</span><span class="p" data-group-id="3101634107-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="3101634107-74">{</span><span class="ss">fff</span><span class="p" data-group-id="3101634107-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="3101634107-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3101634107-76">]</span><span class="p" data-group-id="3101634107-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-77">[</span><span class="n">Fun</span><span class="p" data-group-id="3101634107-78">(</span><span class="n">H</span><span class="p" data-group-id="3101634107-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3101634107-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3101634107-79">)</span><span class="p" data-group-id="3101634107-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="3101634107-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3101634107-81">[</span><span class="p" data-group-id="3101634107-81">]</span><span class="p" data-group-id="3101634107-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3101634107-82">[</span><span class="p" data-group-id="3101634107-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="3101634107-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="3101634107-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="3101634107-84">(</span><span class="p" data-group-id="3101634107-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3101634107-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="3101634107-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="3101634107-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3101634107-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="3101634107-88">(</span><span class="nf">fun</span><span class="p" data-group-id="3101634107-89">(</span><span class="p" data-group-id="3101634107-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3101634107-90">{</span><span class="nf">self</span><span class="p" data-group-id="3101634107-91">(</span><span class="p" data-group-id="3101634107-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="3101634107-92">(</span><span class="n">X</span><span class="p" data-group-id="3101634107-92">)</span><span class="p" data-group-id="3101634107-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="3101634107-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="3101634107-87">]</span><span class="w">
    </span><span class="p" data-group-id="3101634107-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="default">
    Default Style (default)<a class="headerlink" href="#default" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-default"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">default_style</span><span class="p" data-group-id="6767721704-1">(</span><span class="p" data-group-id="6767721704-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="default-example.erl">
      example.erl<a class="headerlink" href="#default-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-default"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1354244737-1">(</span><span class="ss">test</span><span class="p" data-group-id="1354244737-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1354244737-2">(</span><span class="p" data-group-id="1354244737-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1354244737-3">]</span><span class="p" data-group-id="1354244737-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1354244737-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1354244737-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1354244737-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1354244737-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1354244737-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1354244737-9">}</span><span class="p" data-group-id="1354244737-6">]</span><span class="p" data-group-id="1354244737-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1354244737-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1354244737-11">}</span><span class="p" data-group-id="1354244737-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1354244737-12">(</span><span class="n">Port</span><span class="p" data-group-id="1354244737-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1354244737-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1354244737-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1354244737-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1354244737-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1354244737-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-17">[</span><span class="p" data-group-id="1354244737-18">[</span><span class="p" data-group-id="1354244737-18">]</span><span class="p" data-group-id="1354244737-17">]</span><span class="p" data-group-id="1354244737-16">)</span><span class="p" data-group-id="1354244737-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1354244737-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1354244737-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1354244737-20">(</span><span class="n">Players</span><span class="p" data-group-id="1354244737-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1354244737-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-22">[</span><span class="p" data-group-id="1354244737-22">]</span><span class="p" data-group-id="1354244737-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1354244737-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1354244737-24">(</span><span class="n">P</span><span class="p" data-group-id="1354244737-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1354244737-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-26">[</span><span class="n">P</span><span class="p" data-group-id="1354244737-26">]</span><span class="p" data-group-id="1354244737-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1354244737-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1354244737-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1354244737-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1354244737-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1354244737-29">(</span><span class="n">Player</span><span class="p" data-group-id="1354244737-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1354244737-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-31">[</span><span class="n">Player</span><span class="p" data-group-id="1354244737-31">]</span><span class="p" data-group-id="1354244737-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1354244737-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1354244737-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1354244737-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1354244737-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1354244737-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-36">[</span><span class="n">Player</span><span class="p" data-group-id="1354244737-36">]</span><span class="p" data-group-id="1354244737-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1354244737-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1354244737-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1354244737-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1354244737-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1354244737-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1354244737-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1354244737-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1354244737-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1354244737-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1354244737-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1354244737-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1354244737-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1354244737-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1354244737-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1354244737-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1354244737-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1354244737-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1354244737-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1354244737-49">(</span><span class="n">Player</span><span class="p" data-group-id="1354244737-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1354244737-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1354244737-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1354244737-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1354244737-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1354244737-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1354244737-53">(</span><span class="n">P</span><span class="p" data-group-id="1354244737-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1354244737-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1354244737-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1354244737-55">(</span><span class="n">P</span><span class="p" data-group-id="1354244737-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1354244737-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1354244737-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1354244737-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1354244737-57">(</span><span class="p" data-group-id="1354244737-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-58">{</span><span class="p" data-group-id="1354244737-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1354244737-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1354244737-60">}</span><span class="p" data-group-id="1354244737-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1354244737-61">(</span><span class="p" data-group-id="1354244737-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1354244737-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1354244737-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1354244737-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1354244737-64">]</span><span class="w">
        </span><span class="p" data-group-id="1354244737-63">)</span><span class="w">
    </span><span class="p" data-group-id="1354244737-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1354244737-65">(</span><span class="p" data-group-id="1354244737-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1354244737-66">(</span><span class="p" data-group-id="1354244737-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1354244737-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1354244737-68">]</span><span class="p" data-group-id="1354244737-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1354244737-69">(</span><span class="p" data-group-id="1354244737-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1354244737-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1354244737-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1354244737-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1354244737-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1354244737-72">(</span><span class="p" data-group-id="1354244737-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1354244737-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1354244737-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1354244737-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1354244737-76">]</span><span class="p" data-group-id="1354244737-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1354244737-78">(</span><span class="n">H</span><span class="p" data-group-id="1354244737-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1354244737-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1354244737-79">)</span><span class="p" data-group-id="1354244737-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1354244737-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1354244737-81">[</span><span class="p" data-group-id="1354244737-81">]</span><span class="p" data-group-id="1354244737-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1354244737-82">[</span><span class="p" data-group-id="1354244737-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1354244737-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1354244737-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1354244737-84">(</span><span class="p" data-group-id="1354244737-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1354244737-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1354244737-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1354244737-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1354244737-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1354244737-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1354244737-89">(</span><span class="p" data-group-id="1354244737-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1354244737-90">{</span><span class="nf">self</span><span class="p" data-group-id="1354244737-91">(</span><span class="p" data-group-id="1354244737-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1354244737-92">(</span><span class="n">X</span><span class="p" data-group-id="1354244737-92">)</span><span class="p" data-group-id="1354244737-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1354244737-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1354244737-87">]</span><span class="w">
    </span><span class="p" data-group-id="1354244737-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="emacs">
    Emacs Style (emacs)<a class="headerlink" href="#emacs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-emacs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">emacs_style</span><span class="p" data-group-id="1231611801-1">(</span><span class="p" data-group-id="1231611801-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="emacs-example.erl">
      example.erl<a class="headerlink" href="#emacs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-emacs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1724341011-1">(</span><span class="ss">test</span><span class="p" data-group-id="1724341011-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1724341011-2">(</span><span class="p" data-group-id="1724341011-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1724341011-3">]</span><span class="p" data-group-id="1724341011-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1724341011-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1724341011-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1724341011-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1724341011-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1724341011-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1724341011-9">}</span><span class="p" data-group-id="1724341011-6">]</span><span class="p" data-group-id="1724341011-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1724341011-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1724341011-11">}</span><span class="p" data-group-id="1724341011-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1724341011-12">(</span><span class="n">Port</span><span class="p" data-group-id="1724341011-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1724341011-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1724341011-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1724341011-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1724341011-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1724341011-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-17">[</span><span class="p" data-group-id="1724341011-18">[</span><span class="p" data-group-id="1724341011-18">]</span><span class="p" data-group-id="1724341011-17">]</span><span class="p" data-group-id="1724341011-16">)</span><span class="p" data-group-id="1724341011-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1724341011-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1724341011-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1724341011-20">(</span><span class="n">Players</span><span class="p" data-group-id="1724341011-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1724341011-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-22">[</span><span class="p" data-group-id="1724341011-22">]</span><span class="p" data-group-id="1724341011-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1724341011-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1724341011-24">(</span><span class="n">P</span><span class="p" data-group-id="1724341011-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1724341011-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-26">[</span><span class="n">P</span><span class="p" data-group-id="1724341011-26">]</span><span class="p" data-group-id="1724341011-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1724341011-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1724341011-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1724341011-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1724341011-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1724341011-29">(</span><span class="n">Player</span><span class="p" data-group-id="1724341011-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1724341011-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-31">[</span><span class="n">Player</span><span class="p" data-group-id="1724341011-31">]</span><span class="p" data-group-id="1724341011-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1724341011-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1724341011-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1724341011-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1724341011-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1724341011-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-36">[</span><span class="n">Player</span><span class="p" data-group-id="1724341011-36">]</span><span class="p" data-group-id="1724341011-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1724341011-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1724341011-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1724341011-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1724341011-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1724341011-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1724341011-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1724341011-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1724341011-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1724341011-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1724341011-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1724341011-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1724341011-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1724341011-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1724341011-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1724341011-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1724341011-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1724341011-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1724341011-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1724341011-49">(</span><span class="n">Player</span><span class="p" data-group-id="1724341011-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1724341011-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1724341011-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1724341011-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1724341011-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1724341011-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1724341011-53">(</span><span class="n">P</span><span class="p" data-group-id="1724341011-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1724341011-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1724341011-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1724341011-55">(</span><span class="n">P</span><span class="p" data-group-id="1724341011-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1724341011-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1724341011-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1724341011-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1724341011-57">(</span><span class="p" data-group-id="1724341011-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-58">{</span><span class="p" data-group-id="1724341011-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1724341011-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1724341011-60">}</span><span class="p" data-group-id="1724341011-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1724341011-61">(</span><span class="p" data-group-id="1724341011-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1724341011-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1724341011-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1724341011-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1724341011-64">]</span><span class="w">
        </span><span class="p" data-group-id="1724341011-63">)</span><span class="w">
    </span><span class="p" data-group-id="1724341011-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1724341011-65">(</span><span class="p" data-group-id="1724341011-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1724341011-66">(</span><span class="p" data-group-id="1724341011-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1724341011-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1724341011-68">]</span><span class="p" data-group-id="1724341011-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1724341011-69">(</span><span class="p" data-group-id="1724341011-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1724341011-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1724341011-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1724341011-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1724341011-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1724341011-72">(</span><span class="p" data-group-id="1724341011-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1724341011-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1724341011-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1724341011-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1724341011-76">]</span><span class="p" data-group-id="1724341011-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1724341011-78">(</span><span class="n">H</span><span class="p" data-group-id="1724341011-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1724341011-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1724341011-79">)</span><span class="p" data-group-id="1724341011-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1724341011-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1724341011-81">[</span><span class="p" data-group-id="1724341011-81">]</span><span class="p" data-group-id="1724341011-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1724341011-82">[</span><span class="p" data-group-id="1724341011-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1724341011-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1724341011-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1724341011-84">(</span><span class="p" data-group-id="1724341011-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1724341011-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1724341011-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1724341011-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1724341011-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1724341011-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1724341011-89">(</span><span class="p" data-group-id="1724341011-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1724341011-90">{</span><span class="nf">self</span><span class="p" data-group-id="1724341011-91">(</span><span class="p" data-group-id="1724341011-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1724341011-92">(</span><span class="n">X</span><span class="p" data-group-id="1724341011-92">)</span><span class="p" data-group-id="1724341011-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1724341011-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1724341011-87">]</span><span class="w">
    </span><span class="p" data-group-id="1724341011-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="friendly">
    Friendly Style (friendly)<a class="headerlink" href="#friendly" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-friendly"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">friendly_style</span><span class="p" data-group-id="2114631124-1">(</span><span class="p" data-group-id="2114631124-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="friendly-example.erl">
      example.erl<a class="headerlink" href="#friendly-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-friendly"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1044212542-1">(</span><span class="ss">test</span><span class="p" data-group-id="1044212542-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1044212542-2">(</span><span class="p" data-group-id="1044212542-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1044212542-3">]</span><span class="p" data-group-id="1044212542-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1044212542-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1044212542-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1044212542-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1044212542-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1044212542-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1044212542-9">}</span><span class="p" data-group-id="1044212542-6">]</span><span class="p" data-group-id="1044212542-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1044212542-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1044212542-11">}</span><span class="p" data-group-id="1044212542-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1044212542-12">(</span><span class="n">Port</span><span class="p" data-group-id="1044212542-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1044212542-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1044212542-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1044212542-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1044212542-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1044212542-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-17">[</span><span class="p" data-group-id="1044212542-18">[</span><span class="p" data-group-id="1044212542-18">]</span><span class="p" data-group-id="1044212542-17">]</span><span class="p" data-group-id="1044212542-16">)</span><span class="p" data-group-id="1044212542-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1044212542-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1044212542-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1044212542-20">(</span><span class="n">Players</span><span class="p" data-group-id="1044212542-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1044212542-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-22">[</span><span class="p" data-group-id="1044212542-22">]</span><span class="p" data-group-id="1044212542-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1044212542-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1044212542-24">(</span><span class="n">P</span><span class="p" data-group-id="1044212542-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1044212542-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-26">[</span><span class="n">P</span><span class="p" data-group-id="1044212542-26">]</span><span class="p" data-group-id="1044212542-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1044212542-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1044212542-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1044212542-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1044212542-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1044212542-29">(</span><span class="n">Player</span><span class="p" data-group-id="1044212542-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1044212542-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-31">[</span><span class="n">Player</span><span class="p" data-group-id="1044212542-31">]</span><span class="p" data-group-id="1044212542-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1044212542-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1044212542-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1044212542-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1044212542-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1044212542-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-36">[</span><span class="n">Player</span><span class="p" data-group-id="1044212542-36">]</span><span class="p" data-group-id="1044212542-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1044212542-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1044212542-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1044212542-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1044212542-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1044212542-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1044212542-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1044212542-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1044212542-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1044212542-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1044212542-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1044212542-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1044212542-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1044212542-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1044212542-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1044212542-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1044212542-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1044212542-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1044212542-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1044212542-49">(</span><span class="n">Player</span><span class="p" data-group-id="1044212542-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1044212542-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1044212542-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1044212542-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1044212542-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1044212542-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1044212542-53">(</span><span class="n">P</span><span class="p" data-group-id="1044212542-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1044212542-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1044212542-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1044212542-55">(</span><span class="n">P</span><span class="p" data-group-id="1044212542-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1044212542-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1044212542-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1044212542-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1044212542-57">(</span><span class="p" data-group-id="1044212542-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-58">{</span><span class="p" data-group-id="1044212542-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1044212542-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1044212542-60">}</span><span class="p" data-group-id="1044212542-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1044212542-61">(</span><span class="p" data-group-id="1044212542-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1044212542-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1044212542-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1044212542-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1044212542-64">]</span><span class="w">
        </span><span class="p" data-group-id="1044212542-63">)</span><span class="w">
    </span><span class="p" data-group-id="1044212542-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1044212542-65">(</span><span class="p" data-group-id="1044212542-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1044212542-66">(</span><span class="p" data-group-id="1044212542-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1044212542-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1044212542-68">]</span><span class="p" data-group-id="1044212542-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1044212542-69">(</span><span class="p" data-group-id="1044212542-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1044212542-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1044212542-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1044212542-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1044212542-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1044212542-72">(</span><span class="p" data-group-id="1044212542-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1044212542-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1044212542-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1044212542-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1044212542-76">]</span><span class="p" data-group-id="1044212542-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1044212542-78">(</span><span class="n">H</span><span class="p" data-group-id="1044212542-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1044212542-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1044212542-79">)</span><span class="p" data-group-id="1044212542-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1044212542-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1044212542-81">[</span><span class="p" data-group-id="1044212542-81">]</span><span class="p" data-group-id="1044212542-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1044212542-82">[</span><span class="p" data-group-id="1044212542-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1044212542-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1044212542-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1044212542-84">(</span><span class="p" data-group-id="1044212542-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1044212542-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1044212542-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1044212542-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1044212542-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1044212542-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1044212542-89">(</span><span class="p" data-group-id="1044212542-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1044212542-90">{</span><span class="nf">self</span><span class="p" data-group-id="1044212542-91">(</span><span class="p" data-group-id="1044212542-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1044212542-92">(</span><span class="n">X</span><span class="p" data-group-id="1044212542-92">)</span><span class="p" data-group-id="1044212542-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1044212542-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1044212542-87">]</span><span class="w">
    </span><span class="p" data-group-id="1044212542-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="fruity">
    Fruity Style (fruity)<a class="headerlink" href="#fruity" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-fruity"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">fruity_style</span><span class="p" data-group-id="5701008097-1">(</span><span class="p" data-group-id="5701008097-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="fruity-example.erl">
      example.erl<a class="headerlink" href="#fruity-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-fruity"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0131113583-1">(</span><span class="ss">test</span><span class="p" data-group-id="0131113583-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0131113583-2">(</span><span class="p" data-group-id="0131113583-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0131113583-3">]</span><span class="p" data-group-id="0131113583-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0131113583-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0131113583-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0131113583-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0131113583-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0131113583-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0131113583-9">}</span><span class="p" data-group-id="0131113583-6">]</span><span class="p" data-group-id="0131113583-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0131113583-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0131113583-11">}</span><span class="p" data-group-id="0131113583-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0131113583-12">(</span><span class="n">Port</span><span class="p" data-group-id="0131113583-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0131113583-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0131113583-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0131113583-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0131113583-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0131113583-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-17">[</span><span class="p" data-group-id="0131113583-18">[</span><span class="p" data-group-id="0131113583-18">]</span><span class="p" data-group-id="0131113583-17">]</span><span class="p" data-group-id="0131113583-16">)</span><span class="p" data-group-id="0131113583-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0131113583-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0131113583-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0131113583-20">(</span><span class="n">Players</span><span class="p" data-group-id="0131113583-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0131113583-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-22">[</span><span class="p" data-group-id="0131113583-22">]</span><span class="p" data-group-id="0131113583-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0131113583-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0131113583-24">(</span><span class="n">P</span><span class="p" data-group-id="0131113583-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0131113583-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-26">[</span><span class="n">P</span><span class="p" data-group-id="0131113583-26">]</span><span class="p" data-group-id="0131113583-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0131113583-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0131113583-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0131113583-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0131113583-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0131113583-29">(</span><span class="n">Player</span><span class="p" data-group-id="0131113583-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0131113583-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-31">[</span><span class="n">Player</span><span class="p" data-group-id="0131113583-31">]</span><span class="p" data-group-id="0131113583-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0131113583-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0131113583-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0131113583-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0131113583-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0131113583-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-36">[</span><span class="n">Player</span><span class="p" data-group-id="0131113583-36">]</span><span class="p" data-group-id="0131113583-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0131113583-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0131113583-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0131113583-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0131113583-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0131113583-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0131113583-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0131113583-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0131113583-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0131113583-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0131113583-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0131113583-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0131113583-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0131113583-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0131113583-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0131113583-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0131113583-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0131113583-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0131113583-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0131113583-49">(</span><span class="n">Player</span><span class="p" data-group-id="0131113583-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0131113583-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0131113583-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0131113583-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0131113583-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0131113583-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0131113583-53">(</span><span class="n">P</span><span class="p" data-group-id="0131113583-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0131113583-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0131113583-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0131113583-55">(</span><span class="n">P</span><span class="p" data-group-id="0131113583-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0131113583-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0131113583-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0131113583-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0131113583-57">(</span><span class="p" data-group-id="0131113583-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-58">{</span><span class="p" data-group-id="0131113583-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0131113583-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0131113583-60">}</span><span class="p" data-group-id="0131113583-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0131113583-61">(</span><span class="p" data-group-id="0131113583-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0131113583-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0131113583-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0131113583-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0131113583-64">]</span><span class="w">
        </span><span class="p" data-group-id="0131113583-63">)</span><span class="w">
    </span><span class="p" data-group-id="0131113583-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0131113583-65">(</span><span class="p" data-group-id="0131113583-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0131113583-66">(</span><span class="p" data-group-id="0131113583-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0131113583-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0131113583-68">]</span><span class="p" data-group-id="0131113583-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0131113583-69">(</span><span class="p" data-group-id="0131113583-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0131113583-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0131113583-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0131113583-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0131113583-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0131113583-72">(</span><span class="p" data-group-id="0131113583-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0131113583-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0131113583-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0131113583-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0131113583-76">]</span><span class="p" data-group-id="0131113583-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0131113583-78">(</span><span class="n">H</span><span class="p" data-group-id="0131113583-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0131113583-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0131113583-79">)</span><span class="p" data-group-id="0131113583-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0131113583-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0131113583-81">[</span><span class="p" data-group-id="0131113583-81">]</span><span class="p" data-group-id="0131113583-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0131113583-82">[</span><span class="p" data-group-id="0131113583-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0131113583-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0131113583-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0131113583-84">(</span><span class="p" data-group-id="0131113583-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0131113583-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0131113583-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0131113583-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0131113583-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0131113583-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0131113583-89">(</span><span class="p" data-group-id="0131113583-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0131113583-90">{</span><span class="nf">self</span><span class="p" data-group-id="0131113583-91">(</span><span class="p" data-group-id="0131113583-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0131113583-92">(</span><span class="n">X</span><span class="p" data-group-id="0131113583-92">)</span><span class="p" data-group-id="0131113583-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0131113583-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0131113583-87">]</span><span class="w">
    </span><span class="p" data-group-id="0131113583-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="igor">
    Igor Style (igor)<a class="headerlink" href="#igor" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-igor"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">igor_style</span><span class="p" data-group-id="2869939117-1">(</span><span class="p" data-group-id="2869939117-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="igor-example.erl">
      example.erl<a class="headerlink" href="#igor-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-igor"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9799587013-1">(</span><span class="ss">test</span><span class="p" data-group-id="9799587013-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9799587013-2">(</span><span class="p" data-group-id="9799587013-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9799587013-3">]</span><span class="p" data-group-id="9799587013-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9799587013-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9799587013-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9799587013-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9799587013-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9799587013-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9799587013-9">}</span><span class="p" data-group-id="9799587013-6">]</span><span class="p" data-group-id="9799587013-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9799587013-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9799587013-11">}</span><span class="p" data-group-id="9799587013-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9799587013-12">(</span><span class="n">Port</span><span class="p" data-group-id="9799587013-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9799587013-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9799587013-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9799587013-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9799587013-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9799587013-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-17">[</span><span class="p" data-group-id="9799587013-18">[</span><span class="p" data-group-id="9799587013-18">]</span><span class="p" data-group-id="9799587013-17">]</span><span class="p" data-group-id="9799587013-16">)</span><span class="p" data-group-id="9799587013-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9799587013-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9799587013-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9799587013-20">(</span><span class="n">Players</span><span class="p" data-group-id="9799587013-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9799587013-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-22">[</span><span class="p" data-group-id="9799587013-22">]</span><span class="p" data-group-id="9799587013-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9799587013-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9799587013-24">(</span><span class="n">P</span><span class="p" data-group-id="9799587013-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9799587013-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-26">[</span><span class="n">P</span><span class="p" data-group-id="9799587013-26">]</span><span class="p" data-group-id="9799587013-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9799587013-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9799587013-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9799587013-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9799587013-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9799587013-29">(</span><span class="n">Player</span><span class="p" data-group-id="9799587013-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9799587013-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-31">[</span><span class="n">Player</span><span class="p" data-group-id="9799587013-31">]</span><span class="p" data-group-id="9799587013-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9799587013-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9799587013-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9799587013-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9799587013-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9799587013-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-36">[</span><span class="n">Player</span><span class="p" data-group-id="9799587013-36">]</span><span class="p" data-group-id="9799587013-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9799587013-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9799587013-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9799587013-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9799587013-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9799587013-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9799587013-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9799587013-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9799587013-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9799587013-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9799587013-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9799587013-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9799587013-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9799587013-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9799587013-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9799587013-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9799587013-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9799587013-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9799587013-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9799587013-49">(</span><span class="n">Player</span><span class="p" data-group-id="9799587013-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9799587013-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9799587013-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9799587013-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9799587013-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9799587013-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9799587013-53">(</span><span class="n">P</span><span class="p" data-group-id="9799587013-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9799587013-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9799587013-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9799587013-55">(</span><span class="n">P</span><span class="p" data-group-id="9799587013-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9799587013-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9799587013-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9799587013-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9799587013-57">(</span><span class="p" data-group-id="9799587013-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-58">{</span><span class="p" data-group-id="9799587013-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9799587013-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9799587013-60">}</span><span class="p" data-group-id="9799587013-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9799587013-61">(</span><span class="p" data-group-id="9799587013-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9799587013-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9799587013-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9799587013-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9799587013-64">]</span><span class="w">
        </span><span class="p" data-group-id="9799587013-63">)</span><span class="w">
    </span><span class="p" data-group-id="9799587013-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9799587013-65">(</span><span class="p" data-group-id="9799587013-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9799587013-66">(</span><span class="p" data-group-id="9799587013-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9799587013-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9799587013-68">]</span><span class="p" data-group-id="9799587013-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9799587013-69">(</span><span class="p" data-group-id="9799587013-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9799587013-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9799587013-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9799587013-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9799587013-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9799587013-72">(</span><span class="p" data-group-id="9799587013-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9799587013-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9799587013-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9799587013-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9799587013-76">]</span><span class="p" data-group-id="9799587013-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9799587013-78">(</span><span class="n">H</span><span class="p" data-group-id="9799587013-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9799587013-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9799587013-79">)</span><span class="p" data-group-id="9799587013-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9799587013-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9799587013-81">[</span><span class="p" data-group-id="9799587013-81">]</span><span class="p" data-group-id="9799587013-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9799587013-82">[</span><span class="p" data-group-id="9799587013-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9799587013-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9799587013-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9799587013-84">(</span><span class="p" data-group-id="9799587013-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9799587013-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9799587013-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9799587013-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9799587013-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9799587013-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9799587013-89">(</span><span class="p" data-group-id="9799587013-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9799587013-90">{</span><span class="nf">self</span><span class="p" data-group-id="9799587013-91">(</span><span class="p" data-group-id="9799587013-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9799587013-92">(</span><span class="n">X</span><span class="p" data-group-id="9799587013-92">)</span><span class="p" data-group-id="9799587013-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9799587013-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9799587013-87">]</span><span class="w">
    </span><span class="p" data-group-id="9799587013-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="lovelace">
    Lovelace Style (lovelace)<a class="headerlink" href="#lovelace" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-lovelace"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">lovelace_style</span><span class="p" data-group-id="6963520463-1">(</span><span class="p" data-group-id="6963520463-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="lovelace-example.erl">
      example.erl<a class="headerlink" href="#lovelace-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-lovelace"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4281945890-1">(</span><span class="ss">test</span><span class="p" data-group-id="4281945890-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4281945890-2">(</span><span class="p" data-group-id="4281945890-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4281945890-3">]</span><span class="p" data-group-id="4281945890-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4281945890-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4281945890-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4281945890-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4281945890-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4281945890-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4281945890-9">}</span><span class="p" data-group-id="4281945890-6">]</span><span class="p" data-group-id="4281945890-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4281945890-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4281945890-11">}</span><span class="p" data-group-id="4281945890-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4281945890-12">(</span><span class="n">Port</span><span class="p" data-group-id="4281945890-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4281945890-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4281945890-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4281945890-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4281945890-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4281945890-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-17">[</span><span class="p" data-group-id="4281945890-18">[</span><span class="p" data-group-id="4281945890-18">]</span><span class="p" data-group-id="4281945890-17">]</span><span class="p" data-group-id="4281945890-16">)</span><span class="p" data-group-id="4281945890-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4281945890-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4281945890-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4281945890-20">(</span><span class="n">Players</span><span class="p" data-group-id="4281945890-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4281945890-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-22">[</span><span class="p" data-group-id="4281945890-22">]</span><span class="p" data-group-id="4281945890-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4281945890-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4281945890-24">(</span><span class="n">P</span><span class="p" data-group-id="4281945890-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4281945890-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-26">[</span><span class="n">P</span><span class="p" data-group-id="4281945890-26">]</span><span class="p" data-group-id="4281945890-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4281945890-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4281945890-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4281945890-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4281945890-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4281945890-29">(</span><span class="n">Player</span><span class="p" data-group-id="4281945890-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4281945890-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-31">[</span><span class="n">Player</span><span class="p" data-group-id="4281945890-31">]</span><span class="p" data-group-id="4281945890-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4281945890-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4281945890-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4281945890-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4281945890-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4281945890-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-36">[</span><span class="n">Player</span><span class="p" data-group-id="4281945890-36">]</span><span class="p" data-group-id="4281945890-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4281945890-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4281945890-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4281945890-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4281945890-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4281945890-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4281945890-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4281945890-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4281945890-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4281945890-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4281945890-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4281945890-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4281945890-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4281945890-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4281945890-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4281945890-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4281945890-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4281945890-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4281945890-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4281945890-49">(</span><span class="n">Player</span><span class="p" data-group-id="4281945890-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4281945890-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4281945890-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4281945890-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4281945890-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4281945890-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4281945890-53">(</span><span class="n">P</span><span class="p" data-group-id="4281945890-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4281945890-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4281945890-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4281945890-55">(</span><span class="n">P</span><span class="p" data-group-id="4281945890-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4281945890-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4281945890-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4281945890-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4281945890-57">(</span><span class="p" data-group-id="4281945890-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-58">{</span><span class="p" data-group-id="4281945890-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4281945890-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4281945890-60">}</span><span class="p" data-group-id="4281945890-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4281945890-61">(</span><span class="p" data-group-id="4281945890-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4281945890-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4281945890-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4281945890-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4281945890-64">]</span><span class="w">
        </span><span class="p" data-group-id="4281945890-63">)</span><span class="w">
    </span><span class="p" data-group-id="4281945890-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4281945890-65">(</span><span class="p" data-group-id="4281945890-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4281945890-66">(</span><span class="p" data-group-id="4281945890-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4281945890-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4281945890-68">]</span><span class="p" data-group-id="4281945890-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4281945890-69">(</span><span class="p" data-group-id="4281945890-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4281945890-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4281945890-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4281945890-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4281945890-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4281945890-72">(</span><span class="p" data-group-id="4281945890-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4281945890-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4281945890-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4281945890-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4281945890-76">]</span><span class="p" data-group-id="4281945890-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4281945890-78">(</span><span class="n">H</span><span class="p" data-group-id="4281945890-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4281945890-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4281945890-79">)</span><span class="p" data-group-id="4281945890-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4281945890-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4281945890-81">[</span><span class="p" data-group-id="4281945890-81">]</span><span class="p" data-group-id="4281945890-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4281945890-82">[</span><span class="p" data-group-id="4281945890-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4281945890-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4281945890-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4281945890-84">(</span><span class="p" data-group-id="4281945890-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4281945890-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4281945890-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4281945890-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4281945890-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4281945890-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4281945890-89">(</span><span class="p" data-group-id="4281945890-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4281945890-90">{</span><span class="nf">self</span><span class="p" data-group-id="4281945890-91">(</span><span class="p" data-group-id="4281945890-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4281945890-92">(</span><span class="n">X</span><span class="p" data-group-id="4281945890-92">)</span><span class="p" data-group-id="4281945890-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4281945890-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4281945890-87">]</span><span class="w">
    </span><span class="p" data-group-id="4281945890-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="manni">
    Manni Style (manni)<a class="headerlink" href="#manni" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-manni"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">manni_style</span><span class="p" data-group-id="8454594756-1">(</span><span class="p" data-group-id="8454594756-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="manni-example.erl">
      example.erl<a class="headerlink" href="#manni-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-manni"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6997015406-1">(</span><span class="ss">test</span><span class="p" data-group-id="6997015406-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6997015406-2">(</span><span class="p" data-group-id="6997015406-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6997015406-3">]</span><span class="p" data-group-id="6997015406-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6997015406-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6997015406-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6997015406-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6997015406-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6997015406-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6997015406-9">}</span><span class="p" data-group-id="6997015406-6">]</span><span class="p" data-group-id="6997015406-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6997015406-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6997015406-11">}</span><span class="p" data-group-id="6997015406-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6997015406-12">(</span><span class="n">Port</span><span class="p" data-group-id="6997015406-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6997015406-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6997015406-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6997015406-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6997015406-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6997015406-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-17">[</span><span class="p" data-group-id="6997015406-18">[</span><span class="p" data-group-id="6997015406-18">]</span><span class="p" data-group-id="6997015406-17">]</span><span class="p" data-group-id="6997015406-16">)</span><span class="p" data-group-id="6997015406-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6997015406-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6997015406-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6997015406-20">(</span><span class="n">Players</span><span class="p" data-group-id="6997015406-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6997015406-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-22">[</span><span class="p" data-group-id="6997015406-22">]</span><span class="p" data-group-id="6997015406-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6997015406-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6997015406-24">(</span><span class="n">P</span><span class="p" data-group-id="6997015406-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6997015406-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-26">[</span><span class="n">P</span><span class="p" data-group-id="6997015406-26">]</span><span class="p" data-group-id="6997015406-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6997015406-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6997015406-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6997015406-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6997015406-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6997015406-29">(</span><span class="n">Player</span><span class="p" data-group-id="6997015406-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6997015406-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-31">[</span><span class="n">Player</span><span class="p" data-group-id="6997015406-31">]</span><span class="p" data-group-id="6997015406-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6997015406-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6997015406-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6997015406-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6997015406-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6997015406-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-36">[</span><span class="n">Player</span><span class="p" data-group-id="6997015406-36">]</span><span class="p" data-group-id="6997015406-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6997015406-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6997015406-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6997015406-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6997015406-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6997015406-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6997015406-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6997015406-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6997015406-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6997015406-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6997015406-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6997015406-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6997015406-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6997015406-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6997015406-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6997015406-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6997015406-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6997015406-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6997015406-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6997015406-49">(</span><span class="n">Player</span><span class="p" data-group-id="6997015406-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6997015406-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6997015406-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6997015406-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6997015406-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6997015406-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6997015406-53">(</span><span class="n">P</span><span class="p" data-group-id="6997015406-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6997015406-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6997015406-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6997015406-55">(</span><span class="n">P</span><span class="p" data-group-id="6997015406-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6997015406-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6997015406-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6997015406-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6997015406-57">(</span><span class="p" data-group-id="6997015406-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-58">{</span><span class="p" data-group-id="6997015406-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6997015406-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6997015406-60">}</span><span class="p" data-group-id="6997015406-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6997015406-61">(</span><span class="p" data-group-id="6997015406-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6997015406-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6997015406-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6997015406-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6997015406-64">]</span><span class="w">
        </span><span class="p" data-group-id="6997015406-63">)</span><span class="w">
    </span><span class="p" data-group-id="6997015406-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6997015406-65">(</span><span class="p" data-group-id="6997015406-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6997015406-66">(</span><span class="p" data-group-id="6997015406-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6997015406-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6997015406-68">]</span><span class="p" data-group-id="6997015406-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6997015406-69">(</span><span class="p" data-group-id="6997015406-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6997015406-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6997015406-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6997015406-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6997015406-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6997015406-72">(</span><span class="p" data-group-id="6997015406-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6997015406-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6997015406-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6997015406-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6997015406-76">]</span><span class="p" data-group-id="6997015406-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6997015406-78">(</span><span class="n">H</span><span class="p" data-group-id="6997015406-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6997015406-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6997015406-79">)</span><span class="p" data-group-id="6997015406-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6997015406-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6997015406-81">[</span><span class="p" data-group-id="6997015406-81">]</span><span class="p" data-group-id="6997015406-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6997015406-82">[</span><span class="p" data-group-id="6997015406-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6997015406-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6997015406-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6997015406-84">(</span><span class="p" data-group-id="6997015406-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6997015406-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6997015406-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6997015406-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6997015406-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6997015406-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6997015406-89">(</span><span class="p" data-group-id="6997015406-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6997015406-90">{</span><span class="nf">self</span><span class="p" data-group-id="6997015406-91">(</span><span class="p" data-group-id="6997015406-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6997015406-92">(</span><span class="n">X</span><span class="p" data-group-id="6997015406-92">)</span><span class="p" data-group-id="6997015406-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6997015406-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6997015406-87">]</span><span class="w">
    </span><span class="p" data-group-id="6997015406-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="monokai">
    Monokai Style (monokai)<a class="headerlink" href="#monokai" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-monokai"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">monokai_style</span><span class="p" data-group-id="5882237296-1">(</span><span class="p" data-group-id="5882237296-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="monokai-example.erl">
      example.erl<a class="headerlink" href="#monokai-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-monokai"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4154777980-1">(</span><span class="ss">test</span><span class="p" data-group-id="4154777980-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4154777980-2">(</span><span class="p" data-group-id="4154777980-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4154777980-3">]</span><span class="p" data-group-id="4154777980-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4154777980-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4154777980-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4154777980-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4154777980-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4154777980-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4154777980-9">}</span><span class="p" data-group-id="4154777980-6">]</span><span class="p" data-group-id="4154777980-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4154777980-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4154777980-11">}</span><span class="p" data-group-id="4154777980-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4154777980-12">(</span><span class="n">Port</span><span class="p" data-group-id="4154777980-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4154777980-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4154777980-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4154777980-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4154777980-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4154777980-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-17">[</span><span class="p" data-group-id="4154777980-18">[</span><span class="p" data-group-id="4154777980-18">]</span><span class="p" data-group-id="4154777980-17">]</span><span class="p" data-group-id="4154777980-16">)</span><span class="p" data-group-id="4154777980-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4154777980-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4154777980-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4154777980-20">(</span><span class="n">Players</span><span class="p" data-group-id="4154777980-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4154777980-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-22">[</span><span class="p" data-group-id="4154777980-22">]</span><span class="p" data-group-id="4154777980-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4154777980-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4154777980-24">(</span><span class="n">P</span><span class="p" data-group-id="4154777980-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4154777980-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-26">[</span><span class="n">P</span><span class="p" data-group-id="4154777980-26">]</span><span class="p" data-group-id="4154777980-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4154777980-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4154777980-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4154777980-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4154777980-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4154777980-29">(</span><span class="n">Player</span><span class="p" data-group-id="4154777980-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4154777980-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-31">[</span><span class="n">Player</span><span class="p" data-group-id="4154777980-31">]</span><span class="p" data-group-id="4154777980-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4154777980-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4154777980-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4154777980-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4154777980-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4154777980-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-36">[</span><span class="n">Player</span><span class="p" data-group-id="4154777980-36">]</span><span class="p" data-group-id="4154777980-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4154777980-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4154777980-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4154777980-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4154777980-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4154777980-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4154777980-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4154777980-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4154777980-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4154777980-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4154777980-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4154777980-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4154777980-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4154777980-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4154777980-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4154777980-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4154777980-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4154777980-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4154777980-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4154777980-49">(</span><span class="n">Player</span><span class="p" data-group-id="4154777980-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4154777980-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4154777980-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4154777980-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4154777980-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4154777980-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4154777980-53">(</span><span class="n">P</span><span class="p" data-group-id="4154777980-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4154777980-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4154777980-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4154777980-55">(</span><span class="n">P</span><span class="p" data-group-id="4154777980-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4154777980-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4154777980-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4154777980-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4154777980-57">(</span><span class="p" data-group-id="4154777980-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-58">{</span><span class="p" data-group-id="4154777980-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4154777980-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4154777980-60">}</span><span class="p" data-group-id="4154777980-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4154777980-61">(</span><span class="p" data-group-id="4154777980-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4154777980-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4154777980-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4154777980-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4154777980-64">]</span><span class="w">
        </span><span class="p" data-group-id="4154777980-63">)</span><span class="w">
    </span><span class="p" data-group-id="4154777980-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4154777980-65">(</span><span class="p" data-group-id="4154777980-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4154777980-66">(</span><span class="p" data-group-id="4154777980-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4154777980-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4154777980-68">]</span><span class="p" data-group-id="4154777980-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4154777980-69">(</span><span class="p" data-group-id="4154777980-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4154777980-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4154777980-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4154777980-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4154777980-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4154777980-72">(</span><span class="p" data-group-id="4154777980-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4154777980-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4154777980-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4154777980-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4154777980-76">]</span><span class="p" data-group-id="4154777980-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4154777980-78">(</span><span class="n">H</span><span class="p" data-group-id="4154777980-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4154777980-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4154777980-79">)</span><span class="p" data-group-id="4154777980-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4154777980-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4154777980-81">[</span><span class="p" data-group-id="4154777980-81">]</span><span class="p" data-group-id="4154777980-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4154777980-82">[</span><span class="p" data-group-id="4154777980-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4154777980-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4154777980-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4154777980-84">(</span><span class="p" data-group-id="4154777980-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4154777980-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4154777980-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4154777980-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4154777980-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4154777980-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4154777980-89">(</span><span class="p" data-group-id="4154777980-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4154777980-90">{</span><span class="nf">self</span><span class="p" data-group-id="4154777980-91">(</span><span class="p" data-group-id="4154777980-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4154777980-92">(</span><span class="n">X</span><span class="p" data-group-id="4154777980-92">)</span><span class="p" data-group-id="4154777980-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4154777980-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4154777980-87">]</span><span class="w">
    </span><span class="p" data-group-id="4154777980-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="murphy">
    Murphy Style (murphy)<a class="headerlink" href="#murphy" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-murphy"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">murphy_style</span><span class="p" data-group-id="5601207798-1">(</span><span class="p" data-group-id="5601207798-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="murphy-example.erl">
      example.erl<a class="headerlink" href="#murphy-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-murphy"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9113590283-1">(</span><span class="ss">test</span><span class="p" data-group-id="9113590283-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9113590283-2">(</span><span class="p" data-group-id="9113590283-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9113590283-3">]</span><span class="p" data-group-id="9113590283-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9113590283-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9113590283-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9113590283-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9113590283-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9113590283-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9113590283-9">}</span><span class="p" data-group-id="9113590283-6">]</span><span class="p" data-group-id="9113590283-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9113590283-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9113590283-11">}</span><span class="p" data-group-id="9113590283-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9113590283-12">(</span><span class="n">Port</span><span class="p" data-group-id="9113590283-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9113590283-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9113590283-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9113590283-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9113590283-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9113590283-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-17">[</span><span class="p" data-group-id="9113590283-18">[</span><span class="p" data-group-id="9113590283-18">]</span><span class="p" data-group-id="9113590283-17">]</span><span class="p" data-group-id="9113590283-16">)</span><span class="p" data-group-id="9113590283-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9113590283-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9113590283-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9113590283-20">(</span><span class="n">Players</span><span class="p" data-group-id="9113590283-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9113590283-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-22">[</span><span class="p" data-group-id="9113590283-22">]</span><span class="p" data-group-id="9113590283-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9113590283-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9113590283-24">(</span><span class="n">P</span><span class="p" data-group-id="9113590283-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9113590283-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-26">[</span><span class="n">P</span><span class="p" data-group-id="9113590283-26">]</span><span class="p" data-group-id="9113590283-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9113590283-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9113590283-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9113590283-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9113590283-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9113590283-29">(</span><span class="n">Player</span><span class="p" data-group-id="9113590283-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9113590283-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-31">[</span><span class="n">Player</span><span class="p" data-group-id="9113590283-31">]</span><span class="p" data-group-id="9113590283-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9113590283-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9113590283-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9113590283-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9113590283-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9113590283-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-36">[</span><span class="n">Player</span><span class="p" data-group-id="9113590283-36">]</span><span class="p" data-group-id="9113590283-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9113590283-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9113590283-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9113590283-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9113590283-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9113590283-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9113590283-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9113590283-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9113590283-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9113590283-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9113590283-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9113590283-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9113590283-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9113590283-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9113590283-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9113590283-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9113590283-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9113590283-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9113590283-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9113590283-49">(</span><span class="n">Player</span><span class="p" data-group-id="9113590283-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9113590283-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9113590283-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9113590283-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9113590283-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9113590283-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9113590283-53">(</span><span class="n">P</span><span class="p" data-group-id="9113590283-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9113590283-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9113590283-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9113590283-55">(</span><span class="n">P</span><span class="p" data-group-id="9113590283-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9113590283-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9113590283-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9113590283-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9113590283-57">(</span><span class="p" data-group-id="9113590283-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-58">{</span><span class="p" data-group-id="9113590283-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9113590283-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9113590283-60">}</span><span class="p" data-group-id="9113590283-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9113590283-61">(</span><span class="p" data-group-id="9113590283-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9113590283-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9113590283-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9113590283-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9113590283-64">]</span><span class="w">
        </span><span class="p" data-group-id="9113590283-63">)</span><span class="w">
    </span><span class="p" data-group-id="9113590283-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9113590283-65">(</span><span class="p" data-group-id="9113590283-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9113590283-66">(</span><span class="p" data-group-id="9113590283-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9113590283-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9113590283-68">]</span><span class="p" data-group-id="9113590283-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9113590283-69">(</span><span class="p" data-group-id="9113590283-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9113590283-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9113590283-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9113590283-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9113590283-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9113590283-72">(</span><span class="p" data-group-id="9113590283-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9113590283-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9113590283-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9113590283-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9113590283-76">]</span><span class="p" data-group-id="9113590283-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9113590283-78">(</span><span class="n">H</span><span class="p" data-group-id="9113590283-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9113590283-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9113590283-79">)</span><span class="p" data-group-id="9113590283-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9113590283-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9113590283-81">[</span><span class="p" data-group-id="9113590283-81">]</span><span class="p" data-group-id="9113590283-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9113590283-82">[</span><span class="p" data-group-id="9113590283-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9113590283-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9113590283-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9113590283-84">(</span><span class="p" data-group-id="9113590283-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9113590283-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9113590283-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9113590283-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9113590283-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9113590283-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9113590283-89">(</span><span class="p" data-group-id="9113590283-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9113590283-90">{</span><span class="nf">self</span><span class="p" data-group-id="9113590283-91">(</span><span class="p" data-group-id="9113590283-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9113590283-92">(</span><span class="n">X</span><span class="p" data-group-id="9113590283-92">)</span><span class="p" data-group-id="9113590283-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9113590283-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9113590283-87">]</span><span class="w">
    </span><span class="p" data-group-id="9113590283-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="native">
    Native Style (native)<a class="headerlink" href="#native" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-native"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">native_style</span><span class="p" data-group-id="4630162264-1">(</span><span class="p" data-group-id="4630162264-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="native-example.erl">
      example.erl<a class="headerlink" href="#native-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-native"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9323509074-1">(</span><span class="ss">test</span><span class="p" data-group-id="9323509074-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9323509074-2">(</span><span class="p" data-group-id="9323509074-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9323509074-3">]</span><span class="p" data-group-id="9323509074-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9323509074-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9323509074-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9323509074-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9323509074-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9323509074-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9323509074-9">}</span><span class="p" data-group-id="9323509074-6">]</span><span class="p" data-group-id="9323509074-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9323509074-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9323509074-11">}</span><span class="p" data-group-id="9323509074-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9323509074-12">(</span><span class="n">Port</span><span class="p" data-group-id="9323509074-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9323509074-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9323509074-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9323509074-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9323509074-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9323509074-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-17">[</span><span class="p" data-group-id="9323509074-18">[</span><span class="p" data-group-id="9323509074-18">]</span><span class="p" data-group-id="9323509074-17">]</span><span class="p" data-group-id="9323509074-16">)</span><span class="p" data-group-id="9323509074-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9323509074-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9323509074-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9323509074-20">(</span><span class="n">Players</span><span class="p" data-group-id="9323509074-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9323509074-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-22">[</span><span class="p" data-group-id="9323509074-22">]</span><span class="p" data-group-id="9323509074-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9323509074-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9323509074-24">(</span><span class="n">P</span><span class="p" data-group-id="9323509074-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9323509074-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-26">[</span><span class="n">P</span><span class="p" data-group-id="9323509074-26">]</span><span class="p" data-group-id="9323509074-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9323509074-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9323509074-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9323509074-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9323509074-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9323509074-29">(</span><span class="n">Player</span><span class="p" data-group-id="9323509074-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9323509074-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-31">[</span><span class="n">Player</span><span class="p" data-group-id="9323509074-31">]</span><span class="p" data-group-id="9323509074-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9323509074-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9323509074-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9323509074-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9323509074-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9323509074-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-36">[</span><span class="n">Player</span><span class="p" data-group-id="9323509074-36">]</span><span class="p" data-group-id="9323509074-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9323509074-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9323509074-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9323509074-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9323509074-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9323509074-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9323509074-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9323509074-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9323509074-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9323509074-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9323509074-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9323509074-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9323509074-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9323509074-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9323509074-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9323509074-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9323509074-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9323509074-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9323509074-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9323509074-49">(</span><span class="n">Player</span><span class="p" data-group-id="9323509074-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9323509074-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9323509074-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9323509074-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9323509074-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9323509074-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9323509074-53">(</span><span class="n">P</span><span class="p" data-group-id="9323509074-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9323509074-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9323509074-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9323509074-55">(</span><span class="n">P</span><span class="p" data-group-id="9323509074-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9323509074-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9323509074-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9323509074-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9323509074-57">(</span><span class="p" data-group-id="9323509074-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-58">{</span><span class="p" data-group-id="9323509074-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9323509074-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9323509074-60">}</span><span class="p" data-group-id="9323509074-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9323509074-61">(</span><span class="p" data-group-id="9323509074-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9323509074-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9323509074-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9323509074-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9323509074-64">]</span><span class="w">
        </span><span class="p" data-group-id="9323509074-63">)</span><span class="w">
    </span><span class="p" data-group-id="9323509074-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9323509074-65">(</span><span class="p" data-group-id="9323509074-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9323509074-66">(</span><span class="p" data-group-id="9323509074-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9323509074-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9323509074-68">]</span><span class="p" data-group-id="9323509074-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9323509074-69">(</span><span class="p" data-group-id="9323509074-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9323509074-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9323509074-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9323509074-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9323509074-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9323509074-72">(</span><span class="p" data-group-id="9323509074-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9323509074-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9323509074-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9323509074-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9323509074-76">]</span><span class="p" data-group-id="9323509074-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9323509074-78">(</span><span class="n">H</span><span class="p" data-group-id="9323509074-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9323509074-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9323509074-79">)</span><span class="p" data-group-id="9323509074-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9323509074-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9323509074-81">[</span><span class="p" data-group-id="9323509074-81">]</span><span class="p" data-group-id="9323509074-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9323509074-82">[</span><span class="p" data-group-id="9323509074-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9323509074-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9323509074-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9323509074-84">(</span><span class="p" data-group-id="9323509074-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9323509074-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9323509074-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9323509074-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9323509074-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9323509074-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9323509074-89">(</span><span class="p" data-group-id="9323509074-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9323509074-90">{</span><span class="nf">self</span><span class="p" data-group-id="9323509074-91">(</span><span class="p" data-group-id="9323509074-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9323509074-92">(</span><span class="n">X</span><span class="p" data-group-id="9323509074-92">)</span><span class="p" data-group-id="9323509074-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9323509074-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9323509074-87">]</span><span class="w">
    </span><span class="p" data-group-id="9323509074-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_dark">
    ParaisoDark Style (paraiso_dark)<a class="headerlink" href="#paraiso_dark" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_dark"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_dark_style</span><span class="p" data-group-id="7740918242-1">(</span><span class="p" data-group-id="7740918242-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_dark-example.erl">
      example.erl<a class="headerlink" href="#paraiso_dark-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_dark"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9587416476-1">(</span><span class="ss">test</span><span class="p" data-group-id="9587416476-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9587416476-2">(</span><span class="p" data-group-id="9587416476-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9587416476-3">]</span><span class="p" data-group-id="9587416476-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9587416476-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9587416476-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9587416476-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9587416476-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9587416476-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9587416476-9">}</span><span class="p" data-group-id="9587416476-6">]</span><span class="p" data-group-id="9587416476-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9587416476-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9587416476-11">}</span><span class="p" data-group-id="9587416476-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9587416476-12">(</span><span class="n">Port</span><span class="p" data-group-id="9587416476-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9587416476-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9587416476-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9587416476-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9587416476-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9587416476-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-17">[</span><span class="p" data-group-id="9587416476-18">[</span><span class="p" data-group-id="9587416476-18">]</span><span class="p" data-group-id="9587416476-17">]</span><span class="p" data-group-id="9587416476-16">)</span><span class="p" data-group-id="9587416476-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9587416476-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9587416476-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9587416476-20">(</span><span class="n">Players</span><span class="p" data-group-id="9587416476-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9587416476-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-22">[</span><span class="p" data-group-id="9587416476-22">]</span><span class="p" data-group-id="9587416476-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9587416476-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9587416476-24">(</span><span class="n">P</span><span class="p" data-group-id="9587416476-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9587416476-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-26">[</span><span class="n">P</span><span class="p" data-group-id="9587416476-26">]</span><span class="p" data-group-id="9587416476-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9587416476-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9587416476-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9587416476-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9587416476-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9587416476-29">(</span><span class="n">Player</span><span class="p" data-group-id="9587416476-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9587416476-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-31">[</span><span class="n">Player</span><span class="p" data-group-id="9587416476-31">]</span><span class="p" data-group-id="9587416476-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9587416476-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9587416476-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9587416476-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9587416476-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9587416476-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-36">[</span><span class="n">Player</span><span class="p" data-group-id="9587416476-36">]</span><span class="p" data-group-id="9587416476-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9587416476-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9587416476-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9587416476-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9587416476-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9587416476-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9587416476-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9587416476-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9587416476-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9587416476-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9587416476-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9587416476-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9587416476-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9587416476-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9587416476-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9587416476-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9587416476-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9587416476-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9587416476-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9587416476-49">(</span><span class="n">Player</span><span class="p" data-group-id="9587416476-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9587416476-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9587416476-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9587416476-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9587416476-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9587416476-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9587416476-53">(</span><span class="n">P</span><span class="p" data-group-id="9587416476-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9587416476-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9587416476-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9587416476-55">(</span><span class="n">P</span><span class="p" data-group-id="9587416476-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9587416476-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9587416476-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9587416476-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9587416476-57">(</span><span class="p" data-group-id="9587416476-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-58">{</span><span class="p" data-group-id="9587416476-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9587416476-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9587416476-60">}</span><span class="p" data-group-id="9587416476-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9587416476-61">(</span><span class="p" data-group-id="9587416476-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9587416476-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9587416476-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9587416476-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9587416476-64">]</span><span class="w">
        </span><span class="p" data-group-id="9587416476-63">)</span><span class="w">
    </span><span class="p" data-group-id="9587416476-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9587416476-65">(</span><span class="p" data-group-id="9587416476-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9587416476-66">(</span><span class="p" data-group-id="9587416476-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9587416476-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9587416476-68">]</span><span class="p" data-group-id="9587416476-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9587416476-69">(</span><span class="p" data-group-id="9587416476-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9587416476-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9587416476-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9587416476-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9587416476-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9587416476-72">(</span><span class="p" data-group-id="9587416476-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9587416476-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9587416476-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9587416476-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9587416476-76">]</span><span class="p" data-group-id="9587416476-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9587416476-78">(</span><span class="n">H</span><span class="p" data-group-id="9587416476-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9587416476-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9587416476-79">)</span><span class="p" data-group-id="9587416476-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9587416476-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9587416476-81">[</span><span class="p" data-group-id="9587416476-81">]</span><span class="p" data-group-id="9587416476-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9587416476-82">[</span><span class="p" data-group-id="9587416476-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9587416476-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9587416476-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9587416476-84">(</span><span class="p" data-group-id="9587416476-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9587416476-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9587416476-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9587416476-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9587416476-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9587416476-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9587416476-89">(</span><span class="p" data-group-id="9587416476-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9587416476-90">{</span><span class="nf">self</span><span class="p" data-group-id="9587416476-91">(</span><span class="p" data-group-id="9587416476-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9587416476-92">(</span><span class="n">X</span><span class="p" data-group-id="9587416476-92">)</span><span class="p" data-group-id="9587416476-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9587416476-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9587416476-87">]</span><span class="w">
    </span><span class="p" data-group-id="9587416476-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_light">
    ParaisoLight Style (paraiso_light)<a class="headerlink" href="#paraiso_light" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_light"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_light_style</span><span class="p" data-group-id="4113410390-1">(</span><span class="p" data-group-id="4113410390-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_light-example.erl">
      example.erl<a class="headerlink" href="#paraiso_light-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_light"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9065498212-1">(</span><span class="ss">test</span><span class="p" data-group-id="9065498212-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9065498212-2">(</span><span class="p" data-group-id="9065498212-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9065498212-3">]</span><span class="p" data-group-id="9065498212-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9065498212-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9065498212-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9065498212-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9065498212-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9065498212-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9065498212-9">}</span><span class="p" data-group-id="9065498212-6">]</span><span class="p" data-group-id="9065498212-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9065498212-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9065498212-11">}</span><span class="p" data-group-id="9065498212-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9065498212-12">(</span><span class="n">Port</span><span class="p" data-group-id="9065498212-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9065498212-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9065498212-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9065498212-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9065498212-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9065498212-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-17">[</span><span class="p" data-group-id="9065498212-18">[</span><span class="p" data-group-id="9065498212-18">]</span><span class="p" data-group-id="9065498212-17">]</span><span class="p" data-group-id="9065498212-16">)</span><span class="p" data-group-id="9065498212-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9065498212-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9065498212-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9065498212-20">(</span><span class="n">Players</span><span class="p" data-group-id="9065498212-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9065498212-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-22">[</span><span class="p" data-group-id="9065498212-22">]</span><span class="p" data-group-id="9065498212-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9065498212-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9065498212-24">(</span><span class="n">P</span><span class="p" data-group-id="9065498212-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9065498212-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-26">[</span><span class="n">P</span><span class="p" data-group-id="9065498212-26">]</span><span class="p" data-group-id="9065498212-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9065498212-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9065498212-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9065498212-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9065498212-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9065498212-29">(</span><span class="n">Player</span><span class="p" data-group-id="9065498212-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9065498212-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-31">[</span><span class="n">Player</span><span class="p" data-group-id="9065498212-31">]</span><span class="p" data-group-id="9065498212-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9065498212-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9065498212-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9065498212-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9065498212-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9065498212-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-36">[</span><span class="n">Player</span><span class="p" data-group-id="9065498212-36">]</span><span class="p" data-group-id="9065498212-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9065498212-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9065498212-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9065498212-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9065498212-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9065498212-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9065498212-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9065498212-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9065498212-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9065498212-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9065498212-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9065498212-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9065498212-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9065498212-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9065498212-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9065498212-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9065498212-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9065498212-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9065498212-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9065498212-49">(</span><span class="n">Player</span><span class="p" data-group-id="9065498212-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9065498212-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9065498212-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9065498212-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9065498212-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9065498212-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9065498212-53">(</span><span class="n">P</span><span class="p" data-group-id="9065498212-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9065498212-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9065498212-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9065498212-55">(</span><span class="n">P</span><span class="p" data-group-id="9065498212-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9065498212-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9065498212-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9065498212-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9065498212-57">(</span><span class="p" data-group-id="9065498212-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-58">{</span><span class="p" data-group-id="9065498212-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9065498212-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9065498212-60">}</span><span class="p" data-group-id="9065498212-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9065498212-61">(</span><span class="p" data-group-id="9065498212-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9065498212-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9065498212-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9065498212-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9065498212-64">]</span><span class="w">
        </span><span class="p" data-group-id="9065498212-63">)</span><span class="w">
    </span><span class="p" data-group-id="9065498212-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9065498212-65">(</span><span class="p" data-group-id="9065498212-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9065498212-66">(</span><span class="p" data-group-id="9065498212-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9065498212-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9065498212-68">]</span><span class="p" data-group-id="9065498212-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9065498212-69">(</span><span class="p" data-group-id="9065498212-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9065498212-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9065498212-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9065498212-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9065498212-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9065498212-72">(</span><span class="p" data-group-id="9065498212-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9065498212-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9065498212-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9065498212-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9065498212-76">]</span><span class="p" data-group-id="9065498212-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9065498212-78">(</span><span class="n">H</span><span class="p" data-group-id="9065498212-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9065498212-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9065498212-79">)</span><span class="p" data-group-id="9065498212-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9065498212-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9065498212-81">[</span><span class="p" data-group-id="9065498212-81">]</span><span class="p" data-group-id="9065498212-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9065498212-82">[</span><span class="p" data-group-id="9065498212-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9065498212-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9065498212-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9065498212-84">(</span><span class="p" data-group-id="9065498212-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9065498212-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9065498212-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9065498212-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9065498212-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9065498212-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9065498212-89">(</span><span class="p" data-group-id="9065498212-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9065498212-90">{</span><span class="nf">self</span><span class="p" data-group-id="9065498212-91">(</span><span class="p" data-group-id="9065498212-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9065498212-92">(</span><span class="n">X</span><span class="p" data-group-id="9065498212-92">)</span><span class="p" data-group-id="9065498212-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9065498212-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9065498212-87">]</span><span class="w">
    </span><span class="p" data-group-id="9065498212-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="pastie">
    Pastie Style (pastie)<a class="headerlink" href="#pastie" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-pastie"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">pastie_style</span><span class="p" data-group-id="9056543488-1">(</span><span class="p" data-group-id="9056543488-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="pastie-example.erl">
      example.erl<a class="headerlink" href="#pastie-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-pastie"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1625508250-1">(</span><span class="ss">test</span><span class="p" data-group-id="1625508250-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1625508250-2">(</span><span class="p" data-group-id="1625508250-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1625508250-3">]</span><span class="p" data-group-id="1625508250-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1625508250-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1625508250-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1625508250-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1625508250-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1625508250-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1625508250-9">}</span><span class="p" data-group-id="1625508250-6">]</span><span class="p" data-group-id="1625508250-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1625508250-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1625508250-11">}</span><span class="p" data-group-id="1625508250-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1625508250-12">(</span><span class="n">Port</span><span class="p" data-group-id="1625508250-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1625508250-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1625508250-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1625508250-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1625508250-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1625508250-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-17">[</span><span class="p" data-group-id="1625508250-18">[</span><span class="p" data-group-id="1625508250-18">]</span><span class="p" data-group-id="1625508250-17">]</span><span class="p" data-group-id="1625508250-16">)</span><span class="p" data-group-id="1625508250-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1625508250-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1625508250-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1625508250-20">(</span><span class="n">Players</span><span class="p" data-group-id="1625508250-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1625508250-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-22">[</span><span class="p" data-group-id="1625508250-22">]</span><span class="p" data-group-id="1625508250-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1625508250-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1625508250-24">(</span><span class="n">P</span><span class="p" data-group-id="1625508250-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1625508250-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-26">[</span><span class="n">P</span><span class="p" data-group-id="1625508250-26">]</span><span class="p" data-group-id="1625508250-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1625508250-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1625508250-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1625508250-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1625508250-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1625508250-29">(</span><span class="n">Player</span><span class="p" data-group-id="1625508250-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1625508250-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-31">[</span><span class="n">Player</span><span class="p" data-group-id="1625508250-31">]</span><span class="p" data-group-id="1625508250-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1625508250-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1625508250-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1625508250-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1625508250-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1625508250-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-36">[</span><span class="n">Player</span><span class="p" data-group-id="1625508250-36">]</span><span class="p" data-group-id="1625508250-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1625508250-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1625508250-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1625508250-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1625508250-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1625508250-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1625508250-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1625508250-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1625508250-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1625508250-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1625508250-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1625508250-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1625508250-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1625508250-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1625508250-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1625508250-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1625508250-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1625508250-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1625508250-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1625508250-49">(</span><span class="n">Player</span><span class="p" data-group-id="1625508250-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1625508250-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1625508250-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1625508250-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1625508250-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1625508250-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1625508250-53">(</span><span class="n">P</span><span class="p" data-group-id="1625508250-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1625508250-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1625508250-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1625508250-55">(</span><span class="n">P</span><span class="p" data-group-id="1625508250-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1625508250-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1625508250-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1625508250-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1625508250-57">(</span><span class="p" data-group-id="1625508250-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-58">{</span><span class="p" data-group-id="1625508250-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1625508250-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1625508250-60">}</span><span class="p" data-group-id="1625508250-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1625508250-61">(</span><span class="p" data-group-id="1625508250-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1625508250-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1625508250-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1625508250-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1625508250-64">]</span><span class="w">
        </span><span class="p" data-group-id="1625508250-63">)</span><span class="w">
    </span><span class="p" data-group-id="1625508250-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1625508250-65">(</span><span class="p" data-group-id="1625508250-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1625508250-66">(</span><span class="p" data-group-id="1625508250-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1625508250-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1625508250-68">]</span><span class="p" data-group-id="1625508250-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1625508250-69">(</span><span class="p" data-group-id="1625508250-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1625508250-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1625508250-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1625508250-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1625508250-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1625508250-72">(</span><span class="p" data-group-id="1625508250-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1625508250-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1625508250-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1625508250-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1625508250-76">]</span><span class="p" data-group-id="1625508250-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1625508250-78">(</span><span class="n">H</span><span class="p" data-group-id="1625508250-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1625508250-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1625508250-79">)</span><span class="p" data-group-id="1625508250-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1625508250-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1625508250-81">[</span><span class="p" data-group-id="1625508250-81">]</span><span class="p" data-group-id="1625508250-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1625508250-82">[</span><span class="p" data-group-id="1625508250-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1625508250-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1625508250-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1625508250-84">(</span><span class="p" data-group-id="1625508250-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1625508250-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1625508250-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1625508250-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1625508250-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1625508250-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1625508250-89">(</span><span class="p" data-group-id="1625508250-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1625508250-90">{</span><span class="nf">self</span><span class="p" data-group-id="1625508250-91">(</span><span class="p" data-group-id="1625508250-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1625508250-92">(</span><span class="n">X</span><span class="p" data-group-id="1625508250-92">)</span><span class="p" data-group-id="1625508250-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1625508250-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1625508250-87">]</span><span class="w">
    </span><span class="p" data-group-id="1625508250-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="perldoc">
    Perldoc Style (perldoc)<a class="headerlink" href="#perldoc" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-perldoc"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">perldoc_style</span><span class="p" data-group-id="8328650386-1">(</span><span class="p" data-group-id="8328650386-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="perldoc-example.erl">
      example.erl<a class="headerlink" href="#perldoc-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-perldoc"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9078220701-1">(</span><span class="ss">test</span><span class="p" data-group-id="9078220701-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9078220701-2">(</span><span class="p" data-group-id="9078220701-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9078220701-3">]</span><span class="p" data-group-id="9078220701-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9078220701-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9078220701-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9078220701-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9078220701-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9078220701-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9078220701-9">}</span><span class="p" data-group-id="9078220701-6">]</span><span class="p" data-group-id="9078220701-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9078220701-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9078220701-11">}</span><span class="p" data-group-id="9078220701-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9078220701-12">(</span><span class="n">Port</span><span class="p" data-group-id="9078220701-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9078220701-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9078220701-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9078220701-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9078220701-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9078220701-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-17">[</span><span class="p" data-group-id="9078220701-18">[</span><span class="p" data-group-id="9078220701-18">]</span><span class="p" data-group-id="9078220701-17">]</span><span class="p" data-group-id="9078220701-16">)</span><span class="p" data-group-id="9078220701-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9078220701-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9078220701-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9078220701-20">(</span><span class="n">Players</span><span class="p" data-group-id="9078220701-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9078220701-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-22">[</span><span class="p" data-group-id="9078220701-22">]</span><span class="p" data-group-id="9078220701-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9078220701-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9078220701-24">(</span><span class="n">P</span><span class="p" data-group-id="9078220701-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9078220701-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-26">[</span><span class="n">P</span><span class="p" data-group-id="9078220701-26">]</span><span class="p" data-group-id="9078220701-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9078220701-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9078220701-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9078220701-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9078220701-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9078220701-29">(</span><span class="n">Player</span><span class="p" data-group-id="9078220701-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9078220701-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-31">[</span><span class="n">Player</span><span class="p" data-group-id="9078220701-31">]</span><span class="p" data-group-id="9078220701-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9078220701-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9078220701-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9078220701-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9078220701-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9078220701-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-36">[</span><span class="n">Player</span><span class="p" data-group-id="9078220701-36">]</span><span class="p" data-group-id="9078220701-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9078220701-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9078220701-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9078220701-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9078220701-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9078220701-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9078220701-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9078220701-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9078220701-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9078220701-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9078220701-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9078220701-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9078220701-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9078220701-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9078220701-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9078220701-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9078220701-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9078220701-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9078220701-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9078220701-49">(</span><span class="n">Player</span><span class="p" data-group-id="9078220701-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9078220701-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9078220701-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9078220701-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9078220701-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9078220701-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9078220701-53">(</span><span class="n">P</span><span class="p" data-group-id="9078220701-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9078220701-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9078220701-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9078220701-55">(</span><span class="n">P</span><span class="p" data-group-id="9078220701-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9078220701-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9078220701-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9078220701-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9078220701-57">(</span><span class="p" data-group-id="9078220701-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-58">{</span><span class="p" data-group-id="9078220701-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9078220701-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9078220701-60">}</span><span class="p" data-group-id="9078220701-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9078220701-61">(</span><span class="p" data-group-id="9078220701-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9078220701-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9078220701-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9078220701-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9078220701-64">]</span><span class="w">
        </span><span class="p" data-group-id="9078220701-63">)</span><span class="w">
    </span><span class="p" data-group-id="9078220701-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9078220701-65">(</span><span class="p" data-group-id="9078220701-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9078220701-66">(</span><span class="p" data-group-id="9078220701-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9078220701-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9078220701-68">]</span><span class="p" data-group-id="9078220701-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9078220701-69">(</span><span class="p" data-group-id="9078220701-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9078220701-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9078220701-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9078220701-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9078220701-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9078220701-72">(</span><span class="p" data-group-id="9078220701-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9078220701-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9078220701-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9078220701-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9078220701-76">]</span><span class="p" data-group-id="9078220701-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9078220701-78">(</span><span class="n">H</span><span class="p" data-group-id="9078220701-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9078220701-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9078220701-79">)</span><span class="p" data-group-id="9078220701-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9078220701-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9078220701-81">[</span><span class="p" data-group-id="9078220701-81">]</span><span class="p" data-group-id="9078220701-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9078220701-82">[</span><span class="p" data-group-id="9078220701-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9078220701-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9078220701-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9078220701-84">(</span><span class="p" data-group-id="9078220701-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9078220701-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9078220701-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9078220701-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9078220701-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9078220701-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9078220701-89">(</span><span class="p" data-group-id="9078220701-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9078220701-90">{</span><span class="nf">self</span><span class="p" data-group-id="9078220701-91">(</span><span class="p" data-group-id="9078220701-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9078220701-92">(</span><span class="n">X</span><span class="p" data-group-id="9078220701-92">)</span><span class="p" data-group-id="9078220701-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9078220701-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9078220701-87">]</span><span class="w">
    </span><span class="p" data-group-id="9078220701-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rainbow_dash">
    RainbowDash Style (rainbow_dash)<a class="headerlink" href="#rainbow_dash" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rainbow_dash"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rainbow_dash_style</span><span class="p" data-group-id="4941057207-1">(</span><span class="p" data-group-id="4941057207-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="rainbow_dash-example.erl">
      example.erl<a class="headerlink" href="#rainbow_dash-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rainbow_dash"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2892268368-1">(</span><span class="ss">test</span><span class="p" data-group-id="2892268368-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2892268368-2">(</span><span class="p" data-group-id="2892268368-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2892268368-3">]</span><span class="p" data-group-id="2892268368-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2892268368-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2892268368-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2892268368-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2892268368-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2892268368-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2892268368-9">}</span><span class="p" data-group-id="2892268368-6">]</span><span class="p" data-group-id="2892268368-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2892268368-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2892268368-11">}</span><span class="p" data-group-id="2892268368-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2892268368-12">(</span><span class="n">Port</span><span class="p" data-group-id="2892268368-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2892268368-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2892268368-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2892268368-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2892268368-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2892268368-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-17">[</span><span class="p" data-group-id="2892268368-18">[</span><span class="p" data-group-id="2892268368-18">]</span><span class="p" data-group-id="2892268368-17">]</span><span class="p" data-group-id="2892268368-16">)</span><span class="p" data-group-id="2892268368-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2892268368-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2892268368-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2892268368-20">(</span><span class="n">Players</span><span class="p" data-group-id="2892268368-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2892268368-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-22">[</span><span class="p" data-group-id="2892268368-22">]</span><span class="p" data-group-id="2892268368-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2892268368-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2892268368-24">(</span><span class="n">P</span><span class="p" data-group-id="2892268368-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2892268368-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-26">[</span><span class="n">P</span><span class="p" data-group-id="2892268368-26">]</span><span class="p" data-group-id="2892268368-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2892268368-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2892268368-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2892268368-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2892268368-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2892268368-29">(</span><span class="n">Player</span><span class="p" data-group-id="2892268368-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2892268368-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-31">[</span><span class="n">Player</span><span class="p" data-group-id="2892268368-31">]</span><span class="p" data-group-id="2892268368-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2892268368-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2892268368-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2892268368-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2892268368-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2892268368-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-36">[</span><span class="n">Player</span><span class="p" data-group-id="2892268368-36">]</span><span class="p" data-group-id="2892268368-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2892268368-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2892268368-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2892268368-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2892268368-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2892268368-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2892268368-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2892268368-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2892268368-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2892268368-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2892268368-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2892268368-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2892268368-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2892268368-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2892268368-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2892268368-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2892268368-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2892268368-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2892268368-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2892268368-49">(</span><span class="n">Player</span><span class="p" data-group-id="2892268368-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2892268368-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2892268368-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2892268368-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2892268368-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2892268368-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2892268368-53">(</span><span class="n">P</span><span class="p" data-group-id="2892268368-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2892268368-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2892268368-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2892268368-55">(</span><span class="n">P</span><span class="p" data-group-id="2892268368-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2892268368-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2892268368-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2892268368-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2892268368-57">(</span><span class="p" data-group-id="2892268368-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-58">{</span><span class="p" data-group-id="2892268368-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2892268368-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2892268368-60">}</span><span class="p" data-group-id="2892268368-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2892268368-61">(</span><span class="p" data-group-id="2892268368-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2892268368-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2892268368-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2892268368-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2892268368-64">]</span><span class="w">
        </span><span class="p" data-group-id="2892268368-63">)</span><span class="w">
    </span><span class="p" data-group-id="2892268368-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2892268368-65">(</span><span class="p" data-group-id="2892268368-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2892268368-66">(</span><span class="p" data-group-id="2892268368-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2892268368-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2892268368-68">]</span><span class="p" data-group-id="2892268368-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2892268368-69">(</span><span class="p" data-group-id="2892268368-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2892268368-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2892268368-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2892268368-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2892268368-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2892268368-72">(</span><span class="p" data-group-id="2892268368-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2892268368-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2892268368-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2892268368-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2892268368-76">]</span><span class="p" data-group-id="2892268368-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2892268368-78">(</span><span class="n">H</span><span class="p" data-group-id="2892268368-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2892268368-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2892268368-79">)</span><span class="p" data-group-id="2892268368-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2892268368-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2892268368-81">[</span><span class="p" data-group-id="2892268368-81">]</span><span class="p" data-group-id="2892268368-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2892268368-82">[</span><span class="p" data-group-id="2892268368-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2892268368-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2892268368-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2892268368-84">(</span><span class="p" data-group-id="2892268368-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2892268368-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2892268368-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2892268368-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2892268368-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2892268368-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2892268368-89">(</span><span class="p" data-group-id="2892268368-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2892268368-90">{</span><span class="nf">self</span><span class="p" data-group-id="2892268368-91">(</span><span class="p" data-group-id="2892268368-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2892268368-92">(</span><span class="n">X</span><span class="p" data-group-id="2892268368-92">)</span><span class="p" data-group-id="2892268368-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2892268368-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2892268368-87">]</span><span class="w">
    </span><span class="p" data-group-id="2892268368-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rrt">
    Rrt Style (rrt)<a class="headerlink" href="#rrt" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rrt"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rrt_style</span><span class="p" data-group-id="7187690007-1">(</span><span class="p" data-group-id="7187690007-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="rrt-example.erl">
      example.erl<a class="headerlink" href="#rrt-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rrt"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9201745116-1">(</span><span class="ss">test</span><span class="p" data-group-id="9201745116-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9201745116-2">(</span><span class="p" data-group-id="9201745116-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9201745116-3">]</span><span class="p" data-group-id="9201745116-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9201745116-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9201745116-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9201745116-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9201745116-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9201745116-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9201745116-9">}</span><span class="p" data-group-id="9201745116-6">]</span><span class="p" data-group-id="9201745116-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9201745116-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9201745116-11">}</span><span class="p" data-group-id="9201745116-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9201745116-12">(</span><span class="n">Port</span><span class="p" data-group-id="9201745116-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9201745116-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9201745116-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9201745116-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9201745116-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9201745116-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-17">[</span><span class="p" data-group-id="9201745116-18">[</span><span class="p" data-group-id="9201745116-18">]</span><span class="p" data-group-id="9201745116-17">]</span><span class="p" data-group-id="9201745116-16">)</span><span class="p" data-group-id="9201745116-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9201745116-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9201745116-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9201745116-20">(</span><span class="n">Players</span><span class="p" data-group-id="9201745116-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9201745116-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-22">[</span><span class="p" data-group-id="9201745116-22">]</span><span class="p" data-group-id="9201745116-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9201745116-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9201745116-24">(</span><span class="n">P</span><span class="p" data-group-id="9201745116-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9201745116-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-26">[</span><span class="n">P</span><span class="p" data-group-id="9201745116-26">]</span><span class="p" data-group-id="9201745116-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9201745116-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9201745116-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9201745116-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9201745116-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9201745116-29">(</span><span class="n">Player</span><span class="p" data-group-id="9201745116-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9201745116-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-31">[</span><span class="n">Player</span><span class="p" data-group-id="9201745116-31">]</span><span class="p" data-group-id="9201745116-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9201745116-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9201745116-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9201745116-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9201745116-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9201745116-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-36">[</span><span class="n">Player</span><span class="p" data-group-id="9201745116-36">]</span><span class="p" data-group-id="9201745116-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9201745116-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9201745116-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9201745116-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9201745116-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9201745116-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9201745116-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9201745116-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9201745116-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9201745116-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9201745116-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9201745116-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9201745116-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9201745116-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9201745116-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9201745116-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9201745116-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9201745116-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9201745116-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9201745116-49">(</span><span class="n">Player</span><span class="p" data-group-id="9201745116-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9201745116-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9201745116-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9201745116-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9201745116-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9201745116-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9201745116-53">(</span><span class="n">P</span><span class="p" data-group-id="9201745116-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9201745116-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9201745116-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9201745116-55">(</span><span class="n">P</span><span class="p" data-group-id="9201745116-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9201745116-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9201745116-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9201745116-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9201745116-57">(</span><span class="p" data-group-id="9201745116-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-58">{</span><span class="p" data-group-id="9201745116-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9201745116-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9201745116-60">}</span><span class="p" data-group-id="9201745116-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9201745116-61">(</span><span class="p" data-group-id="9201745116-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9201745116-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9201745116-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9201745116-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9201745116-64">]</span><span class="w">
        </span><span class="p" data-group-id="9201745116-63">)</span><span class="w">
    </span><span class="p" data-group-id="9201745116-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9201745116-65">(</span><span class="p" data-group-id="9201745116-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9201745116-66">(</span><span class="p" data-group-id="9201745116-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9201745116-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9201745116-68">]</span><span class="p" data-group-id="9201745116-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9201745116-69">(</span><span class="p" data-group-id="9201745116-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9201745116-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9201745116-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9201745116-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9201745116-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9201745116-72">(</span><span class="p" data-group-id="9201745116-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9201745116-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9201745116-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9201745116-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9201745116-76">]</span><span class="p" data-group-id="9201745116-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9201745116-78">(</span><span class="n">H</span><span class="p" data-group-id="9201745116-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9201745116-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9201745116-79">)</span><span class="p" data-group-id="9201745116-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9201745116-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9201745116-81">[</span><span class="p" data-group-id="9201745116-81">]</span><span class="p" data-group-id="9201745116-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9201745116-82">[</span><span class="p" data-group-id="9201745116-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9201745116-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9201745116-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9201745116-84">(</span><span class="p" data-group-id="9201745116-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9201745116-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9201745116-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9201745116-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9201745116-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9201745116-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9201745116-89">(</span><span class="p" data-group-id="9201745116-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9201745116-90">{</span><span class="nf">self</span><span class="p" data-group-id="9201745116-91">(</span><span class="p" data-group-id="9201745116-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9201745116-92">(</span><span class="n">X</span><span class="p" data-group-id="9201745116-92">)</span><span class="p" data-group-id="9201745116-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9201745116-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9201745116-87">]</span><span class="w">
    </span><span class="p" data-group-id="9201745116-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="tango">
    Tango Style (tango)<a class="headerlink" href="#tango" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-tango"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">tango_style</span><span class="p" data-group-id="9649982827-1">(</span><span class="p" data-group-id="9649982827-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="tango-example.erl">
      example.erl<a class="headerlink" href="#tango-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-tango"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7460236171-1">(</span><span class="ss">test</span><span class="p" data-group-id="7460236171-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7460236171-2">(</span><span class="p" data-group-id="7460236171-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7460236171-3">]</span><span class="p" data-group-id="7460236171-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7460236171-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7460236171-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7460236171-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7460236171-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7460236171-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7460236171-9">}</span><span class="p" data-group-id="7460236171-6">]</span><span class="p" data-group-id="7460236171-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7460236171-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7460236171-11">}</span><span class="p" data-group-id="7460236171-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7460236171-12">(</span><span class="n">Port</span><span class="p" data-group-id="7460236171-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7460236171-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7460236171-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7460236171-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7460236171-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7460236171-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-17">[</span><span class="p" data-group-id="7460236171-18">[</span><span class="p" data-group-id="7460236171-18">]</span><span class="p" data-group-id="7460236171-17">]</span><span class="p" data-group-id="7460236171-16">)</span><span class="p" data-group-id="7460236171-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7460236171-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7460236171-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7460236171-20">(</span><span class="n">Players</span><span class="p" data-group-id="7460236171-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7460236171-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-22">[</span><span class="p" data-group-id="7460236171-22">]</span><span class="p" data-group-id="7460236171-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7460236171-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7460236171-24">(</span><span class="n">P</span><span class="p" data-group-id="7460236171-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7460236171-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-26">[</span><span class="n">P</span><span class="p" data-group-id="7460236171-26">]</span><span class="p" data-group-id="7460236171-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7460236171-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7460236171-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7460236171-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7460236171-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7460236171-29">(</span><span class="n">Player</span><span class="p" data-group-id="7460236171-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7460236171-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-31">[</span><span class="n">Player</span><span class="p" data-group-id="7460236171-31">]</span><span class="p" data-group-id="7460236171-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7460236171-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7460236171-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7460236171-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7460236171-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7460236171-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-36">[</span><span class="n">Player</span><span class="p" data-group-id="7460236171-36">]</span><span class="p" data-group-id="7460236171-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7460236171-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7460236171-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7460236171-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7460236171-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7460236171-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7460236171-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7460236171-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7460236171-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7460236171-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7460236171-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7460236171-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7460236171-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7460236171-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7460236171-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7460236171-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7460236171-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7460236171-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7460236171-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7460236171-49">(</span><span class="n">Player</span><span class="p" data-group-id="7460236171-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7460236171-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7460236171-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7460236171-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7460236171-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7460236171-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7460236171-53">(</span><span class="n">P</span><span class="p" data-group-id="7460236171-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7460236171-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7460236171-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7460236171-55">(</span><span class="n">P</span><span class="p" data-group-id="7460236171-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7460236171-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7460236171-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7460236171-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7460236171-57">(</span><span class="p" data-group-id="7460236171-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-58">{</span><span class="p" data-group-id="7460236171-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7460236171-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7460236171-60">}</span><span class="p" data-group-id="7460236171-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7460236171-61">(</span><span class="p" data-group-id="7460236171-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7460236171-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7460236171-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7460236171-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7460236171-64">]</span><span class="w">
        </span><span class="p" data-group-id="7460236171-63">)</span><span class="w">
    </span><span class="p" data-group-id="7460236171-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7460236171-65">(</span><span class="p" data-group-id="7460236171-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7460236171-66">(</span><span class="p" data-group-id="7460236171-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7460236171-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7460236171-68">]</span><span class="p" data-group-id="7460236171-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7460236171-69">(</span><span class="p" data-group-id="7460236171-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7460236171-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7460236171-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7460236171-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7460236171-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7460236171-72">(</span><span class="p" data-group-id="7460236171-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7460236171-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7460236171-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7460236171-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7460236171-76">]</span><span class="p" data-group-id="7460236171-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7460236171-78">(</span><span class="n">H</span><span class="p" data-group-id="7460236171-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7460236171-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7460236171-79">)</span><span class="p" data-group-id="7460236171-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7460236171-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7460236171-81">[</span><span class="p" data-group-id="7460236171-81">]</span><span class="p" data-group-id="7460236171-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7460236171-82">[</span><span class="p" data-group-id="7460236171-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7460236171-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7460236171-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7460236171-84">(</span><span class="p" data-group-id="7460236171-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7460236171-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7460236171-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7460236171-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7460236171-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7460236171-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7460236171-89">(</span><span class="p" data-group-id="7460236171-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7460236171-90">{</span><span class="nf">self</span><span class="p" data-group-id="7460236171-91">(</span><span class="p" data-group-id="7460236171-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7460236171-92">(</span><span class="n">X</span><span class="p" data-group-id="7460236171-92">)</span><span class="p" data-group-id="7460236171-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7460236171-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7460236171-87">]</span><span class="w">
    </span><span class="p" data-group-id="7460236171-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="trac">
    Trac Style (trac)<a class="headerlink" href="#trac" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-trac"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">trac_style</span><span class="p" data-group-id="7104049237-1">(</span><span class="p" data-group-id="7104049237-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="trac-example.erl">
      example.erl<a class="headerlink" href="#trac-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-trac"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7882911268-1">(</span><span class="ss">test</span><span class="p" data-group-id="7882911268-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7882911268-2">(</span><span class="p" data-group-id="7882911268-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7882911268-3">]</span><span class="p" data-group-id="7882911268-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7882911268-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7882911268-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7882911268-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7882911268-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7882911268-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7882911268-9">}</span><span class="p" data-group-id="7882911268-6">]</span><span class="p" data-group-id="7882911268-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7882911268-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7882911268-11">}</span><span class="p" data-group-id="7882911268-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7882911268-12">(</span><span class="n">Port</span><span class="p" data-group-id="7882911268-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7882911268-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7882911268-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7882911268-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7882911268-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7882911268-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-17">[</span><span class="p" data-group-id="7882911268-18">[</span><span class="p" data-group-id="7882911268-18">]</span><span class="p" data-group-id="7882911268-17">]</span><span class="p" data-group-id="7882911268-16">)</span><span class="p" data-group-id="7882911268-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7882911268-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7882911268-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7882911268-20">(</span><span class="n">Players</span><span class="p" data-group-id="7882911268-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7882911268-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-22">[</span><span class="p" data-group-id="7882911268-22">]</span><span class="p" data-group-id="7882911268-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7882911268-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7882911268-24">(</span><span class="n">P</span><span class="p" data-group-id="7882911268-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7882911268-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-26">[</span><span class="n">P</span><span class="p" data-group-id="7882911268-26">]</span><span class="p" data-group-id="7882911268-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7882911268-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7882911268-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7882911268-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7882911268-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7882911268-29">(</span><span class="n">Player</span><span class="p" data-group-id="7882911268-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7882911268-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-31">[</span><span class="n">Player</span><span class="p" data-group-id="7882911268-31">]</span><span class="p" data-group-id="7882911268-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7882911268-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7882911268-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7882911268-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7882911268-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7882911268-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-36">[</span><span class="n">Player</span><span class="p" data-group-id="7882911268-36">]</span><span class="p" data-group-id="7882911268-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7882911268-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7882911268-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7882911268-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7882911268-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7882911268-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7882911268-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7882911268-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7882911268-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7882911268-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7882911268-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7882911268-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7882911268-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7882911268-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7882911268-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7882911268-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7882911268-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7882911268-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7882911268-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7882911268-49">(</span><span class="n">Player</span><span class="p" data-group-id="7882911268-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7882911268-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7882911268-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7882911268-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7882911268-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7882911268-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7882911268-53">(</span><span class="n">P</span><span class="p" data-group-id="7882911268-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7882911268-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7882911268-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7882911268-55">(</span><span class="n">P</span><span class="p" data-group-id="7882911268-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7882911268-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7882911268-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7882911268-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7882911268-57">(</span><span class="p" data-group-id="7882911268-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-58">{</span><span class="p" data-group-id="7882911268-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7882911268-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7882911268-60">}</span><span class="p" data-group-id="7882911268-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7882911268-61">(</span><span class="p" data-group-id="7882911268-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7882911268-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7882911268-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7882911268-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7882911268-64">]</span><span class="w">
        </span><span class="p" data-group-id="7882911268-63">)</span><span class="w">
    </span><span class="p" data-group-id="7882911268-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7882911268-65">(</span><span class="p" data-group-id="7882911268-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7882911268-66">(</span><span class="p" data-group-id="7882911268-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7882911268-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7882911268-68">]</span><span class="p" data-group-id="7882911268-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7882911268-69">(</span><span class="p" data-group-id="7882911268-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7882911268-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7882911268-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7882911268-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7882911268-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7882911268-72">(</span><span class="p" data-group-id="7882911268-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7882911268-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7882911268-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7882911268-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7882911268-76">]</span><span class="p" data-group-id="7882911268-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7882911268-78">(</span><span class="n">H</span><span class="p" data-group-id="7882911268-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7882911268-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7882911268-79">)</span><span class="p" data-group-id="7882911268-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7882911268-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7882911268-81">[</span><span class="p" data-group-id="7882911268-81">]</span><span class="p" data-group-id="7882911268-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7882911268-82">[</span><span class="p" data-group-id="7882911268-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7882911268-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7882911268-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7882911268-84">(</span><span class="p" data-group-id="7882911268-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7882911268-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7882911268-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7882911268-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7882911268-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7882911268-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7882911268-89">(</span><span class="p" data-group-id="7882911268-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7882911268-90">{</span><span class="nf">self</span><span class="p" data-group-id="7882911268-91">(</span><span class="p" data-group-id="7882911268-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7882911268-92">(</span><span class="n">X</span><span class="p" data-group-id="7882911268-92">)</span><span class="p" data-group-id="7882911268-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7882911268-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7882911268-87">]</span><span class="w">
    </span><span class="p" data-group-id="7882911268-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vim">
    Vim Style (vim)<a class="headerlink" href="#vim" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vim"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vim_style</span><span class="p" data-group-id="8740638296-1">(</span><span class="p" data-group-id="8740638296-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="vim-example.erl">
      example.erl<a class="headerlink" href="#vim-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vim"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4828908701-1">(</span><span class="ss">test</span><span class="p" data-group-id="4828908701-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4828908701-2">(</span><span class="p" data-group-id="4828908701-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4828908701-3">]</span><span class="p" data-group-id="4828908701-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4828908701-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4828908701-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4828908701-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4828908701-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4828908701-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4828908701-9">}</span><span class="p" data-group-id="4828908701-6">]</span><span class="p" data-group-id="4828908701-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4828908701-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4828908701-11">}</span><span class="p" data-group-id="4828908701-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4828908701-12">(</span><span class="n">Port</span><span class="p" data-group-id="4828908701-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4828908701-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4828908701-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4828908701-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4828908701-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4828908701-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-17">[</span><span class="p" data-group-id="4828908701-18">[</span><span class="p" data-group-id="4828908701-18">]</span><span class="p" data-group-id="4828908701-17">]</span><span class="p" data-group-id="4828908701-16">)</span><span class="p" data-group-id="4828908701-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4828908701-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4828908701-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4828908701-20">(</span><span class="n">Players</span><span class="p" data-group-id="4828908701-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4828908701-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-22">[</span><span class="p" data-group-id="4828908701-22">]</span><span class="p" data-group-id="4828908701-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4828908701-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4828908701-24">(</span><span class="n">P</span><span class="p" data-group-id="4828908701-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4828908701-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-26">[</span><span class="n">P</span><span class="p" data-group-id="4828908701-26">]</span><span class="p" data-group-id="4828908701-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4828908701-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4828908701-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4828908701-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4828908701-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4828908701-29">(</span><span class="n">Player</span><span class="p" data-group-id="4828908701-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4828908701-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-31">[</span><span class="n">Player</span><span class="p" data-group-id="4828908701-31">]</span><span class="p" data-group-id="4828908701-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4828908701-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4828908701-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4828908701-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4828908701-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4828908701-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-36">[</span><span class="n">Player</span><span class="p" data-group-id="4828908701-36">]</span><span class="p" data-group-id="4828908701-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4828908701-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4828908701-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4828908701-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4828908701-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4828908701-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4828908701-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4828908701-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4828908701-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4828908701-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4828908701-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4828908701-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4828908701-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4828908701-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4828908701-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4828908701-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4828908701-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4828908701-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4828908701-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4828908701-49">(</span><span class="n">Player</span><span class="p" data-group-id="4828908701-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4828908701-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4828908701-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4828908701-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4828908701-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4828908701-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4828908701-53">(</span><span class="n">P</span><span class="p" data-group-id="4828908701-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4828908701-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4828908701-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4828908701-55">(</span><span class="n">P</span><span class="p" data-group-id="4828908701-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4828908701-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4828908701-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4828908701-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4828908701-57">(</span><span class="p" data-group-id="4828908701-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-58">{</span><span class="p" data-group-id="4828908701-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4828908701-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4828908701-60">}</span><span class="p" data-group-id="4828908701-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4828908701-61">(</span><span class="p" data-group-id="4828908701-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4828908701-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4828908701-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4828908701-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4828908701-64">]</span><span class="w">
        </span><span class="p" data-group-id="4828908701-63">)</span><span class="w">
    </span><span class="p" data-group-id="4828908701-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4828908701-65">(</span><span class="p" data-group-id="4828908701-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4828908701-66">(</span><span class="p" data-group-id="4828908701-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4828908701-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4828908701-68">]</span><span class="p" data-group-id="4828908701-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4828908701-69">(</span><span class="p" data-group-id="4828908701-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4828908701-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4828908701-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4828908701-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4828908701-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4828908701-72">(</span><span class="p" data-group-id="4828908701-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4828908701-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4828908701-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4828908701-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4828908701-76">]</span><span class="p" data-group-id="4828908701-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4828908701-78">(</span><span class="n">H</span><span class="p" data-group-id="4828908701-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4828908701-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4828908701-79">)</span><span class="p" data-group-id="4828908701-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4828908701-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4828908701-81">[</span><span class="p" data-group-id="4828908701-81">]</span><span class="p" data-group-id="4828908701-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4828908701-82">[</span><span class="p" data-group-id="4828908701-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4828908701-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4828908701-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4828908701-84">(</span><span class="p" data-group-id="4828908701-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4828908701-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4828908701-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4828908701-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4828908701-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4828908701-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4828908701-89">(</span><span class="p" data-group-id="4828908701-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4828908701-90">{</span><span class="nf">self</span><span class="p" data-group-id="4828908701-91">(</span><span class="p" data-group-id="4828908701-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4828908701-92">(</span><span class="n">X</span><span class="p" data-group-id="4828908701-92">)</span><span class="p" data-group-id="4828908701-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4828908701-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4828908701-87">]</span><span class="w">
    </span><span class="p" data-group-id="4828908701-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vs">
    VisualStudio Style (vs)<a class="headerlink" href="#vs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vs_style</span><span class="p" data-group-id="3666031766-1">(</span><span class="p" data-group-id="3666031766-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="vs-example.erl">
      example.erl<a class="headerlink" href="#vs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2392480559-1">(</span><span class="ss">test</span><span class="p" data-group-id="2392480559-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2392480559-2">(</span><span class="p" data-group-id="2392480559-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2392480559-3">]</span><span class="p" data-group-id="2392480559-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2392480559-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2392480559-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2392480559-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2392480559-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2392480559-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2392480559-9">}</span><span class="p" data-group-id="2392480559-6">]</span><span class="p" data-group-id="2392480559-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2392480559-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2392480559-11">}</span><span class="p" data-group-id="2392480559-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2392480559-12">(</span><span class="n">Port</span><span class="p" data-group-id="2392480559-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2392480559-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2392480559-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2392480559-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2392480559-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2392480559-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-17">[</span><span class="p" data-group-id="2392480559-18">[</span><span class="p" data-group-id="2392480559-18">]</span><span class="p" data-group-id="2392480559-17">]</span><span class="p" data-group-id="2392480559-16">)</span><span class="p" data-group-id="2392480559-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2392480559-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2392480559-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2392480559-20">(</span><span class="n">Players</span><span class="p" data-group-id="2392480559-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2392480559-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-22">[</span><span class="p" data-group-id="2392480559-22">]</span><span class="p" data-group-id="2392480559-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2392480559-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2392480559-24">(</span><span class="n">P</span><span class="p" data-group-id="2392480559-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2392480559-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-26">[</span><span class="n">P</span><span class="p" data-group-id="2392480559-26">]</span><span class="p" data-group-id="2392480559-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2392480559-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2392480559-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2392480559-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2392480559-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2392480559-29">(</span><span class="n">Player</span><span class="p" data-group-id="2392480559-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2392480559-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-31">[</span><span class="n">Player</span><span class="p" data-group-id="2392480559-31">]</span><span class="p" data-group-id="2392480559-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2392480559-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2392480559-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2392480559-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2392480559-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2392480559-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-36">[</span><span class="n">Player</span><span class="p" data-group-id="2392480559-36">]</span><span class="p" data-group-id="2392480559-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2392480559-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2392480559-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2392480559-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2392480559-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2392480559-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2392480559-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2392480559-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2392480559-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2392480559-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2392480559-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2392480559-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2392480559-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2392480559-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2392480559-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2392480559-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2392480559-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2392480559-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2392480559-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2392480559-49">(</span><span class="n">Player</span><span class="p" data-group-id="2392480559-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2392480559-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2392480559-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2392480559-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2392480559-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2392480559-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2392480559-53">(</span><span class="n">P</span><span class="p" data-group-id="2392480559-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2392480559-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2392480559-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2392480559-55">(</span><span class="n">P</span><span class="p" data-group-id="2392480559-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2392480559-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2392480559-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2392480559-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2392480559-57">(</span><span class="p" data-group-id="2392480559-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-58">{</span><span class="p" data-group-id="2392480559-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2392480559-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2392480559-60">}</span><span class="p" data-group-id="2392480559-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2392480559-61">(</span><span class="p" data-group-id="2392480559-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2392480559-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2392480559-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2392480559-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2392480559-64">]</span><span class="w">
        </span><span class="p" data-group-id="2392480559-63">)</span><span class="w">
    </span><span class="p" data-group-id="2392480559-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2392480559-65">(</span><span class="p" data-group-id="2392480559-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2392480559-66">(</span><span class="p" data-group-id="2392480559-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2392480559-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2392480559-68">]</span><span class="p" data-group-id="2392480559-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2392480559-69">(</span><span class="p" data-group-id="2392480559-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2392480559-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2392480559-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2392480559-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2392480559-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2392480559-72">(</span><span class="p" data-group-id="2392480559-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2392480559-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2392480559-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2392480559-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2392480559-76">]</span><span class="p" data-group-id="2392480559-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2392480559-78">(</span><span class="n">H</span><span class="p" data-group-id="2392480559-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2392480559-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2392480559-79">)</span><span class="p" data-group-id="2392480559-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2392480559-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2392480559-81">[</span><span class="p" data-group-id="2392480559-81">]</span><span class="p" data-group-id="2392480559-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2392480559-82">[</span><span class="p" data-group-id="2392480559-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2392480559-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2392480559-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2392480559-84">(</span><span class="p" data-group-id="2392480559-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2392480559-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2392480559-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2392480559-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2392480559-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2392480559-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2392480559-89">(</span><span class="p" data-group-id="2392480559-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2392480559-90">{</span><span class="nf">self</span><span class="p" data-group-id="2392480559-91">(</span><span class="p" data-group-id="2392480559-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2392480559-92">(</span><span class="n">X</span><span class="p" data-group-id="2392480559-92">)</span><span class="p" data-group-id="2392480559-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2392480559-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2392480559-87">]</span><span class="w">
    </span><span class="p" data-group-id="2392480559-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="xcode">
    Xcode Style (xcode)<a class="headerlink" href="#xcode" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-xcode"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">xcode_style</span><span class="p" data-group-id="2603819438-1">(</span><span class="p" data-group-id="2603819438-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the apporpriate stylesheets for you.
  </p>

  
    <h3 id="xcode-example.erl">
      example.erl<a class="headerlink" href="#xcode-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-xcode"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5281835910-1">(</span><span class="ss">test</span><span class="p" data-group-id="5281835910-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5281835910-2">(</span><span class="p" data-group-id="5281835910-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5281835910-3">]</span><span class="p" data-group-id="5281835910-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5281835910-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5281835910-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5281835910-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5281835910-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5281835910-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5281835910-9">}</span><span class="p" data-group-id="5281835910-6">]</span><span class="p" data-group-id="5281835910-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5281835910-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5281835910-11">}</span><span class="p" data-group-id="5281835910-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5281835910-12">(</span><span class="n">Port</span><span class="p" data-group-id="5281835910-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5281835910-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5281835910-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5281835910-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5281835910-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5281835910-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-17">[</span><span class="p" data-group-id="5281835910-18">[</span><span class="p" data-group-id="5281835910-18">]</span><span class="p" data-group-id="5281835910-17">]</span><span class="p" data-group-id="5281835910-16">)</span><span class="p" data-group-id="5281835910-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5281835910-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5281835910-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5281835910-20">(</span><span class="n">Players</span><span class="p" data-group-id="5281835910-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5281835910-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-22">[</span><span class="p" data-group-id="5281835910-22">]</span><span class="p" data-group-id="5281835910-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5281835910-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5281835910-24">(</span><span class="n">P</span><span class="p" data-group-id="5281835910-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5281835910-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-26">[</span><span class="n">P</span><span class="p" data-group-id="5281835910-26">]</span><span class="p" data-group-id="5281835910-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5281835910-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5281835910-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5281835910-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5281835910-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5281835910-29">(</span><span class="n">Player</span><span class="p" data-group-id="5281835910-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5281835910-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-31">[</span><span class="n">Player</span><span class="p" data-group-id="5281835910-31">]</span><span class="p" data-group-id="5281835910-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5281835910-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5281835910-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5281835910-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5281835910-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5281835910-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-36">[</span><span class="n">Player</span><span class="p" data-group-id="5281835910-36">]</span><span class="p" data-group-id="5281835910-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5281835910-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5281835910-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5281835910-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5281835910-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5281835910-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5281835910-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5281835910-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5281835910-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5281835910-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5281835910-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5281835910-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5281835910-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5281835910-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5281835910-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5281835910-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5281835910-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5281835910-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5281835910-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5281835910-49">(</span><span class="n">Player</span><span class="p" data-group-id="5281835910-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5281835910-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5281835910-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5281835910-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5281835910-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5281835910-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5281835910-53">(</span><span class="n">P</span><span class="p" data-group-id="5281835910-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5281835910-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5281835910-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5281835910-55">(</span><span class="n">P</span><span class="p" data-group-id="5281835910-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5281835910-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5281835910-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5281835910-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5281835910-57">(</span><span class="p" data-group-id="5281835910-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-58">{</span><span class="p" data-group-id="5281835910-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5281835910-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5281835910-60">}</span><span class="p" data-group-id="5281835910-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5281835910-61">(</span><span class="p" data-group-id="5281835910-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5281835910-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5281835910-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5281835910-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5281835910-64">]</span><span class="w">
        </span><span class="p" data-group-id="5281835910-63">)</span><span class="w">
    </span><span class="p" data-group-id="5281835910-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5281835910-65">(</span><span class="p" data-group-id="5281835910-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5281835910-66">(</span><span class="p" data-group-id="5281835910-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5281835910-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5281835910-68">]</span><span class="p" data-group-id="5281835910-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5281835910-69">(</span><span class="p" data-group-id="5281835910-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5281835910-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5281835910-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5281835910-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5281835910-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5281835910-72">(</span><span class="p" data-group-id="5281835910-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5281835910-74">{</span><span class="ss">fff</span><span class="p" data-group-id="5281835910-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5281835910-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5281835910-76">]</span><span class="p" data-group-id="5281835910-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-77">[</span><span class="n">Fun</span><span class="p" data-group-id="5281835910-78">(</span><span class="n">H</span><span class="p" data-group-id="5281835910-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5281835910-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5281835910-79">)</span><span class="p" data-group-id="5281835910-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5281835910-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5281835910-81">[</span><span class="p" data-group-id="5281835910-81">]</span><span class="p" data-group-id="5281835910-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5281835910-82">[</span><span class="p" data-group-id="5281835910-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5281835910-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5281835910-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5281835910-84">(</span><span class="p" data-group-id="5281835910-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5281835910-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5281835910-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5281835910-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5281835910-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5281835910-88">(</span><span class="nf">fun</span><span class="p" data-group-id="5281835910-89">(</span><span class="p" data-group-id="5281835910-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5281835910-90">{</span><span class="nf">self</span><span class="p" data-group-id="5281835910-91">(</span><span class="p" data-group-id="5281835910-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5281835910-92">(</span><span class="n">X</span><span class="p" data-group-id="5281835910-92">)</span><span class="p" data-group-id="5281835910-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5281835910-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5281835910-87">]</span><span class="w">
    </span><span class="p" data-group-id="5281835910-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  


          </div>


        </div>
        
        <div class="clearer"></div>

      </div>

      <div class="clearfix"></div>
    </div>

    <script type="text/javascript">
      document.querySelector(".menu-btn").addEventListener("click", () => { 
        document.querySelector(".left-column").classList.toggle("left-column--active");
      });
    </script>
  </body>
</html>