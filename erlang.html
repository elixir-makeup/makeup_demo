<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- Licensed under the Apache 2.0 License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/open-sans/stylesheet.css" />
    <!-- Licensed under the SIL Open Font License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/source-serif-pro/source-serif-pro.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Makeup Demo</title>

    <!--Bootstrap 5-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

    <link rel="stylesheet" href="static/css/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="static/css/makeup.css" type="text/css" />
  </head>

  <body role="document">
    <div class="container-wrapper">
      <div id="mobile-toggle">
        <a class="text-logo--mobile"  href="index.html">
          <span>Makeup Demo</span>
        </a>
        <button class="menu-btn" area-label="Menu">
          <img class="menu-icon" src="static/img/menu-line.svg">
        </button>
      </div>

      <div id="left-column" class="left-column">
        <div class="makeupsidebar"><a href="index.html" class="text-logo">Makeup Demo</a>

          
            <div class="sidebar-block">
              <div class="sidebar-wrapper">
                <h2>Styles</h2>
              </div>
              <div class="sidebar-toc">
                <ul>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#abap">
                        Abap Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol">
                        Algol Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol_nu">
                        Algol_Nu Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#arduino">
                        Arduino Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#autumn">
                        Autumn Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#borland">
                        Borland Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#bw">
                        BlackWhite Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#colorful">
                        Colorful Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#default">
                        Default Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#emacs">
                        Emacs Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#friendly">
                        Friendly Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#fruity">
                        Fruity Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#igor">
                        Igor Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#lovelace">
                        Lovelace Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#manni">
                        Manni Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#monokai">
                        Monokai Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#murphy">
                        Murphy Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#native">
                        Native Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_dark">
                        ParaisoDark Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_light">
                        ParaisoLight Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#pastie">
                        Pastie Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#perldoc">
                        Perldoc Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rainbow_dash">
                        RainbowDash Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rrt">
                        Rrt Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#tango">
                        Tango Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#trac">
                        Trac Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vim">
                        Vim Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vs">
                        VisualStudio Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#xcode">
                        Xcode Style</a></li>
                  
                </ul>
              </div>
            </div>
          

          <div class="sidebar-block">
            <div class="sidebar-wrapper">
              <h2>Languages</h2>
            </div>
            <div class="sidebar-toc">
              <ul>
                
                <li class="toctree-l1"><a class="reference internal" href="c.html">C</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="diff.html">Diff</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="eex.html">EEx</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="elixir.html">Elixir</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="erlang.html">Erlang</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="heex.html">HEEx</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="json.html">JSON</a></li>
                
              </ul>
            </div>
          </div>

        </div>
      </div>

      <div id="right-column">

        <div class="document clearer body">

          <div class="section">
            <h1 id="heading">
  Erlang Language<a class="headerlink" href="#heading" title="Permalink">¶</a>
</h1>

<p>
  A lexer for the Erlang language.
</p>


<p>
  This page shows examples of source files lexed by the same lexer,
  but rendered into HTML using different styles.
</p>

<p>
  Some styles are richer than others in that they define more different token categories.

  Examples of such richer styles are the <a href="#default">Default</a> style,
  the <a href="#tango">Tango</a> style and the <a href="#colorful">Colorful</a> style.
</p>

<p>
  In all cases the lexer is the same, and the only difference is the colors defined by the styles.
</p>


  <h2 id="abap">
    Abap Style (abap)<a class="headerlink" href="#abap" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-abap"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">abap_style</span><span class="p" data-group-id="7074728140-1">(</span><span class="p" data-group-id="7074728140-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="abap-example.erl">
      example.erl<a class="headerlink" href="#abap-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-abap"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0156108784-1">(</span><span class="ss">test</span><span class="p" data-group-id="0156108784-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0156108784-2">(</span><span class="p" data-group-id="0156108784-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0156108784-3">]</span><span class="p" data-group-id="0156108784-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0156108784-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0156108784-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0156108784-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0156108784-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0156108784-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0156108784-9">}</span><span class="p" data-group-id="0156108784-6">]</span><span class="p" data-group-id="0156108784-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0156108784-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0156108784-11">}</span><span class="p" data-group-id="0156108784-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0156108784-12">(</span><span class="n">Port</span><span class="p" data-group-id="0156108784-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0156108784-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0156108784-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0156108784-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0156108784-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0156108784-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-17">[</span><span class="p" data-group-id="0156108784-18">[</span><span class="p" data-group-id="0156108784-18">]</span><span class="p" data-group-id="0156108784-17">]</span><span class="p" data-group-id="0156108784-16">)</span><span class="p" data-group-id="0156108784-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0156108784-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0156108784-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0156108784-20">(</span><span class="n">Players</span><span class="p" data-group-id="0156108784-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0156108784-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-22">[</span><span class="p" data-group-id="0156108784-22">]</span><span class="p" data-group-id="0156108784-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0156108784-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0156108784-24">(</span><span class="n">P</span><span class="p" data-group-id="0156108784-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0156108784-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-26">[</span><span class="n">P</span><span class="p" data-group-id="0156108784-26">]</span><span class="p" data-group-id="0156108784-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0156108784-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0156108784-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0156108784-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0156108784-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0156108784-29">(</span><span class="n">Player</span><span class="p" data-group-id="0156108784-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0156108784-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-31">[</span><span class="n">Player</span><span class="p" data-group-id="0156108784-31">]</span><span class="p" data-group-id="0156108784-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0156108784-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0156108784-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0156108784-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0156108784-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0156108784-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-36">[</span><span class="n">Player</span><span class="p" data-group-id="0156108784-36">]</span><span class="p" data-group-id="0156108784-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0156108784-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0156108784-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0156108784-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0156108784-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0156108784-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0156108784-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0156108784-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0156108784-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0156108784-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0156108784-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0156108784-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0156108784-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0156108784-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0156108784-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0156108784-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0156108784-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0156108784-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0156108784-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0156108784-49">(</span><span class="n">Player</span><span class="p" data-group-id="0156108784-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0156108784-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0156108784-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0156108784-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0156108784-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0156108784-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0156108784-53">(</span><span class="n">P</span><span class="p" data-group-id="0156108784-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0156108784-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0156108784-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0156108784-55">(</span><span class="n">P</span><span class="p" data-group-id="0156108784-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0156108784-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0156108784-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0156108784-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0156108784-57">(</span><span class="p" data-group-id="0156108784-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-58">{</span><span class="p" data-group-id="0156108784-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0156108784-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0156108784-60">}</span><span class="p" data-group-id="0156108784-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0156108784-61">(</span><span class="p" data-group-id="0156108784-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0156108784-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0156108784-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0156108784-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0156108784-64">]</span><span class="w">
        </span><span class="p" data-group-id="0156108784-63">)</span><span class="w">
    </span><span class="p" data-group-id="0156108784-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0156108784-65">(</span><span class="p" data-group-id="0156108784-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="0156108784-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0156108784-67">(</span><span class="p" data-group-id="0156108784-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0156108784-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0156108784-69">]</span><span class="p" data-group-id="0156108784-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0156108784-70">(</span><span class="p" data-group-id="0156108784-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0156108784-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0156108784-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0156108784-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0156108784-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0156108784-73">(</span><span class="p" data-group-id="0156108784-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0156108784-75">{</span><span class="ss">fff</span><span class="p" data-group-id="0156108784-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0156108784-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0156108784-77">]</span><span class="p" data-group-id="0156108784-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-78">[</span><span class="n">Fun</span><span class="p" data-group-id="0156108784-79">(</span><span class="n">H</span><span class="p" data-group-id="0156108784-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0156108784-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0156108784-80">)</span><span class="p" data-group-id="0156108784-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0156108784-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0156108784-82">[</span><span class="p" data-group-id="0156108784-82">]</span><span class="p" data-group-id="0156108784-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0156108784-83">[</span><span class="p" data-group-id="0156108784-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0156108784-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0156108784-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0156108784-85">(</span><span class="p" data-group-id="0156108784-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0156108784-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0156108784-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0156108784-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0156108784-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0156108784-89">(</span><span class="nf">fun</span><span class="p" data-group-id="0156108784-90">(</span><span class="p" data-group-id="0156108784-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0156108784-91">{</span><span class="nf">self</span><span class="p" data-group-id="0156108784-92">(</span><span class="p" data-group-id="0156108784-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0156108784-93">(</span><span class="n">X</span><span class="p" data-group-id="0156108784-93">)</span><span class="p" data-group-id="0156108784-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0156108784-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0156108784-88">]</span><span class="w">
    </span><span class="p" data-group-id="0156108784-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol">
    Algol Style (algol)<a class="headerlink" href="#algol" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_style</span><span class="p" data-group-id="6025746391-1">(</span><span class="p" data-group-id="6025746391-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="algol-example.erl">
      example.erl<a class="headerlink" href="#algol-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5671488556-1">(</span><span class="ss">test</span><span class="p" data-group-id="5671488556-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5671488556-2">(</span><span class="p" data-group-id="5671488556-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5671488556-3">]</span><span class="p" data-group-id="5671488556-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5671488556-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5671488556-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5671488556-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5671488556-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5671488556-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5671488556-9">}</span><span class="p" data-group-id="5671488556-6">]</span><span class="p" data-group-id="5671488556-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5671488556-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5671488556-11">}</span><span class="p" data-group-id="5671488556-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5671488556-12">(</span><span class="n">Port</span><span class="p" data-group-id="5671488556-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5671488556-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5671488556-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5671488556-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5671488556-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5671488556-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-17">[</span><span class="p" data-group-id="5671488556-18">[</span><span class="p" data-group-id="5671488556-18">]</span><span class="p" data-group-id="5671488556-17">]</span><span class="p" data-group-id="5671488556-16">)</span><span class="p" data-group-id="5671488556-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5671488556-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5671488556-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5671488556-20">(</span><span class="n">Players</span><span class="p" data-group-id="5671488556-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5671488556-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-22">[</span><span class="p" data-group-id="5671488556-22">]</span><span class="p" data-group-id="5671488556-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5671488556-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5671488556-24">(</span><span class="n">P</span><span class="p" data-group-id="5671488556-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5671488556-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-26">[</span><span class="n">P</span><span class="p" data-group-id="5671488556-26">]</span><span class="p" data-group-id="5671488556-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5671488556-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5671488556-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5671488556-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5671488556-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5671488556-29">(</span><span class="n">Player</span><span class="p" data-group-id="5671488556-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5671488556-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-31">[</span><span class="n">Player</span><span class="p" data-group-id="5671488556-31">]</span><span class="p" data-group-id="5671488556-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5671488556-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5671488556-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5671488556-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5671488556-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5671488556-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-36">[</span><span class="n">Player</span><span class="p" data-group-id="5671488556-36">]</span><span class="p" data-group-id="5671488556-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5671488556-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5671488556-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5671488556-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5671488556-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5671488556-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5671488556-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5671488556-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5671488556-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5671488556-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5671488556-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5671488556-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5671488556-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5671488556-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5671488556-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5671488556-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5671488556-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5671488556-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5671488556-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5671488556-49">(</span><span class="n">Player</span><span class="p" data-group-id="5671488556-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5671488556-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5671488556-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5671488556-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5671488556-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5671488556-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5671488556-53">(</span><span class="n">P</span><span class="p" data-group-id="5671488556-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5671488556-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5671488556-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5671488556-55">(</span><span class="n">P</span><span class="p" data-group-id="5671488556-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5671488556-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5671488556-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5671488556-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5671488556-57">(</span><span class="p" data-group-id="5671488556-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-58">{</span><span class="p" data-group-id="5671488556-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5671488556-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5671488556-60">}</span><span class="p" data-group-id="5671488556-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5671488556-61">(</span><span class="p" data-group-id="5671488556-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5671488556-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5671488556-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5671488556-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5671488556-64">]</span><span class="w">
        </span><span class="p" data-group-id="5671488556-63">)</span><span class="w">
    </span><span class="p" data-group-id="5671488556-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5671488556-65">(</span><span class="p" data-group-id="5671488556-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5671488556-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5671488556-67">(</span><span class="p" data-group-id="5671488556-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5671488556-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5671488556-69">]</span><span class="p" data-group-id="5671488556-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5671488556-70">(</span><span class="p" data-group-id="5671488556-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5671488556-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5671488556-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5671488556-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5671488556-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5671488556-73">(</span><span class="p" data-group-id="5671488556-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5671488556-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5671488556-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5671488556-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5671488556-77">]</span><span class="p" data-group-id="5671488556-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5671488556-79">(</span><span class="n">H</span><span class="p" data-group-id="5671488556-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5671488556-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5671488556-80">)</span><span class="p" data-group-id="5671488556-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5671488556-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5671488556-82">[</span><span class="p" data-group-id="5671488556-82">]</span><span class="p" data-group-id="5671488556-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5671488556-83">[</span><span class="p" data-group-id="5671488556-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5671488556-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5671488556-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5671488556-85">(</span><span class="p" data-group-id="5671488556-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5671488556-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5671488556-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5671488556-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5671488556-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5671488556-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5671488556-90">(</span><span class="p" data-group-id="5671488556-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5671488556-91">{</span><span class="nf">self</span><span class="p" data-group-id="5671488556-92">(</span><span class="p" data-group-id="5671488556-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5671488556-93">(</span><span class="n">X</span><span class="p" data-group-id="5671488556-93">)</span><span class="p" data-group-id="5671488556-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5671488556-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5671488556-88">]</span><span class="w">
    </span><span class="p" data-group-id="5671488556-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol_nu">
    Algol_Nu Style (algol_nu)<a class="headerlink" href="#algol_nu" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol_nu"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_nu_style</span><span class="p" data-group-id="2897663701-1">(</span><span class="p" data-group-id="2897663701-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="algol_nu-example.erl">
      example.erl<a class="headerlink" href="#algol_nu-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol_nu"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5999055958-1">(</span><span class="ss">test</span><span class="p" data-group-id="5999055958-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5999055958-2">(</span><span class="p" data-group-id="5999055958-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5999055958-3">]</span><span class="p" data-group-id="5999055958-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5999055958-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5999055958-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5999055958-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5999055958-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5999055958-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5999055958-9">}</span><span class="p" data-group-id="5999055958-6">]</span><span class="p" data-group-id="5999055958-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5999055958-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5999055958-11">}</span><span class="p" data-group-id="5999055958-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5999055958-12">(</span><span class="n">Port</span><span class="p" data-group-id="5999055958-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5999055958-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5999055958-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5999055958-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5999055958-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5999055958-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-17">[</span><span class="p" data-group-id="5999055958-18">[</span><span class="p" data-group-id="5999055958-18">]</span><span class="p" data-group-id="5999055958-17">]</span><span class="p" data-group-id="5999055958-16">)</span><span class="p" data-group-id="5999055958-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5999055958-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5999055958-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5999055958-20">(</span><span class="n">Players</span><span class="p" data-group-id="5999055958-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5999055958-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-22">[</span><span class="p" data-group-id="5999055958-22">]</span><span class="p" data-group-id="5999055958-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5999055958-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5999055958-24">(</span><span class="n">P</span><span class="p" data-group-id="5999055958-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5999055958-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-26">[</span><span class="n">P</span><span class="p" data-group-id="5999055958-26">]</span><span class="p" data-group-id="5999055958-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5999055958-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5999055958-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5999055958-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5999055958-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5999055958-29">(</span><span class="n">Player</span><span class="p" data-group-id="5999055958-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5999055958-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-31">[</span><span class="n">Player</span><span class="p" data-group-id="5999055958-31">]</span><span class="p" data-group-id="5999055958-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5999055958-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5999055958-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5999055958-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5999055958-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5999055958-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-36">[</span><span class="n">Player</span><span class="p" data-group-id="5999055958-36">]</span><span class="p" data-group-id="5999055958-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5999055958-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5999055958-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5999055958-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5999055958-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5999055958-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5999055958-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5999055958-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5999055958-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5999055958-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5999055958-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5999055958-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5999055958-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5999055958-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5999055958-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5999055958-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5999055958-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5999055958-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5999055958-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5999055958-49">(</span><span class="n">Player</span><span class="p" data-group-id="5999055958-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5999055958-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5999055958-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5999055958-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5999055958-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5999055958-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5999055958-53">(</span><span class="n">P</span><span class="p" data-group-id="5999055958-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5999055958-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5999055958-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5999055958-55">(</span><span class="n">P</span><span class="p" data-group-id="5999055958-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5999055958-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5999055958-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5999055958-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5999055958-57">(</span><span class="p" data-group-id="5999055958-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-58">{</span><span class="p" data-group-id="5999055958-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5999055958-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5999055958-60">}</span><span class="p" data-group-id="5999055958-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5999055958-61">(</span><span class="p" data-group-id="5999055958-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5999055958-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5999055958-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5999055958-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5999055958-64">]</span><span class="w">
        </span><span class="p" data-group-id="5999055958-63">)</span><span class="w">
    </span><span class="p" data-group-id="5999055958-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5999055958-65">(</span><span class="p" data-group-id="5999055958-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5999055958-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5999055958-67">(</span><span class="p" data-group-id="5999055958-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5999055958-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5999055958-69">]</span><span class="p" data-group-id="5999055958-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5999055958-70">(</span><span class="p" data-group-id="5999055958-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5999055958-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5999055958-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5999055958-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5999055958-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5999055958-73">(</span><span class="p" data-group-id="5999055958-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5999055958-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5999055958-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5999055958-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5999055958-77">]</span><span class="p" data-group-id="5999055958-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5999055958-79">(</span><span class="n">H</span><span class="p" data-group-id="5999055958-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5999055958-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5999055958-80">)</span><span class="p" data-group-id="5999055958-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5999055958-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5999055958-82">[</span><span class="p" data-group-id="5999055958-82">]</span><span class="p" data-group-id="5999055958-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5999055958-83">[</span><span class="p" data-group-id="5999055958-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5999055958-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5999055958-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5999055958-85">(</span><span class="p" data-group-id="5999055958-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5999055958-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5999055958-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5999055958-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5999055958-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5999055958-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5999055958-90">(</span><span class="p" data-group-id="5999055958-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5999055958-91">{</span><span class="nf">self</span><span class="p" data-group-id="5999055958-92">(</span><span class="p" data-group-id="5999055958-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5999055958-93">(</span><span class="n">X</span><span class="p" data-group-id="5999055958-93">)</span><span class="p" data-group-id="5999055958-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5999055958-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5999055958-88">]</span><span class="w">
    </span><span class="p" data-group-id="5999055958-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="arduino">
    Arduino Style (arduino)<a class="headerlink" href="#arduino" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-arduino"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">arduino_style</span><span class="p" data-group-id="7426383342-1">(</span><span class="p" data-group-id="7426383342-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="arduino-example.erl">
      example.erl<a class="headerlink" href="#arduino-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-arduino"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7678712641-1">(</span><span class="ss">test</span><span class="p" data-group-id="7678712641-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7678712641-2">(</span><span class="p" data-group-id="7678712641-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7678712641-3">]</span><span class="p" data-group-id="7678712641-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7678712641-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7678712641-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7678712641-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7678712641-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7678712641-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7678712641-9">}</span><span class="p" data-group-id="7678712641-6">]</span><span class="p" data-group-id="7678712641-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7678712641-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7678712641-11">}</span><span class="p" data-group-id="7678712641-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7678712641-12">(</span><span class="n">Port</span><span class="p" data-group-id="7678712641-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7678712641-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7678712641-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7678712641-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7678712641-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7678712641-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-17">[</span><span class="p" data-group-id="7678712641-18">[</span><span class="p" data-group-id="7678712641-18">]</span><span class="p" data-group-id="7678712641-17">]</span><span class="p" data-group-id="7678712641-16">)</span><span class="p" data-group-id="7678712641-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7678712641-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7678712641-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7678712641-20">(</span><span class="n">Players</span><span class="p" data-group-id="7678712641-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7678712641-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-22">[</span><span class="p" data-group-id="7678712641-22">]</span><span class="p" data-group-id="7678712641-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7678712641-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7678712641-24">(</span><span class="n">P</span><span class="p" data-group-id="7678712641-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7678712641-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-26">[</span><span class="n">P</span><span class="p" data-group-id="7678712641-26">]</span><span class="p" data-group-id="7678712641-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7678712641-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7678712641-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7678712641-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7678712641-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7678712641-29">(</span><span class="n">Player</span><span class="p" data-group-id="7678712641-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7678712641-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-31">[</span><span class="n">Player</span><span class="p" data-group-id="7678712641-31">]</span><span class="p" data-group-id="7678712641-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7678712641-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7678712641-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7678712641-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7678712641-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7678712641-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-36">[</span><span class="n">Player</span><span class="p" data-group-id="7678712641-36">]</span><span class="p" data-group-id="7678712641-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7678712641-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7678712641-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7678712641-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7678712641-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7678712641-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7678712641-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7678712641-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7678712641-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7678712641-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7678712641-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7678712641-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7678712641-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7678712641-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7678712641-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7678712641-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7678712641-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7678712641-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7678712641-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7678712641-49">(</span><span class="n">Player</span><span class="p" data-group-id="7678712641-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7678712641-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7678712641-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7678712641-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7678712641-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7678712641-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7678712641-53">(</span><span class="n">P</span><span class="p" data-group-id="7678712641-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7678712641-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7678712641-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7678712641-55">(</span><span class="n">P</span><span class="p" data-group-id="7678712641-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7678712641-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7678712641-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7678712641-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7678712641-57">(</span><span class="p" data-group-id="7678712641-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-58">{</span><span class="p" data-group-id="7678712641-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7678712641-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7678712641-60">}</span><span class="p" data-group-id="7678712641-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7678712641-61">(</span><span class="p" data-group-id="7678712641-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7678712641-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7678712641-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7678712641-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7678712641-64">]</span><span class="w">
        </span><span class="p" data-group-id="7678712641-63">)</span><span class="w">
    </span><span class="p" data-group-id="7678712641-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7678712641-65">(</span><span class="p" data-group-id="7678712641-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="7678712641-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7678712641-67">(</span><span class="p" data-group-id="7678712641-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7678712641-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7678712641-69">]</span><span class="p" data-group-id="7678712641-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7678712641-70">(</span><span class="p" data-group-id="7678712641-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7678712641-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7678712641-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7678712641-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7678712641-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7678712641-73">(</span><span class="p" data-group-id="7678712641-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7678712641-75">{</span><span class="ss">fff</span><span class="p" data-group-id="7678712641-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7678712641-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7678712641-77">]</span><span class="p" data-group-id="7678712641-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-78">[</span><span class="n">Fun</span><span class="p" data-group-id="7678712641-79">(</span><span class="n">H</span><span class="p" data-group-id="7678712641-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7678712641-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7678712641-80">)</span><span class="p" data-group-id="7678712641-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7678712641-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7678712641-82">[</span><span class="p" data-group-id="7678712641-82">]</span><span class="p" data-group-id="7678712641-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7678712641-83">[</span><span class="p" data-group-id="7678712641-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7678712641-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7678712641-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7678712641-85">(</span><span class="p" data-group-id="7678712641-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7678712641-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7678712641-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7678712641-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7678712641-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7678712641-89">(</span><span class="nf">fun</span><span class="p" data-group-id="7678712641-90">(</span><span class="p" data-group-id="7678712641-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7678712641-91">{</span><span class="nf">self</span><span class="p" data-group-id="7678712641-92">(</span><span class="p" data-group-id="7678712641-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7678712641-93">(</span><span class="n">X</span><span class="p" data-group-id="7678712641-93">)</span><span class="p" data-group-id="7678712641-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7678712641-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7678712641-88">]</span><span class="w">
    </span><span class="p" data-group-id="7678712641-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="autumn">
    Autumn Style (autumn)<a class="headerlink" href="#autumn" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-autumn"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">autumn_style</span><span class="p" data-group-id="1799196264-1">(</span><span class="p" data-group-id="1799196264-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="autumn-example.erl">
      example.erl<a class="headerlink" href="#autumn-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-autumn"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1943773534-1">(</span><span class="ss">test</span><span class="p" data-group-id="1943773534-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1943773534-2">(</span><span class="p" data-group-id="1943773534-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1943773534-3">]</span><span class="p" data-group-id="1943773534-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1943773534-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1943773534-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1943773534-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1943773534-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1943773534-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1943773534-9">}</span><span class="p" data-group-id="1943773534-6">]</span><span class="p" data-group-id="1943773534-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1943773534-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1943773534-11">}</span><span class="p" data-group-id="1943773534-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1943773534-12">(</span><span class="n">Port</span><span class="p" data-group-id="1943773534-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1943773534-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1943773534-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1943773534-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1943773534-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1943773534-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-17">[</span><span class="p" data-group-id="1943773534-18">[</span><span class="p" data-group-id="1943773534-18">]</span><span class="p" data-group-id="1943773534-17">]</span><span class="p" data-group-id="1943773534-16">)</span><span class="p" data-group-id="1943773534-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1943773534-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1943773534-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1943773534-20">(</span><span class="n">Players</span><span class="p" data-group-id="1943773534-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1943773534-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-22">[</span><span class="p" data-group-id="1943773534-22">]</span><span class="p" data-group-id="1943773534-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1943773534-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1943773534-24">(</span><span class="n">P</span><span class="p" data-group-id="1943773534-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1943773534-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-26">[</span><span class="n">P</span><span class="p" data-group-id="1943773534-26">]</span><span class="p" data-group-id="1943773534-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1943773534-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1943773534-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1943773534-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1943773534-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1943773534-29">(</span><span class="n">Player</span><span class="p" data-group-id="1943773534-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1943773534-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-31">[</span><span class="n">Player</span><span class="p" data-group-id="1943773534-31">]</span><span class="p" data-group-id="1943773534-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1943773534-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1943773534-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1943773534-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1943773534-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1943773534-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-36">[</span><span class="n">Player</span><span class="p" data-group-id="1943773534-36">]</span><span class="p" data-group-id="1943773534-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1943773534-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1943773534-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1943773534-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1943773534-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1943773534-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1943773534-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1943773534-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1943773534-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1943773534-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1943773534-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1943773534-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1943773534-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1943773534-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1943773534-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1943773534-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1943773534-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1943773534-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1943773534-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1943773534-49">(</span><span class="n">Player</span><span class="p" data-group-id="1943773534-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1943773534-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1943773534-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1943773534-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1943773534-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1943773534-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1943773534-53">(</span><span class="n">P</span><span class="p" data-group-id="1943773534-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1943773534-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1943773534-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1943773534-55">(</span><span class="n">P</span><span class="p" data-group-id="1943773534-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1943773534-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1943773534-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1943773534-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1943773534-57">(</span><span class="p" data-group-id="1943773534-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-58">{</span><span class="p" data-group-id="1943773534-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1943773534-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1943773534-60">}</span><span class="p" data-group-id="1943773534-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1943773534-61">(</span><span class="p" data-group-id="1943773534-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1943773534-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1943773534-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1943773534-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1943773534-64">]</span><span class="w">
        </span><span class="p" data-group-id="1943773534-63">)</span><span class="w">
    </span><span class="p" data-group-id="1943773534-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1943773534-65">(</span><span class="p" data-group-id="1943773534-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="1943773534-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1943773534-67">(</span><span class="p" data-group-id="1943773534-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1943773534-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1943773534-69">]</span><span class="p" data-group-id="1943773534-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1943773534-70">(</span><span class="p" data-group-id="1943773534-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1943773534-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1943773534-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1943773534-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1943773534-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1943773534-73">(</span><span class="p" data-group-id="1943773534-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1943773534-75">{</span><span class="ss">fff</span><span class="p" data-group-id="1943773534-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1943773534-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1943773534-77">]</span><span class="p" data-group-id="1943773534-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-78">[</span><span class="n">Fun</span><span class="p" data-group-id="1943773534-79">(</span><span class="n">H</span><span class="p" data-group-id="1943773534-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1943773534-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1943773534-80">)</span><span class="p" data-group-id="1943773534-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1943773534-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1943773534-82">[</span><span class="p" data-group-id="1943773534-82">]</span><span class="p" data-group-id="1943773534-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1943773534-83">[</span><span class="p" data-group-id="1943773534-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1943773534-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1943773534-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1943773534-85">(</span><span class="p" data-group-id="1943773534-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1943773534-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1943773534-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1943773534-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1943773534-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1943773534-89">(</span><span class="nf">fun</span><span class="p" data-group-id="1943773534-90">(</span><span class="p" data-group-id="1943773534-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1943773534-91">{</span><span class="nf">self</span><span class="p" data-group-id="1943773534-92">(</span><span class="p" data-group-id="1943773534-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1943773534-93">(</span><span class="n">X</span><span class="p" data-group-id="1943773534-93">)</span><span class="p" data-group-id="1943773534-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1943773534-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1943773534-88">]</span><span class="w">
    </span><span class="p" data-group-id="1943773534-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="borland">
    Borland Style (borland)<a class="headerlink" href="#borland" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-borland"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">borland_style</span><span class="p" data-group-id="8439141250-1">(</span><span class="p" data-group-id="8439141250-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="borland-example.erl">
      example.erl<a class="headerlink" href="#borland-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-borland"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1814517529-1">(</span><span class="ss">test</span><span class="p" data-group-id="1814517529-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1814517529-2">(</span><span class="p" data-group-id="1814517529-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1814517529-3">]</span><span class="p" data-group-id="1814517529-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1814517529-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1814517529-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1814517529-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1814517529-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1814517529-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1814517529-9">}</span><span class="p" data-group-id="1814517529-6">]</span><span class="p" data-group-id="1814517529-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1814517529-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1814517529-11">}</span><span class="p" data-group-id="1814517529-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1814517529-12">(</span><span class="n">Port</span><span class="p" data-group-id="1814517529-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1814517529-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1814517529-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1814517529-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1814517529-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1814517529-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-17">[</span><span class="p" data-group-id="1814517529-18">[</span><span class="p" data-group-id="1814517529-18">]</span><span class="p" data-group-id="1814517529-17">]</span><span class="p" data-group-id="1814517529-16">)</span><span class="p" data-group-id="1814517529-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1814517529-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1814517529-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1814517529-20">(</span><span class="n">Players</span><span class="p" data-group-id="1814517529-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1814517529-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-22">[</span><span class="p" data-group-id="1814517529-22">]</span><span class="p" data-group-id="1814517529-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1814517529-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1814517529-24">(</span><span class="n">P</span><span class="p" data-group-id="1814517529-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1814517529-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-26">[</span><span class="n">P</span><span class="p" data-group-id="1814517529-26">]</span><span class="p" data-group-id="1814517529-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1814517529-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1814517529-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1814517529-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1814517529-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1814517529-29">(</span><span class="n">Player</span><span class="p" data-group-id="1814517529-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1814517529-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-31">[</span><span class="n">Player</span><span class="p" data-group-id="1814517529-31">]</span><span class="p" data-group-id="1814517529-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1814517529-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1814517529-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1814517529-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1814517529-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1814517529-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-36">[</span><span class="n">Player</span><span class="p" data-group-id="1814517529-36">]</span><span class="p" data-group-id="1814517529-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1814517529-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1814517529-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1814517529-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1814517529-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1814517529-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1814517529-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1814517529-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1814517529-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1814517529-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1814517529-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1814517529-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1814517529-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1814517529-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1814517529-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1814517529-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1814517529-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1814517529-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1814517529-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1814517529-49">(</span><span class="n">Player</span><span class="p" data-group-id="1814517529-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1814517529-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1814517529-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1814517529-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1814517529-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1814517529-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1814517529-53">(</span><span class="n">P</span><span class="p" data-group-id="1814517529-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1814517529-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1814517529-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1814517529-55">(</span><span class="n">P</span><span class="p" data-group-id="1814517529-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1814517529-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1814517529-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1814517529-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1814517529-57">(</span><span class="p" data-group-id="1814517529-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-58">{</span><span class="p" data-group-id="1814517529-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1814517529-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1814517529-60">}</span><span class="p" data-group-id="1814517529-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1814517529-61">(</span><span class="p" data-group-id="1814517529-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1814517529-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1814517529-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1814517529-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1814517529-64">]</span><span class="w">
        </span><span class="p" data-group-id="1814517529-63">)</span><span class="w">
    </span><span class="p" data-group-id="1814517529-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1814517529-65">(</span><span class="p" data-group-id="1814517529-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="1814517529-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1814517529-67">(</span><span class="p" data-group-id="1814517529-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1814517529-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1814517529-69">]</span><span class="p" data-group-id="1814517529-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1814517529-70">(</span><span class="p" data-group-id="1814517529-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1814517529-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1814517529-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1814517529-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1814517529-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1814517529-73">(</span><span class="p" data-group-id="1814517529-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1814517529-75">{</span><span class="ss">fff</span><span class="p" data-group-id="1814517529-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1814517529-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1814517529-77">]</span><span class="p" data-group-id="1814517529-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-78">[</span><span class="n">Fun</span><span class="p" data-group-id="1814517529-79">(</span><span class="n">H</span><span class="p" data-group-id="1814517529-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1814517529-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1814517529-80">)</span><span class="p" data-group-id="1814517529-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1814517529-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1814517529-82">[</span><span class="p" data-group-id="1814517529-82">]</span><span class="p" data-group-id="1814517529-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1814517529-83">[</span><span class="p" data-group-id="1814517529-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1814517529-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1814517529-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1814517529-85">(</span><span class="p" data-group-id="1814517529-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1814517529-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1814517529-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1814517529-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1814517529-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1814517529-89">(</span><span class="nf">fun</span><span class="p" data-group-id="1814517529-90">(</span><span class="p" data-group-id="1814517529-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1814517529-91">{</span><span class="nf">self</span><span class="p" data-group-id="1814517529-92">(</span><span class="p" data-group-id="1814517529-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1814517529-93">(</span><span class="n">X</span><span class="p" data-group-id="1814517529-93">)</span><span class="p" data-group-id="1814517529-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1814517529-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1814517529-88">]</span><span class="w">
    </span><span class="p" data-group-id="1814517529-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="bw">
    BlackWhite Style (bw)<a class="headerlink" href="#bw" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-bw"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">bw_style</span><span class="p" data-group-id="9683650037-1">(</span><span class="p" data-group-id="9683650037-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="bw-example.erl">
      example.erl<a class="headerlink" href="#bw-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-bw"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7900148057-1">(</span><span class="ss">test</span><span class="p" data-group-id="7900148057-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7900148057-2">(</span><span class="p" data-group-id="7900148057-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7900148057-3">]</span><span class="p" data-group-id="7900148057-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7900148057-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7900148057-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7900148057-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7900148057-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7900148057-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7900148057-9">}</span><span class="p" data-group-id="7900148057-6">]</span><span class="p" data-group-id="7900148057-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7900148057-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7900148057-11">}</span><span class="p" data-group-id="7900148057-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7900148057-12">(</span><span class="n">Port</span><span class="p" data-group-id="7900148057-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7900148057-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7900148057-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7900148057-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7900148057-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7900148057-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-17">[</span><span class="p" data-group-id="7900148057-18">[</span><span class="p" data-group-id="7900148057-18">]</span><span class="p" data-group-id="7900148057-17">]</span><span class="p" data-group-id="7900148057-16">)</span><span class="p" data-group-id="7900148057-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7900148057-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7900148057-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7900148057-20">(</span><span class="n">Players</span><span class="p" data-group-id="7900148057-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7900148057-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-22">[</span><span class="p" data-group-id="7900148057-22">]</span><span class="p" data-group-id="7900148057-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7900148057-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7900148057-24">(</span><span class="n">P</span><span class="p" data-group-id="7900148057-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7900148057-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-26">[</span><span class="n">P</span><span class="p" data-group-id="7900148057-26">]</span><span class="p" data-group-id="7900148057-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7900148057-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7900148057-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7900148057-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7900148057-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7900148057-29">(</span><span class="n">Player</span><span class="p" data-group-id="7900148057-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7900148057-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-31">[</span><span class="n">Player</span><span class="p" data-group-id="7900148057-31">]</span><span class="p" data-group-id="7900148057-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7900148057-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7900148057-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7900148057-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7900148057-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7900148057-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-36">[</span><span class="n">Player</span><span class="p" data-group-id="7900148057-36">]</span><span class="p" data-group-id="7900148057-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7900148057-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7900148057-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7900148057-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7900148057-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7900148057-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7900148057-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7900148057-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7900148057-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7900148057-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7900148057-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7900148057-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7900148057-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7900148057-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7900148057-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7900148057-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7900148057-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7900148057-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7900148057-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7900148057-49">(</span><span class="n">Player</span><span class="p" data-group-id="7900148057-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7900148057-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7900148057-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7900148057-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7900148057-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7900148057-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7900148057-53">(</span><span class="n">P</span><span class="p" data-group-id="7900148057-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7900148057-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7900148057-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7900148057-55">(</span><span class="n">P</span><span class="p" data-group-id="7900148057-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7900148057-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7900148057-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7900148057-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7900148057-57">(</span><span class="p" data-group-id="7900148057-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-58">{</span><span class="p" data-group-id="7900148057-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7900148057-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7900148057-60">}</span><span class="p" data-group-id="7900148057-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7900148057-61">(</span><span class="p" data-group-id="7900148057-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7900148057-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7900148057-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7900148057-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7900148057-64">]</span><span class="w">
        </span><span class="p" data-group-id="7900148057-63">)</span><span class="w">
    </span><span class="p" data-group-id="7900148057-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7900148057-65">(</span><span class="p" data-group-id="7900148057-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="7900148057-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7900148057-67">(</span><span class="p" data-group-id="7900148057-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7900148057-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7900148057-69">]</span><span class="p" data-group-id="7900148057-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7900148057-70">(</span><span class="p" data-group-id="7900148057-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7900148057-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7900148057-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7900148057-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7900148057-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7900148057-73">(</span><span class="p" data-group-id="7900148057-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7900148057-75">{</span><span class="ss">fff</span><span class="p" data-group-id="7900148057-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7900148057-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7900148057-77">]</span><span class="p" data-group-id="7900148057-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-78">[</span><span class="n">Fun</span><span class="p" data-group-id="7900148057-79">(</span><span class="n">H</span><span class="p" data-group-id="7900148057-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7900148057-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7900148057-80">)</span><span class="p" data-group-id="7900148057-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7900148057-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7900148057-82">[</span><span class="p" data-group-id="7900148057-82">]</span><span class="p" data-group-id="7900148057-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7900148057-83">[</span><span class="p" data-group-id="7900148057-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7900148057-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7900148057-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7900148057-85">(</span><span class="p" data-group-id="7900148057-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7900148057-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7900148057-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7900148057-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7900148057-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7900148057-89">(</span><span class="nf">fun</span><span class="p" data-group-id="7900148057-90">(</span><span class="p" data-group-id="7900148057-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7900148057-91">{</span><span class="nf">self</span><span class="p" data-group-id="7900148057-92">(</span><span class="p" data-group-id="7900148057-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7900148057-93">(</span><span class="n">X</span><span class="p" data-group-id="7900148057-93">)</span><span class="p" data-group-id="7900148057-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7900148057-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7900148057-88">]</span><span class="w">
    </span><span class="p" data-group-id="7900148057-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="colorful">
    Colorful Style (colorful)<a class="headerlink" href="#colorful" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-colorful"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">colorful_style</span><span class="p" data-group-id="6951741279-1">(</span><span class="p" data-group-id="6951741279-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="colorful-example.erl">
      example.erl<a class="headerlink" href="#colorful-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-colorful"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5858629412-1">(</span><span class="ss">test</span><span class="p" data-group-id="5858629412-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5858629412-2">(</span><span class="p" data-group-id="5858629412-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5858629412-3">]</span><span class="p" data-group-id="5858629412-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5858629412-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5858629412-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5858629412-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5858629412-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5858629412-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5858629412-9">}</span><span class="p" data-group-id="5858629412-6">]</span><span class="p" data-group-id="5858629412-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5858629412-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5858629412-11">}</span><span class="p" data-group-id="5858629412-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5858629412-12">(</span><span class="n">Port</span><span class="p" data-group-id="5858629412-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5858629412-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5858629412-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5858629412-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5858629412-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5858629412-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-17">[</span><span class="p" data-group-id="5858629412-18">[</span><span class="p" data-group-id="5858629412-18">]</span><span class="p" data-group-id="5858629412-17">]</span><span class="p" data-group-id="5858629412-16">)</span><span class="p" data-group-id="5858629412-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5858629412-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5858629412-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5858629412-20">(</span><span class="n">Players</span><span class="p" data-group-id="5858629412-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5858629412-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-22">[</span><span class="p" data-group-id="5858629412-22">]</span><span class="p" data-group-id="5858629412-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5858629412-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5858629412-24">(</span><span class="n">P</span><span class="p" data-group-id="5858629412-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5858629412-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-26">[</span><span class="n">P</span><span class="p" data-group-id="5858629412-26">]</span><span class="p" data-group-id="5858629412-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5858629412-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5858629412-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5858629412-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5858629412-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5858629412-29">(</span><span class="n">Player</span><span class="p" data-group-id="5858629412-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5858629412-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-31">[</span><span class="n">Player</span><span class="p" data-group-id="5858629412-31">]</span><span class="p" data-group-id="5858629412-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5858629412-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5858629412-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5858629412-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5858629412-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5858629412-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-36">[</span><span class="n">Player</span><span class="p" data-group-id="5858629412-36">]</span><span class="p" data-group-id="5858629412-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5858629412-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5858629412-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5858629412-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5858629412-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5858629412-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5858629412-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5858629412-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5858629412-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5858629412-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5858629412-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5858629412-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5858629412-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5858629412-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5858629412-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5858629412-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5858629412-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5858629412-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5858629412-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5858629412-49">(</span><span class="n">Player</span><span class="p" data-group-id="5858629412-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5858629412-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5858629412-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5858629412-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5858629412-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5858629412-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5858629412-53">(</span><span class="n">P</span><span class="p" data-group-id="5858629412-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5858629412-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5858629412-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5858629412-55">(</span><span class="n">P</span><span class="p" data-group-id="5858629412-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5858629412-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5858629412-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5858629412-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5858629412-57">(</span><span class="p" data-group-id="5858629412-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-58">{</span><span class="p" data-group-id="5858629412-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5858629412-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5858629412-60">}</span><span class="p" data-group-id="5858629412-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5858629412-61">(</span><span class="p" data-group-id="5858629412-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5858629412-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5858629412-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5858629412-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5858629412-64">]</span><span class="w">
        </span><span class="p" data-group-id="5858629412-63">)</span><span class="w">
    </span><span class="p" data-group-id="5858629412-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5858629412-65">(</span><span class="p" data-group-id="5858629412-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5858629412-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5858629412-67">(</span><span class="p" data-group-id="5858629412-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5858629412-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5858629412-69">]</span><span class="p" data-group-id="5858629412-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5858629412-70">(</span><span class="p" data-group-id="5858629412-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5858629412-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5858629412-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5858629412-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5858629412-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5858629412-73">(</span><span class="p" data-group-id="5858629412-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5858629412-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5858629412-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5858629412-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5858629412-77">]</span><span class="p" data-group-id="5858629412-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5858629412-79">(</span><span class="n">H</span><span class="p" data-group-id="5858629412-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5858629412-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5858629412-80">)</span><span class="p" data-group-id="5858629412-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5858629412-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5858629412-82">[</span><span class="p" data-group-id="5858629412-82">]</span><span class="p" data-group-id="5858629412-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5858629412-83">[</span><span class="p" data-group-id="5858629412-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5858629412-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5858629412-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5858629412-85">(</span><span class="p" data-group-id="5858629412-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5858629412-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5858629412-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5858629412-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5858629412-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5858629412-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5858629412-90">(</span><span class="p" data-group-id="5858629412-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5858629412-91">{</span><span class="nf">self</span><span class="p" data-group-id="5858629412-92">(</span><span class="p" data-group-id="5858629412-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5858629412-93">(</span><span class="n">X</span><span class="p" data-group-id="5858629412-93">)</span><span class="p" data-group-id="5858629412-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5858629412-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5858629412-88">]</span><span class="w">
    </span><span class="p" data-group-id="5858629412-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="default">
    Default Style (default)<a class="headerlink" href="#default" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-default"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">default_style</span><span class="p" data-group-id="3614630180-1">(</span><span class="p" data-group-id="3614630180-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="default-example.erl">
      example.erl<a class="headerlink" href="#default-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-default"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8052573222-1">(</span><span class="ss">test</span><span class="p" data-group-id="8052573222-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8052573222-2">(</span><span class="p" data-group-id="8052573222-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8052573222-3">]</span><span class="p" data-group-id="8052573222-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8052573222-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8052573222-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8052573222-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8052573222-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8052573222-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8052573222-9">}</span><span class="p" data-group-id="8052573222-6">]</span><span class="p" data-group-id="8052573222-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8052573222-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8052573222-11">}</span><span class="p" data-group-id="8052573222-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8052573222-12">(</span><span class="n">Port</span><span class="p" data-group-id="8052573222-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8052573222-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8052573222-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8052573222-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8052573222-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8052573222-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-17">[</span><span class="p" data-group-id="8052573222-18">[</span><span class="p" data-group-id="8052573222-18">]</span><span class="p" data-group-id="8052573222-17">]</span><span class="p" data-group-id="8052573222-16">)</span><span class="p" data-group-id="8052573222-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8052573222-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8052573222-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8052573222-20">(</span><span class="n">Players</span><span class="p" data-group-id="8052573222-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8052573222-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-22">[</span><span class="p" data-group-id="8052573222-22">]</span><span class="p" data-group-id="8052573222-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8052573222-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8052573222-24">(</span><span class="n">P</span><span class="p" data-group-id="8052573222-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8052573222-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-26">[</span><span class="n">P</span><span class="p" data-group-id="8052573222-26">]</span><span class="p" data-group-id="8052573222-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8052573222-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8052573222-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8052573222-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8052573222-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8052573222-29">(</span><span class="n">Player</span><span class="p" data-group-id="8052573222-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8052573222-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-31">[</span><span class="n">Player</span><span class="p" data-group-id="8052573222-31">]</span><span class="p" data-group-id="8052573222-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8052573222-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8052573222-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8052573222-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8052573222-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8052573222-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-36">[</span><span class="n">Player</span><span class="p" data-group-id="8052573222-36">]</span><span class="p" data-group-id="8052573222-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8052573222-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8052573222-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8052573222-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8052573222-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8052573222-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8052573222-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8052573222-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8052573222-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8052573222-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8052573222-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8052573222-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8052573222-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8052573222-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8052573222-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8052573222-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8052573222-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8052573222-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8052573222-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8052573222-49">(</span><span class="n">Player</span><span class="p" data-group-id="8052573222-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8052573222-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8052573222-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8052573222-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8052573222-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8052573222-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8052573222-53">(</span><span class="n">P</span><span class="p" data-group-id="8052573222-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8052573222-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8052573222-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8052573222-55">(</span><span class="n">P</span><span class="p" data-group-id="8052573222-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8052573222-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8052573222-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8052573222-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8052573222-57">(</span><span class="p" data-group-id="8052573222-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-58">{</span><span class="p" data-group-id="8052573222-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8052573222-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8052573222-60">}</span><span class="p" data-group-id="8052573222-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8052573222-61">(</span><span class="p" data-group-id="8052573222-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8052573222-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8052573222-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8052573222-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8052573222-64">]</span><span class="w">
        </span><span class="p" data-group-id="8052573222-63">)</span><span class="w">
    </span><span class="p" data-group-id="8052573222-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8052573222-65">(</span><span class="p" data-group-id="8052573222-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="8052573222-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8052573222-67">(</span><span class="p" data-group-id="8052573222-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8052573222-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8052573222-69">]</span><span class="p" data-group-id="8052573222-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8052573222-70">(</span><span class="p" data-group-id="8052573222-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8052573222-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8052573222-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8052573222-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8052573222-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8052573222-73">(</span><span class="p" data-group-id="8052573222-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8052573222-75">{</span><span class="ss">fff</span><span class="p" data-group-id="8052573222-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8052573222-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8052573222-77">]</span><span class="p" data-group-id="8052573222-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-78">[</span><span class="n">Fun</span><span class="p" data-group-id="8052573222-79">(</span><span class="n">H</span><span class="p" data-group-id="8052573222-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8052573222-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8052573222-80">)</span><span class="p" data-group-id="8052573222-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8052573222-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8052573222-82">[</span><span class="p" data-group-id="8052573222-82">]</span><span class="p" data-group-id="8052573222-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8052573222-83">[</span><span class="p" data-group-id="8052573222-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8052573222-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8052573222-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8052573222-85">(</span><span class="p" data-group-id="8052573222-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8052573222-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8052573222-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8052573222-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8052573222-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8052573222-89">(</span><span class="nf">fun</span><span class="p" data-group-id="8052573222-90">(</span><span class="p" data-group-id="8052573222-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8052573222-91">{</span><span class="nf">self</span><span class="p" data-group-id="8052573222-92">(</span><span class="p" data-group-id="8052573222-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8052573222-93">(</span><span class="n">X</span><span class="p" data-group-id="8052573222-93">)</span><span class="p" data-group-id="8052573222-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8052573222-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8052573222-88">]</span><span class="w">
    </span><span class="p" data-group-id="8052573222-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="emacs">
    Emacs Style (emacs)<a class="headerlink" href="#emacs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-emacs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">emacs_style</span><span class="p" data-group-id="5457684477-1">(</span><span class="p" data-group-id="5457684477-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="emacs-example.erl">
      example.erl<a class="headerlink" href="#emacs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-emacs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3840826642-1">(</span><span class="ss">test</span><span class="p" data-group-id="3840826642-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3840826642-2">(</span><span class="p" data-group-id="3840826642-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="3840826642-3">]</span><span class="p" data-group-id="3840826642-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="3840826642-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="3840826642-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="3840826642-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3840826642-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3840826642-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3840826642-9">}</span><span class="p" data-group-id="3840826642-6">]</span><span class="p" data-group-id="3840826642-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="3840826642-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="3840826642-11">}</span><span class="p" data-group-id="3840826642-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="3840826642-12">(</span><span class="n">Port</span><span class="p" data-group-id="3840826642-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="3840826642-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="3840826642-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="3840826642-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="3840826642-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="3840826642-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-17">[</span><span class="p" data-group-id="3840826642-18">[</span><span class="p" data-group-id="3840826642-18">]</span><span class="p" data-group-id="3840826642-17">]</span><span class="p" data-group-id="3840826642-16">)</span><span class="p" data-group-id="3840826642-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="3840826642-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="3840826642-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="3840826642-20">(</span><span class="n">Players</span><span class="p" data-group-id="3840826642-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3840826642-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-22">[</span><span class="p" data-group-id="3840826642-22">]</span><span class="p" data-group-id="3840826642-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3840826642-23">(</span><span class="nf">fun</span><span class="p" data-group-id="3840826642-24">(</span><span class="n">P</span><span class="p" data-group-id="3840826642-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3840826642-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-26">[</span><span class="n">P</span><span class="p" data-group-id="3840826642-26">]</span><span class="p" data-group-id="3840826642-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3840826642-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3840826642-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="3840826642-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="3840826642-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3840826642-29">(</span><span class="n">Player</span><span class="p" data-group-id="3840826642-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3840826642-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-31">[</span><span class="n">Player</span><span class="p" data-group-id="3840826642-31">]</span><span class="p" data-group-id="3840826642-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3840826642-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3840826642-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3840826642-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3840826642-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3840826642-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-36">[</span><span class="n">Player</span><span class="p" data-group-id="3840826642-36">]</span><span class="p" data-group-id="3840826642-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="3840826642-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3840826642-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3840826642-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3840826642-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="3840826642-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3840826642-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3840826642-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="3840826642-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3840826642-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="3840826642-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="3840826642-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="3840826642-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="3840826642-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="3840826642-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="3840826642-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="3840826642-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="3840826642-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3840826642-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="3840826642-49">(</span><span class="n">Player</span><span class="p" data-group-id="3840826642-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3840826642-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="3840826642-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="3840826642-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3840826642-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="3840826642-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3840826642-53">(</span><span class="n">P</span><span class="p" data-group-id="3840826642-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="3840826642-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3840826642-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3840826642-55">(</span><span class="n">P</span><span class="p" data-group-id="3840826642-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3840826642-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3840826642-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="3840826642-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="3840826642-57">(</span><span class="p" data-group-id="3840826642-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-58">{</span><span class="p" data-group-id="3840826642-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="3840826642-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3840826642-60">}</span><span class="p" data-group-id="3840826642-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="3840826642-61">(</span><span class="p" data-group-id="3840826642-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="3840826642-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3840826642-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3840826642-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3840826642-64">]</span><span class="w">
        </span><span class="p" data-group-id="3840826642-63">)</span><span class="w">
    </span><span class="p" data-group-id="3840826642-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="3840826642-65">(</span><span class="p" data-group-id="3840826642-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="3840826642-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="3840826642-67">(</span><span class="p" data-group-id="3840826642-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3840826642-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3840826642-69">]</span><span class="p" data-group-id="3840826642-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="3840826642-70">(</span><span class="p" data-group-id="3840826642-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3840826642-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3840826642-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="3840826642-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="3840826642-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="3840826642-73">(</span><span class="p" data-group-id="3840826642-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="3840826642-75">{</span><span class="ss">fff</span><span class="p" data-group-id="3840826642-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="3840826642-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3840826642-77">]</span><span class="p" data-group-id="3840826642-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-78">[</span><span class="n">Fun</span><span class="p" data-group-id="3840826642-79">(</span><span class="n">H</span><span class="p" data-group-id="3840826642-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3840826642-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3840826642-80">)</span><span class="p" data-group-id="3840826642-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="3840826642-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3840826642-82">[</span><span class="p" data-group-id="3840826642-82">]</span><span class="p" data-group-id="3840826642-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3840826642-83">[</span><span class="p" data-group-id="3840826642-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="3840826642-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="3840826642-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="3840826642-85">(</span><span class="p" data-group-id="3840826642-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3840826642-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="3840826642-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="3840826642-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3840826642-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="3840826642-89">(</span><span class="nf">fun</span><span class="p" data-group-id="3840826642-90">(</span><span class="p" data-group-id="3840826642-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3840826642-91">{</span><span class="nf">self</span><span class="p" data-group-id="3840826642-92">(</span><span class="p" data-group-id="3840826642-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="3840826642-93">(</span><span class="n">X</span><span class="p" data-group-id="3840826642-93">)</span><span class="p" data-group-id="3840826642-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="3840826642-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="3840826642-88">]</span><span class="w">
    </span><span class="p" data-group-id="3840826642-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="friendly">
    Friendly Style (friendly)<a class="headerlink" href="#friendly" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-friendly"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">friendly_style</span><span class="p" data-group-id="3691347009-1">(</span><span class="p" data-group-id="3691347009-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="friendly-example.erl">
      example.erl<a class="headerlink" href="#friendly-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-friendly"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6832336238-1">(</span><span class="ss">test</span><span class="p" data-group-id="6832336238-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6832336238-2">(</span><span class="p" data-group-id="6832336238-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6832336238-3">]</span><span class="p" data-group-id="6832336238-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6832336238-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6832336238-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6832336238-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6832336238-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6832336238-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6832336238-9">}</span><span class="p" data-group-id="6832336238-6">]</span><span class="p" data-group-id="6832336238-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6832336238-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6832336238-11">}</span><span class="p" data-group-id="6832336238-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6832336238-12">(</span><span class="n">Port</span><span class="p" data-group-id="6832336238-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6832336238-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6832336238-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6832336238-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6832336238-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6832336238-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-17">[</span><span class="p" data-group-id="6832336238-18">[</span><span class="p" data-group-id="6832336238-18">]</span><span class="p" data-group-id="6832336238-17">]</span><span class="p" data-group-id="6832336238-16">)</span><span class="p" data-group-id="6832336238-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6832336238-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6832336238-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6832336238-20">(</span><span class="n">Players</span><span class="p" data-group-id="6832336238-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6832336238-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-22">[</span><span class="p" data-group-id="6832336238-22">]</span><span class="p" data-group-id="6832336238-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6832336238-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6832336238-24">(</span><span class="n">P</span><span class="p" data-group-id="6832336238-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6832336238-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-26">[</span><span class="n">P</span><span class="p" data-group-id="6832336238-26">]</span><span class="p" data-group-id="6832336238-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6832336238-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6832336238-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6832336238-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6832336238-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6832336238-29">(</span><span class="n">Player</span><span class="p" data-group-id="6832336238-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6832336238-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-31">[</span><span class="n">Player</span><span class="p" data-group-id="6832336238-31">]</span><span class="p" data-group-id="6832336238-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6832336238-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6832336238-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6832336238-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6832336238-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6832336238-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-36">[</span><span class="n">Player</span><span class="p" data-group-id="6832336238-36">]</span><span class="p" data-group-id="6832336238-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6832336238-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6832336238-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6832336238-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6832336238-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6832336238-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6832336238-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6832336238-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6832336238-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6832336238-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6832336238-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6832336238-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6832336238-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6832336238-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6832336238-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6832336238-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6832336238-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6832336238-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6832336238-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6832336238-49">(</span><span class="n">Player</span><span class="p" data-group-id="6832336238-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6832336238-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6832336238-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6832336238-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6832336238-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6832336238-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6832336238-53">(</span><span class="n">P</span><span class="p" data-group-id="6832336238-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6832336238-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6832336238-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6832336238-55">(</span><span class="n">P</span><span class="p" data-group-id="6832336238-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6832336238-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6832336238-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6832336238-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6832336238-57">(</span><span class="p" data-group-id="6832336238-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-58">{</span><span class="p" data-group-id="6832336238-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6832336238-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6832336238-60">}</span><span class="p" data-group-id="6832336238-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6832336238-61">(</span><span class="p" data-group-id="6832336238-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6832336238-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6832336238-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6832336238-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6832336238-64">]</span><span class="w">
        </span><span class="p" data-group-id="6832336238-63">)</span><span class="w">
    </span><span class="p" data-group-id="6832336238-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6832336238-65">(</span><span class="p" data-group-id="6832336238-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="6832336238-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6832336238-67">(</span><span class="p" data-group-id="6832336238-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6832336238-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6832336238-69">]</span><span class="p" data-group-id="6832336238-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6832336238-70">(</span><span class="p" data-group-id="6832336238-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6832336238-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6832336238-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6832336238-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6832336238-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6832336238-73">(</span><span class="p" data-group-id="6832336238-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6832336238-75">{</span><span class="ss">fff</span><span class="p" data-group-id="6832336238-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6832336238-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6832336238-77">]</span><span class="p" data-group-id="6832336238-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-78">[</span><span class="n">Fun</span><span class="p" data-group-id="6832336238-79">(</span><span class="n">H</span><span class="p" data-group-id="6832336238-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6832336238-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6832336238-80">)</span><span class="p" data-group-id="6832336238-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6832336238-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6832336238-82">[</span><span class="p" data-group-id="6832336238-82">]</span><span class="p" data-group-id="6832336238-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6832336238-83">[</span><span class="p" data-group-id="6832336238-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6832336238-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6832336238-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6832336238-85">(</span><span class="p" data-group-id="6832336238-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6832336238-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6832336238-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6832336238-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6832336238-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6832336238-89">(</span><span class="nf">fun</span><span class="p" data-group-id="6832336238-90">(</span><span class="p" data-group-id="6832336238-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6832336238-91">{</span><span class="nf">self</span><span class="p" data-group-id="6832336238-92">(</span><span class="p" data-group-id="6832336238-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6832336238-93">(</span><span class="n">X</span><span class="p" data-group-id="6832336238-93">)</span><span class="p" data-group-id="6832336238-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6832336238-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6832336238-88">]</span><span class="w">
    </span><span class="p" data-group-id="6832336238-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="fruity">
    Fruity Style (fruity)<a class="headerlink" href="#fruity" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-fruity"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">fruity_style</span><span class="p" data-group-id="4645099323-1">(</span><span class="p" data-group-id="4645099323-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="fruity-example.erl">
      example.erl<a class="headerlink" href="#fruity-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-fruity"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1026528654-1">(</span><span class="ss">test</span><span class="p" data-group-id="1026528654-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1026528654-2">(</span><span class="p" data-group-id="1026528654-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1026528654-3">]</span><span class="p" data-group-id="1026528654-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1026528654-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1026528654-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1026528654-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1026528654-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1026528654-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1026528654-9">}</span><span class="p" data-group-id="1026528654-6">]</span><span class="p" data-group-id="1026528654-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1026528654-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1026528654-11">}</span><span class="p" data-group-id="1026528654-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1026528654-12">(</span><span class="n">Port</span><span class="p" data-group-id="1026528654-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1026528654-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1026528654-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1026528654-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1026528654-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1026528654-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-17">[</span><span class="p" data-group-id="1026528654-18">[</span><span class="p" data-group-id="1026528654-18">]</span><span class="p" data-group-id="1026528654-17">]</span><span class="p" data-group-id="1026528654-16">)</span><span class="p" data-group-id="1026528654-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1026528654-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1026528654-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1026528654-20">(</span><span class="n">Players</span><span class="p" data-group-id="1026528654-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1026528654-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-22">[</span><span class="p" data-group-id="1026528654-22">]</span><span class="p" data-group-id="1026528654-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1026528654-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1026528654-24">(</span><span class="n">P</span><span class="p" data-group-id="1026528654-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1026528654-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-26">[</span><span class="n">P</span><span class="p" data-group-id="1026528654-26">]</span><span class="p" data-group-id="1026528654-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1026528654-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1026528654-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1026528654-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1026528654-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1026528654-29">(</span><span class="n">Player</span><span class="p" data-group-id="1026528654-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1026528654-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-31">[</span><span class="n">Player</span><span class="p" data-group-id="1026528654-31">]</span><span class="p" data-group-id="1026528654-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1026528654-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1026528654-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1026528654-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1026528654-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1026528654-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-36">[</span><span class="n">Player</span><span class="p" data-group-id="1026528654-36">]</span><span class="p" data-group-id="1026528654-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1026528654-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1026528654-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1026528654-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1026528654-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1026528654-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1026528654-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1026528654-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1026528654-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1026528654-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1026528654-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1026528654-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1026528654-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1026528654-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1026528654-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1026528654-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1026528654-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1026528654-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1026528654-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1026528654-49">(</span><span class="n">Player</span><span class="p" data-group-id="1026528654-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1026528654-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1026528654-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1026528654-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1026528654-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1026528654-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1026528654-53">(</span><span class="n">P</span><span class="p" data-group-id="1026528654-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1026528654-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1026528654-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1026528654-55">(</span><span class="n">P</span><span class="p" data-group-id="1026528654-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1026528654-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1026528654-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1026528654-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1026528654-57">(</span><span class="p" data-group-id="1026528654-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-58">{</span><span class="p" data-group-id="1026528654-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1026528654-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1026528654-60">}</span><span class="p" data-group-id="1026528654-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1026528654-61">(</span><span class="p" data-group-id="1026528654-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1026528654-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1026528654-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1026528654-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1026528654-64">]</span><span class="w">
        </span><span class="p" data-group-id="1026528654-63">)</span><span class="w">
    </span><span class="p" data-group-id="1026528654-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1026528654-65">(</span><span class="p" data-group-id="1026528654-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="1026528654-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1026528654-67">(</span><span class="p" data-group-id="1026528654-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1026528654-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1026528654-69">]</span><span class="p" data-group-id="1026528654-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1026528654-70">(</span><span class="p" data-group-id="1026528654-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1026528654-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1026528654-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1026528654-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1026528654-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1026528654-73">(</span><span class="p" data-group-id="1026528654-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1026528654-75">{</span><span class="ss">fff</span><span class="p" data-group-id="1026528654-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1026528654-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1026528654-77">]</span><span class="p" data-group-id="1026528654-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-78">[</span><span class="n">Fun</span><span class="p" data-group-id="1026528654-79">(</span><span class="n">H</span><span class="p" data-group-id="1026528654-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1026528654-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1026528654-80">)</span><span class="p" data-group-id="1026528654-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1026528654-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1026528654-82">[</span><span class="p" data-group-id="1026528654-82">]</span><span class="p" data-group-id="1026528654-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1026528654-83">[</span><span class="p" data-group-id="1026528654-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1026528654-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1026528654-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1026528654-85">(</span><span class="p" data-group-id="1026528654-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1026528654-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1026528654-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1026528654-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1026528654-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1026528654-89">(</span><span class="nf">fun</span><span class="p" data-group-id="1026528654-90">(</span><span class="p" data-group-id="1026528654-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1026528654-91">{</span><span class="nf">self</span><span class="p" data-group-id="1026528654-92">(</span><span class="p" data-group-id="1026528654-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1026528654-93">(</span><span class="n">X</span><span class="p" data-group-id="1026528654-93">)</span><span class="p" data-group-id="1026528654-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1026528654-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1026528654-88">]</span><span class="w">
    </span><span class="p" data-group-id="1026528654-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="igor">
    Igor Style (igor)<a class="headerlink" href="#igor" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-igor"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">igor_style</span><span class="p" data-group-id="3499786674-1">(</span><span class="p" data-group-id="3499786674-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="igor-example.erl">
      example.erl<a class="headerlink" href="#igor-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-igor"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5266636274-1">(</span><span class="ss">test</span><span class="p" data-group-id="5266636274-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5266636274-2">(</span><span class="p" data-group-id="5266636274-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5266636274-3">]</span><span class="p" data-group-id="5266636274-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5266636274-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5266636274-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5266636274-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5266636274-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5266636274-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5266636274-9">}</span><span class="p" data-group-id="5266636274-6">]</span><span class="p" data-group-id="5266636274-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5266636274-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5266636274-11">}</span><span class="p" data-group-id="5266636274-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5266636274-12">(</span><span class="n">Port</span><span class="p" data-group-id="5266636274-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5266636274-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5266636274-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5266636274-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5266636274-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5266636274-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-17">[</span><span class="p" data-group-id="5266636274-18">[</span><span class="p" data-group-id="5266636274-18">]</span><span class="p" data-group-id="5266636274-17">]</span><span class="p" data-group-id="5266636274-16">)</span><span class="p" data-group-id="5266636274-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5266636274-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5266636274-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5266636274-20">(</span><span class="n">Players</span><span class="p" data-group-id="5266636274-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5266636274-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-22">[</span><span class="p" data-group-id="5266636274-22">]</span><span class="p" data-group-id="5266636274-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5266636274-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5266636274-24">(</span><span class="n">P</span><span class="p" data-group-id="5266636274-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5266636274-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-26">[</span><span class="n">P</span><span class="p" data-group-id="5266636274-26">]</span><span class="p" data-group-id="5266636274-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5266636274-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5266636274-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5266636274-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5266636274-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5266636274-29">(</span><span class="n">Player</span><span class="p" data-group-id="5266636274-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5266636274-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-31">[</span><span class="n">Player</span><span class="p" data-group-id="5266636274-31">]</span><span class="p" data-group-id="5266636274-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5266636274-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5266636274-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5266636274-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5266636274-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5266636274-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-36">[</span><span class="n">Player</span><span class="p" data-group-id="5266636274-36">]</span><span class="p" data-group-id="5266636274-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5266636274-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5266636274-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5266636274-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5266636274-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5266636274-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5266636274-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5266636274-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5266636274-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5266636274-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5266636274-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5266636274-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5266636274-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5266636274-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5266636274-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5266636274-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5266636274-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5266636274-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5266636274-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5266636274-49">(</span><span class="n">Player</span><span class="p" data-group-id="5266636274-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5266636274-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5266636274-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5266636274-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5266636274-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5266636274-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5266636274-53">(</span><span class="n">P</span><span class="p" data-group-id="5266636274-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5266636274-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5266636274-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5266636274-55">(</span><span class="n">P</span><span class="p" data-group-id="5266636274-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5266636274-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5266636274-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5266636274-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5266636274-57">(</span><span class="p" data-group-id="5266636274-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-58">{</span><span class="p" data-group-id="5266636274-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5266636274-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5266636274-60">}</span><span class="p" data-group-id="5266636274-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5266636274-61">(</span><span class="p" data-group-id="5266636274-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5266636274-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5266636274-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5266636274-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5266636274-64">]</span><span class="w">
        </span><span class="p" data-group-id="5266636274-63">)</span><span class="w">
    </span><span class="p" data-group-id="5266636274-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5266636274-65">(</span><span class="p" data-group-id="5266636274-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5266636274-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5266636274-67">(</span><span class="p" data-group-id="5266636274-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5266636274-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5266636274-69">]</span><span class="p" data-group-id="5266636274-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5266636274-70">(</span><span class="p" data-group-id="5266636274-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5266636274-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5266636274-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5266636274-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5266636274-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5266636274-73">(</span><span class="p" data-group-id="5266636274-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5266636274-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5266636274-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5266636274-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5266636274-77">]</span><span class="p" data-group-id="5266636274-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5266636274-79">(</span><span class="n">H</span><span class="p" data-group-id="5266636274-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5266636274-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5266636274-80">)</span><span class="p" data-group-id="5266636274-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5266636274-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5266636274-82">[</span><span class="p" data-group-id="5266636274-82">]</span><span class="p" data-group-id="5266636274-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5266636274-83">[</span><span class="p" data-group-id="5266636274-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5266636274-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5266636274-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5266636274-85">(</span><span class="p" data-group-id="5266636274-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5266636274-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5266636274-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5266636274-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5266636274-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5266636274-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5266636274-90">(</span><span class="p" data-group-id="5266636274-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5266636274-91">{</span><span class="nf">self</span><span class="p" data-group-id="5266636274-92">(</span><span class="p" data-group-id="5266636274-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5266636274-93">(</span><span class="n">X</span><span class="p" data-group-id="5266636274-93">)</span><span class="p" data-group-id="5266636274-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5266636274-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5266636274-88">]</span><span class="w">
    </span><span class="p" data-group-id="5266636274-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="lovelace">
    Lovelace Style (lovelace)<a class="headerlink" href="#lovelace" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-lovelace"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">lovelace_style</span><span class="p" data-group-id="2753834847-1">(</span><span class="p" data-group-id="2753834847-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="lovelace-example.erl">
      example.erl<a class="headerlink" href="#lovelace-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-lovelace"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9089801090-1">(</span><span class="ss">test</span><span class="p" data-group-id="9089801090-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9089801090-2">(</span><span class="p" data-group-id="9089801090-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9089801090-3">]</span><span class="p" data-group-id="9089801090-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9089801090-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9089801090-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9089801090-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9089801090-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9089801090-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9089801090-9">}</span><span class="p" data-group-id="9089801090-6">]</span><span class="p" data-group-id="9089801090-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9089801090-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9089801090-11">}</span><span class="p" data-group-id="9089801090-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9089801090-12">(</span><span class="n">Port</span><span class="p" data-group-id="9089801090-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9089801090-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9089801090-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9089801090-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9089801090-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9089801090-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-17">[</span><span class="p" data-group-id="9089801090-18">[</span><span class="p" data-group-id="9089801090-18">]</span><span class="p" data-group-id="9089801090-17">]</span><span class="p" data-group-id="9089801090-16">)</span><span class="p" data-group-id="9089801090-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9089801090-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9089801090-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9089801090-20">(</span><span class="n">Players</span><span class="p" data-group-id="9089801090-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9089801090-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-22">[</span><span class="p" data-group-id="9089801090-22">]</span><span class="p" data-group-id="9089801090-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9089801090-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9089801090-24">(</span><span class="n">P</span><span class="p" data-group-id="9089801090-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9089801090-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-26">[</span><span class="n">P</span><span class="p" data-group-id="9089801090-26">]</span><span class="p" data-group-id="9089801090-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9089801090-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9089801090-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9089801090-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9089801090-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9089801090-29">(</span><span class="n">Player</span><span class="p" data-group-id="9089801090-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9089801090-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-31">[</span><span class="n">Player</span><span class="p" data-group-id="9089801090-31">]</span><span class="p" data-group-id="9089801090-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9089801090-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9089801090-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9089801090-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9089801090-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9089801090-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-36">[</span><span class="n">Player</span><span class="p" data-group-id="9089801090-36">]</span><span class="p" data-group-id="9089801090-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9089801090-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9089801090-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9089801090-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9089801090-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9089801090-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9089801090-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9089801090-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9089801090-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9089801090-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9089801090-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9089801090-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9089801090-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9089801090-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9089801090-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9089801090-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9089801090-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9089801090-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9089801090-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9089801090-49">(</span><span class="n">Player</span><span class="p" data-group-id="9089801090-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9089801090-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9089801090-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9089801090-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9089801090-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9089801090-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9089801090-53">(</span><span class="n">P</span><span class="p" data-group-id="9089801090-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9089801090-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9089801090-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9089801090-55">(</span><span class="n">P</span><span class="p" data-group-id="9089801090-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9089801090-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9089801090-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9089801090-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9089801090-57">(</span><span class="p" data-group-id="9089801090-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-58">{</span><span class="p" data-group-id="9089801090-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9089801090-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9089801090-60">}</span><span class="p" data-group-id="9089801090-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9089801090-61">(</span><span class="p" data-group-id="9089801090-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9089801090-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9089801090-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9089801090-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9089801090-64">]</span><span class="w">
        </span><span class="p" data-group-id="9089801090-63">)</span><span class="w">
    </span><span class="p" data-group-id="9089801090-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9089801090-65">(</span><span class="p" data-group-id="9089801090-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="9089801090-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9089801090-67">(</span><span class="p" data-group-id="9089801090-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9089801090-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9089801090-69">]</span><span class="p" data-group-id="9089801090-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9089801090-70">(</span><span class="p" data-group-id="9089801090-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9089801090-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9089801090-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9089801090-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9089801090-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9089801090-73">(</span><span class="p" data-group-id="9089801090-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9089801090-75">{</span><span class="ss">fff</span><span class="p" data-group-id="9089801090-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9089801090-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9089801090-77">]</span><span class="p" data-group-id="9089801090-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-78">[</span><span class="n">Fun</span><span class="p" data-group-id="9089801090-79">(</span><span class="n">H</span><span class="p" data-group-id="9089801090-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9089801090-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9089801090-80">)</span><span class="p" data-group-id="9089801090-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9089801090-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9089801090-82">[</span><span class="p" data-group-id="9089801090-82">]</span><span class="p" data-group-id="9089801090-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9089801090-83">[</span><span class="p" data-group-id="9089801090-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9089801090-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9089801090-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9089801090-85">(</span><span class="p" data-group-id="9089801090-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9089801090-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9089801090-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9089801090-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9089801090-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9089801090-89">(</span><span class="nf">fun</span><span class="p" data-group-id="9089801090-90">(</span><span class="p" data-group-id="9089801090-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9089801090-91">{</span><span class="nf">self</span><span class="p" data-group-id="9089801090-92">(</span><span class="p" data-group-id="9089801090-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9089801090-93">(</span><span class="n">X</span><span class="p" data-group-id="9089801090-93">)</span><span class="p" data-group-id="9089801090-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9089801090-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9089801090-88">]</span><span class="w">
    </span><span class="p" data-group-id="9089801090-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="manni">
    Manni Style (manni)<a class="headerlink" href="#manni" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-manni"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">manni_style</span><span class="p" data-group-id="2645189119-1">(</span><span class="p" data-group-id="2645189119-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="manni-example.erl">
      example.erl<a class="headerlink" href="#manni-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-manni"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7690571297-1">(</span><span class="ss">test</span><span class="p" data-group-id="7690571297-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7690571297-2">(</span><span class="p" data-group-id="7690571297-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7690571297-3">]</span><span class="p" data-group-id="7690571297-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7690571297-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7690571297-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7690571297-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7690571297-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7690571297-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7690571297-9">}</span><span class="p" data-group-id="7690571297-6">]</span><span class="p" data-group-id="7690571297-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7690571297-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7690571297-11">}</span><span class="p" data-group-id="7690571297-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7690571297-12">(</span><span class="n">Port</span><span class="p" data-group-id="7690571297-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7690571297-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7690571297-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7690571297-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7690571297-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7690571297-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-17">[</span><span class="p" data-group-id="7690571297-18">[</span><span class="p" data-group-id="7690571297-18">]</span><span class="p" data-group-id="7690571297-17">]</span><span class="p" data-group-id="7690571297-16">)</span><span class="p" data-group-id="7690571297-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7690571297-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7690571297-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7690571297-20">(</span><span class="n">Players</span><span class="p" data-group-id="7690571297-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7690571297-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-22">[</span><span class="p" data-group-id="7690571297-22">]</span><span class="p" data-group-id="7690571297-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7690571297-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7690571297-24">(</span><span class="n">P</span><span class="p" data-group-id="7690571297-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7690571297-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-26">[</span><span class="n">P</span><span class="p" data-group-id="7690571297-26">]</span><span class="p" data-group-id="7690571297-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7690571297-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7690571297-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7690571297-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7690571297-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7690571297-29">(</span><span class="n">Player</span><span class="p" data-group-id="7690571297-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7690571297-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-31">[</span><span class="n">Player</span><span class="p" data-group-id="7690571297-31">]</span><span class="p" data-group-id="7690571297-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7690571297-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7690571297-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7690571297-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7690571297-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7690571297-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-36">[</span><span class="n">Player</span><span class="p" data-group-id="7690571297-36">]</span><span class="p" data-group-id="7690571297-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7690571297-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7690571297-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7690571297-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7690571297-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7690571297-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7690571297-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7690571297-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7690571297-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7690571297-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7690571297-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7690571297-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7690571297-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7690571297-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7690571297-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7690571297-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7690571297-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7690571297-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7690571297-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7690571297-49">(</span><span class="n">Player</span><span class="p" data-group-id="7690571297-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7690571297-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7690571297-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7690571297-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7690571297-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7690571297-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7690571297-53">(</span><span class="n">P</span><span class="p" data-group-id="7690571297-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7690571297-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7690571297-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7690571297-55">(</span><span class="n">P</span><span class="p" data-group-id="7690571297-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7690571297-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7690571297-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7690571297-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7690571297-57">(</span><span class="p" data-group-id="7690571297-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-58">{</span><span class="p" data-group-id="7690571297-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7690571297-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7690571297-60">}</span><span class="p" data-group-id="7690571297-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7690571297-61">(</span><span class="p" data-group-id="7690571297-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7690571297-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7690571297-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7690571297-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7690571297-64">]</span><span class="w">
        </span><span class="p" data-group-id="7690571297-63">)</span><span class="w">
    </span><span class="p" data-group-id="7690571297-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7690571297-65">(</span><span class="p" data-group-id="7690571297-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="7690571297-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7690571297-67">(</span><span class="p" data-group-id="7690571297-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7690571297-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7690571297-69">]</span><span class="p" data-group-id="7690571297-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7690571297-70">(</span><span class="p" data-group-id="7690571297-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7690571297-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7690571297-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7690571297-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7690571297-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7690571297-73">(</span><span class="p" data-group-id="7690571297-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7690571297-75">{</span><span class="ss">fff</span><span class="p" data-group-id="7690571297-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7690571297-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7690571297-77">]</span><span class="p" data-group-id="7690571297-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-78">[</span><span class="n">Fun</span><span class="p" data-group-id="7690571297-79">(</span><span class="n">H</span><span class="p" data-group-id="7690571297-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7690571297-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7690571297-80">)</span><span class="p" data-group-id="7690571297-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7690571297-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7690571297-82">[</span><span class="p" data-group-id="7690571297-82">]</span><span class="p" data-group-id="7690571297-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7690571297-83">[</span><span class="p" data-group-id="7690571297-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7690571297-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7690571297-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7690571297-85">(</span><span class="p" data-group-id="7690571297-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7690571297-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7690571297-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7690571297-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7690571297-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7690571297-89">(</span><span class="nf">fun</span><span class="p" data-group-id="7690571297-90">(</span><span class="p" data-group-id="7690571297-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7690571297-91">{</span><span class="nf">self</span><span class="p" data-group-id="7690571297-92">(</span><span class="p" data-group-id="7690571297-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7690571297-93">(</span><span class="n">X</span><span class="p" data-group-id="7690571297-93">)</span><span class="p" data-group-id="7690571297-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7690571297-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7690571297-88">]</span><span class="w">
    </span><span class="p" data-group-id="7690571297-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="monokai">
    Monokai Style (monokai)<a class="headerlink" href="#monokai" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-monokai"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">monokai_style</span><span class="p" data-group-id="9407902912-1">(</span><span class="p" data-group-id="9407902912-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="monokai-example.erl">
      example.erl<a class="headerlink" href="#monokai-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-monokai"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6070187701-1">(</span><span class="ss">test</span><span class="p" data-group-id="6070187701-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6070187701-2">(</span><span class="p" data-group-id="6070187701-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6070187701-3">]</span><span class="p" data-group-id="6070187701-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6070187701-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6070187701-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6070187701-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6070187701-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6070187701-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6070187701-9">}</span><span class="p" data-group-id="6070187701-6">]</span><span class="p" data-group-id="6070187701-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6070187701-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6070187701-11">}</span><span class="p" data-group-id="6070187701-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6070187701-12">(</span><span class="n">Port</span><span class="p" data-group-id="6070187701-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6070187701-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6070187701-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6070187701-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6070187701-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6070187701-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-17">[</span><span class="p" data-group-id="6070187701-18">[</span><span class="p" data-group-id="6070187701-18">]</span><span class="p" data-group-id="6070187701-17">]</span><span class="p" data-group-id="6070187701-16">)</span><span class="p" data-group-id="6070187701-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6070187701-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6070187701-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6070187701-20">(</span><span class="n">Players</span><span class="p" data-group-id="6070187701-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6070187701-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-22">[</span><span class="p" data-group-id="6070187701-22">]</span><span class="p" data-group-id="6070187701-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6070187701-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6070187701-24">(</span><span class="n">P</span><span class="p" data-group-id="6070187701-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6070187701-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-26">[</span><span class="n">P</span><span class="p" data-group-id="6070187701-26">]</span><span class="p" data-group-id="6070187701-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6070187701-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6070187701-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6070187701-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6070187701-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6070187701-29">(</span><span class="n">Player</span><span class="p" data-group-id="6070187701-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6070187701-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-31">[</span><span class="n">Player</span><span class="p" data-group-id="6070187701-31">]</span><span class="p" data-group-id="6070187701-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6070187701-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6070187701-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6070187701-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6070187701-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6070187701-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-36">[</span><span class="n">Player</span><span class="p" data-group-id="6070187701-36">]</span><span class="p" data-group-id="6070187701-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6070187701-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6070187701-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6070187701-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6070187701-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6070187701-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6070187701-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6070187701-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6070187701-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6070187701-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6070187701-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6070187701-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6070187701-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6070187701-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6070187701-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6070187701-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6070187701-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6070187701-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6070187701-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6070187701-49">(</span><span class="n">Player</span><span class="p" data-group-id="6070187701-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6070187701-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6070187701-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6070187701-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6070187701-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6070187701-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6070187701-53">(</span><span class="n">P</span><span class="p" data-group-id="6070187701-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6070187701-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6070187701-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6070187701-55">(</span><span class="n">P</span><span class="p" data-group-id="6070187701-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6070187701-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6070187701-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6070187701-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6070187701-57">(</span><span class="p" data-group-id="6070187701-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-58">{</span><span class="p" data-group-id="6070187701-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6070187701-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6070187701-60">}</span><span class="p" data-group-id="6070187701-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6070187701-61">(</span><span class="p" data-group-id="6070187701-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6070187701-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6070187701-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6070187701-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6070187701-64">]</span><span class="w">
        </span><span class="p" data-group-id="6070187701-63">)</span><span class="w">
    </span><span class="p" data-group-id="6070187701-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6070187701-65">(</span><span class="p" data-group-id="6070187701-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="6070187701-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6070187701-67">(</span><span class="p" data-group-id="6070187701-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6070187701-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6070187701-69">]</span><span class="p" data-group-id="6070187701-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6070187701-70">(</span><span class="p" data-group-id="6070187701-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6070187701-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6070187701-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6070187701-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6070187701-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6070187701-73">(</span><span class="p" data-group-id="6070187701-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6070187701-75">{</span><span class="ss">fff</span><span class="p" data-group-id="6070187701-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6070187701-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6070187701-77">]</span><span class="p" data-group-id="6070187701-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-78">[</span><span class="n">Fun</span><span class="p" data-group-id="6070187701-79">(</span><span class="n">H</span><span class="p" data-group-id="6070187701-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6070187701-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6070187701-80">)</span><span class="p" data-group-id="6070187701-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6070187701-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6070187701-82">[</span><span class="p" data-group-id="6070187701-82">]</span><span class="p" data-group-id="6070187701-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6070187701-83">[</span><span class="p" data-group-id="6070187701-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6070187701-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6070187701-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6070187701-85">(</span><span class="p" data-group-id="6070187701-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6070187701-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6070187701-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6070187701-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6070187701-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6070187701-89">(</span><span class="nf">fun</span><span class="p" data-group-id="6070187701-90">(</span><span class="p" data-group-id="6070187701-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6070187701-91">{</span><span class="nf">self</span><span class="p" data-group-id="6070187701-92">(</span><span class="p" data-group-id="6070187701-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6070187701-93">(</span><span class="n">X</span><span class="p" data-group-id="6070187701-93">)</span><span class="p" data-group-id="6070187701-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6070187701-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6070187701-88">]</span><span class="w">
    </span><span class="p" data-group-id="6070187701-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="murphy">
    Murphy Style (murphy)<a class="headerlink" href="#murphy" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-murphy"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">murphy_style</span><span class="p" data-group-id="2254121654-1">(</span><span class="p" data-group-id="2254121654-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="murphy-example.erl">
      example.erl<a class="headerlink" href="#murphy-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-murphy"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4420872917-1">(</span><span class="ss">test</span><span class="p" data-group-id="4420872917-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4420872917-2">(</span><span class="p" data-group-id="4420872917-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4420872917-3">]</span><span class="p" data-group-id="4420872917-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4420872917-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4420872917-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4420872917-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4420872917-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4420872917-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4420872917-9">}</span><span class="p" data-group-id="4420872917-6">]</span><span class="p" data-group-id="4420872917-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4420872917-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4420872917-11">}</span><span class="p" data-group-id="4420872917-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4420872917-12">(</span><span class="n">Port</span><span class="p" data-group-id="4420872917-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4420872917-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4420872917-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4420872917-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4420872917-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4420872917-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-17">[</span><span class="p" data-group-id="4420872917-18">[</span><span class="p" data-group-id="4420872917-18">]</span><span class="p" data-group-id="4420872917-17">]</span><span class="p" data-group-id="4420872917-16">)</span><span class="p" data-group-id="4420872917-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4420872917-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4420872917-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4420872917-20">(</span><span class="n">Players</span><span class="p" data-group-id="4420872917-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4420872917-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-22">[</span><span class="p" data-group-id="4420872917-22">]</span><span class="p" data-group-id="4420872917-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4420872917-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4420872917-24">(</span><span class="n">P</span><span class="p" data-group-id="4420872917-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4420872917-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-26">[</span><span class="n">P</span><span class="p" data-group-id="4420872917-26">]</span><span class="p" data-group-id="4420872917-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4420872917-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4420872917-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4420872917-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4420872917-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4420872917-29">(</span><span class="n">Player</span><span class="p" data-group-id="4420872917-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4420872917-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-31">[</span><span class="n">Player</span><span class="p" data-group-id="4420872917-31">]</span><span class="p" data-group-id="4420872917-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4420872917-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4420872917-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4420872917-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4420872917-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4420872917-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-36">[</span><span class="n">Player</span><span class="p" data-group-id="4420872917-36">]</span><span class="p" data-group-id="4420872917-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4420872917-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4420872917-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4420872917-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4420872917-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4420872917-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4420872917-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4420872917-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4420872917-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4420872917-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4420872917-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4420872917-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4420872917-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4420872917-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4420872917-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4420872917-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4420872917-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4420872917-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4420872917-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4420872917-49">(</span><span class="n">Player</span><span class="p" data-group-id="4420872917-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4420872917-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4420872917-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4420872917-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4420872917-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4420872917-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4420872917-53">(</span><span class="n">P</span><span class="p" data-group-id="4420872917-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4420872917-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4420872917-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4420872917-55">(</span><span class="n">P</span><span class="p" data-group-id="4420872917-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4420872917-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4420872917-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4420872917-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4420872917-57">(</span><span class="p" data-group-id="4420872917-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-58">{</span><span class="p" data-group-id="4420872917-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4420872917-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4420872917-60">}</span><span class="p" data-group-id="4420872917-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4420872917-61">(</span><span class="p" data-group-id="4420872917-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4420872917-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4420872917-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4420872917-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4420872917-64">]</span><span class="w">
        </span><span class="p" data-group-id="4420872917-63">)</span><span class="w">
    </span><span class="p" data-group-id="4420872917-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4420872917-65">(</span><span class="p" data-group-id="4420872917-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="4420872917-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4420872917-67">(</span><span class="p" data-group-id="4420872917-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4420872917-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4420872917-69">]</span><span class="p" data-group-id="4420872917-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4420872917-70">(</span><span class="p" data-group-id="4420872917-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4420872917-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4420872917-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4420872917-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4420872917-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4420872917-73">(</span><span class="p" data-group-id="4420872917-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4420872917-75">{</span><span class="ss">fff</span><span class="p" data-group-id="4420872917-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4420872917-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4420872917-77">]</span><span class="p" data-group-id="4420872917-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-78">[</span><span class="n">Fun</span><span class="p" data-group-id="4420872917-79">(</span><span class="n">H</span><span class="p" data-group-id="4420872917-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4420872917-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4420872917-80">)</span><span class="p" data-group-id="4420872917-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4420872917-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4420872917-82">[</span><span class="p" data-group-id="4420872917-82">]</span><span class="p" data-group-id="4420872917-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4420872917-83">[</span><span class="p" data-group-id="4420872917-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4420872917-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4420872917-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4420872917-85">(</span><span class="p" data-group-id="4420872917-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4420872917-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4420872917-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4420872917-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4420872917-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4420872917-89">(</span><span class="nf">fun</span><span class="p" data-group-id="4420872917-90">(</span><span class="p" data-group-id="4420872917-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4420872917-91">{</span><span class="nf">self</span><span class="p" data-group-id="4420872917-92">(</span><span class="p" data-group-id="4420872917-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4420872917-93">(</span><span class="n">X</span><span class="p" data-group-id="4420872917-93">)</span><span class="p" data-group-id="4420872917-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4420872917-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4420872917-88">]</span><span class="w">
    </span><span class="p" data-group-id="4420872917-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="native">
    Native Style (native)<a class="headerlink" href="#native" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-native"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">native_style</span><span class="p" data-group-id="6658436080-1">(</span><span class="p" data-group-id="6658436080-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="native-example.erl">
      example.erl<a class="headerlink" href="#native-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-native"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7559536608-1">(</span><span class="ss">test</span><span class="p" data-group-id="7559536608-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7559536608-2">(</span><span class="p" data-group-id="7559536608-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7559536608-3">]</span><span class="p" data-group-id="7559536608-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7559536608-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7559536608-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7559536608-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7559536608-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7559536608-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7559536608-9">}</span><span class="p" data-group-id="7559536608-6">]</span><span class="p" data-group-id="7559536608-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7559536608-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7559536608-11">}</span><span class="p" data-group-id="7559536608-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7559536608-12">(</span><span class="n">Port</span><span class="p" data-group-id="7559536608-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7559536608-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7559536608-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7559536608-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7559536608-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7559536608-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-17">[</span><span class="p" data-group-id="7559536608-18">[</span><span class="p" data-group-id="7559536608-18">]</span><span class="p" data-group-id="7559536608-17">]</span><span class="p" data-group-id="7559536608-16">)</span><span class="p" data-group-id="7559536608-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7559536608-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7559536608-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7559536608-20">(</span><span class="n">Players</span><span class="p" data-group-id="7559536608-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7559536608-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-22">[</span><span class="p" data-group-id="7559536608-22">]</span><span class="p" data-group-id="7559536608-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7559536608-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7559536608-24">(</span><span class="n">P</span><span class="p" data-group-id="7559536608-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7559536608-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-26">[</span><span class="n">P</span><span class="p" data-group-id="7559536608-26">]</span><span class="p" data-group-id="7559536608-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7559536608-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7559536608-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7559536608-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7559536608-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7559536608-29">(</span><span class="n">Player</span><span class="p" data-group-id="7559536608-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7559536608-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-31">[</span><span class="n">Player</span><span class="p" data-group-id="7559536608-31">]</span><span class="p" data-group-id="7559536608-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7559536608-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7559536608-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7559536608-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7559536608-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7559536608-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-36">[</span><span class="n">Player</span><span class="p" data-group-id="7559536608-36">]</span><span class="p" data-group-id="7559536608-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7559536608-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7559536608-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7559536608-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7559536608-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7559536608-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7559536608-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7559536608-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7559536608-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7559536608-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7559536608-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7559536608-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7559536608-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7559536608-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7559536608-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7559536608-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7559536608-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7559536608-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7559536608-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7559536608-49">(</span><span class="n">Player</span><span class="p" data-group-id="7559536608-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7559536608-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7559536608-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7559536608-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7559536608-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7559536608-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7559536608-53">(</span><span class="n">P</span><span class="p" data-group-id="7559536608-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7559536608-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7559536608-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7559536608-55">(</span><span class="n">P</span><span class="p" data-group-id="7559536608-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7559536608-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7559536608-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7559536608-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7559536608-57">(</span><span class="p" data-group-id="7559536608-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-58">{</span><span class="p" data-group-id="7559536608-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7559536608-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7559536608-60">}</span><span class="p" data-group-id="7559536608-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7559536608-61">(</span><span class="p" data-group-id="7559536608-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7559536608-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7559536608-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7559536608-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7559536608-64">]</span><span class="w">
        </span><span class="p" data-group-id="7559536608-63">)</span><span class="w">
    </span><span class="p" data-group-id="7559536608-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7559536608-65">(</span><span class="p" data-group-id="7559536608-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="7559536608-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7559536608-67">(</span><span class="p" data-group-id="7559536608-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7559536608-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7559536608-69">]</span><span class="p" data-group-id="7559536608-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7559536608-70">(</span><span class="p" data-group-id="7559536608-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7559536608-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7559536608-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7559536608-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7559536608-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7559536608-73">(</span><span class="p" data-group-id="7559536608-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7559536608-75">{</span><span class="ss">fff</span><span class="p" data-group-id="7559536608-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7559536608-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7559536608-77">]</span><span class="p" data-group-id="7559536608-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-78">[</span><span class="n">Fun</span><span class="p" data-group-id="7559536608-79">(</span><span class="n">H</span><span class="p" data-group-id="7559536608-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7559536608-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7559536608-80">)</span><span class="p" data-group-id="7559536608-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7559536608-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7559536608-82">[</span><span class="p" data-group-id="7559536608-82">]</span><span class="p" data-group-id="7559536608-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7559536608-83">[</span><span class="p" data-group-id="7559536608-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7559536608-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7559536608-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7559536608-85">(</span><span class="p" data-group-id="7559536608-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7559536608-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7559536608-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7559536608-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7559536608-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7559536608-89">(</span><span class="nf">fun</span><span class="p" data-group-id="7559536608-90">(</span><span class="p" data-group-id="7559536608-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7559536608-91">{</span><span class="nf">self</span><span class="p" data-group-id="7559536608-92">(</span><span class="p" data-group-id="7559536608-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7559536608-93">(</span><span class="n">X</span><span class="p" data-group-id="7559536608-93">)</span><span class="p" data-group-id="7559536608-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7559536608-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7559536608-88">]</span><span class="w">
    </span><span class="p" data-group-id="7559536608-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_dark">
    ParaisoDark Style (paraiso_dark)<a class="headerlink" href="#paraiso_dark" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_dark"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_dark_style</span><span class="p" data-group-id="4855073017-1">(</span><span class="p" data-group-id="4855073017-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_dark-example.erl">
      example.erl<a class="headerlink" href="#paraiso_dark-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_dark"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1752313656-1">(</span><span class="ss">test</span><span class="p" data-group-id="1752313656-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1752313656-2">(</span><span class="p" data-group-id="1752313656-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1752313656-3">]</span><span class="p" data-group-id="1752313656-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1752313656-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1752313656-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1752313656-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1752313656-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1752313656-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1752313656-9">}</span><span class="p" data-group-id="1752313656-6">]</span><span class="p" data-group-id="1752313656-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1752313656-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1752313656-11">}</span><span class="p" data-group-id="1752313656-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1752313656-12">(</span><span class="n">Port</span><span class="p" data-group-id="1752313656-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1752313656-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1752313656-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1752313656-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1752313656-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1752313656-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-17">[</span><span class="p" data-group-id="1752313656-18">[</span><span class="p" data-group-id="1752313656-18">]</span><span class="p" data-group-id="1752313656-17">]</span><span class="p" data-group-id="1752313656-16">)</span><span class="p" data-group-id="1752313656-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1752313656-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1752313656-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1752313656-20">(</span><span class="n">Players</span><span class="p" data-group-id="1752313656-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1752313656-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-22">[</span><span class="p" data-group-id="1752313656-22">]</span><span class="p" data-group-id="1752313656-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1752313656-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1752313656-24">(</span><span class="n">P</span><span class="p" data-group-id="1752313656-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1752313656-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-26">[</span><span class="n">P</span><span class="p" data-group-id="1752313656-26">]</span><span class="p" data-group-id="1752313656-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1752313656-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1752313656-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1752313656-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1752313656-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1752313656-29">(</span><span class="n">Player</span><span class="p" data-group-id="1752313656-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1752313656-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-31">[</span><span class="n">Player</span><span class="p" data-group-id="1752313656-31">]</span><span class="p" data-group-id="1752313656-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1752313656-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1752313656-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1752313656-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1752313656-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1752313656-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-36">[</span><span class="n">Player</span><span class="p" data-group-id="1752313656-36">]</span><span class="p" data-group-id="1752313656-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1752313656-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1752313656-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1752313656-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1752313656-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1752313656-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1752313656-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1752313656-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1752313656-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1752313656-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1752313656-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1752313656-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1752313656-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1752313656-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1752313656-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1752313656-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1752313656-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1752313656-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1752313656-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1752313656-49">(</span><span class="n">Player</span><span class="p" data-group-id="1752313656-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1752313656-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1752313656-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1752313656-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1752313656-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1752313656-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1752313656-53">(</span><span class="n">P</span><span class="p" data-group-id="1752313656-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1752313656-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1752313656-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1752313656-55">(</span><span class="n">P</span><span class="p" data-group-id="1752313656-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1752313656-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1752313656-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1752313656-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1752313656-57">(</span><span class="p" data-group-id="1752313656-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-58">{</span><span class="p" data-group-id="1752313656-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1752313656-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1752313656-60">}</span><span class="p" data-group-id="1752313656-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1752313656-61">(</span><span class="p" data-group-id="1752313656-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1752313656-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1752313656-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1752313656-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1752313656-64">]</span><span class="w">
        </span><span class="p" data-group-id="1752313656-63">)</span><span class="w">
    </span><span class="p" data-group-id="1752313656-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1752313656-65">(</span><span class="p" data-group-id="1752313656-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="1752313656-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1752313656-67">(</span><span class="p" data-group-id="1752313656-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1752313656-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1752313656-69">]</span><span class="p" data-group-id="1752313656-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1752313656-70">(</span><span class="p" data-group-id="1752313656-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1752313656-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1752313656-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1752313656-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1752313656-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1752313656-73">(</span><span class="p" data-group-id="1752313656-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1752313656-75">{</span><span class="ss">fff</span><span class="p" data-group-id="1752313656-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1752313656-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1752313656-77">]</span><span class="p" data-group-id="1752313656-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-78">[</span><span class="n">Fun</span><span class="p" data-group-id="1752313656-79">(</span><span class="n">H</span><span class="p" data-group-id="1752313656-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1752313656-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1752313656-80">)</span><span class="p" data-group-id="1752313656-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1752313656-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1752313656-82">[</span><span class="p" data-group-id="1752313656-82">]</span><span class="p" data-group-id="1752313656-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1752313656-83">[</span><span class="p" data-group-id="1752313656-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1752313656-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1752313656-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1752313656-85">(</span><span class="p" data-group-id="1752313656-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1752313656-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1752313656-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1752313656-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1752313656-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1752313656-89">(</span><span class="nf">fun</span><span class="p" data-group-id="1752313656-90">(</span><span class="p" data-group-id="1752313656-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1752313656-91">{</span><span class="nf">self</span><span class="p" data-group-id="1752313656-92">(</span><span class="p" data-group-id="1752313656-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1752313656-93">(</span><span class="n">X</span><span class="p" data-group-id="1752313656-93">)</span><span class="p" data-group-id="1752313656-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1752313656-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1752313656-88">]</span><span class="w">
    </span><span class="p" data-group-id="1752313656-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_light">
    ParaisoLight Style (paraiso_light)<a class="headerlink" href="#paraiso_light" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_light"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_light_style</span><span class="p" data-group-id="1339642905-1">(</span><span class="p" data-group-id="1339642905-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_light-example.erl">
      example.erl<a class="headerlink" href="#paraiso_light-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_light"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5743285756-1">(</span><span class="ss">test</span><span class="p" data-group-id="5743285756-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5743285756-2">(</span><span class="p" data-group-id="5743285756-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5743285756-3">]</span><span class="p" data-group-id="5743285756-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5743285756-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5743285756-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5743285756-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5743285756-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5743285756-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5743285756-9">}</span><span class="p" data-group-id="5743285756-6">]</span><span class="p" data-group-id="5743285756-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5743285756-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5743285756-11">}</span><span class="p" data-group-id="5743285756-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5743285756-12">(</span><span class="n">Port</span><span class="p" data-group-id="5743285756-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5743285756-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5743285756-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5743285756-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5743285756-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5743285756-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-17">[</span><span class="p" data-group-id="5743285756-18">[</span><span class="p" data-group-id="5743285756-18">]</span><span class="p" data-group-id="5743285756-17">]</span><span class="p" data-group-id="5743285756-16">)</span><span class="p" data-group-id="5743285756-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5743285756-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5743285756-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5743285756-20">(</span><span class="n">Players</span><span class="p" data-group-id="5743285756-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5743285756-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-22">[</span><span class="p" data-group-id="5743285756-22">]</span><span class="p" data-group-id="5743285756-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5743285756-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5743285756-24">(</span><span class="n">P</span><span class="p" data-group-id="5743285756-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5743285756-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-26">[</span><span class="n">P</span><span class="p" data-group-id="5743285756-26">]</span><span class="p" data-group-id="5743285756-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5743285756-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5743285756-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5743285756-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5743285756-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5743285756-29">(</span><span class="n">Player</span><span class="p" data-group-id="5743285756-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5743285756-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-31">[</span><span class="n">Player</span><span class="p" data-group-id="5743285756-31">]</span><span class="p" data-group-id="5743285756-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5743285756-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5743285756-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5743285756-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5743285756-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5743285756-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-36">[</span><span class="n">Player</span><span class="p" data-group-id="5743285756-36">]</span><span class="p" data-group-id="5743285756-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5743285756-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5743285756-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5743285756-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5743285756-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5743285756-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5743285756-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5743285756-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5743285756-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5743285756-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5743285756-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5743285756-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5743285756-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5743285756-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5743285756-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5743285756-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5743285756-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5743285756-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5743285756-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5743285756-49">(</span><span class="n">Player</span><span class="p" data-group-id="5743285756-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5743285756-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5743285756-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5743285756-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5743285756-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5743285756-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5743285756-53">(</span><span class="n">P</span><span class="p" data-group-id="5743285756-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5743285756-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5743285756-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5743285756-55">(</span><span class="n">P</span><span class="p" data-group-id="5743285756-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5743285756-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5743285756-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5743285756-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5743285756-57">(</span><span class="p" data-group-id="5743285756-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-58">{</span><span class="p" data-group-id="5743285756-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5743285756-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5743285756-60">}</span><span class="p" data-group-id="5743285756-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5743285756-61">(</span><span class="p" data-group-id="5743285756-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5743285756-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5743285756-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5743285756-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5743285756-64">]</span><span class="w">
        </span><span class="p" data-group-id="5743285756-63">)</span><span class="w">
    </span><span class="p" data-group-id="5743285756-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5743285756-65">(</span><span class="p" data-group-id="5743285756-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5743285756-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5743285756-67">(</span><span class="p" data-group-id="5743285756-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5743285756-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5743285756-69">]</span><span class="p" data-group-id="5743285756-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5743285756-70">(</span><span class="p" data-group-id="5743285756-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5743285756-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5743285756-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5743285756-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5743285756-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5743285756-73">(</span><span class="p" data-group-id="5743285756-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5743285756-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5743285756-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5743285756-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5743285756-77">]</span><span class="p" data-group-id="5743285756-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5743285756-79">(</span><span class="n">H</span><span class="p" data-group-id="5743285756-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5743285756-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5743285756-80">)</span><span class="p" data-group-id="5743285756-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5743285756-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5743285756-82">[</span><span class="p" data-group-id="5743285756-82">]</span><span class="p" data-group-id="5743285756-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5743285756-83">[</span><span class="p" data-group-id="5743285756-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5743285756-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5743285756-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5743285756-85">(</span><span class="p" data-group-id="5743285756-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5743285756-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5743285756-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5743285756-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5743285756-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5743285756-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5743285756-90">(</span><span class="p" data-group-id="5743285756-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5743285756-91">{</span><span class="nf">self</span><span class="p" data-group-id="5743285756-92">(</span><span class="p" data-group-id="5743285756-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5743285756-93">(</span><span class="n">X</span><span class="p" data-group-id="5743285756-93">)</span><span class="p" data-group-id="5743285756-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5743285756-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5743285756-88">]</span><span class="w">
    </span><span class="p" data-group-id="5743285756-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="pastie">
    Pastie Style (pastie)<a class="headerlink" href="#pastie" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-pastie"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">pastie_style</span><span class="p" data-group-id="0521506582-1">(</span><span class="p" data-group-id="0521506582-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="pastie-example.erl">
      example.erl<a class="headerlink" href="#pastie-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-pastie"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4326642496-1">(</span><span class="ss">test</span><span class="p" data-group-id="4326642496-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4326642496-2">(</span><span class="p" data-group-id="4326642496-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4326642496-3">]</span><span class="p" data-group-id="4326642496-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4326642496-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4326642496-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4326642496-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4326642496-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4326642496-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4326642496-9">}</span><span class="p" data-group-id="4326642496-6">]</span><span class="p" data-group-id="4326642496-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4326642496-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4326642496-11">}</span><span class="p" data-group-id="4326642496-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4326642496-12">(</span><span class="n">Port</span><span class="p" data-group-id="4326642496-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4326642496-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4326642496-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4326642496-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4326642496-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4326642496-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-17">[</span><span class="p" data-group-id="4326642496-18">[</span><span class="p" data-group-id="4326642496-18">]</span><span class="p" data-group-id="4326642496-17">]</span><span class="p" data-group-id="4326642496-16">)</span><span class="p" data-group-id="4326642496-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4326642496-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4326642496-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4326642496-20">(</span><span class="n">Players</span><span class="p" data-group-id="4326642496-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4326642496-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-22">[</span><span class="p" data-group-id="4326642496-22">]</span><span class="p" data-group-id="4326642496-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4326642496-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4326642496-24">(</span><span class="n">P</span><span class="p" data-group-id="4326642496-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4326642496-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-26">[</span><span class="n">P</span><span class="p" data-group-id="4326642496-26">]</span><span class="p" data-group-id="4326642496-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4326642496-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4326642496-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4326642496-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4326642496-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4326642496-29">(</span><span class="n">Player</span><span class="p" data-group-id="4326642496-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4326642496-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-31">[</span><span class="n">Player</span><span class="p" data-group-id="4326642496-31">]</span><span class="p" data-group-id="4326642496-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4326642496-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4326642496-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4326642496-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4326642496-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4326642496-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-36">[</span><span class="n">Player</span><span class="p" data-group-id="4326642496-36">]</span><span class="p" data-group-id="4326642496-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4326642496-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4326642496-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4326642496-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4326642496-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4326642496-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4326642496-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4326642496-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4326642496-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4326642496-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4326642496-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4326642496-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4326642496-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4326642496-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4326642496-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4326642496-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4326642496-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4326642496-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4326642496-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4326642496-49">(</span><span class="n">Player</span><span class="p" data-group-id="4326642496-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4326642496-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4326642496-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4326642496-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4326642496-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4326642496-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4326642496-53">(</span><span class="n">P</span><span class="p" data-group-id="4326642496-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4326642496-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4326642496-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4326642496-55">(</span><span class="n">P</span><span class="p" data-group-id="4326642496-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4326642496-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4326642496-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4326642496-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4326642496-57">(</span><span class="p" data-group-id="4326642496-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-58">{</span><span class="p" data-group-id="4326642496-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4326642496-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4326642496-60">}</span><span class="p" data-group-id="4326642496-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4326642496-61">(</span><span class="p" data-group-id="4326642496-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4326642496-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4326642496-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4326642496-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4326642496-64">]</span><span class="w">
        </span><span class="p" data-group-id="4326642496-63">)</span><span class="w">
    </span><span class="p" data-group-id="4326642496-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4326642496-65">(</span><span class="p" data-group-id="4326642496-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="4326642496-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4326642496-67">(</span><span class="p" data-group-id="4326642496-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4326642496-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4326642496-69">]</span><span class="p" data-group-id="4326642496-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4326642496-70">(</span><span class="p" data-group-id="4326642496-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4326642496-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4326642496-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4326642496-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4326642496-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4326642496-73">(</span><span class="p" data-group-id="4326642496-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4326642496-75">{</span><span class="ss">fff</span><span class="p" data-group-id="4326642496-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4326642496-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4326642496-77">]</span><span class="p" data-group-id="4326642496-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-78">[</span><span class="n">Fun</span><span class="p" data-group-id="4326642496-79">(</span><span class="n">H</span><span class="p" data-group-id="4326642496-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4326642496-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4326642496-80">)</span><span class="p" data-group-id="4326642496-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4326642496-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4326642496-82">[</span><span class="p" data-group-id="4326642496-82">]</span><span class="p" data-group-id="4326642496-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4326642496-83">[</span><span class="p" data-group-id="4326642496-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4326642496-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4326642496-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4326642496-85">(</span><span class="p" data-group-id="4326642496-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4326642496-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4326642496-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4326642496-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4326642496-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4326642496-89">(</span><span class="nf">fun</span><span class="p" data-group-id="4326642496-90">(</span><span class="p" data-group-id="4326642496-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4326642496-91">{</span><span class="nf">self</span><span class="p" data-group-id="4326642496-92">(</span><span class="p" data-group-id="4326642496-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4326642496-93">(</span><span class="n">X</span><span class="p" data-group-id="4326642496-93">)</span><span class="p" data-group-id="4326642496-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4326642496-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4326642496-88">]</span><span class="w">
    </span><span class="p" data-group-id="4326642496-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="perldoc">
    Perldoc Style (perldoc)<a class="headerlink" href="#perldoc" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-perldoc"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">perldoc_style</span><span class="p" data-group-id="7666299841-1">(</span><span class="p" data-group-id="7666299841-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="perldoc-example.erl">
      example.erl<a class="headerlink" href="#perldoc-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-perldoc"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7274450623-1">(</span><span class="ss">test</span><span class="p" data-group-id="7274450623-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7274450623-2">(</span><span class="p" data-group-id="7274450623-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7274450623-3">]</span><span class="p" data-group-id="7274450623-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7274450623-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7274450623-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7274450623-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7274450623-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7274450623-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7274450623-9">}</span><span class="p" data-group-id="7274450623-6">]</span><span class="p" data-group-id="7274450623-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7274450623-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7274450623-11">}</span><span class="p" data-group-id="7274450623-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7274450623-12">(</span><span class="n">Port</span><span class="p" data-group-id="7274450623-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7274450623-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7274450623-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7274450623-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7274450623-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7274450623-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-17">[</span><span class="p" data-group-id="7274450623-18">[</span><span class="p" data-group-id="7274450623-18">]</span><span class="p" data-group-id="7274450623-17">]</span><span class="p" data-group-id="7274450623-16">)</span><span class="p" data-group-id="7274450623-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7274450623-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7274450623-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7274450623-20">(</span><span class="n">Players</span><span class="p" data-group-id="7274450623-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7274450623-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-22">[</span><span class="p" data-group-id="7274450623-22">]</span><span class="p" data-group-id="7274450623-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7274450623-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7274450623-24">(</span><span class="n">P</span><span class="p" data-group-id="7274450623-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7274450623-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-26">[</span><span class="n">P</span><span class="p" data-group-id="7274450623-26">]</span><span class="p" data-group-id="7274450623-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7274450623-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7274450623-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7274450623-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7274450623-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7274450623-29">(</span><span class="n">Player</span><span class="p" data-group-id="7274450623-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7274450623-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-31">[</span><span class="n">Player</span><span class="p" data-group-id="7274450623-31">]</span><span class="p" data-group-id="7274450623-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7274450623-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7274450623-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7274450623-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7274450623-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7274450623-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-36">[</span><span class="n">Player</span><span class="p" data-group-id="7274450623-36">]</span><span class="p" data-group-id="7274450623-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7274450623-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7274450623-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7274450623-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7274450623-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7274450623-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7274450623-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7274450623-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7274450623-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7274450623-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7274450623-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7274450623-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7274450623-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7274450623-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7274450623-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7274450623-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7274450623-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7274450623-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7274450623-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7274450623-49">(</span><span class="n">Player</span><span class="p" data-group-id="7274450623-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7274450623-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7274450623-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7274450623-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7274450623-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7274450623-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7274450623-53">(</span><span class="n">P</span><span class="p" data-group-id="7274450623-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7274450623-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7274450623-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7274450623-55">(</span><span class="n">P</span><span class="p" data-group-id="7274450623-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7274450623-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7274450623-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7274450623-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7274450623-57">(</span><span class="p" data-group-id="7274450623-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-58">{</span><span class="p" data-group-id="7274450623-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7274450623-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7274450623-60">}</span><span class="p" data-group-id="7274450623-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7274450623-61">(</span><span class="p" data-group-id="7274450623-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7274450623-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7274450623-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7274450623-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7274450623-64">]</span><span class="w">
        </span><span class="p" data-group-id="7274450623-63">)</span><span class="w">
    </span><span class="p" data-group-id="7274450623-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7274450623-65">(</span><span class="p" data-group-id="7274450623-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="7274450623-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7274450623-67">(</span><span class="p" data-group-id="7274450623-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7274450623-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7274450623-69">]</span><span class="p" data-group-id="7274450623-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7274450623-70">(</span><span class="p" data-group-id="7274450623-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7274450623-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7274450623-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7274450623-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7274450623-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7274450623-73">(</span><span class="p" data-group-id="7274450623-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7274450623-75">{</span><span class="ss">fff</span><span class="p" data-group-id="7274450623-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7274450623-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7274450623-77">]</span><span class="p" data-group-id="7274450623-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-78">[</span><span class="n">Fun</span><span class="p" data-group-id="7274450623-79">(</span><span class="n">H</span><span class="p" data-group-id="7274450623-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7274450623-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7274450623-80">)</span><span class="p" data-group-id="7274450623-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7274450623-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7274450623-82">[</span><span class="p" data-group-id="7274450623-82">]</span><span class="p" data-group-id="7274450623-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7274450623-83">[</span><span class="p" data-group-id="7274450623-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7274450623-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7274450623-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7274450623-85">(</span><span class="p" data-group-id="7274450623-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7274450623-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7274450623-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7274450623-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7274450623-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7274450623-89">(</span><span class="nf">fun</span><span class="p" data-group-id="7274450623-90">(</span><span class="p" data-group-id="7274450623-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7274450623-91">{</span><span class="nf">self</span><span class="p" data-group-id="7274450623-92">(</span><span class="p" data-group-id="7274450623-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7274450623-93">(</span><span class="n">X</span><span class="p" data-group-id="7274450623-93">)</span><span class="p" data-group-id="7274450623-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7274450623-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7274450623-88">]</span><span class="w">
    </span><span class="p" data-group-id="7274450623-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rainbow_dash">
    RainbowDash Style (rainbow_dash)<a class="headerlink" href="#rainbow_dash" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rainbow_dash"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rainbow_dash_style</span><span class="p" data-group-id="1370779879-1">(</span><span class="p" data-group-id="1370779879-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="rainbow_dash-example.erl">
      example.erl<a class="headerlink" href="#rainbow_dash-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rainbow_dash"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9610665448-1">(</span><span class="ss">test</span><span class="p" data-group-id="9610665448-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9610665448-2">(</span><span class="p" data-group-id="9610665448-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9610665448-3">]</span><span class="p" data-group-id="9610665448-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9610665448-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9610665448-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9610665448-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9610665448-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9610665448-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9610665448-9">}</span><span class="p" data-group-id="9610665448-6">]</span><span class="p" data-group-id="9610665448-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9610665448-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9610665448-11">}</span><span class="p" data-group-id="9610665448-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9610665448-12">(</span><span class="n">Port</span><span class="p" data-group-id="9610665448-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9610665448-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9610665448-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9610665448-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9610665448-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9610665448-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-17">[</span><span class="p" data-group-id="9610665448-18">[</span><span class="p" data-group-id="9610665448-18">]</span><span class="p" data-group-id="9610665448-17">]</span><span class="p" data-group-id="9610665448-16">)</span><span class="p" data-group-id="9610665448-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9610665448-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9610665448-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9610665448-20">(</span><span class="n">Players</span><span class="p" data-group-id="9610665448-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9610665448-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-22">[</span><span class="p" data-group-id="9610665448-22">]</span><span class="p" data-group-id="9610665448-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9610665448-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9610665448-24">(</span><span class="n">P</span><span class="p" data-group-id="9610665448-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9610665448-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-26">[</span><span class="n">P</span><span class="p" data-group-id="9610665448-26">]</span><span class="p" data-group-id="9610665448-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9610665448-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9610665448-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9610665448-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9610665448-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9610665448-29">(</span><span class="n">Player</span><span class="p" data-group-id="9610665448-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9610665448-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-31">[</span><span class="n">Player</span><span class="p" data-group-id="9610665448-31">]</span><span class="p" data-group-id="9610665448-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9610665448-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9610665448-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9610665448-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9610665448-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9610665448-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-36">[</span><span class="n">Player</span><span class="p" data-group-id="9610665448-36">]</span><span class="p" data-group-id="9610665448-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9610665448-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9610665448-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9610665448-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9610665448-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9610665448-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9610665448-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9610665448-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9610665448-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9610665448-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9610665448-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9610665448-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9610665448-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9610665448-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9610665448-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9610665448-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9610665448-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9610665448-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9610665448-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9610665448-49">(</span><span class="n">Player</span><span class="p" data-group-id="9610665448-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9610665448-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9610665448-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9610665448-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9610665448-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9610665448-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9610665448-53">(</span><span class="n">P</span><span class="p" data-group-id="9610665448-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9610665448-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9610665448-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9610665448-55">(</span><span class="n">P</span><span class="p" data-group-id="9610665448-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9610665448-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9610665448-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9610665448-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9610665448-57">(</span><span class="p" data-group-id="9610665448-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-58">{</span><span class="p" data-group-id="9610665448-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9610665448-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9610665448-60">}</span><span class="p" data-group-id="9610665448-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9610665448-61">(</span><span class="p" data-group-id="9610665448-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9610665448-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9610665448-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9610665448-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9610665448-64">]</span><span class="w">
        </span><span class="p" data-group-id="9610665448-63">)</span><span class="w">
    </span><span class="p" data-group-id="9610665448-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9610665448-65">(</span><span class="p" data-group-id="9610665448-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="9610665448-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9610665448-67">(</span><span class="p" data-group-id="9610665448-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9610665448-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9610665448-69">]</span><span class="p" data-group-id="9610665448-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9610665448-70">(</span><span class="p" data-group-id="9610665448-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9610665448-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9610665448-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9610665448-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9610665448-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9610665448-73">(</span><span class="p" data-group-id="9610665448-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9610665448-75">{</span><span class="ss">fff</span><span class="p" data-group-id="9610665448-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9610665448-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9610665448-77">]</span><span class="p" data-group-id="9610665448-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-78">[</span><span class="n">Fun</span><span class="p" data-group-id="9610665448-79">(</span><span class="n">H</span><span class="p" data-group-id="9610665448-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9610665448-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9610665448-80">)</span><span class="p" data-group-id="9610665448-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9610665448-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9610665448-82">[</span><span class="p" data-group-id="9610665448-82">]</span><span class="p" data-group-id="9610665448-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9610665448-83">[</span><span class="p" data-group-id="9610665448-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9610665448-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9610665448-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9610665448-85">(</span><span class="p" data-group-id="9610665448-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9610665448-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9610665448-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9610665448-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9610665448-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9610665448-89">(</span><span class="nf">fun</span><span class="p" data-group-id="9610665448-90">(</span><span class="p" data-group-id="9610665448-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9610665448-91">{</span><span class="nf">self</span><span class="p" data-group-id="9610665448-92">(</span><span class="p" data-group-id="9610665448-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9610665448-93">(</span><span class="n">X</span><span class="p" data-group-id="9610665448-93">)</span><span class="p" data-group-id="9610665448-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9610665448-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9610665448-88">]</span><span class="w">
    </span><span class="p" data-group-id="9610665448-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rrt">
    Rrt Style (rrt)<a class="headerlink" href="#rrt" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rrt"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rrt_style</span><span class="p" data-group-id="3187381567-1">(</span><span class="p" data-group-id="3187381567-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="rrt-example.erl">
      example.erl<a class="headerlink" href="#rrt-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rrt"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1041093142-1">(</span><span class="ss">test</span><span class="p" data-group-id="1041093142-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1041093142-2">(</span><span class="p" data-group-id="1041093142-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1041093142-3">]</span><span class="p" data-group-id="1041093142-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1041093142-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1041093142-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1041093142-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1041093142-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1041093142-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1041093142-9">}</span><span class="p" data-group-id="1041093142-6">]</span><span class="p" data-group-id="1041093142-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1041093142-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1041093142-11">}</span><span class="p" data-group-id="1041093142-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1041093142-12">(</span><span class="n">Port</span><span class="p" data-group-id="1041093142-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1041093142-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1041093142-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1041093142-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1041093142-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1041093142-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-17">[</span><span class="p" data-group-id="1041093142-18">[</span><span class="p" data-group-id="1041093142-18">]</span><span class="p" data-group-id="1041093142-17">]</span><span class="p" data-group-id="1041093142-16">)</span><span class="p" data-group-id="1041093142-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1041093142-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1041093142-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1041093142-20">(</span><span class="n">Players</span><span class="p" data-group-id="1041093142-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1041093142-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-22">[</span><span class="p" data-group-id="1041093142-22">]</span><span class="p" data-group-id="1041093142-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1041093142-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1041093142-24">(</span><span class="n">P</span><span class="p" data-group-id="1041093142-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1041093142-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-26">[</span><span class="n">P</span><span class="p" data-group-id="1041093142-26">]</span><span class="p" data-group-id="1041093142-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1041093142-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1041093142-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1041093142-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1041093142-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1041093142-29">(</span><span class="n">Player</span><span class="p" data-group-id="1041093142-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1041093142-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-31">[</span><span class="n">Player</span><span class="p" data-group-id="1041093142-31">]</span><span class="p" data-group-id="1041093142-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1041093142-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1041093142-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1041093142-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1041093142-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1041093142-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-36">[</span><span class="n">Player</span><span class="p" data-group-id="1041093142-36">]</span><span class="p" data-group-id="1041093142-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1041093142-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1041093142-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1041093142-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1041093142-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1041093142-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1041093142-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1041093142-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1041093142-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1041093142-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1041093142-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1041093142-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1041093142-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1041093142-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1041093142-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1041093142-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1041093142-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1041093142-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1041093142-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1041093142-49">(</span><span class="n">Player</span><span class="p" data-group-id="1041093142-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1041093142-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1041093142-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1041093142-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1041093142-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1041093142-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1041093142-53">(</span><span class="n">P</span><span class="p" data-group-id="1041093142-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1041093142-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1041093142-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1041093142-55">(</span><span class="n">P</span><span class="p" data-group-id="1041093142-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1041093142-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1041093142-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1041093142-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1041093142-57">(</span><span class="p" data-group-id="1041093142-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-58">{</span><span class="p" data-group-id="1041093142-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1041093142-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1041093142-60">}</span><span class="p" data-group-id="1041093142-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1041093142-61">(</span><span class="p" data-group-id="1041093142-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1041093142-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1041093142-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1041093142-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1041093142-64">]</span><span class="w">
        </span><span class="p" data-group-id="1041093142-63">)</span><span class="w">
    </span><span class="p" data-group-id="1041093142-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1041093142-65">(</span><span class="p" data-group-id="1041093142-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="1041093142-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1041093142-67">(</span><span class="p" data-group-id="1041093142-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1041093142-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1041093142-69">]</span><span class="p" data-group-id="1041093142-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1041093142-70">(</span><span class="p" data-group-id="1041093142-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1041093142-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1041093142-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1041093142-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1041093142-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1041093142-73">(</span><span class="p" data-group-id="1041093142-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1041093142-75">{</span><span class="ss">fff</span><span class="p" data-group-id="1041093142-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1041093142-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1041093142-77">]</span><span class="p" data-group-id="1041093142-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-78">[</span><span class="n">Fun</span><span class="p" data-group-id="1041093142-79">(</span><span class="n">H</span><span class="p" data-group-id="1041093142-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1041093142-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1041093142-80">)</span><span class="p" data-group-id="1041093142-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1041093142-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1041093142-82">[</span><span class="p" data-group-id="1041093142-82">]</span><span class="p" data-group-id="1041093142-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1041093142-83">[</span><span class="p" data-group-id="1041093142-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1041093142-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1041093142-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1041093142-85">(</span><span class="p" data-group-id="1041093142-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1041093142-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1041093142-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1041093142-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1041093142-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1041093142-89">(</span><span class="nf">fun</span><span class="p" data-group-id="1041093142-90">(</span><span class="p" data-group-id="1041093142-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1041093142-91">{</span><span class="nf">self</span><span class="p" data-group-id="1041093142-92">(</span><span class="p" data-group-id="1041093142-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1041093142-93">(</span><span class="n">X</span><span class="p" data-group-id="1041093142-93">)</span><span class="p" data-group-id="1041093142-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1041093142-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1041093142-88">]</span><span class="w">
    </span><span class="p" data-group-id="1041093142-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="tango">
    Tango Style (tango)<a class="headerlink" href="#tango" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-tango"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">tango_style</span><span class="p" data-group-id="6393841522-1">(</span><span class="p" data-group-id="6393841522-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="tango-example.erl">
      example.erl<a class="headerlink" href="#tango-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-tango"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3195579349-1">(</span><span class="ss">test</span><span class="p" data-group-id="3195579349-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3195579349-2">(</span><span class="p" data-group-id="3195579349-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="3195579349-3">]</span><span class="p" data-group-id="3195579349-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="3195579349-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="3195579349-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="3195579349-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3195579349-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3195579349-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3195579349-9">}</span><span class="p" data-group-id="3195579349-6">]</span><span class="p" data-group-id="3195579349-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="3195579349-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="3195579349-11">}</span><span class="p" data-group-id="3195579349-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="3195579349-12">(</span><span class="n">Port</span><span class="p" data-group-id="3195579349-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="3195579349-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="3195579349-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="3195579349-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="3195579349-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="3195579349-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-17">[</span><span class="p" data-group-id="3195579349-18">[</span><span class="p" data-group-id="3195579349-18">]</span><span class="p" data-group-id="3195579349-17">]</span><span class="p" data-group-id="3195579349-16">)</span><span class="p" data-group-id="3195579349-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="3195579349-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="3195579349-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="3195579349-20">(</span><span class="n">Players</span><span class="p" data-group-id="3195579349-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3195579349-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-22">[</span><span class="p" data-group-id="3195579349-22">]</span><span class="p" data-group-id="3195579349-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3195579349-23">(</span><span class="nf">fun</span><span class="p" data-group-id="3195579349-24">(</span><span class="n">P</span><span class="p" data-group-id="3195579349-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3195579349-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-26">[</span><span class="n">P</span><span class="p" data-group-id="3195579349-26">]</span><span class="p" data-group-id="3195579349-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3195579349-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3195579349-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="3195579349-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="3195579349-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3195579349-29">(</span><span class="n">Player</span><span class="p" data-group-id="3195579349-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3195579349-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-31">[</span><span class="n">Player</span><span class="p" data-group-id="3195579349-31">]</span><span class="p" data-group-id="3195579349-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3195579349-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3195579349-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3195579349-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3195579349-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3195579349-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-36">[</span><span class="n">Player</span><span class="p" data-group-id="3195579349-36">]</span><span class="p" data-group-id="3195579349-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="3195579349-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3195579349-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3195579349-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3195579349-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="3195579349-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3195579349-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3195579349-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="3195579349-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3195579349-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="3195579349-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="3195579349-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="3195579349-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="3195579349-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="3195579349-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="3195579349-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="3195579349-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="3195579349-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3195579349-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="3195579349-49">(</span><span class="n">Player</span><span class="p" data-group-id="3195579349-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3195579349-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="3195579349-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="3195579349-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3195579349-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="3195579349-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3195579349-53">(</span><span class="n">P</span><span class="p" data-group-id="3195579349-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="3195579349-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3195579349-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3195579349-55">(</span><span class="n">P</span><span class="p" data-group-id="3195579349-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3195579349-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3195579349-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="3195579349-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="3195579349-57">(</span><span class="p" data-group-id="3195579349-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-58">{</span><span class="p" data-group-id="3195579349-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="3195579349-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3195579349-60">}</span><span class="p" data-group-id="3195579349-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="3195579349-61">(</span><span class="p" data-group-id="3195579349-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="3195579349-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3195579349-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3195579349-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3195579349-64">]</span><span class="w">
        </span><span class="p" data-group-id="3195579349-63">)</span><span class="w">
    </span><span class="p" data-group-id="3195579349-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="3195579349-65">(</span><span class="p" data-group-id="3195579349-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="3195579349-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="3195579349-67">(</span><span class="p" data-group-id="3195579349-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3195579349-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3195579349-69">]</span><span class="p" data-group-id="3195579349-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="3195579349-70">(</span><span class="p" data-group-id="3195579349-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3195579349-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3195579349-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="3195579349-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="3195579349-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="3195579349-73">(</span><span class="p" data-group-id="3195579349-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="3195579349-75">{</span><span class="ss">fff</span><span class="p" data-group-id="3195579349-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="3195579349-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3195579349-77">]</span><span class="p" data-group-id="3195579349-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-78">[</span><span class="n">Fun</span><span class="p" data-group-id="3195579349-79">(</span><span class="n">H</span><span class="p" data-group-id="3195579349-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3195579349-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3195579349-80">)</span><span class="p" data-group-id="3195579349-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="3195579349-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195579349-82">[</span><span class="p" data-group-id="3195579349-82">]</span><span class="p" data-group-id="3195579349-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3195579349-83">[</span><span class="p" data-group-id="3195579349-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="3195579349-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="3195579349-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="3195579349-85">(</span><span class="p" data-group-id="3195579349-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3195579349-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="3195579349-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="3195579349-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3195579349-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="3195579349-89">(</span><span class="nf">fun</span><span class="p" data-group-id="3195579349-90">(</span><span class="p" data-group-id="3195579349-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3195579349-91">{</span><span class="nf">self</span><span class="p" data-group-id="3195579349-92">(</span><span class="p" data-group-id="3195579349-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="3195579349-93">(</span><span class="n">X</span><span class="p" data-group-id="3195579349-93">)</span><span class="p" data-group-id="3195579349-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="3195579349-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="3195579349-88">]</span><span class="w">
    </span><span class="p" data-group-id="3195579349-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="trac">
    Trac Style (trac)<a class="headerlink" href="#trac" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-trac"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">trac_style</span><span class="p" data-group-id="4567062793-1">(</span><span class="p" data-group-id="4567062793-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="trac-example.erl">
      example.erl<a class="headerlink" href="#trac-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-trac"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5644322107-1">(</span><span class="ss">test</span><span class="p" data-group-id="5644322107-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5644322107-2">(</span><span class="p" data-group-id="5644322107-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5644322107-3">]</span><span class="p" data-group-id="5644322107-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5644322107-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5644322107-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5644322107-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5644322107-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5644322107-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5644322107-9">}</span><span class="p" data-group-id="5644322107-6">]</span><span class="p" data-group-id="5644322107-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5644322107-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5644322107-11">}</span><span class="p" data-group-id="5644322107-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5644322107-12">(</span><span class="n">Port</span><span class="p" data-group-id="5644322107-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5644322107-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5644322107-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5644322107-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5644322107-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5644322107-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-17">[</span><span class="p" data-group-id="5644322107-18">[</span><span class="p" data-group-id="5644322107-18">]</span><span class="p" data-group-id="5644322107-17">]</span><span class="p" data-group-id="5644322107-16">)</span><span class="p" data-group-id="5644322107-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5644322107-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5644322107-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5644322107-20">(</span><span class="n">Players</span><span class="p" data-group-id="5644322107-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5644322107-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-22">[</span><span class="p" data-group-id="5644322107-22">]</span><span class="p" data-group-id="5644322107-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5644322107-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5644322107-24">(</span><span class="n">P</span><span class="p" data-group-id="5644322107-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5644322107-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-26">[</span><span class="n">P</span><span class="p" data-group-id="5644322107-26">]</span><span class="p" data-group-id="5644322107-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5644322107-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5644322107-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5644322107-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5644322107-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5644322107-29">(</span><span class="n">Player</span><span class="p" data-group-id="5644322107-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5644322107-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-31">[</span><span class="n">Player</span><span class="p" data-group-id="5644322107-31">]</span><span class="p" data-group-id="5644322107-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5644322107-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5644322107-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5644322107-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5644322107-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5644322107-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-36">[</span><span class="n">Player</span><span class="p" data-group-id="5644322107-36">]</span><span class="p" data-group-id="5644322107-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5644322107-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5644322107-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5644322107-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5644322107-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5644322107-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5644322107-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5644322107-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5644322107-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5644322107-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5644322107-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5644322107-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5644322107-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5644322107-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5644322107-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5644322107-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5644322107-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5644322107-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5644322107-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5644322107-49">(</span><span class="n">Player</span><span class="p" data-group-id="5644322107-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5644322107-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5644322107-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5644322107-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5644322107-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5644322107-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5644322107-53">(</span><span class="n">P</span><span class="p" data-group-id="5644322107-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5644322107-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5644322107-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5644322107-55">(</span><span class="n">P</span><span class="p" data-group-id="5644322107-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5644322107-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5644322107-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5644322107-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5644322107-57">(</span><span class="p" data-group-id="5644322107-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-58">{</span><span class="p" data-group-id="5644322107-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5644322107-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5644322107-60">}</span><span class="p" data-group-id="5644322107-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5644322107-61">(</span><span class="p" data-group-id="5644322107-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5644322107-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5644322107-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5644322107-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5644322107-64">]</span><span class="w">
        </span><span class="p" data-group-id="5644322107-63">)</span><span class="w">
    </span><span class="p" data-group-id="5644322107-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5644322107-65">(</span><span class="p" data-group-id="5644322107-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5644322107-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5644322107-67">(</span><span class="p" data-group-id="5644322107-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5644322107-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5644322107-69">]</span><span class="p" data-group-id="5644322107-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5644322107-70">(</span><span class="p" data-group-id="5644322107-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5644322107-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5644322107-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5644322107-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5644322107-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5644322107-73">(</span><span class="p" data-group-id="5644322107-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5644322107-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5644322107-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5644322107-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5644322107-77">]</span><span class="p" data-group-id="5644322107-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5644322107-79">(</span><span class="n">H</span><span class="p" data-group-id="5644322107-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5644322107-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5644322107-80">)</span><span class="p" data-group-id="5644322107-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5644322107-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5644322107-82">[</span><span class="p" data-group-id="5644322107-82">]</span><span class="p" data-group-id="5644322107-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5644322107-83">[</span><span class="p" data-group-id="5644322107-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5644322107-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5644322107-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5644322107-85">(</span><span class="p" data-group-id="5644322107-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5644322107-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5644322107-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5644322107-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5644322107-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5644322107-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5644322107-90">(</span><span class="p" data-group-id="5644322107-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5644322107-91">{</span><span class="nf">self</span><span class="p" data-group-id="5644322107-92">(</span><span class="p" data-group-id="5644322107-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5644322107-93">(</span><span class="n">X</span><span class="p" data-group-id="5644322107-93">)</span><span class="p" data-group-id="5644322107-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5644322107-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5644322107-88">]</span><span class="w">
    </span><span class="p" data-group-id="5644322107-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vim">
    Vim Style (vim)<a class="headerlink" href="#vim" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vim"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vim_style</span><span class="p" data-group-id="6705581546-1">(</span><span class="p" data-group-id="6705581546-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="vim-example.erl">
      example.erl<a class="headerlink" href="#vim-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vim"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5947150128-1">(</span><span class="ss">test</span><span class="p" data-group-id="5947150128-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5947150128-2">(</span><span class="p" data-group-id="5947150128-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5947150128-3">]</span><span class="p" data-group-id="5947150128-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5947150128-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5947150128-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5947150128-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5947150128-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5947150128-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5947150128-9">}</span><span class="p" data-group-id="5947150128-6">]</span><span class="p" data-group-id="5947150128-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5947150128-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5947150128-11">}</span><span class="p" data-group-id="5947150128-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5947150128-12">(</span><span class="n">Port</span><span class="p" data-group-id="5947150128-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5947150128-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5947150128-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5947150128-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5947150128-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5947150128-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-17">[</span><span class="p" data-group-id="5947150128-18">[</span><span class="p" data-group-id="5947150128-18">]</span><span class="p" data-group-id="5947150128-17">]</span><span class="p" data-group-id="5947150128-16">)</span><span class="p" data-group-id="5947150128-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5947150128-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5947150128-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5947150128-20">(</span><span class="n">Players</span><span class="p" data-group-id="5947150128-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5947150128-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-22">[</span><span class="p" data-group-id="5947150128-22">]</span><span class="p" data-group-id="5947150128-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5947150128-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5947150128-24">(</span><span class="n">P</span><span class="p" data-group-id="5947150128-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5947150128-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-26">[</span><span class="n">P</span><span class="p" data-group-id="5947150128-26">]</span><span class="p" data-group-id="5947150128-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5947150128-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5947150128-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5947150128-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5947150128-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5947150128-29">(</span><span class="n">Player</span><span class="p" data-group-id="5947150128-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5947150128-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-31">[</span><span class="n">Player</span><span class="p" data-group-id="5947150128-31">]</span><span class="p" data-group-id="5947150128-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5947150128-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5947150128-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5947150128-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5947150128-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5947150128-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-36">[</span><span class="n">Player</span><span class="p" data-group-id="5947150128-36">]</span><span class="p" data-group-id="5947150128-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5947150128-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5947150128-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5947150128-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5947150128-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5947150128-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5947150128-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5947150128-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5947150128-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5947150128-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5947150128-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5947150128-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5947150128-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5947150128-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5947150128-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5947150128-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5947150128-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5947150128-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5947150128-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5947150128-49">(</span><span class="n">Player</span><span class="p" data-group-id="5947150128-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5947150128-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5947150128-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5947150128-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5947150128-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5947150128-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5947150128-53">(</span><span class="n">P</span><span class="p" data-group-id="5947150128-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5947150128-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5947150128-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5947150128-55">(</span><span class="n">P</span><span class="p" data-group-id="5947150128-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5947150128-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5947150128-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5947150128-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5947150128-57">(</span><span class="p" data-group-id="5947150128-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-58">{</span><span class="p" data-group-id="5947150128-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5947150128-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5947150128-60">}</span><span class="p" data-group-id="5947150128-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5947150128-61">(</span><span class="p" data-group-id="5947150128-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5947150128-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5947150128-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5947150128-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5947150128-64">]</span><span class="w">
        </span><span class="p" data-group-id="5947150128-63">)</span><span class="w">
    </span><span class="p" data-group-id="5947150128-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5947150128-65">(</span><span class="p" data-group-id="5947150128-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5947150128-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5947150128-67">(</span><span class="p" data-group-id="5947150128-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5947150128-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5947150128-69">]</span><span class="p" data-group-id="5947150128-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5947150128-70">(</span><span class="p" data-group-id="5947150128-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5947150128-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5947150128-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5947150128-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5947150128-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5947150128-73">(</span><span class="p" data-group-id="5947150128-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5947150128-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5947150128-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5947150128-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5947150128-77">]</span><span class="p" data-group-id="5947150128-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5947150128-79">(</span><span class="n">H</span><span class="p" data-group-id="5947150128-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5947150128-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5947150128-80">)</span><span class="p" data-group-id="5947150128-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5947150128-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5947150128-82">[</span><span class="p" data-group-id="5947150128-82">]</span><span class="p" data-group-id="5947150128-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5947150128-83">[</span><span class="p" data-group-id="5947150128-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5947150128-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5947150128-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5947150128-85">(</span><span class="p" data-group-id="5947150128-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5947150128-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5947150128-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5947150128-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5947150128-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5947150128-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5947150128-90">(</span><span class="p" data-group-id="5947150128-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5947150128-91">{</span><span class="nf">self</span><span class="p" data-group-id="5947150128-92">(</span><span class="p" data-group-id="5947150128-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5947150128-93">(</span><span class="n">X</span><span class="p" data-group-id="5947150128-93">)</span><span class="p" data-group-id="5947150128-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5947150128-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5947150128-88">]</span><span class="w">
    </span><span class="p" data-group-id="5947150128-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vs">
    VisualStudio Style (vs)<a class="headerlink" href="#vs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vs_style</span><span class="p" data-group-id="6994716224-1">(</span><span class="p" data-group-id="6994716224-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="vs-example.erl">
      example.erl<a class="headerlink" href="#vs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7880581798-1">(</span><span class="ss">test</span><span class="p" data-group-id="7880581798-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7880581798-2">(</span><span class="p" data-group-id="7880581798-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7880581798-3">]</span><span class="p" data-group-id="7880581798-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7880581798-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7880581798-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7880581798-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7880581798-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7880581798-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7880581798-9">}</span><span class="p" data-group-id="7880581798-6">]</span><span class="p" data-group-id="7880581798-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7880581798-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7880581798-11">}</span><span class="p" data-group-id="7880581798-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7880581798-12">(</span><span class="n">Port</span><span class="p" data-group-id="7880581798-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7880581798-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7880581798-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7880581798-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7880581798-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7880581798-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-17">[</span><span class="p" data-group-id="7880581798-18">[</span><span class="p" data-group-id="7880581798-18">]</span><span class="p" data-group-id="7880581798-17">]</span><span class="p" data-group-id="7880581798-16">)</span><span class="p" data-group-id="7880581798-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7880581798-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7880581798-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7880581798-20">(</span><span class="n">Players</span><span class="p" data-group-id="7880581798-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7880581798-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-22">[</span><span class="p" data-group-id="7880581798-22">]</span><span class="p" data-group-id="7880581798-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7880581798-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7880581798-24">(</span><span class="n">P</span><span class="p" data-group-id="7880581798-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7880581798-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-26">[</span><span class="n">P</span><span class="p" data-group-id="7880581798-26">]</span><span class="p" data-group-id="7880581798-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7880581798-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7880581798-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7880581798-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7880581798-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7880581798-29">(</span><span class="n">Player</span><span class="p" data-group-id="7880581798-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7880581798-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-31">[</span><span class="n">Player</span><span class="p" data-group-id="7880581798-31">]</span><span class="p" data-group-id="7880581798-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7880581798-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7880581798-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7880581798-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7880581798-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7880581798-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-36">[</span><span class="n">Player</span><span class="p" data-group-id="7880581798-36">]</span><span class="p" data-group-id="7880581798-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7880581798-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7880581798-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7880581798-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7880581798-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7880581798-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7880581798-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7880581798-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7880581798-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7880581798-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7880581798-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7880581798-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7880581798-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7880581798-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7880581798-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7880581798-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7880581798-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7880581798-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7880581798-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7880581798-49">(</span><span class="n">Player</span><span class="p" data-group-id="7880581798-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7880581798-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7880581798-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7880581798-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7880581798-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7880581798-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7880581798-53">(</span><span class="n">P</span><span class="p" data-group-id="7880581798-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7880581798-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7880581798-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7880581798-55">(</span><span class="n">P</span><span class="p" data-group-id="7880581798-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7880581798-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7880581798-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7880581798-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7880581798-57">(</span><span class="p" data-group-id="7880581798-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-58">{</span><span class="p" data-group-id="7880581798-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7880581798-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7880581798-60">}</span><span class="p" data-group-id="7880581798-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7880581798-61">(</span><span class="p" data-group-id="7880581798-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7880581798-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7880581798-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7880581798-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7880581798-64">]</span><span class="w">
        </span><span class="p" data-group-id="7880581798-63">)</span><span class="w">
    </span><span class="p" data-group-id="7880581798-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7880581798-65">(</span><span class="p" data-group-id="7880581798-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="7880581798-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7880581798-67">(</span><span class="p" data-group-id="7880581798-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7880581798-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7880581798-69">]</span><span class="p" data-group-id="7880581798-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7880581798-70">(</span><span class="p" data-group-id="7880581798-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7880581798-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7880581798-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7880581798-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7880581798-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7880581798-73">(</span><span class="p" data-group-id="7880581798-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7880581798-75">{</span><span class="ss">fff</span><span class="p" data-group-id="7880581798-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7880581798-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7880581798-77">]</span><span class="p" data-group-id="7880581798-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-78">[</span><span class="n">Fun</span><span class="p" data-group-id="7880581798-79">(</span><span class="n">H</span><span class="p" data-group-id="7880581798-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7880581798-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7880581798-80">)</span><span class="p" data-group-id="7880581798-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7880581798-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7880581798-82">[</span><span class="p" data-group-id="7880581798-82">]</span><span class="p" data-group-id="7880581798-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7880581798-83">[</span><span class="p" data-group-id="7880581798-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7880581798-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7880581798-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7880581798-85">(</span><span class="p" data-group-id="7880581798-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7880581798-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7880581798-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7880581798-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7880581798-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7880581798-89">(</span><span class="nf">fun</span><span class="p" data-group-id="7880581798-90">(</span><span class="p" data-group-id="7880581798-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7880581798-91">{</span><span class="nf">self</span><span class="p" data-group-id="7880581798-92">(</span><span class="p" data-group-id="7880581798-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7880581798-93">(</span><span class="n">X</span><span class="p" data-group-id="7880581798-93">)</span><span class="p" data-group-id="7880581798-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7880581798-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7880581798-88">]</span><span class="w">
    </span><span class="p" data-group-id="7880581798-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="xcode">
    Xcode Style (xcode)<a class="headerlink" href="#xcode" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-xcode"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">xcode_style</span><span class="p" data-group-id="4868799864-1">(</span><span class="p" data-group-id="4868799864-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="xcode-example.erl">
      example.erl<a class="headerlink" href="#xcode-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-xcode"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5070573412-1">(</span><span class="ss">test</span><span class="p" data-group-id="5070573412-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5070573412-2">(</span><span class="p" data-group-id="5070573412-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5070573412-3">]</span><span class="p" data-group-id="5070573412-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5070573412-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5070573412-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5070573412-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5070573412-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5070573412-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5070573412-9">}</span><span class="p" data-group-id="5070573412-6">]</span><span class="p" data-group-id="5070573412-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5070573412-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5070573412-11">}</span><span class="p" data-group-id="5070573412-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5070573412-12">(</span><span class="n">Port</span><span class="p" data-group-id="5070573412-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5070573412-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5070573412-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5070573412-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5070573412-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5070573412-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-17">[</span><span class="p" data-group-id="5070573412-18">[</span><span class="p" data-group-id="5070573412-18">]</span><span class="p" data-group-id="5070573412-17">]</span><span class="p" data-group-id="5070573412-16">)</span><span class="p" data-group-id="5070573412-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5070573412-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5070573412-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5070573412-20">(</span><span class="n">Players</span><span class="p" data-group-id="5070573412-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5070573412-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-22">[</span><span class="p" data-group-id="5070573412-22">]</span><span class="p" data-group-id="5070573412-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5070573412-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5070573412-24">(</span><span class="n">P</span><span class="p" data-group-id="5070573412-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5070573412-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-26">[</span><span class="n">P</span><span class="p" data-group-id="5070573412-26">]</span><span class="p" data-group-id="5070573412-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5070573412-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5070573412-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5070573412-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5070573412-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5070573412-29">(</span><span class="n">Player</span><span class="p" data-group-id="5070573412-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5070573412-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-31">[</span><span class="n">Player</span><span class="p" data-group-id="5070573412-31">]</span><span class="p" data-group-id="5070573412-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5070573412-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5070573412-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5070573412-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5070573412-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5070573412-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-36">[</span><span class="n">Player</span><span class="p" data-group-id="5070573412-36">]</span><span class="p" data-group-id="5070573412-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5070573412-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5070573412-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5070573412-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5070573412-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5070573412-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5070573412-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5070573412-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5070573412-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5070573412-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5070573412-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5070573412-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5070573412-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5070573412-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5070573412-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5070573412-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5070573412-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5070573412-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5070573412-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5070573412-49">(</span><span class="n">Player</span><span class="p" data-group-id="5070573412-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5070573412-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5070573412-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5070573412-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5070573412-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5070573412-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5070573412-53">(</span><span class="n">P</span><span class="p" data-group-id="5070573412-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5070573412-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5070573412-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5070573412-55">(</span><span class="n">P</span><span class="p" data-group-id="5070573412-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5070573412-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5070573412-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5070573412-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5070573412-57">(</span><span class="p" data-group-id="5070573412-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-58">{</span><span class="p" data-group-id="5070573412-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5070573412-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5070573412-60">}</span><span class="p" data-group-id="5070573412-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5070573412-61">(</span><span class="p" data-group-id="5070573412-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5070573412-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5070573412-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5070573412-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5070573412-64">]</span><span class="w">
        </span><span class="p" data-group-id="5070573412-63">)</span><span class="w">
    </span><span class="p" data-group-id="5070573412-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5070573412-65">(</span><span class="p" data-group-id="5070573412-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-66">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p" data-group-id="5070573412-66">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5070573412-67">(</span><span class="p" data-group-id="5070573412-67">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-68">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5070573412-69">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5070573412-69">]</span><span class="p" data-group-id="5070573412-68">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5070573412-70">(</span><span class="p" data-group-id="5070573412-70">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5070573412-71">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5070573412-71">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5070573412-72">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5070573412-72">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5070573412-73">(</span><span class="p" data-group-id="5070573412-73">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-74">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5070573412-75">{</span><span class="ss">fff</span><span class="p" data-group-id="5070573412-75">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-74">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5070573412-76">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-77">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5070573412-77">]</span><span class="p" data-group-id="5070573412-76">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-78">[</span><span class="n">Fun</span><span class="p" data-group-id="5070573412-79">(</span><span class="n">H</span><span class="p" data-group-id="5070573412-79">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5070573412-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5070573412-80">)</span><span class="p" data-group-id="5070573412-78">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5070573412-81">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5070573412-82">[</span><span class="p" data-group-id="5070573412-82">]</span><span class="p" data-group-id="5070573412-81">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5070573412-83">[</span><span class="p" data-group-id="5070573412-83">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5070573412-84">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5070573412-84">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5070573412-85">(</span><span class="p" data-group-id="5070573412-85">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5070573412-86">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5070573412-87">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5070573412-87">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5070573412-88">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5070573412-89">(</span><span class="nf">fun</span><span class="p" data-group-id="5070573412-90">(</span><span class="p" data-group-id="5070573412-90">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5070573412-91">{</span><span class="nf">self</span><span class="p" data-group-id="5070573412-92">(</span><span class="p" data-group-id="5070573412-92">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5070573412-93">(</span><span class="n">X</span><span class="p" data-group-id="5070573412-93">)</span><span class="p" data-group-id="5070573412-91">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5070573412-89">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5070573412-88">]</span><span class="w">
    </span><span class="p" data-group-id="5070573412-86">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  


          </div>


        </div>

        <div class="clearer"></div>

      </div>

      <div class="clearfix"></div>
    </div>

    <script src="static/js/matching_groups_highlighter.js"></script>

    <script type="text/javascript">
      document.querySelector(".menu-btn").addEventListener("click", () => {
        document.querySelector(".left-column").classList.toggle("left-column--active");
      });
    </script>
  </body>
</html>
