<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- Licensed under the Apache 2.0 License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/open-sans/stylesheet.css" />
    <!-- Licensed under the SIL Open Font License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/source-serif-pro/source-serif-pro.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Makeup Demo</title>
    
    <!--Bootstrap 5-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    
    <link rel="stylesheet" href="static/css/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="static/css/makeup.css" type="text/css" />
  </head>

  <body role="document">
    <div class="container-wrapper">
      <div id="mobile-toggle">
        <a class="text-logo--mobile"  href="index.html">
          <span>Makeup Demo</span>
        </a>
        <button class="menu-btn" area-label="Menu">
          <img class="menu-icon" src="static/img/menu-line.svg">
        </button>        
      </div>

      <div id="left-column" class="left-column">
        <div class="makeupsidebar"><a href="index.html" class="text-logo">Makeup Demo</a>

          
            <div class="sidebar-block">
              <div class="sidebar-wrapper">
                <h2>Styles</h2>
              </div>
              <div class="sidebar-toc">
                <ul>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#abap">
                        Abap Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol">
                        Algol Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol_nu">
                        Algol_Nu Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#arduino">
                        Arduino Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#autumn">
                        Autumn Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#borland">
                        Borland Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#bw">
                        BlackWhite Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#colorful">
                        Colorful Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#default">
                        Default Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#emacs">
                        Emacs Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#friendly">
                        Friendly Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#fruity">
                        Fruity Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#igor">
                        Igor Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#lovelace">
                        Lovelace Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#manni">
                        Manni Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#monokai">
                        Monokai Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#murphy">
                        Murphy Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#native">
                        Native Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_dark">
                        ParaisoDark Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_light">
                        ParaisoLight Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#pastie">
                        Pastie Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#perldoc">
                        Perldoc Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rainbow_dash">
                        RainbowDash Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rrt">
                        Rrt Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#tango">
                        Tango Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#trac">
                        Trac Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vim">
                        Vim Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vs">
                        VisualStudio Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#xcode">
                        Xcode Style</a></li>
                  
                </ul>
              </div>
            </div>
          

          <div class="sidebar-block">
            <div class="sidebar-wrapper">
              <h2>Languages</h2>
            </div>
            <div class="sidebar-toc">
              <ul>
                
                <li class="toctree-l1"><a class="reference internal" href="c.html">C</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="diff.html">Diff</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="eex.html">EEx</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="elixir.html">Elixir</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="erlang.html">Erlang</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="heex.html">HEEx</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a></li>
                
              </ul>
            </div>
          </div>

        </div>
      </div>

      <div id="right-column">
        
        <div class="document clearer body">

          <div class="section">
            <h1 id="heading">
  Erlang Language<a class="headerlink" href="#heading" title="Permalink">¶</a>
</h1>

<p>
  A lexer for the Erlang language.
</p>


<p>
  This page shows examples of source files lexed by the same lexer,
  but rendered into HTML using different styles.
</p>

<p>
  Some styles are richer than others in that they define more different token categories.

  Examples of such richer styles are the <a href="#default">Default</a> style,
  the <a href="#tango">Tango</a> style and the <a href="#colorful">Colorful</a> style.
</p>

<p>
  In all cases the lexer is the same, and the only difference is the colors defined by the styles.
</p>


  <h2 id="abap">
    Abap Style (abap)<a class="headerlink" href="#abap" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-abap"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">abap_style</span><span class="p" data-group-id="7364093642-1">(</span><span class="p" data-group-id="7364093642-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="abap-example.erl">
      example.erl<a class="headerlink" href="#abap-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-abap"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1246344703-1">(</span><span class="ss">test</span><span class="p" data-group-id="1246344703-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1246344703-2">(</span><span class="p" data-group-id="1246344703-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1246344703-3">]</span><span class="p" data-group-id="1246344703-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1246344703-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1246344703-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1246344703-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1246344703-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1246344703-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1246344703-9">}</span><span class="p" data-group-id="1246344703-6">]</span><span class="p" data-group-id="1246344703-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1246344703-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1246344703-11">}</span><span class="p" data-group-id="1246344703-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1246344703-12">(</span><span class="n">Port</span><span class="p" data-group-id="1246344703-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1246344703-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1246344703-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1246344703-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1246344703-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1246344703-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-17">[</span><span class="p" data-group-id="1246344703-18">[</span><span class="p" data-group-id="1246344703-18">]</span><span class="p" data-group-id="1246344703-17">]</span><span class="p" data-group-id="1246344703-16">)</span><span class="p" data-group-id="1246344703-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1246344703-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1246344703-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1246344703-20">(</span><span class="n">Players</span><span class="p" data-group-id="1246344703-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1246344703-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-22">[</span><span class="p" data-group-id="1246344703-22">]</span><span class="p" data-group-id="1246344703-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1246344703-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1246344703-24">(</span><span class="n">P</span><span class="p" data-group-id="1246344703-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1246344703-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-26">[</span><span class="n">P</span><span class="p" data-group-id="1246344703-26">]</span><span class="p" data-group-id="1246344703-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1246344703-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1246344703-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1246344703-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1246344703-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1246344703-29">(</span><span class="n">Player</span><span class="p" data-group-id="1246344703-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1246344703-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-31">[</span><span class="n">Player</span><span class="p" data-group-id="1246344703-31">]</span><span class="p" data-group-id="1246344703-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1246344703-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1246344703-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1246344703-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1246344703-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1246344703-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-36">[</span><span class="n">Player</span><span class="p" data-group-id="1246344703-36">]</span><span class="p" data-group-id="1246344703-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1246344703-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1246344703-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1246344703-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1246344703-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1246344703-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1246344703-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1246344703-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1246344703-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1246344703-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1246344703-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1246344703-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1246344703-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1246344703-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1246344703-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1246344703-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1246344703-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1246344703-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1246344703-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1246344703-49">(</span><span class="n">Player</span><span class="p" data-group-id="1246344703-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1246344703-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1246344703-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1246344703-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1246344703-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1246344703-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1246344703-53">(</span><span class="n">P</span><span class="p" data-group-id="1246344703-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1246344703-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1246344703-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1246344703-55">(</span><span class="n">P</span><span class="p" data-group-id="1246344703-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1246344703-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1246344703-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1246344703-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1246344703-57">(</span><span class="p" data-group-id="1246344703-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-58">{</span><span class="p" data-group-id="1246344703-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1246344703-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1246344703-60">}</span><span class="p" data-group-id="1246344703-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1246344703-61">(</span><span class="p" data-group-id="1246344703-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1246344703-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1246344703-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1246344703-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1246344703-64">]</span><span class="w">
        </span><span class="p" data-group-id="1246344703-63">)</span><span class="w">
    </span><span class="p" data-group-id="1246344703-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1246344703-65">(</span><span class="p" data-group-id="1246344703-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1246344703-66">(</span><span class="p" data-group-id="1246344703-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1246344703-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1246344703-68">]</span><span class="p" data-group-id="1246344703-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1246344703-69">(</span><span class="p" data-group-id="1246344703-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1246344703-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1246344703-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1246344703-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1246344703-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1246344703-72">(</span><span class="p" data-group-id="1246344703-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1246344703-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1246344703-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1246344703-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1246344703-76">]</span><span class="p" data-group-id="1246344703-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1246344703-78">(</span><span class="n">H</span><span class="p" data-group-id="1246344703-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1246344703-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1246344703-79">)</span><span class="p" data-group-id="1246344703-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1246344703-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246344703-81">[</span><span class="p" data-group-id="1246344703-81">]</span><span class="p" data-group-id="1246344703-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1246344703-82">[</span><span class="p" data-group-id="1246344703-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1246344703-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1246344703-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1246344703-84">(</span><span class="p" data-group-id="1246344703-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1246344703-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1246344703-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1246344703-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1246344703-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1246344703-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1246344703-89">(</span><span class="p" data-group-id="1246344703-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1246344703-90">{</span><span class="nf">self</span><span class="p" data-group-id="1246344703-91">(</span><span class="p" data-group-id="1246344703-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1246344703-92">(</span><span class="n">X</span><span class="p" data-group-id="1246344703-92">)</span><span class="p" data-group-id="1246344703-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1246344703-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1246344703-87">]</span><span class="w">
    </span><span class="p" data-group-id="1246344703-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol">
    Algol Style (algol)<a class="headerlink" href="#algol" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_style</span><span class="p" data-group-id="8066595566-1">(</span><span class="p" data-group-id="8066595566-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="algol-example.erl">
      example.erl<a class="headerlink" href="#algol-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4037526127-1">(</span><span class="ss">test</span><span class="p" data-group-id="4037526127-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4037526127-2">(</span><span class="p" data-group-id="4037526127-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4037526127-3">]</span><span class="p" data-group-id="4037526127-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4037526127-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4037526127-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4037526127-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4037526127-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4037526127-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4037526127-9">}</span><span class="p" data-group-id="4037526127-6">]</span><span class="p" data-group-id="4037526127-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4037526127-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4037526127-11">}</span><span class="p" data-group-id="4037526127-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4037526127-12">(</span><span class="n">Port</span><span class="p" data-group-id="4037526127-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4037526127-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4037526127-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4037526127-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4037526127-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4037526127-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-17">[</span><span class="p" data-group-id="4037526127-18">[</span><span class="p" data-group-id="4037526127-18">]</span><span class="p" data-group-id="4037526127-17">]</span><span class="p" data-group-id="4037526127-16">)</span><span class="p" data-group-id="4037526127-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4037526127-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4037526127-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4037526127-20">(</span><span class="n">Players</span><span class="p" data-group-id="4037526127-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4037526127-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-22">[</span><span class="p" data-group-id="4037526127-22">]</span><span class="p" data-group-id="4037526127-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4037526127-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4037526127-24">(</span><span class="n">P</span><span class="p" data-group-id="4037526127-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4037526127-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-26">[</span><span class="n">P</span><span class="p" data-group-id="4037526127-26">]</span><span class="p" data-group-id="4037526127-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4037526127-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4037526127-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4037526127-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4037526127-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4037526127-29">(</span><span class="n">Player</span><span class="p" data-group-id="4037526127-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4037526127-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-31">[</span><span class="n">Player</span><span class="p" data-group-id="4037526127-31">]</span><span class="p" data-group-id="4037526127-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4037526127-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4037526127-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4037526127-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4037526127-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4037526127-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-36">[</span><span class="n">Player</span><span class="p" data-group-id="4037526127-36">]</span><span class="p" data-group-id="4037526127-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4037526127-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4037526127-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4037526127-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4037526127-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4037526127-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4037526127-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4037526127-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4037526127-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4037526127-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4037526127-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4037526127-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4037526127-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4037526127-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4037526127-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4037526127-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4037526127-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4037526127-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4037526127-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4037526127-49">(</span><span class="n">Player</span><span class="p" data-group-id="4037526127-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4037526127-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4037526127-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4037526127-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4037526127-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4037526127-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4037526127-53">(</span><span class="n">P</span><span class="p" data-group-id="4037526127-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4037526127-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4037526127-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4037526127-55">(</span><span class="n">P</span><span class="p" data-group-id="4037526127-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4037526127-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4037526127-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4037526127-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4037526127-57">(</span><span class="p" data-group-id="4037526127-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-58">{</span><span class="p" data-group-id="4037526127-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4037526127-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4037526127-60">}</span><span class="p" data-group-id="4037526127-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4037526127-61">(</span><span class="p" data-group-id="4037526127-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4037526127-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4037526127-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4037526127-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4037526127-64">]</span><span class="w">
        </span><span class="p" data-group-id="4037526127-63">)</span><span class="w">
    </span><span class="p" data-group-id="4037526127-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4037526127-65">(</span><span class="p" data-group-id="4037526127-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4037526127-66">(</span><span class="p" data-group-id="4037526127-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4037526127-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4037526127-68">]</span><span class="p" data-group-id="4037526127-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4037526127-69">(</span><span class="p" data-group-id="4037526127-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4037526127-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4037526127-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4037526127-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4037526127-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4037526127-72">(</span><span class="p" data-group-id="4037526127-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4037526127-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4037526127-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4037526127-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4037526127-76">]</span><span class="p" data-group-id="4037526127-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4037526127-78">(</span><span class="n">H</span><span class="p" data-group-id="4037526127-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4037526127-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4037526127-79">)</span><span class="p" data-group-id="4037526127-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4037526127-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4037526127-81">[</span><span class="p" data-group-id="4037526127-81">]</span><span class="p" data-group-id="4037526127-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4037526127-82">[</span><span class="p" data-group-id="4037526127-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4037526127-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4037526127-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4037526127-84">(</span><span class="p" data-group-id="4037526127-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4037526127-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4037526127-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4037526127-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4037526127-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4037526127-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4037526127-89">(</span><span class="p" data-group-id="4037526127-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4037526127-90">{</span><span class="nf">self</span><span class="p" data-group-id="4037526127-91">(</span><span class="p" data-group-id="4037526127-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4037526127-92">(</span><span class="n">X</span><span class="p" data-group-id="4037526127-92">)</span><span class="p" data-group-id="4037526127-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4037526127-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4037526127-87">]</span><span class="w">
    </span><span class="p" data-group-id="4037526127-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol_nu">
    Algol_Nu Style (algol_nu)<a class="headerlink" href="#algol_nu" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol_nu"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_nu_style</span><span class="p" data-group-id="2502758613-1">(</span><span class="p" data-group-id="2502758613-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="algol_nu-example.erl">
      example.erl<a class="headerlink" href="#algol_nu-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol_nu"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6698889278-1">(</span><span class="ss">test</span><span class="p" data-group-id="6698889278-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6698889278-2">(</span><span class="p" data-group-id="6698889278-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6698889278-3">]</span><span class="p" data-group-id="6698889278-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6698889278-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6698889278-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6698889278-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6698889278-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6698889278-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6698889278-9">}</span><span class="p" data-group-id="6698889278-6">]</span><span class="p" data-group-id="6698889278-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6698889278-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6698889278-11">}</span><span class="p" data-group-id="6698889278-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6698889278-12">(</span><span class="n">Port</span><span class="p" data-group-id="6698889278-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6698889278-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6698889278-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6698889278-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6698889278-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6698889278-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-17">[</span><span class="p" data-group-id="6698889278-18">[</span><span class="p" data-group-id="6698889278-18">]</span><span class="p" data-group-id="6698889278-17">]</span><span class="p" data-group-id="6698889278-16">)</span><span class="p" data-group-id="6698889278-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6698889278-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6698889278-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6698889278-20">(</span><span class="n">Players</span><span class="p" data-group-id="6698889278-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6698889278-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-22">[</span><span class="p" data-group-id="6698889278-22">]</span><span class="p" data-group-id="6698889278-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6698889278-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6698889278-24">(</span><span class="n">P</span><span class="p" data-group-id="6698889278-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6698889278-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-26">[</span><span class="n">P</span><span class="p" data-group-id="6698889278-26">]</span><span class="p" data-group-id="6698889278-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6698889278-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6698889278-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6698889278-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6698889278-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6698889278-29">(</span><span class="n">Player</span><span class="p" data-group-id="6698889278-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6698889278-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-31">[</span><span class="n">Player</span><span class="p" data-group-id="6698889278-31">]</span><span class="p" data-group-id="6698889278-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6698889278-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6698889278-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6698889278-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6698889278-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6698889278-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-36">[</span><span class="n">Player</span><span class="p" data-group-id="6698889278-36">]</span><span class="p" data-group-id="6698889278-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6698889278-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6698889278-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6698889278-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6698889278-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6698889278-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6698889278-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6698889278-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6698889278-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6698889278-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6698889278-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6698889278-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6698889278-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6698889278-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6698889278-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6698889278-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6698889278-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6698889278-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6698889278-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6698889278-49">(</span><span class="n">Player</span><span class="p" data-group-id="6698889278-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6698889278-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6698889278-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6698889278-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6698889278-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6698889278-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6698889278-53">(</span><span class="n">P</span><span class="p" data-group-id="6698889278-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6698889278-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6698889278-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6698889278-55">(</span><span class="n">P</span><span class="p" data-group-id="6698889278-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6698889278-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6698889278-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6698889278-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6698889278-57">(</span><span class="p" data-group-id="6698889278-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-58">{</span><span class="p" data-group-id="6698889278-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6698889278-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6698889278-60">}</span><span class="p" data-group-id="6698889278-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6698889278-61">(</span><span class="p" data-group-id="6698889278-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6698889278-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6698889278-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6698889278-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6698889278-64">]</span><span class="w">
        </span><span class="p" data-group-id="6698889278-63">)</span><span class="w">
    </span><span class="p" data-group-id="6698889278-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6698889278-65">(</span><span class="p" data-group-id="6698889278-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6698889278-66">(</span><span class="p" data-group-id="6698889278-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6698889278-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6698889278-68">]</span><span class="p" data-group-id="6698889278-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6698889278-69">(</span><span class="p" data-group-id="6698889278-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6698889278-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6698889278-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6698889278-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6698889278-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6698889278-72">(</span><span class="p" data-group-id="6698889278-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6698889278-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6698889278-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6698889278-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6698889278-76">]</span><span class="p" data-group-id="6698889278-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6698889278-78">(</span><span class="n">H</span><span class="p" data-group-id="6698889278-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6698889278-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6698889278-79">)</span><span class="p" data-group-id="6698889278-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6698889278-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6698889278-81">[</span><span class="p" data-group-id="6698889278-81">]</span><span class="p" data-group-id="6698889278-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6698889278-82">[</span><span class="p" data-group-id="6698889278-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6698889278-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6698889278-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6698889278-84">(</span><span class="p" data-group-id="6698889278-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6698889278-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6698889278-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6698889278-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6698889278-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6698889278-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6698889278-89">(</span><span class="p" data-group-id="6698889278-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6698889278-90">{</span><span class="nf">self</span><span class="p" data-group-id="6698889278-91">(</span><span class="p" data-group-id="6698889278-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6698889278-92">(</span><span class="n">X</span><span class="p" data-group-id="6698889278-92">)</span><span class="p" data-group-id="6698889278-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6698889278-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6698889278-87">]</span><span class="w">
    </span><span class="p" data-group-id="6698889278-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="arduino">
    Arduino Style (arduino)<a class="headerlink" href="#arduino" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-arduino"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">arduino_style</span><span class="p" data-group-id="0928017491-1">(</span><span class="p" data-group-id="0928017491-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="arduino-example.erl">
      example.erl<a class="headerlink" href="#arduino-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-arduino"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2823768048-1">(</span><span class="ss">test</span><span class="p" data-group-id="2823768048-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2823768048-2">(</span><span class="p" data-group-id="2823768048-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2823768048-3">]</span><span class="p" data-group-id="2823768048-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2823768048-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2823768048-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2823768048-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2823768048-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2823768048-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2823768048-9">}</span><span class="p" data-group-id="2823768048-6">]</span><span class="p" data-group-id="2823768048-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2823768048-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2823768048-11">}</span><span class="p" data-group-id="2823768048-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2823768048-12">(</span><span class="n">Port</span><span class="p" data-group-id="2823768048-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2823768048-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2823768048-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2823768048-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2823768048-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2823768048-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-17">[</span><span class="p" data-group-id="2823768048-18">[</span><span class="p" data-group-id="2823768048-18">]</span><span class="p" data-group-id="2823768048-17">]</span><span class="p" data-group-id="2823768048-16">)</span><span class="p" data-group-id="2823768048-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2823768048-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2823768048-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2823768048-20">(</span><span class="n">Players</span><span class="p" data-group-id="2823768048-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2823768048-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-22">[</span><span class="p" data-group-id="2823768048-22">]</span><span class="p" data-group-id="2823768048-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2823768048-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2823768048-24">(</span><span class="n">P</span><span class="p" data-group-id="2823768048-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2823768048-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-26">[</span><span class="n">P</span><span class="p" data-group-id="2823768048-26">]</span><span class="p" data-group-id="2823768048-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2823768048-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2823768048-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2823768048-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2823768048-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2823768048-29">(</span><span class="n">Player</span><span class="p" data-group-id="2823768048-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2823768048-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-31">[</span><span class="n">Player</span><span class="p" data-group-id="2823768048-31">]</span><span class="p" data-group-id="2823768048-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2823768048-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2823768048-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2823768048-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2823768048-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2823768048-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-36">[</span><span class="n">Player</span><span class="p" data-group-id="2823768048-36">]</span><span class="p" data-group-id="2823768048-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2823768048-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2823768048-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2823768048-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2823768048-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2823768048-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2823768048-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2823768048-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2823768048-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2823768048-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2823768048-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2823768048-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2823768048-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2823768048-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2823768048-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2823768048-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2823768048-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2823768048-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2823768048-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2823768048-49">(</span><span class="n">Player</span><span class="p" data-group-id="2823768048-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2823768048-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2823768048-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2823768048-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2823768048-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2823768048-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2823768048-53">(</span><span class="n">P</span><span class="p" data-group-id="2823768048-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2823768048-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2823768048-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2823768048-55">(</span><span class="n">P</span><span class="p" data-group-id="2823768048-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2823768048-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2823768048-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2823768048-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2823768048-57">(</span><span class="p" data-group-id="2823768048-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-58">{</span><span class="p" data-group-id="2823768048-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2823768048-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2823768048-60">}</span><span class="p" data-group-id="2823768048-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2823768048-61">(</span><span class="p" data-group-id="2823768048-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2823768048-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2823768048-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2823768048-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2823768048-64">]</span><span class="w">
        </span><span class="p" data-group-id="2823768048-63">)</span><span class="w">
    </span><span class="p" data-group-id="2823768048-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2823768048-65">(</span><span class="p" data-group-id="2823768048-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2823768048-66">(</span><span class="p" data-group-id="2823768048-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2823768048-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2823768048-68">]</span><span class="p" data-group-id="2823768048-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2823768048-69">(</span><span class="p" data-group-id="2823768048-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2823768048-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2823768048-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2823768048-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2823768048-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2823768048-72">(</span><span class="p" data-group-id="2823768048-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2823768048-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2823768048-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2823768048-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2823768048-76">]</span><span class="p" data-group-id="2823768048-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2823768048-78">(</span><span class="n">H</span><span class="p" data-group-id="2823768048-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2823768048-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2823768048-79">)</span><span class="p" data-group-id="2823768048-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2823768048-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2823768048-81">[</span><span class="p" data-group-id="2823768048-81">]</span><span class="p" data-group-id="2823768048-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2823768048-82">[</span><span class="p" data-group-id="2823768048-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2823768048-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2823768048-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2823768048-84">(</span><span class="p" data-group-id="2823768048-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2823768048-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2823768048-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2823768048-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2823768048-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2823768048-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2823768048-89">(</span><span class="p" data-group-id="2823768048-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2823768048-90">{</span><span class="nf">self</span><span class="p" data-group-id="2823768048-91">(</span><span class="p" data-group-id="2823768048-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2823768048-92">(</span><span class="n">X</span><span class="p" data-group-id="2823768048-92">)</span><span class="p" data-group-id="2823768048-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2823768048-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2823768048-87">]</span><span class="w">
    </span><span class="p" data-group-id="2823768048-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="autumn">
    Autumn Style (autumn)<a class="headerlink" href="#autumn" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-autumn"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">autumn_style</span><span class="p" data-group-id="7925318622-1">(</span><span class="p" data-group-id="7925318622-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="autumn-example.erl">
      example.erl<a class="headerlink" href="#autumn-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-autumn"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4295523614-1">(</span><span class="ss">test</span><span class="p" data-group-id="4295523614-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4295523614-2">(</span><span class="p" data-group-id="4295523614-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4295523614-3">]</span><span class="p" data-group-id="4295523614-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4295523614-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4295523614-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4295523614-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4295523614-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4295523614-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4295523614-9">}</span><span class="p" data-group-id="4295523614-6">]</span><span class="p" data-group-id="4295523614-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4295523614-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4295523614-11">}</span><span class="p" data-group-id="4295523614-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4295523614-12">(</span><span class="n">Port</span><span class="p" data-group-id="4295523614-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4295523614-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4295523614-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4295523614-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4295523614-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4295523614-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-17">[</span><span class="p" data-group-id="4295523614-18">[</span><span class="p" data-group-id="4295523614-18">]</span><span class="p" data-group-id="4295523614-17">]</span><span class="p" data-group-id="4295523614-16">)</span><span class="p" data-group-id="4295523614-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4295523614-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4295523614-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4295523614-20">(</span><span class="n">Players</span><span class="p" data-group-id="4295523614-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4295523614-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-22">[</span><span class="p" data-group-id="4295523614-22">]</span><span class="p" data-group-id="4295523614-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4295523614-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4295523614-24">(</span><span class="n">P</span><span class="p" data-group-id="4295523614-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4295523614-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-26">[</span><span class="n">P</span><span class="p" data-group-id="4295523614-26">]</span><span class="p" data-group-id="4295523614-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4295523614-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4295523614-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4295523614-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4295523614-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4295523614-29">(</span><span class="n">Player</span><span class="p" data-group-id="4295523614-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4295523614-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-31">[</span><span class="n">Player</span><span class="p" data-group-id="4295523614-31">]</span><span class="p" data-group-id="4295523614-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4295523614-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4295523614-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4295523614-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4295523614-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4295523614-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-36">[</span><span class="n">Player</span><span class="p" data-group-id="4295523614-36">]</span><span class="p" data-group-id="4295523614-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4295523614-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4295523614-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4295523614-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4295523614-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4295523614-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4295523614-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4295523614-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4295523614-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4295523614-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4295523614-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4295523614-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4295523614-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4295523614-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4295523614-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4295523614-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4295523614-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4295523614-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4295523614-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4295523614-49">(</span><span class="n">Player</span><span class="p" data-group-id="4295523614-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4295523614-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4295523614-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4295523614-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4295523614-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4295523614-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4295523614-53">(</span><span class="n">P</span><span class="p" data-group-id="4295523614-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4295523614-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4295523614-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4295523614-55">(</span><span class="n">P</span><span class="p" data-group-id="4295523614-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4295523614-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4295523614-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4295523614-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4295523614-57">(</span><span class="p" data-group-id="4295523614-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-58">{</span><span class="p" data-group-id="4295523614-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4295523614-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4295523614-60">}</span><span class="p" data-group-id="4295523614-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4295523614-61">(</span><span class="p" data-group-id="4295523614-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4295523614-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4295523614-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4295523614-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4295523614-64">]</span><span class="w">
        </span><span class="p" data-group-id="4295523614-63">)</span><span class="w">
    </span><span class="p" data-group-id="4295523614-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4295523614-65">(</span><span class="p" data-group-id="4295523614-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4295523614-66">(</span><span class="p" data-group-id="4295523614-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4295523614-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4295523614-68">]</span><span class="p" data-group-id="4295523614-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4295523614-69">(</span><span class="p" data-group-id="4295523614-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4295523614-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4295523614-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4295523614-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4295523614-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4295523614-72">(</span><span class="p" data-group-id="4295523614-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4295523614-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4295523614-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4295523614-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4295523614-76">]</span><span class="p" data-group-id="4295523614-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4295523614-78">(</span><span class="n">H</span><span class="p" data-group-id="4295523614-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4295523614-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4295523614-79">)</span><span class="p" data-group-id="4295523614-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4295523614-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295523614-81">[</span><span class="p" data-group-id="4295523614-81">]</span><span class="p" data-group-id="4295523614-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4295523614-82">[</span><span class="p" data-group-id="4295523614-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4295523614-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4295523614-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4295523614-84">(</span><span class="p" data-group-id="4295523614-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4295523614-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4295523614-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4295523614-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4295523614-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4295523614-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4295523614-89">(</span><span class="p" data-group-id="4295523614-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4295523614-90">{</span><span class="nf">self</span><span class="p" data-group-id="4295523614-91">(</span><span class="p" data-group-id="4295523614-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4295523614-92">(</span><span class="n">X</span><span class="p" data-group-id="4295523614-92">)</span><span class="p" data-group-id="4295523614-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4295523614-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4295523614-87">]</span><span class="w">
    </span><span class="p" data-group-id="4295523614-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="borland">
    Borland Style (borland)<a class="headerlink" href="#borland" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-borland"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">borland_style</span><span class="p" data-group-id="7614042449-1">(</span><span class="p" data-group-id="7614042449-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="borland-example.erl">
      example.erl<a class="headerlink" href="#borland-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-borland"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2601289068-1">(</span><span class="ss">test</span><span class="p" data-group-id="2601289068-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2601289068-2">(</span><span class="p" data-group-id="2601289068-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2601289068-3">]</span><span class="p" data-group-id="2601289068-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2601289068-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2601289068-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2601289068-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2601289068-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2601289068-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2601289068-9">}</span><span class="p" data-group-id="2601289068-6">]</span><span class="p" data-group-id="2601289068-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2601289068-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2601289068-11">}</span><span class="p" data-group-id="2601289068-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2601289068-12">(</span><span class="n">Port</span><span class="p" data-group-id="2601289068-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2601289068-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2601289068-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2601289068-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2601289068-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2601289068-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-17">[</span><span class="p" data-group-id="2601289068-18">[</span><span class="p" data-group-id="2601289068-18">]</span><span class="p" data-group-id="2601289068-17">]</span><span class="p" data-group-id="2601289068-16">)</span><span class="p" data-group-id="2601289068-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2601289068-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2601289068-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2601289068-20">(</span><span class="n">Players</span><span class="p" data-group-id="2601289068-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2601289068-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-22">[</span><span class="p" data-group-id="2601289068-22">]</span><span class="p" data-group-id="2601289068-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2601289068-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2601289068-24">(</span><span class="n">P</span><span class="p" data-group-id="2601289068-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2601289068-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-26">[</span><span class="n">P</span><span class="p" data-group-id="2601289068-26">]</span><span class="p" data-group-id="2601289068-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2601289068-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2601289068-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2601289068-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2601289068-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2601289068-29">(</span><span class="n">Player</span><span class="p" data-group-id="2601289068-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2601289068-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-31">[</span><span class="n">Player</span><span class="p" data-group-id="2601289068-31">]</span><span class="p" data-group-id="2601289068-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2601289068-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2601289068-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2601289068-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2601289068-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2601289068-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-36">[</span><span class="n">Player</span><span class="p" data-group-id="2601289068-36">]</span><span class="p" data-group-id="2601289068-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2601289068-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2601289068-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2601289068-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2601289068-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2601289068-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2601289068-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2601289068-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2601289068-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2601289068-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2601289068-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2601289068-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2601289068-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2601289068-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2601289068-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2601289068-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2601289068-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2601289068-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2601289068-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2601289068-49">(</span><span class="n">Player</span><span class="p" data-group-id="2601289068-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2601289068-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2601289068-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2601289068-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2601289068-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2601289068-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2601289068-53">(</span><span class="n">P</span><span class="p" data-group-id="2601289068-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2601289068-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2601289068-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2601289068-55">(</span><span class="n">P</span><span class="p" data-group-id="2601289068-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2601289068-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2601289068-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2601289068-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2601289068-57">(</span><span class="p" data-group-id="2601289068-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-58">{</span><span class="p" data-group-id="2601289068-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2601289068-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2601289068-60">}</span><span class="p" data-group-id="2601289068-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2601289068-61">(</span><span class="p" data-group-id="2601289068-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2601289068-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2601289068-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2601289068-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2601289068-64">]</span><span class="w">
        </span><span class="p" data-group-id="2601289068-63">)</span><span class="w">
    </span><span class="p" data-group-id="2601289068-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2601289068-65">(</span><span class="p" data-group-id="2601289068-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2601289068-66">(</span><span class="p" data-group-id="2601289068-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2601289068-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2601289068-68">]</span><span class="p" data-group-id="2601289068-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2601289068-69">(</span><span class="p" data-group-id="2601289068-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2601289068-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2601289068-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2601289068-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2601289068-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2601289068-72">(</span><span class="p" data-group-id="2601289068-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2601289068-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2601289068-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2601289068-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2601289068-76">]</span><span class="p" data-group-id="2601289068-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2601289068-78">(</span><span class="n">H</span><span class="p" data-group-id="2601289068-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2601289068-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2601289068-79">)</span><span class="p" data-group-id="2601289068-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2601289068-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2601289068-81">[</span><span class="p" data-group-id="2601289068-81">]</span><span class="p" data-group-id="2601289068-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2601289068-82">[</span><span class="p" data-group-id="2601289068-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2601289068-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2601289068-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2601289068-84">(</span><span class="p" data-group-id="2601289068-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2601289068-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2601289068-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2601289068-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2601289068-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2601289068-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2601289068-89">(</span><span class="p" data-group-id="2601289068-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2601289068-90">{</span><span class="nf">self</span><span class="p" data-group-id="2601289068-91">(</span><span class="p" data-group-id="2601289068-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2601289068-92">(</span><span class="n">X</span><span class="p" data-group-id="2601289068-92">)</span><span class="p" data-group-id="2601289068-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2601289068-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2601289068-87">]</span><span class="w">
    </span><span class="p" data-group-id="2601289068-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="bw">
    BlackWhite Style (bw)<a class="headerlink" href="#bw" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-bw"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">bw_style</span><span class="p" data-group-id="9737570554-1">(</span><span class="p" data-group-id="9737570554-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="bw-example.erl">
      example.erl<a class="headerlink" href="#bw-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-bw"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4522734006-1">(</span><span class="ss">test</span><span class="p" data-group-id="4522734006-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4522734006-2">(</span><span class="p" data-group-id="4522734006-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4522734006-3">]</span><span class="p" data-group-id="4522734006-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4522734006-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4522734006-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4522734006-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4522734006-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4522734006-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4522734006-9">}</span><span class="p" data-group-id="4522734006-6">]</span><span class="p" data-group-id="4522734006-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4522734006-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4522734006-11">}</span><span class="p" data-group-id="4522734006-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4522734006-12">(</span><span class="n">Port</span><span class="p" data-group-id="4522734006-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4522734006-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4522734006-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4522734006-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4522734006-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4522734006-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-17">[</span><span class="p" data-group-id="4522734006-18">[</span><span class="p" data-group-id="4522734006-18">]</span><span class="p" data-group-id="4522734006-17">]</span><span class="p" data-group-id="4522734006-16">)</span><span class="p" data-group-id="4522734006-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4522734006-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4522734006-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4522734006-20">(</span><span class="n">Players</span><span class="p" data-group-id="4522734006-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4522734006-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-22">[</span><span class="p" data-group-id="4522734006-22">]</span><span class="p" data-group-id="4522734006-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4522734006-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4522734006-24">(</span><span class="n">P</span><span class="p" data-group-id="4522734006-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4522734006-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-26">[</span><span class="n">P</span><span class="p" data-group-id="4522734006-26">]</span><span class="p" data-group-id="4522734006-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4522734006-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4522734006-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4522734006-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4522734006-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4522734006-29">(</span><span class="n">Player</span><span class="p" data-group-id="4522734006-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4522734006-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-31">[</span><span class="n">Player</span><span class="p" data-group-id="4522734006-31">]</span><span class="p" data-group-id="4522734006-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4522734006-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4522734006-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4522734006-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4522734006-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4522734006-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-36">[</span><span class="n">Player</span><span class="p" data-group-id="4522734006-36">]</span><span class="p" data-group-id="4522734006-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4522734006-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4522734006-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4522734006-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4522734006-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4522734006-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4522734006-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4522734006-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4522734006-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4522734006-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4522734006-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4522734006-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4522734006-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4522734006-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4522734006-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4522734006-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4522734006-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4522734006-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4522734006-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4522734006-49">(</span><span class="n">Player</span><span class="p" data-group-id="4522734006-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4522734006-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4522734006-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4522734006-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4522734006-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4522734006-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4522734006-53">(</span><span class="n">P</span><span class="p" data-group-id="4522734006-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4522734006-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4522734006-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4522734006-55">(</span><span class="n">P</span><span class="p" data-group-id="4522734006-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4522734006-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4522734006-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4522734006-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4522734006-57">(</span><span class="p" data-group-id="4522734006-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-58">{</span><span class="p" data-group-id="4522734006-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4522734006-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4522734006-60">}</span><span class="p" data-group-id="4522734006-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4522734006-61">(</span><span class="p" data-group-id="4522734006-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4522734006-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4522734006-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4522734006-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4522734006-64">]</span><span class="w">
        </span><span class="p" data-group-id="4522734006-63">)</span><span class="w">
    </span><span class="p" data-group-id="4522734006-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4522734006-65">(</span><span class="p" data-group-id="4522734006-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4522734006-66">(</span><span class="p" data-group-id="4522734006-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4522734006-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4522734006-68">]</span><span class="p" data-group-id="4522734006-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4522734006-69">(</span><span class="p" data-group-id="4522734006-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4522734006-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4522734006-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4522734006-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4522734006-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4522734006-72">(</span><span class="p" data-group-id="4522734006-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4522734006-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4522734006-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4522734006-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4522734006-76">]</span><span class="p" data-group-id="4522734006-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4522734006-78">(</span><span class="n">H</span><span class="p" data-group-id="4522734006-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4522734006-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4522734006-79">)</span><span class="p" data-group-id="4522734006-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4522734006-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4522734006-81">[</span><span class="p" data-group-id="4522734006-81">]</span><span class="p" data-group-id="4522734006-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4522734006-82">[</span><span class="p" data-group-id="4522734006-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4522734006-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4522734006-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4522734006-84">(</span><span class="p" data-group-id="4522734006-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4522734006-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4522734006-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4522734006-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4522734006-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4522734006-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4522734006-89">(</span><span class="p" data-group-id="4522734006-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4522734006-90">{</span><span class="nf">self</span><span class="p" data-group-id="4522734006-91">(</span><span class="p" data-group-id="4522734006-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4522734006-92">(</span><span class="n">X</span><span class="p" data-group-id="4522734006-92">)</span><span class="p" data-group-id="4522734006-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4522734006-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4522734006-87">]</span><span class="w">
    </span><span class="p" data-group-id="4522734006-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="colorful">
    Colorful Style (colorful)<a class="headerlink" href="#colorful" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-colorful"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">colorful_style</span><span class="p" data-group-id="0363504042-1">(</span><span class="p" data-group-id="0363504042-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="colorful-example.erl">
      example.erl<a class="headerlink" href="#colorful-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-colorful"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8364363076-1">(</span><span class="ss">test</span><span class="p" data-group-id="8364363076-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8364363076-2">(</span><span class="p" data-group-id="8364363076-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8364363076-3">]</span><span class="p" data-group-id="8364363076-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8364363076-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8364363076-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8364363076-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8364363076-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8364363076-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8364363076-9">}</span><span class="p" data-group-id="8364363076-6">]</span><span class="p" data-group-id="8364363076-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8364363076-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8364363076-11">}</span><span class="p" data-group-id="8364363076-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8364363076-12">(</span><span class="n">Port</span><span class="p" data-group-id="8364363076-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8364363076-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8364363076-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8364363076-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8364363076-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8364363076-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-17">[</span><span class="p" data-group-id="8364363076-18">[</span><span class="p" data-group-id="8364363076-18">]</span><span class="p" data-group-id="8364363076-17">]</span><span class="p" data-group-id="8364363076-16">)</span><span class="p" data-group-id="8364363076-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8364363076-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8364363076-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8364363076-20">(</span><span class="n">Players</span><span class="p" data-group-id="8364363076-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8364363076-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-22">[</span><span class="p" data-group-id="8364363076-22">]</span><span class="p" data-group-id="8364363076-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8364363076-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8364363076-24">(</span><span class="n">P</span><span class="p" data-group-id="8364363076-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8364363076-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-26">[</span><span class="n">P</span><span class="p" data-group-id="8364363076-26">]</span><span class="p" data-group-id="8364363076-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8364363076-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8364363076-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8364363076-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8364363076-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8364363076-29">(</span><span class="n">Player</span><span class="p" data-group-id="8364363076-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8364363076-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-31">[</span><span class="n">Player</span><span class="p" data-group-id="8364363076-31">]</span><span class="p" data-group-id="8364363076-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8364363076-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8364363076-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8364363076-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8364363076-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8364363076-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-36">[</span><span class="n">Player</span><span class="p" data-group-id="8364363076-36">]</span><span class="p" data-group-id="8364363076-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8364363076-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8364363076-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8364363076-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8364363076-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8364363076-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8364363076-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8364363076-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8364363076-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8364363076-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8364363076-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8364363076-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8364363076-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8364363076-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8364363076-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8364363076-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8364363076-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8364363076-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8364363076-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8364363076-49">(</span><span class="n">Player</span><span class="p" data-group-id="8364363076-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8364363076-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8364363076-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8364363076-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8364363076-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8364363076-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8364363076-53">(</span><span class="n">P</span><span class="p" data-group-id="8364363076-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8364363076-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8364363076-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8364363076-55">(</span><span class="n">P</span><span class="p" data-group-id="8364363076-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8364363076-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8364363076-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8364363076-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8364363076-57">(</span><span class="p" data-group-id="8364363076-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-58">{</span><span class="p" data-group-id="8364363076-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8364363076-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8364363076-60">}</span><span class="p" data-group-id="8364363076-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8364363076-61">(</span><span class="p" data-group-id="8364363076-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8364363076-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8364363076-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8364363076-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8364363076-64">]</span><span class="w">
        </span><span class="p" data-group-id="8364363076-63">)</span><span class="w">
    </span><span class="p" data-group-id="8364363076-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8364363076-65">(</span><span class="p" data-group-id="8364363076-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8364363076-66">(</span><span class="p" data-group-id="8364363076-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8364363076-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8364363076-68">]</span><span class="p" data-group-id="8364363076-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8364363076-69">(</span><span class="p" data-group-id="8364363076-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8364363076-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8364363076-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8364363076-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8364363076-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8364363076-72">(</span><span class="p" data-group-id="8364363076-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8364363076-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8364363076-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8364363076-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8364363076-76">]</span><span class="p" data-group-id="8364363076-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8364363076-78">(</span><span class="n">H</span><span class="p" data-group-id="8364363076-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8364363076-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8364363076-79">)</span><span class="p" data-group-id="8364363076-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8364363076-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8364363076-81">[</span><span class="p" data-group-id="8364363076-81">]</span><span class="p" data-group-id="8364363076-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8364363076-82">[</span><span class="p" data-group-id="8364363076-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8364363076-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8364363076-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8364363076-84">(</span><span class="p" data-group-id="8364363076-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8364363076-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8364363076-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8364363076-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8364363076-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8364363076-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8364363076-89">(</span><span class="p" data-group-id="8364363076-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8364363076-90">{</span><span class="nf">self</span><span class="p" data-group-id="8364363076-91">(</span><span class="p" data-group-id="8364363076-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8364363076-92">(</span><span class="n">X</span><span class="p" data-group-id="8364363076-92">)</span><span class="p" data-group-id="8364363076-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8364363076-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8364363076-87">]</span><span class="w">
    </span><span class="p" data-group-id="8364363076-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="default">
    Default Style (default)<a class="headerlink" href="#default" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-default"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">default_style</span><span class="p" data-group-id="3927321122-1">(</span><span class="p" data-group-id="3927321122-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="default-example.erl">
      example.erl<a class="headerlink" href="#default-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-default"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5507027124-1">(</span><span class="ss">test</span><span class="p" data-group-id="5507027124-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5507027124-2">(</span><span class="p" data-group-id="5507027124-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5507027124-3">]</span><span class="p" data-group-id="5507027124-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5507027124-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5507027124-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5507027124-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5507027124-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5507027124-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5507027124-9">}</span><span class="p" data-group-id="5507027124-6">]</span><span class="p" data-group-id="5507027124-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5507027124-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5507027124-11">}</span><span class="p" data-group-id="5507027124-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5507027124-12">(</span><span class="n">Port</span><span class="p" data-group-id="5507027124-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5507027124-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5507027124-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5507027124-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5507027124-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5507027124-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-17">[</span><span class="p" data-group-id="5507027124-18">[</span><span class="p" data-group-id="5507027124-18">]</span><span class="p" data-group-id="5507027124-17">]</span><span class="p" data-group-id="5507027124-16">)</span><span class="p" data-group-id="5507027124-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5507027124-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5507027124-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5507027124-20">(</span><span class="n">Players</span><span class="p" data-group-id="5507027124-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5507027124-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-22">[</span><span class="p" data-group-id="5507027124-22">]</span><span class="p" data-group-id="5507027124-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5507027124-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5507027124-24">(</span><span class="n">P</span><span class="p" data-group-id="5507027124-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5507027124-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-26">[</span><span class="n">P</span><span class="p" data-group-id="5507027124-26">]</span><span class="p" data-group-id="5507027124-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5507027124-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5507027124-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5507027124-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5507027124-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5507027124-29">(</span><span class="n">Player</span><span class="p" data-group-id="5507027124-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5507027124-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-31">[</span><span class="n">Player</span><span class="p" data-group-id="5507027124-31">]</span><span class="p" data-group-id="5507027124-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5507027124-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5507027124-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5507027124-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5507027124-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5507027124-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-36">[</span><span class="n">Player</span><span class="p" data-group-id="5507027124-36">]</span><span class="p" data-group-id="5507027124-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5507027124-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5507027124-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5507027124-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5507027124-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5507027124-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5507027124-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5507027124-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5507027124-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5507027124-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5507027124-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5507027124-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5507027124-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5507027124-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5507027124-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5507027124-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5507027124-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5507027124-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5507027124-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5507027124-49">(</span><span class="n">Player</span><span class="p" data-group-id="5507027124-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5507027124-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5507027124-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5507027124-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5507027124-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5507027124-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5507027124-53">(</span><span class="n">P</span><span class="p" data-group-id="5507027124-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5507027124-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5507027124-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5507027124-55">(</span><span class="n">P</span><span class="p" data-group-id="5507027124-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5507027124-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5507027124-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5507027124-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5507027124-57">(</span><span class="p" data-group-id="5507027124-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-58">{</span><span class="p" data-group-id="5507027124-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5507027124-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5507027124-60">}</span><span class="p" data-group-id="5507027124-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5507027124-61">(</span><span class="p" data-group-id="5507027124-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5507027124-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5507027124-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5507027124-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5507027124-64">]</span><span class="w">
        </span><span class="p" data-group-id="5507027124-63">)</span><span class="w">
    </span><span class="p" data-group-id="5507027124-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5507027124-65">(</span><span class="p" data-group-id="5507027124-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5507027124-66">(</span><span class="p" data-group-id="5507027124-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5507027124-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5507027124-68">]</span><span class="p" data-group-id="5507027124-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5507027124-69">(</span><span class="p" data-group-id="5507027124-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5507027124-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5507027124-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5507027124-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5507027124-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5507027124-72">(</span><span class="p" data-group-id="5507027124-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5507027124-74">{</span><span class="ss">fff</span><span class="p" data-group-id="5507027124-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5507027124-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5507027124-76">]</span><span class="p" data-group-id="5507027124-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-77">[</span><span class="n">Fun</span><span class="p" data-group-id="5507027124-78">(</span><span class="n">H</span><span class="p" data-group-id="5507027124-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5507027124-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5507027124-79">)</span><span class="p" data-group-id="5507027124-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5507027124-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5507027124-81">[</span><span class="p" data-group-id="5507027124-81">]</span><span class="p" data-group-id="5507027124-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5507027124-82">[</span><span class="p" data-group-id="5507027124-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5507027124-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5507027124-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5507027124-84">(</span><span class="p" data-group-id="5507027124-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5507027124-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5507027124-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5507027124-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5507027124-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5507027124-88">(</span><span class="nf">fun</span><span class="p" data-group-id="5507027124-89">(</span><span class="p" data-group-id="5507027124-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5507027124-90">{</span><span class="nf">self</span><span class="p" data-group-id="5507027124-91">(</span><span class="p" data-group-id="5507027124-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5507027124-92">(</span><span class="n">X</span><span class="p" data-group-id="5507027124-92">)</span><span class="p" data-group-id="5507027124-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5507027124-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5507027124-87">]</span><span class="w">
    </span><span class="p" data-group-id="5507027124-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="emacs">
    Emacs Style (emacs)<a class="headerlink" href="#emacs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-emacs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">emacs_style</span><span class="p" data-group-id="6656494032-1">(</span><span class="p" data-group-id="6656494032-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="emacs-example.erl">
      example.erl<a class="headerlink" href="#emacs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-emacs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8316591978-1">(</span><span class="ss">test</span><span class="p" data-group-id="8316591978-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8316591978-2">(</span><span class="p" data-group-id="8316591978-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8316591978-3">]</span><span class="p" data-group-id="8316591978-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8316591978-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8316591978-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8316591978-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8316591978-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8316591978-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8316591978-9">}</span><span class="p" data-group-id="8316591978-6">]</span><span class="p" data-group-id="8316591978-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8316591978-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8316591978-11">}</span><span class="p" data-group-id="8316591978-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8316591978-12">(</span><span class="n">Port</span><span class="p" data-group-id="8316591978-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8316591978-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8316591978-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8316591978-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8316591978-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8316591978-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-17">[</span><span class="p" data-group-id="8316591978-18">[</span><span class="p" data-group-id="8316591978-18">]</span><span class="p" data-group-id="8316591978-17">]</span><span class="p" data-group-id="8316591978-16">)</span><span class="p" data-group-id="8316591978-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8316591978-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8316591978-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8316591978-20">(</span><span class="n">Players</span><span class="p" data-group-id="8316591978-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8316591978-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-22">[</span><span class="p" data-group-id="8316591978-22">]</span><span class="p" data-group-id="8316591978-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8316591978-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8316591978-24">(</span><span class="n">P</span><span class="p" data-group-id="8316591978-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8316591978-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-26">[</span><span class="n">P</span><span class="p" data-group-id="8316591978-26">]</span><span class="p" data-group-id="8316591978-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8316591978-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8316591978-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8316591978-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8316591978-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8316591978-29">(</span><span class="n">Player</span><span class="p" data-group-id="8316591978-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8316591978-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-31">[</span><span class="n">Player</span><span class="p" data-group-id="8316591978-31">]</span><span class="p" data-group-id="8316591978-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8316591978-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8316591978-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8316591978-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8316591978-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8316591978-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-36">[</span><span class="n">Player</span><span class="p" data-group-id="8316591978-36">]</span><span class="p" data-group-id="8316591978-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8316591978-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8316591978-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8316591978-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8316591978-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8316591978-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8316591978-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8316591978-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8316591978-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8316591978-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8316591978-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8316591978-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8316591978-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8316591978-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8316591978-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8316591978-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8316591978-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8316591978-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8316591978-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8316591978-49">(</span><span class="n">Player</span><span class="p" data-group-id="8316591978-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8316591978-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8316591978-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8316591978-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8316591978-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8316591978-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8316591978-53">(</span><span class="n">P</span><span class="p" data-group-id="8316591978-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8316591978-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8316591978-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8316591978-55">(</span><span class="n">P</span><span class="p" data-group-id="8316591978-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8316591978-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8316591978-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8316591978-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8316591978-57">(</span><span class="p" data-group-id="8316591978-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-58">{</span><span class="p" data-group-id="8316591978-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8316591978-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8316591978-60">}</span><span class="p" data-group-id="8316591978-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8316591978-61">(</span><span class="p" data-group-id="8316591978-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8316591978-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8316591978-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8316591978-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8316591978-64">]</span><span class="w">
        </span><span class="p" data-group-id="8316591978-63">)</span><span class="w">
    </span><span class="p" data-group-id="8316591978-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8316591978-65">(</span><span class="p" data-group-id="8316591978-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8316591978-66">(</span><span class="p" data-group-id="8316591978-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8316591978-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8316591978-68">]</span><span class="p" data-group-id="8316591978-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8316591978-69">(</span><span class="p" data-group-id="8316591978-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8316591978-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8316591978-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8316591978-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8316591978-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8316591978-72">(</span><span class="p" data-group-id="8316591978-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8316591978-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8316591978-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8316591978-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8316591978-76">]</span><span class="p" data-group-id="8316591978-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8316591978-78">(</span><span class="n">H</span><span class="p" data-group-id="8316591978-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8316591978-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8316591978-79">)</span><span class="p" data-group-id="8316591978-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8316591978-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8316591978-81">[</span><span class="p" data-group-id="8316591978-81">]</span><span class="p" data-group-id="8316591978-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8316591978-82">[</span><span class="p" data-group-id="8316591978-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8316591978-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8316591978-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8316591978-84">(</span><span class="p" data-group-id="8316591978-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8316591978-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8316591978-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8316591978-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8316591978-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8316591978-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8316591978-89">(</span><span class="p" data-group-id="8316591978-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8316591978-90">{</span><span class="nf">self</span><span class="p" data-group-id="8316591978-91">(</span><span class="p" data-group-id="8316591978-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8316591978-92">(</span><span class="n">X</span><span class="p" data-group-id="8316591978-92">)</span><span class="p" data-group-id="8316591978-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8316591978-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8316591978-87">]</span><span class="w">
    </span><span class="p" data-group-id="8316591978-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="friendly">
    Friendly Style (friendly)<a class="headerlink" href="#friendly" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-friendly"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">friendly_style</span><span class="p" data-group-id="0762740266-1">(</span><span class="p" data-group-id="0762740266-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="friendly-example.erl">
      example.erl<a class="headerlink" href="#friendly-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-friendly"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4825700896-1">(</span><span class="ss">test</span><span class="p" data-group-id="4825700896-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4825700896-2">(</span><span class="p" data-group-id="4825700896-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4825700896-3">]</span><span class="p" data-group-id="4825700896-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4825700896-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4825700896-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4825700896-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4825700896-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4825700896-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4825700896-9">}</span><span class="p" data-group-id="4825700896-6">]</span><span class="p" data-group-id="4825700896-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4825700896-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4825700896-11">}</span><span class="p" data-group-id="4825700896-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4825700896-12">(</span><span class="n">Port</span><span class="p" data-group-id="4825700896-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4825700896-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4825700896-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4825700896-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4825700896-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4825700896-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-17">[</span><span class="p" data-group-id="4825700896-18">[</span><span class="p" data-group-id="4825700896-18">]</span><span class="p" data-group-id="4825700896-17">]</span><span class="p" data-group-id="4825700896-16">)</span><span class="p" data-group-id="4825700896-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4825700896-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4825700896-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4825700896-20">(</span><span class="n">Players</span><span class="p" data-group-id="4825700896-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4825700896-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-22">[</span><span class="p" data-group-id="4825700896-22">]</span><span class="p" data-group-id="4825700896-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4825700896-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4825700896-24">(</span><span class="n">P</span><span class="p" data-group-id="4825700896-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4825700896-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-26">[</span><span class="n">P</span><span class="p" data-group-id="4825700896-26">]</span><span class="p" data-group-id="4825700896-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4825700896-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4825700896-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4825700896-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4825700896-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4825700896-29">(</span><span class="n">Player</span><span class="p" data-group-id="4825700896-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4825700896-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-31">[</span><span class="n">Player</span><span class="p" data-group-id="4825700896-31">]</span><span class="p" data-group-id="4825700896-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4825700896-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4825700896-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4825700896-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4825700896-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4825700896-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-36">[</span><span class="n">Player</span><span class="p" data-group-id="4825700896-36">]</span><span class="p" data-group-id="4825700896-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4825700896-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4825700896-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4825700896-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4825700896-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4825700896-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4825700896-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4825700896-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4825700896-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4825700896-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4825700896-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4825700896-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4825700896-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4825700896-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4825700896-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4825700896-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4825700896-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4825700896-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4825700896-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4825700896-49">(</span><span class="n">Player</span><span class="p" data-group-id="4825700896-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4825700896-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4825700896-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4825700896-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4825700896-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4825700896-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4825700896-53">(</span><span class="n">P</span><span class="p" data-group-id="4825700896-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4825700896-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4825700896-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4825700896-55">(</span><span class="n">P</span><span class="p" data-group-id="4825700896-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4825700896-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4825700896-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4825700896-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4825700896-57">(</span><span class="p" data-group-id="4825700896-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-58">{</span><span class="p" data-group-id="4825700896-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4825700896-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4825700896-60">}</span><span class="p" data-group-id="4825700896-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4825700896-61">(</span><span class="p" data-group-id="4825700896-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4825700896-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4825700896-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4825700896-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4825700896-64">]</span><span class="w">
        </span><span class="p" data-group-id="4825700896-63">)</span><span class="w">
    </span><span class="p" data-group-id="4825700896-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4825700896-65">(</span><span class="p" data-group-id="4825700896-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4825700896-66">(</span><span class="p" data-group-id="4825700896-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4825700896-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4825700896-68">]</span><span class="p" data-group-id="4825700896-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4825700896-69">(</span><span class="p" data-group-id="4825700896-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4825700896-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4825700896-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4825700896-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4825700896-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4825700896-72">(</span><span class="p" data-group-id="4825700896-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4825700896-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4825700896-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4825700896-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4825700896-76">]</span><span class="p" data-group-id="4825700896-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4825700896-78">(</span><span class="n">H</span><span class="p" data-group-id="4825700896-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4825700896-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4825700896-79">)</span><span class="p" data-group-id="4825700896-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4825700896-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4825700896-81">[</span><span class="p" data-group-id="4825700896-81">]</span><span class="p" data-group-id="4825700896-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4825700896-82">[</span><span class="p" data-group-id="4825700896-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4825700896-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4825700896-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4825700896-84">(</span><span class="p" data-group-id="4825700896-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4825700896-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4825700896-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4825700896-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4825700896-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4825700896-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4825700896-89">(</span><span class="p" data-group-id="4825700896-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4825700896-90">{</span><span class="nf">self</span><span class="p" data-group-id="4825700896-91">(</span><span class="p" data-group-id="4825700896-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4825700896-92">(</span><span class="n">X</span><span class="p" data-group-id="4825700896-92">)</span><span class="p" data-group-id="4825700896-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4825700896-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4825700896-87">]</span><span class="w">
    </span><span class="p" data-group-id="4825700896-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="fruity">
    Fruity Style (fruity)<a class="headerlink" href="#fruity" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-fruity"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">fruity_style</span><span class="p" data-group-id="6650671589-1">(</span><span class="p" data-group-id="6650671589-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="fruity-example.erl">
      example.erl<a class="headerlink" href="#fruity-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-fruity"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4206042922-1">(</span><span class="ss">test</span><span class="p" data-group-id="4206042922-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4206042922-2">(</span><span class="p" data-group-id="4206042922-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4206042922-3">]</span><span class="p" data-group-id="4206042922-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4206042922-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4206042922-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4206042922-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4206042922-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4206042922-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4206042922-9">}</span><span class="p" data-group-id="4206042922-6">]</span><span class="p" data-group-id="4206042922-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4206042922-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4206042922-11">}</span><span class="p" data-group-id="4206042922-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4206042922-12">(</span><span class="n">Port</span><span class="p" data-group-id="4206042922-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4206042922-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4206042922-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4206042922-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4206042922-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4206042922-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-17">[</span><span class="p" data-group-id="4206042922-18">[</span><span class="p" data-group-id="4206042922-18">]</span><span class="p" data-group-id="4206042922-17">]</span><span class="p" data-group-id="4206042922-16">)</span><span class="p" data-group-id="4206042922-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4206042922-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4206042922-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4206042922-20">(</span><span class="n">Players</span><span class="p" data-group-id="4206042922-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4206042922-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-22">[</span><span class="p" data-group-id="4206042922-22">]</span><span class="p" data-group-id="4206042922-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4206042922-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4206042922-24">(</span><span class="n">P</span><span class="p" data-group-id="4206042922-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4206042922-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-26">[</span><span class="n">P</span><span class="p" data-group-id="4206042922-26">]</span><span class="p" data-group-id="4206042922-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4206042922-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4206042922-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4206042922-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4206042922-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4206042922-29">(</span><span class="n">Player</span><span class="p" data-group-id="4206042922-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4206042922-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-31">[</span><span class="n">Player</span><span class="p" data-group-id="4206042922-31">]</span><span class="p" data-group-id="4206042922-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4206042922-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4206042922-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4206042922-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4206042922-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4206042922-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-36">[</span><span class="n">Player</span><span class="p" data-group-id="4206042922-36">]</span><span class="p" data-group-id="4206042922-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4206042922-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4206042922-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4206042922-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4206042922-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4206042922-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4206042922-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4206042922-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4206042922-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4206042922-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4206042922-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4206042922-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4206042922-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4206042922-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4206042922-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4206042922-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4206042922-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4206042922-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4206042922-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4206042922-49">(</span><span class="n">Player</span><span class="p" data-group-id="4206042922-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4206042922-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4206042922-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4206042922-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4206042922-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4206042922-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4206042922-53">(</span><span class="n">P</span><span class="p" data-group-id="4206042922-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4206042922-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4206042922-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4206042922-55">(</span><span class="n">P</span><span class="p" data-group-id="4206042922-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4206042922-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4206042922-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4206042922-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4206042922-57">(</span><span class="p" data-group-id="4206042922-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-58">{</span><span class="p" data-group-id="4206042922-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4206042922-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4206042922-60">}</span><span class="p" data-group-id="4206042922-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4206042922-61">(</span><span class="p" data-group-id="4206042922-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4206042922-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4206042922-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4206042922-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4206042922-64">]</span><span class="w">
        </span><span class="p" data-group-id="4206042922-63">)</span><span class="w">
    </span><span class="p" data-group-id="4206042922-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4206042922-65">(</span><span class="p" data-group-id="4206042922-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4206042922-66">(</span><span class="p" data-group-id="4206042922-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4206042922-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4206042922-68">]</span><span class="p" data-group-id="4206042922-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4206042922-69">(</span><span class="p" data-group-id="4206042922-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4206042922-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4206042922-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4206042922-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4206042922-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4206042922-72">(</span><span class="p" data-group-id="4206042922-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4206042922-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4206042922-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4206042922-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4206042922-76">]</span><span class="p" data-group-id="4206042922-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4206042922-78">(</span><span class="n">H</span><span class="p" data-group-id="4206042922-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4206042922-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4206042922-79">)</span><span class="p" data-group-id="4206042922-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4206042922-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4206042922-81">[</span><span class="p" data-group-id="4206042922-81">]</span><span class="p" data-group-id="4206042922-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4206042922-82">[</span><span class="p" data-group-id="4206042922-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4206042922-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4206042922-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4206042922-84">(</span><span class="p" data-group-id="4206042922-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4206042922-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4206042922-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4206042922-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4206042922-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4206042922-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4206042922-89">(</span><span class="p" data-group-id="4206042922-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4206042922-90">{</span><span class="nf">self</span><span class="p" data-group-id="4206042922-91">(</span><span class="p" data-group-id="4206042922-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4206042922-92">(</span><span class="n">X</span><span class="p" data-group-id="4206042922-92">)</span><span class="p" data-group-id="4206042922-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4206042922-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4206042922-87">]</span><span class="w">
    </span><span class="p" data-group-id="4206042922-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="igor">
    Igor Style (igor)<a class="headerlink" href="#igor" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-igor"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">igor_style</span><span class="p" data-group-id="6635958041-1">(</span><span class="p" data-group-id="6635958041-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="igor-example.erl">
      example.erl<a class="headerlink" href="#igor-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-igor"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="3215731820-1">(</span><span class="ss">test</span><span class="p" data-group-id="3215731820-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="3215731820-2">(</span><span class="p" data-group-id="3215731820-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="3215731820-3">]</span><span class="p" data-group-id="3215731820-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="3215731820-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="3215731820-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="3215731820-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3215731820-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3215731820-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3215731820-9">}</span><span class="p" data-group-id="3215731820-6">]</span><span class="p" data-group-id="3215731820-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="3215731820-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="3215731820-11">}</span><span class="p" data-group-id="3215731820-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="3215731820-12">(</span><span class="n">Port</span><span class="p" data-group-id="3215731820-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="3215731820-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="3215731820-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="3215731820-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="3215731820-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="3215731820-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-17">[</span><span class="p" data-group-id="3215731820-18">[</span><span class="p" data-group-id="3215731820-18">]</span><span class="p" data-group-id="3215731820-17">]</span><span class="p" data-group-id="3215731820-16">)</span><span class="p" data-group-id="3215731820-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="3215731820-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="3215731820-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="3215731820-20">(</span><span class="n">Players</span><span class="p" data-group-id="3215731820-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3215731820-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-22">[</span><span class="p" data-group-id="3215731820-22">]</span><span class="p" data-group-id="3215731820-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3215731820-23">(</span><span class="nf">fun</span><span class="p" data-group-id="3215731820-24">(</span><span class="n">P</span><span class="p" data-group-id="3215731820-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3215731820-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-26">[</span><span class="n">P</span><span class="p" data-group-id="3215731820-26">]</span><span class="p" data-group-id="3215731820-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="3215731820-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3215731820-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="3215731820-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="3215731820-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3215731820-29">(</span><span class="n">Player</span><span class="p" data-group-id="3215731820-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3215731820-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-31">[</span><span class="n">Player</span><span class="p" data-group-id="3215731820-31">]</span><span class="p" data-group-id="3215731820-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3215731820-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3215731820-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="3215731820-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3215731820-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3215731820-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-36">[</span><span class="n">Player</span><span class="p" data-group-id="3215731820-36">]</span><span class="p" data-group-id="3215731820-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="3215731820-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="3215731820-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3215731820-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3215731820-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="3215731820-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3215731820-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="3215731820-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="3215731820-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="3215731820-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="3215731820-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="3215731820-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="3215731820-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="3215731820-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="3215731820-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="3215731820-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="3215731820-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="3215731820-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="3215731820-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="3215731820-49">(</span><span class="n">Player</span><span class="p" data-group-id="3215731820-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3215731820-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="3215731820-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="3215731820-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3215731820-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="3215731820-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3215731820-53">(</span><span class="n">P</span><span class="p" data-group-id="3215731820-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="3215731820-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="3215731820-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="3215731820-55">(</span><span class="n">P</span><span class="p" data-group-id="3215731820-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="3215731820-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3215731820-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="3215731820-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="3215731820-57">(</span><span class="p" data-group-id="3215731820-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-58">{</span><span class="p" data-group-id="3215731820-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="3215731820-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3215731820-60">}</span><span class="p" data-group-id="3215731820-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="3215731820-61">(</span><span class="p" data-group-id="3215731820-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="3215731820-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="3215731820-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="3215731820-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="3215731820-64">]</span><span class="w">
        </span><span class="p" data-group-id="3215731820-63">)</span><span class="w">
    </span><span class="p" data-group-id="3215731820-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="3215731820-65">(</span><span class="p" data-group-id="3215731820-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="3215731820-66">(</span><span class="p" data-group-id="3215731820-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3215731820-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="3215731820-68">]</span><span class="p" data-group-id="3215731820-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="3215731820-69">(</span><span class="p" data-group-id="3215731820-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3215731820-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3215731820-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="3215731820-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="3215731820-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="3215731820-72">(</span><span class="p" data-group-id="3215731820-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="3215731820-74">{</span><span class="ss">fff</span><span class="p" data-group-id="3215731820-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="3215731820-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3215731820-76">]</span><span class="p" data-group-id="3215731820-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-77">[</span><span class="n">Fun</span><span class="p" data-group-id="3215731820-78">(</span><span class="n">H</span><span class="p" data-group-id="3215731820-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="3215731820-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="3215731820-79">)</span><span class="p" data-group-id="3215731820-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="3215731820-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3215731820-81">[</span><span class="p" data-group-id="3215731820-81">]</span><span class="p" data-group-id="3215731820-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="3215731820-82">[</span><span class="p" data-group-id="3215731820-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="3215731820-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="3215731820-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="3215731820-84">(</span><span class="p" data-group-id="3215731820-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3215731820-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="3215731820-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="3215731820-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3215731820-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="3215731820-88">(</span><span class="nf">fun</span><span class="p" data-group-id="3215731820-89">(</span><span class="p" data-group-id="3215731820-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="3215731820-90">{</span><span class="nf">self</span><span class="p" data-group-id="3215731820-91">(</span><span class="p" data-group-id="3215731820-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="3215731820-92">(</span><span class="n">X</span><span class="p" data-group-id="3215731820-92">)</span><span class="p" data-group-id="3215731820-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="3215731820-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="3215731820-87">]</span><span class="w">
    </span><span class="p" data-group-id="3215731820-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="lovelace">
    Lovelace Style (lovelace)<a class="headerlink" href="#lovelace" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-lovelace"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">lovelace_style</span><span class="p" data-group-id="0176706516-1">(</span><span class="p" data-group-id="0176706516-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="lovelace-example.erl">
      example.erl<a class="headerlink" href="#lovelace-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-lovelace"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7173648160-1">(</span><span class="ss">test</span><span class="p" data-group-id="7173648160-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7173648160-2">(</span><span class="p" data-group-id="7173648160-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7173648160-3">]</span><span class="p" data-group-id="7173648160-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7173648160-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7173648160-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7173648160-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7173648160-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7173648160-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7173648160-9">}</span><span class="p" data-group-id="7173648160-6">]</span><span class="p" data-group-id="7173648160-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7173648160-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7173648160-11">}</span><span class="p" data-group-id="7173648160-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7173648160-12">(</span><span class="n">Port</span><span class="p" data-group-id="7173648160-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7173648160-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7173648160-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7173648160-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7173648160-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7173648160-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-17">[</span><span class="p" data-group-id="7173648160-18">[</span><span class="p" data-group-id="7173648160-18">]</span><span class="p" data-group-id="7173648160-17">]</span><span class="p" data-group-id="7173648160-16">)</span><span class="p" data-group-id="7173648160-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7173648160-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7173648160-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7173648160-20">(</span><span class="n">Players</span><span class="p" data-group-id="7173648160-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7173648160-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-22">[</span><span class="p" data-group-id="7173648160-22">]</span><span class="p" data-group-id="7173648160-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7173648160-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7173648160-24">(</span><span class="n">P</span><span class="p" data-group-id="7173648160-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7173648160-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-26">[</span><span class="n">P</span><span class="p" data-group-id="7173648160-26">]</span><span class="p" data-group-id="7173648160-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7173648160-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7173648160-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7173648160-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7173648160-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7173648160-29">(</span><span class="n">Player</span><span class="p" data-group-id="7173648160-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7173648160-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-31">[</span><span class="n">Player</span><span class="p" data-group-id="7173648160-31">]</span><span class="p" data-group-id="7173648160-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7173648160-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7173648160-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7173648160-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7173648160-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7173648160-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-36">[</span><span class="n">Player</span><span class="p" data-group-id="7173648160-36">]</span><span class="p" data-group-id="7173648160-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7173648160-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7173648160-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7173648160-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7173648160-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7173648160-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7173648160-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7173648160-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7173648160-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7173648160-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7173648160-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7173648160-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7173648160-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7173648160-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7173648160-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7173648160-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7173648160-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7173648160-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7173648160-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7173648160-49">(</span><span class="n">Player</span><span class="p" data-group-id="7173648160-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7173648160-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7173648160-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7173648160-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7173648160-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7173648160-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7173648160-53">(</span><span class="n">P</span><span class="p" data-group-id="7173648160-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7173648160-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7173648160-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7173648160-55">(</span><span class="n">P</span><span class="p" data-group-id="7173648160-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7173648160-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7173648160-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7173648160-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7173648160-57">(</span><span class="p" data-group-id="7173648160-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-58">{</span><span class="p" data-group-id="7173648160-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7173648160-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7173648160-60">}</span><span class="p" data-group-id="7173648160-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7173648160-61">(</span><span class="p" data-group-id="7173648160-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7173648160-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7173648160-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7173648160-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7173648160-64">]</span><span class="w">
        </span><span class="p" data-group-id="7173648160-63">)</span><span class="w">
    </span><span class="p" data-group-id="7173648160-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7173648160-65">(</span><span class="p" data-group-id="7173648160-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7173648160-66">(</span><span class="p" data-group-id="7173648160-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7173648160-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7173648160-68">]</span><span class="p" data-group-id="7173648160-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7173648160-69">(</span><span class="p" data-group-id="7173648160-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7173648160-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7173648160-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7173648160-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7173648160-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7173648160-72">(</span><span class="p" data-group-id="7173648160-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7173648160-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7173648160-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7173648160-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7173648160-76">]</span><span class="p" data-group-id="7173648160-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7173648160-78">(</span><span class="n">H</span><span class="p" data-group-id="7173648160-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7173648160-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7173648160-79">)</span><span class="p" data-group-id="7173648160-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7173648160-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7173648160-81">[</span><span class="p" data-group-id="7173648160-81">]</span><span class="p" data-group-id="7173648160-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7173648160-82">[</span><span class="p" data-group-id="7173648160-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7173648160-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7173648160-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7173648160-84">(</span><span class="p" data-group-id="7173648160-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7173648160-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7173648160-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7173648160-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7173648160-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7173648160-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7173648160-89">(</span><span class="p" data-group-id="7173648160-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7173648160-90">{</span><span class="nf">self</span><span class="p" data-group-id="7173648160-91">(</span><span class="p" data-group-id="7173648160-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7173648160-92">(</span><span class="n">X</span><span class="p" data-group-id="7173648160-92">)</span><span class="p" data-group-id="7173648160-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7173648160-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7173648160-87">]</span><span class="w">
    </span><span class="p" data-group-id="7173648160-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="manni">
    Manni Style (manni)<a class="headerlink" href="#manni" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-manni"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">manni_style</span><span class="p" data-group-id="4559259384-1">(</span><span class="p" data-group-id="4559259384-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="manni-example.erl">
      example.erl<a class="headerlink" href="#manni-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-manni"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6513336392-1">(</span><span class="ss">test</span><span class="p" data-group-id="6513336392-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6513336392-2">(</span><span class="p" data-group-id="6513336392-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6513336392-3">]</span><span class="p" data-group-id="6513336392-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6513336392-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6513336392-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6513336392-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6513336392-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6513336392-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6513336392-9">}</span><span class="p" data-group-id="6513336392-6">]</span><span class="p" data-group-id="6513336392-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6513336392-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6513336392-11">}</span><span class="p" data-group-id="6513336392-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6513336392-12">(</span><span class="n">Port</span><span class="p" data-group-id="6513336392-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6513336392-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6513336392-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6513336392-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6513336392-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6513336392-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-17">[</span><span class="p" data-group-id="6513336392-18">[</span><span class="p" data-group-id="6513336392-18">]</span><span class="p" data-group-id="6513336392-17">]</span><span class="p" data-group-id="6513336392-16">)</span><span class="p" data-group-id="6513336392-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6513336392-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6513336392-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6513336392-20">(</span><span class="n">Players</span><span class="p" data-group-id="6513336392-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6513336392-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-22">[</span><span class="p" data-group-id="6513336392-22">]</span><span class="p" data-group-id="6513336392-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6513336392-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6513336392-24">(</span><span class="n">P</span><span class="p" data-group-id="6513336392-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6513336392-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-26">[</span><span class="n">P</span><span class="p" data-group-id="6513336392-26">]</span><span class="p" data-group-id="6513336392-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6513336392-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6513336392-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6513336392-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6513336392-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6513336392-29">(</span><span class="n">Player</span><span class="p" data-group-id="6513336392-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6513336392-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-31">[</span><span class="n">Player</span><span class="p" data-group-id="6513336392-31">]</span><span class="p" data-group-id="6513336392-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6513336392-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6513336392-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6513336392-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6513336392-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6513336392-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-36">[</span><span class="n">Player</span><span class="p" data-group-id="6513336392-36">]</span><span class="p" data-group-id="6513336392-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6513336392-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6513336392-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6513336392-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6513336392-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6513336392-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6513336392-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6513336392-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6513336392-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6513336392-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6513336392-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6513336392-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6513336392-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6513336392-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6513336392-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6513336392-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6513336392-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6513336392-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6513336392-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6513336392-49">(</span><span class="n">Player</span><span class="p" data-group-id="6513336392-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6513336392-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6513336392-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6513336392-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6513336392-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6513336392-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6513336392-53">(</span><span class="n">P</span><span class="p" data-group-id="6513336392-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6513336392-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6513336392-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6513336392-55">(</span><span class="n">P</span><span class="p" data-group-id="6513336392-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6513336392-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6513336392-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6513336392-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6513336392-57">(</span><span class="p" data-group-id="6513336392-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-58">{</span><span class="p" data-group-id="6513336392-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6513336392-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6513336392-60">}</span><span class="p" data-group-id="6513336392-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6513336392-61">(</span><span class="p" data-group-id="6513336392-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6513336392-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6513336392-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6513336392-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6513336392-64">]</span><span class="w">
        </span><span class="p" data-group-id="6513336392-63">)</span><span class="w">
    </span><span class="p" data-group-id="6513336392-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6513336392-65">(</span><span class="p" data-group-id="6513336392-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6513336392-66">(</span><span class="p" data-group-id="6513336392-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6513336392-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6513336392-68">]</span><span class="p" data-group-id="6513336392-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6513336392-69">(</span><span class="p" data-group-id="6513336392-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6513336392-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6513336392-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6513336392-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6513336392-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6513336392-72">(</span><span class="p" data-group-id="6513336392-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6513336392-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6513336392-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6513336392-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6513336392-76">]</span><span class="p" data-group-id="6513336392-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6513336392-78">(</span><span class="n">H</span><span class="p" data-group-id="6513336392-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6513336392-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6513336392-79">)</span><span class="p" data-group-id="6513336392-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6513336392-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6513336392-81">[</span><span class="p" data-group-id="6513336392-81">]</span><span class="p" data-group-id="6513336392-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6513336392-82">[</span><span class="p" data-group-id="6513336392-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6513336392-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6513336392-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6513336392-84">(</span><span class="p" data-group-id="6513336392-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6513336392-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6513336392-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6513336392-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6513336392-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6513336392-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6513336392-89">(</span><span class="p" data-group-id="6513336392-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6513336392-90">{</span><span class="nf">self</span><span class="p" data-group-id="6513336392-91">(</span><span class="p" data-group-id="6513336392-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6513336392-92">(</span><span class="n">X</span><span class="p" data-group-id="6513336392-92">)</span><span class="p" data-group-id="6513336392-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6513336392-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6513336392-87">]</span><span class="w">
    </span><span class="p" data-group-id="6513336392-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="monokai">
    Monokai Style (monokai)<a class="headerlink" href="#monokai" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-monokai"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">monokai_style</span><span class="p" data-group-id="9321731919-1">(</span><span class="p" data-group-id="9321731919-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="monokai-example.erl">
      example.erl<a class="headerlink" href="#monokai-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-monokai"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9138002726-1">(</span><span class="ss">test</span><span class="p" data-group-id="9138002726-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9138002726-2">(</span><span class="p" data-group-id="9138002726-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9138002726-3">]</span><span class="p" data-group-id="9138002726-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9138002726-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9138002726-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9138002726-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9138002726-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9138002726-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9138002726-9">}</span><span class="p" data-group-id="9138002726-6">]</span><span class="p" data-group-id="9138002726-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9138002726-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9138002726-11">}</span><span class="p" data-group-id="9138002726-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9138002726-12">(</span><span class="n">Port</span><span class="p" data-group-id="9138002726-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9138002726-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9138002726-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9138002726-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9138002726-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9138002726-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-17">[</span><span class="p" data-group-id="9138002726-18">[</span><span class="p" data-group-id="9138002726-18">]</span><span class="p" data-group-id="9138002726-17">]</span><span class="p" data-group-id="9138002726-16">)</span><span class="p" data-group-id="9138002726-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9138002726-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9138002726-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9138002726-20">(</span><span class="n">Players</span><span class="p" data-group-id="9138002726-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9138002726-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-22">[</span><span class="p" data-group-id="9138002726-22">]</span><span class="p" data-group-id="9138002726-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9138002726-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9138002726-24">(</span><span class="n">P</span><span class="p" data-group-id="9138002726-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9138002726-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-26">[</span><span class="n">P</span><span class="p" data-group-id="9138002726-26">]</span><span class="p" data-group-id="9138002726-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9138002726-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9138002726-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9138002726-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9138002726-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9138002726-29">(</span><span class="n">Player</span><span class="p" data-group-id="9138002726-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9138002726-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-31">[</span><span class="n">Player</span><span class="p" data-group-id="9138002726-31">]</span><span class="p" data-group-id="9138002726-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9138002726-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9138002726-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9138002726-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9138002726-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9138002726-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-36">[</span><span class="n">Player</span><span class="p" data-group-id="9138002726-36">]</span><span class="p" data-group-id="9138002726-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9138002726-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9138002726-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9138002726-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9138002726-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9138002726-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9138002726-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9138002726-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9138002726-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9138002726-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9138002726-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9138002726-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9138002726-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9138002726-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9138002726-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9138002726-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9138002726-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9138002726-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9138002726-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9138002726-49">(</span><span class="n">Player</span><span class="p" data-group-id="9138002726-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9138002726-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9138002726-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9138002726-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9138002726-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9138002726-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9138002726-53">(</span><span class="n">P</span><span class="p" data-group-id="9138002726-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9138002726-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9138002726-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9138002726-55">(</span><span class="n">P</span><span class="p" data-group-id="9138002726-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9138002726-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9138002726-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9138002726-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9138002726-57">(</span><span class="p" data-group-id="9138002726-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-58">{</span><span class="p" data-group-id="9138002726-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9138002726-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9138002726-60">}</span><span class="p" data-group-id="9138002726-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9138002726-61">(</span><span class="p" data-group-id="9138002726-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9138002726-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9138002726-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9138002726-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9138002726-64">]</span><span class="w">
        </span><span class="p" data-group-id="9138002726-63">)</span><span class="w">
    </span><span class="p" data-group-id="9138002726-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9138002726-65">(</span><span class="p" data-group-id="9138002726-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9138002726-66">(</span><span class="p" data-group-id="9138002726-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9138002726-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9138002726-68">]</span><span class="p" data-group-id="9138002726-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9138002726-69">(</span><span class="p" data-group-id="9138002726-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9138002726-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9138002726-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9138002726-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9138002726-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9138002726-72">(</span><span class="p" data-group-id="9138002726-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9138002726-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9138002726-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9138002726-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9138002726-76">]</span><span class="p" data-group-id="9138002726-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9138002726-78">(</span><span class="n">H</span><span class="p" data-group-id="9138002726-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9138002726-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9138002726-79">)</span><span class="p" data-group-id="9138002726-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9138002726-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9138002726-81">[</span><span class="p" data-group-id="9138002726-81">]</span><span class="p" data-group-id="9138002726-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9138002726-82">[</span><span class="p" data-group-id="9138002726-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9138002726-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9138002726-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9138002726-84">(</span><span class="p" data-group-id="9138002726-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9138002726-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9138002726-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9138002726-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9138002726-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9138002726-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9138002726-89">(</span><span class="p" data-group-id="9138002726-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9138002726-90">{</span><span class="nf">self</span><span class="p" data-group-id="9138002726-91">(</span><span class="p" data-group-id="9138002726-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9138002726-92">(</span><span class="n">X</span><span class="p" data-group-id="9138002726-92">)</span><span class="p" data-group-id="9138002726-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9138002726-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9138002726-87">]</span><span class="w">
    </span><span class="p" data-group-id="9138002726-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="murphy">
    Murphy Style (murphy)<a class="headerlink" href="#murphy" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-murphy"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">murphy_style</span><span class="p" data-group-id="8349747028-1">(</span><span class="p" data-group-id="8349747028-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="murphy-example.erl">
      example.erl<a class="headerlink" href="#murphy-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-murphy"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6703428332-1">(</span><span class="ss">test</span><span class="p" data-group-id="6703428332-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6703428332-2">(</span><span class="p" data-group-id="6703428332-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6703428332-3">]</span><span class="p" data-group-id="6703428332-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6703428332-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6703428332-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6703428332-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6703428332-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6703428332-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6703428332-9">}</span><span class="p" data-group-id="6703428332-6">]</span><span class="p" data-group-id="6703428332-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6703428332-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6703428332-11">}</span><span class="p" data-group-id="6703428332-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6703428332-12">(</span><span class="n">Port</span><span class="p" data-group-id="6703428332-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6703428332-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6703428332-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6703428332-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6703428332-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6703428332-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-17">[</span><span class="p" data-group-id="6703428332-18">[</span><span class="p" data-group-id="6703428332-18">]</span><span class="p" data-group-id="6703428332-17">]</span><span class="p" data-group-id="6703428332-16">)</span><span class="p" data-group-id="6703428332-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6703428332-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6703428332-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6703428332-20">(</span><span class="n">Players</span><span class="p" data-group-id="6703428332-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6703428332-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-22">[</span><span class="p" data-group-id="6703428332-22">]</span><span class="p" data-group-id="6703428332-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6703428332-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6703428332-24">(</span><span class="n">P</span><span class="p" data-group-id="6703428332-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6703428332-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-26">[</span><span class="n">P</span><span class="p" data-group-id="6703428332-26">]</span><span class="p" data-group-id="6703428332-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6703428332-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6703428332-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6703428332-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6703428332-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6703428332-29">(</span><span class="n">Player</span><span class="p" data-group-id="6703428332-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6703428332-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-31">[</span><span class="n">Player</span><span class="p" data-group-id="6703428332-31">]</span><span class="p" data-group-id="6703428332-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6703428332-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6703428332-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6703428332-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6703428332-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6703428332-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-36">[</span><span class="n">Player</span><span class="p" data-group-id="6703428332-36">]</span><span class="p" data-group-id="6703428332-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6703428332-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6703428332-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6703428332-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6703428332-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6703428332-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6703428332-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6703428332-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6703428332-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6703428332-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6703428332-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6703428332-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6703428332-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6703428332-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6703428332-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6703428332-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6703428332-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6703428332-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6703428332-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6703428332-49">(</span><span class="n">Player</span><span class="p" data-group-id="6703428332-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6703428332-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6703428332-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6703428332-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6703428332-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6703428332-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6703428332-53">(</span><span class="n">P</span><span class="p" data-group-id="6703428332-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6703428332-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6703428332-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6703428332-55">(</span><span class="n">P</span><span class="p" data-group-id="6703428332-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6703428332-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6703428332-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6703428332-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6703428332-57">(</span><span class="p" data-group-id="6703428332-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-58">{</span><span class="p" data-group-id="6703428332-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6703428332-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6703428332-60">}</span><span class="p" data-group-id="6703428332-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6703428332-61">(</span><span class="p" data-group-id="6703428332-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6703428332-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6703428332-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6703428332-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6703428332-64">]</span><span class="w">
        </span><span class="p" data-group-id="6703428332-63">)</span><span class="w">
    </span><span class="p" data-group-id="6703428332-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6703428332-65">(</span><span class="p" data-group-id="6703428332-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6703428332-66">(</span><span class="p" data-group-id="6703428332-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6703428332-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6703428332-68">]</span><span class="p" data-group-id="6703428332-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6703428332-69">(</span><span class="p" data-group-id="6703428332-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6703428332-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6703428332-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6703428332-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6703428332-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6703428332-72">(</span><span class="p" data-group-id="6703428332-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6703428332-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6703428332-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6703428332-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6703428332-76">]</span><span class="p" data-group-id="6703428332-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6703428332-78">(</span><span class="n">H</span><span class="p" data-group-id="6703428332-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6703428332-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6703428332-79">)</span><span class="p" data-group-id="6703428332-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6703428332-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6703428332-81">[</span><span class="p" data-group-id="6703428332-81">]</span><span class="p" data-group-id="6703428332-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6703428332-82">[</span><span class="p" data-group-id="6703428332-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6703428332-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6703428332-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6703428332-84">(</span><span class="p" data-group-id="6703428332-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6703428332-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6703428332-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6703428332-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6703428332-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6703428332-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6703428332-89">(</span><span class="p" data-group-id="6703428332-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6703428332-90">{</span><span class="nf">self</span><span class="p" data-group-id="6703428332-91">(</span><span class="p" data-group-id="6703428332-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6703428332-92">(</span><span class="n">X</span><span class="p" data-group-id="6703428332-92">)</span><span class="p" data-group-id="6703428332-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6703428332-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6703428332-87">]</span><span class="w">
    </span><span class="p" data-group-id="6703428332-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="native">
    Native Style (native)<a class="headerlink" href="#native" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-native"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">native_style</span><span class="p" data-group-id="7042072083-1">(</span><span class="p" data-group-id="7042072083-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="native-example.erl">
      example.erl<a class="headerlink" href="#native-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-native"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6340863855-1">(</span><span class="ss">test</span><span class="p" data-group-id="6340863855-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6340863855-2">(</span><span class="p" data-group-id="6340863855-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6340863855-3">]</span><span class="p" data-group-id="6340863855-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6340863855-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6340863855-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6340863855-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6340863855-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6340863855-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6340863855-9">}</span><span class="p" data-group-id="6340863855-6">]</span><span class="p" data-group-id="6340863855-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6340863855-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6340863855-11">}</span><span class="p" data-group-id="6340863855-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6340863855-12">(</span><span class="n">Port</span><span class="p" data-group-id="6340863855-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6340863855-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6340863855-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6340863855-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6340863855-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6340863855-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-17">[</span><span class="p" data-group-id="6340863855-18">[</span><span class="p" data-group-id="6340863855-18">]</span><span class="p" data-group-id="6340863855-17">]</span><span class="p" data-group-id="6340863855-16">)</span><span class="p" data-group-id="6340863855-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6340863855-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6340863855-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6340863855-20">(</span><span class="n">Players</span><span class="p" data-group-id="6340863855-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6340863855-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-22">[</span><span class="p" data-group-id="6340863855-22">]</span><span class="p" data-group-id="6340863855-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6340863855-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6340863855-24">(</span><span class="n">P</span><span class="p" data-group-id="6340863855-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6340863855-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-26">[</span><span class="n">P</span><span class="p" data-group-id="6340863855-26">]</span><span class="p" data-group-id="6340863855-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6340863855-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6340863855-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6340863855-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6340863855-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6340863855-29">(</span><span class="n">Player</span><span class="p" data-group-id="6340863855-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6340863855-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-31">[</span><span class="n">Player</span><span class="p" data-group-id="6340863855-31">]</span><span class="p" data-group-id="6340863855-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6340863855-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6340863855-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6340863855-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6340863855-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6340863855-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-36">[</span><span class="n">Player</span><span class="p" data-group-id="6340863855-36">]</span><span class="p" data-group-id="6340863855-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6340863855-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6340863855-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6340863855-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6340863855-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6340863855-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6340863855-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6340863855-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6340863855-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6340863855-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6340863855-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6340863855-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6340863855-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6340863855-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6340863855-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6340863855-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6340863855-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6340863855-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6340863855-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6340863855-49">(</span><span class="n">Player</span><span class="p" data-group-id="6340863855-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6340863855-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6340863855-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6340863855-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6340863855-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6340863855-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6340863855-53">(</span><span class="n">P</span><span class="p" data-group-id="6340863855-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6340863855-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6340863855-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6340863855-55">(</span><span class="n">P</span><span class="p" data-group-id="6340863855-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6340863855-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6340863855-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6340863855-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6340863855-57">(</span><span class="p" data-group-id="6340863855-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-58">{</span><span class="p" data-group-id="6340863855-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6340863855-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6340863855-60">}</span><span class="p" data-group-id="6340863855-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6340863855-61">(</span><span class="p" data-group-id="6340863855-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6340863855-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6340863855-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6340863855-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6340863855-64">]</span><span class="w">
        </span><span class="p" data-group-id="6340863855-63">)</span><span class="w">
    </span><span class="p" data-group-id="6340863855-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6340863855-65">(</span><span class="p" data-group-id="6340863855-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6340863855-66">(</span><span class="p" data-group-id="6340863855-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6340863855-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6340863855-68">]</span><span class="p" data-group-id="6340863855-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6340863855-69">(</span><span class="p" data-group-id="6340863855-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6340863855-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6340863855-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6340863855-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6340863855-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6340863855-72">(</span><span class="p" data-group-id="6340863855-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6340863855-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6340863855-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6340863855-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6340863855-76">]</span><span class="p" data-group-id="6340863855-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6340863855-78">(</span><span class="n">H</span><span class="p" data-group-id="6340863855-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6340863855-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6340863855-79">)</span><span class="p" data-group-id="6340863855-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6340863855-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6340863855-81">[</span><span class="p" data-group-id="6340863855-81">]</span><span class="p" data-group-id="6340863855-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6340863855-82">[</span><span class="p" data-group-id="6340863855-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6340863855-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6340863855-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6340863855-84">(</span><span class="p" data-group-id="6340863855-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6340863855-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6340863855-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6340863855-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6340863855-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6340863855-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6340863855-89">(</span><span class="p" data-group-id="6340863855-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6340863855-90">{</span><span class="nf">self</span><span class="p" data-group-id="6340863855-91">(</span><span class="p" data-group-id="6340863855-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6340863855-92">(</span><span class="n">X</span><span class="p" data-group-id="6340863855-92">)</span><span class="p" data-group-id="6340863855-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6340863855-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6340863855-87">]</span><span class="w">
    </span><span class="p" data-group-id="6340863855-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_dark">
    ParaisoDark Style (paraiso_dark)<a class="headerlink" href="#paraiso_dark" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_dark"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_dark_style</span><span class="p" data-group-id="5303254226-1">(</span><span class="p" data-group-id="5303254226-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_dark-example.erl">
      example.erl<a class="headerlink" href="#paraiso_dark-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_dark"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8395194361-1">(</span><span class="ss">test</span><span class="p" data-group-id="8395194361-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8395194361-2">(</span><span class="p" data-group-id="8395194361-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8395194361-3">]</span><span class="p" data-group-id="8395194361-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8395194361-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8395194361-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8395194361-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8395194361-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8395194361-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8395194361-9">}</span><span class="p" data-group-id="8395194361-6">]</span><span class="p" data-group-id="8395194361-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8395194361-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8395194361-11">}</span><span class="p" data-group-id="8395194361-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8395194361-12">(</span><span class="n">Port</span><span class="p" data-group-id="8395194361-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8395194361-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8395194361-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8395194361-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8395194361-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8395194361-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-17">[</span><span class="p" data-group-id="8395194361-18">[</span><span class="p" data-group-id="8395194361-18">]</span><span class="p" data-group-id="8395194361-17">]</span><span class="p" data-group-id="8395194361-16">)</span><span class="p" data-group-id="8395194361-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8395194361-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8395194361-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8395194361-20">(</span><span class="n">Players</span><span class="p" data-group-id="8395194361-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8395194361-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-22">[</span><span class="p" data-group-id="8395194361-22">]</span><span class="p" data-group-id="8395194361-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8395194361-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8395194361-24">(</span><span class="n">P</span><span class="p" data-group-id="8395194361-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8395194361-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-26">[</span><span class="n">P</span><span class="p" data-group-id="8395194361-26">]</span><span class="p" data-group-id="8395194361-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8395194361-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8395194361-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8395194361-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8395194361-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8395194361-29">(</span><span class="n">Player</span><span class="p" data-group-id="8395194361-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8395194361-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-31">[</span><span class="n">Player</span><span class="p" data-group-id="8395194361-31">]</span><span class="p" data-group-id="8395194361-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8395194361-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8395194361-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8395194361-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8395194361-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8395194361-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-36">[</span><span class="n">Player</span><span class="p" data-group-id="8395194361-36">]</span><span class="p" data-group-id="8395194361-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8395194361-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8395194361-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8395194361-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8395194361-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8395194361-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8395194361-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8395194361-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8395194361-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8395194361-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8395194361-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8395194361-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8395194361-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8395194361-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8395194361-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8395194361-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8395194361-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8395194361-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8395194361-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8395194361-49">(</span><span class="n">Player</span><span class="p" data-group-id="8395194361-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8395194361-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8395194361-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8395194361-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8395194361-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8395194361-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8395194361-53">(</span><span class="n">P</span><span class="p" data-group-id="8395194361-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8395194361-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8395194361-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8395194361-55">(</span><span class="n">P</span><span class="p" data-group-id="8395194361-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8395194361-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8395194361-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8395194361-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8395194361-57">(</span><span class="p" data-group-id="8395194361-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-58">{</span><span class="p" data-group-id="8395194361-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8395194361-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8395194361-60">}</span><span class="p" data-group-id="8395194361-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8395194361-61">(</span><span class="p" data-group-id="8395194361-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8395194361-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8395194361-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8395194361-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8395194361-64">]</span><span class="w">
        </span><span class="p" data-group-id="8395194361-63">)</span><span class="w">
    </span><span class="p" data-group-id="8395194361-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8395194361-65">(</span><span class="p" data-group-id="8395194361-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8395194361-66">(</span><span class="p" data-group-id="8395194361-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8395194361-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8395194361-68">]</span><span class="p" data-group-id="8395194361-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8395194361-69">(</span><span class="p" data-group-id="8395194361-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8395194361-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8395194361-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8395194361-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8395194361-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8395194361-72">(</span><span class="p" data-group-id="8395194361-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8395194361-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8395194361-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8395194361-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8395194361-76">]</span><span class="p" data-group-id="8395194361-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8395194361-78">(</span><span class="n">H</span><span class="p" data-group-id="8395194361-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8395194361-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8395194361-79">)</span><span class="p" data-group-id="8395194361-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8395194361-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8395194361-81">[</span><span class="p" data-group-id="8395194361-81">]</span><span class="p" data-group-id="8395194361-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8395194361-82">[</span><span class="p" data-group-id="8395194361-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8395194361-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8395194361-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8395194361-84">(</span><span class="p" data-group-id="8395194361-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8395194361-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8395194361-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8395194361-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8395194361-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8395194361-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8395194361-89">(</span><span class="p" data-group-id="8395194361-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8395194361-90">{</span><span class="nf">self</span><span class="p" data-group-id="8395194361-91">(</span><span class="p" data-group-id="8395194361-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8395194361-92">(</span><span class="n">X</span><span class="p" data-group-id="8395194361-92">)</span><span class="p" data-group-id="8395194361-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8395194361-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8395194361-87">]</span><span class="w">
    </span><span class="p" data-group-id="8395194361-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_light">
    ParaisoLight Style (paraiso_light)<a class="headerlink" href="#paraiso_light" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_light"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_light_style</span><span class="p" data-group-id="1258703497-1">(</span><span class="p" data-group-id="1258703497-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_light-example.erl">
      example.erl<a class="headerlink" href="#paraiso_light-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_light"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1471890435-1">(</span><span class="ss">test</span><span class="p" data-group-id="1471890435-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1471890435-2">(</span><span class="p" data-group-id="1471890435-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1471890435-3">]</span><span class="p" data-group-id="1471890435-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1471890435-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1471890435-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1471890435-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1471890435-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1471890435-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1471890435-9">}</span><span class="p" data-group-id="1471890435-6">]</span><span class="p" data-group-id="1471890435-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1471890435-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1471890435-11">}</span><span class="p" data-group-id="1471890435-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1471890435-12">(</span><span class="n">Port</span><span class="p" data-group-id="1471890435-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1471890435-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1471890435-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1471890435-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1471890435-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1471890435-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-17">[</span><span class="p" data-group-id="1471890435-18">[</span><span class="p" data-group-id="1471890435-18">]</span><span class="p" data-group-id="1471890435-17">]</span><span class="p" data-group-id="1471890435-16">)</span><span class="p" data-group-id="1471890435-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1471890435-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1471890435-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1471890435-20">(</span><span class="n">Players</span><span class="p" data-group-id="1471890435-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1471890435-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-22">[</span><span class="p" data-group-id="1471890435-22">]</span><span class="p" data-group-id="1471890435-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1471890435-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1471890435-24">(</span><span class="n">P</span><span class="p" data-group-id="1471890435-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1471890435-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-26">[</span><span class="n">P</span><span class="p" data-group-id="1471890435-26">]</span><span class="p" data-group-id="1471890435-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1471890435-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1471890435-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1471890435-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1471890435-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1471890435-29">(</span><span class="n">Player</span><span class="p" data-group-id="1471890435-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1471890435-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-31">[</span><span class="n">Player</span><span class="p" data-group-id="1471890435-31">]</span><span class="p" data-group-id="1471890435-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1471890435-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1471890435-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1471890435-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1471890435-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1471890435-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-36">[</span><span class="n">Player</span><span class="p" data-group-id="1471890435-36">]</span><span class="p" data-group-id="1471890435-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1471890435-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1471890435-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1471890435-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1471890435-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1471890435-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1471890435-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1471890435-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1471890435-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1471890435-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1471890435-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1471890435-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1471890435-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1471890435-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1471890435-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1471890435-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1471890435-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1471890435-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1471890435-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1471890435-49">(</span><span class="n">Player</span><span class="p" data-group-id="1471890435-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1471890435-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1471890435-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1471890435-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1471890435-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1471890435-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1471890435-53">(</span><span class="n">P</span><span class="p" data-group-id="1471890435-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1471890435-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1471890435-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1471890435-55">(</span><span class="n">P</span><span class="p" data-group-id="1471890435-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1471890435-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1471890435-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1471890435-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1471890435-57">(</span><span class="p" data-group-id="1471890435-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-58">{</span><span class="p" data-group-id="1471890435-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1471890435-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1471890435-60">}</span><span class="p" data-group-id="1471890435-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1471890435-61">(</span><span class="p" data-group-id="1471890435-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1471890435-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1471890435-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1471890435-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1471890435-64">]</span><span class="w">
        </span><span class="p" data-group-id="1471890435-63">)</span><span class="w">
    </span><span class="p" data-group-id="1471890435-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1471890435-65">(</span><span class="p" data-group-id="1471890435-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1471890435-66">(</span><span class="p" data-group-id="1471890435-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1471890435-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1471890435-68">]</span><span class="p" data-group-id="1471890435-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1471890435-69">(</span><span class="p" data-group-id="1471890435-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1471890435-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1471890435-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1471890435-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1471890435-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1471890435-72">(</span><span class="p" data-group-id="1471890435-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1471890435-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1471890435-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1471890435-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1471890435-76">]</span><span class="p" data-group-id="1471890435-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1471890435-78">(</span><span class="n">H</span><span class="p" data-group-id="1471890435-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1471890435-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1471890435-79">)</span><span class="p" data-group-id="1471890435-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1471890435-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1471890435-81">[</span><span class="p" data-group-id="1471890435-81">]</span><span class="p" data-group-id="1471890435-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1471890435-82">[</span><span class="p" data-group-id="1471890435-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1471890435-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1471890435-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1471890435-84">(</span><span class="p" data-group-id="1471890435-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1471890435-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1471890435-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1471890435-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1471890435-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1471890435-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1471890435-89">(</span><span class="p" data-group-id="1471890435-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1471890435-90">{</span><span class="nf">self</span><span class="p" data-group-id="1471890435-91">(</span><span class="p" data-group-id="1471890435-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1471890435-92">(</span><span class="n">X</span><span class="p" data-group-id="1471890435-92">)</span><span class="p" data-group-id="1471890435-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1471890435-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1471890435-87">]</span><span class="w">
    </span><span class="p" data-group-id="1471890435-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="pastie">
    Pastie Style (pastie)<a class="headerlink" href="#pastie" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-pastie"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">pastie_style</span><span class="p" data-group-id="6237432446-1">(</span><span class="p" data-group-id="6237432446-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="pastie-example.erl">
      example.erl<a class="headerlink" href="#pastie-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-pastie"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2161178666-1">(</span><span class="ss">test</span><span class="p" data-group-id="2161178666-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2161178666-2">(</span><span class="p" data-group-id="2161178666-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2161178666-3">]</span><span class="p" data-group-id="2161178666-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2161178666-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2161178666-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2161178666-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2161178666-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2161178666-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2161178666-9">}</span><span class="p" data-group-id="2161178666-6">]</span><span class="p" data-group-id="2161178666-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2161178666-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2161178666-11">}</span><span class="p" data-group-id="2161178666-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2161178666-12">(</span><span class="n">Port</span><span class="p" data-group-id="2161178666-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2161178666-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2161178666-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2161178666-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2161178666-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2161178666-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-17">[</span><span class="p" data-group-id="2161178666-18">[</span><span class="p" data-group-id="2161178666-18">]</span><span class="p" data-group-id="2161178666-17">]</span><span class="p" data-group-id="2161178666-16">)</span><span class="p" data-group-id="2161178666-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2161178666-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2161178666-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2161178666-20">(</span><span class="n">Players</span><span class="p" data-group-id="2161178666-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2161178666-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-22">[</span><span class="p" data-group-id="2161178666-22">]</span><span class="p" data-group-id="2161178666-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2161178666-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2161178666-24">(</span><span class="n">P</span><span class="p" data-group-id="2161178666-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2161178666-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-26">[</span><span class="n">P</span><span class="p" data-group-id="2161178666-26">]</span><span class="p" data-group-id="2161178666-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2161178666-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2161178666-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2161178666-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2161178666-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2161178666-29">(</span><span class="n">Player</span><span class="p" data-group-id="2161178666-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2161178666-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-31">[</span><span class="n">Player</span><span class="p" data-group-id="2161178666-31">]</span><span class="p" data-group-id="2161178666-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2161178666-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2161178666-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2161178666-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2161178666-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2161178666-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-36">[</span><span class="n">Player</span><span class="p" data-group-id="2161178666-36">]</span><span class="p" data-group-id="2161178666-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2161178666-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2161178666-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2161178666-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2161178666-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2161178666-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2161178666-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2161178666-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2161178666-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2161178666-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2161178666-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2161178666-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2161178666-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2161178666-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2161178666-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2161178666-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2161178666-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2161178666-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2161178666-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2161178666-49">(</span><span class="n">Player</span><span class="p" data-group-id="2161178666-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2161178666-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2161178666-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2161178666-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2161178666-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2161178666-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2161178666-53">(</span><span class="n">P</span><span class="p" data-group-id="2161178666-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2161178666-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2161178666-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2161178666-55">(</span><span class="n">P</span><span class="p" data-group-id="2161178666-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2161178666-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2161178666-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2161178666-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2161178666-57">(</span><span class="p" data-group-id="2161178666-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-58">{</span><span class="p" data-group-id="2161178666-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2161178666-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2161178666-60">}</span><span class="p" data-group-id="2161178666-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2161178666-61">(</span><span class="p" data-group-id="2161178666-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2161178666-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2161178666-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2161178666-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2161178666-64">]</span><span class="w">
        </span><span class="p" data-group-id="2161178666-63">)</span><span class="w">
    </span><span class="p" data-group-id="2161178666-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2161178666-65">(</span><span class="p" data-group-id="2161178666-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2161178666-66">(</span><span class="p" data-group-id="2161178666-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2161178666-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2161178666-68">]</span><span class="p" data-group-id="2161178666-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2161178666-69">(</span><span class="p" data-group-id="2161178666-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2161178666-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2161178666-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2161178666-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2161178666-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2161178666-72">(</span><span class="p" data-group-id="2161178666-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2161178666-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2161178666-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2161178666-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2161178666-76">]</span><span class="p" data-group-id="2161178666-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2161178666-78">(</span><span class="n">H</span><span class="p" data-group-id="2161178666-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2161178666-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2161178666-79">)</span><span class="p" data-group-id="2161178666-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2161178666-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2161178666-81">[</span><span class="p" data-group-id="2161178666-81">]</span><span class="p" data-group-id="2161178666-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2161178666-82">[</span><span class="p" data-group-id="2161178666-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2161178666-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2161178666-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2161178666-84">(</span><span class="p" data-group-id="2161178666-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2161178666-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2161178666-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2161178666-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2161178666-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2161178666-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2161178666-89">(</span><span class="p" data-group-id="2161178666-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2161178666-90">{</span><span class="nf">self</span><span class="p" data-group-id="2161178666-91">(</span><span class="p" data-group-id="2161178666-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2161178666-92">(</span><span class="n">X</span><span class="p" data-group-id="2161178666-92">)</span><span class="p" data-group-id="2161178666-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2161178666-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2161178666-87">]</span><span class="w">
    </span><span class="p" data-group-id="2161178666-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="perldoc">
    Perldoc Style (perldoc)<a class="headerlink" href="#perldoc" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-perldoc"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">perldoc_style</span><span class="p" data-group-id="3966476613-1">(</span><span class="p" data-group-id="3966476613-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="perldoc-example.erl">
      example.erl<a class="headerlink" href="#perldoc-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-perldoc"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8013342992-1">(</span><span class="ss">test</span><span class="p" data-group-id="8013342992-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8013342992-2">(</span><span class="p" data-group-id="8013342992-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8013342992-3">]</span><span class="p" data-group-id="8013342992-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8013342992-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8013342992-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8013342992-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8013342992-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8013342992-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8013342992-9">}</span><span class="p" data-group-id="8013342992-6">]</span><span class="p" data-group-id="8013342992-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8013342992-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8013342992-11">}</span><span class="p" data-group-id="8013342992-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8013342992-12">(</span><span class="n">Port</span><span class="p" data-group-id="8013342992-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8013342992-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8013342992-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8013342992-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8013342992-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8013342992-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-17">[</span><span class="p" data-group-id="8013342992-18">[</span><span class="p" data-group-id="8013342992-18">]</span><span class="p" data-group-id="8013342992-17">]</span><span class="p" data-group-id="8013342992-16">)</span><span class="p" data-group-id="8013342992-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8013342992-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8013342992-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8013342992-20">(</span><span class="n">Players</span><span class="p" data-group-id="8013342992-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8013342992-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-22">[</span><span class="p" data-group-id="8013342992-22">]</span><span class="p" data-group-id="8013342992-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8013342992-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8013342992-24">(</span><span class="n">P</span><span class="p" data-group-id="8013342992-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8013342992-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-26">[</span><span class="n">P</span><span class="p" data-group-id="8013342992-26">]</span><span class="p" data-group-id="8013342992-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8013342992-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8013342992-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8013342992-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8013342992-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8013342992-29">(</span><span class="n">Player</span><span class="p" data-group-id="8013342992-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8013342992-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-31">[</span><span class="n">Player</span><span class="p" data-group-id="8013342992-31">]</span><span class="p" data-group-id="8013342992-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8013342992-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8013342992-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8013342992-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8013342992-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8013342992-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-36">[</span><span class="n">Player</span><span class="p" data-group-id="8013342992-36">]</span><span class="p" data-group-id="8013342992-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8013342992-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8013342992-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8013342992-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8013342992-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8013342992-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8013342992-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8013342992-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8013342992-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8013342992-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8013342992-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8013342992-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8013342992-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8013342992-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8013342992-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8013342992-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8013342992-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8013342992-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8013342992-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8013342992-49">(</span><span class="n">Player</span><span class="p" data-group-id="8013342992-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8013342992-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8013342992-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8013342992-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8013342992-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8013342992-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8013342992-53">(</span><span class="n">P</span><span class="p" data-group-id="8013342992-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8013342992-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8013342992-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8013342992-55">(</span><span class="n">P</span><span class="p" data-group-id="8013342992-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8013342992-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8013342992-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8013342992-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8013342992-57">(</span><span class="p" data-group-id="8013342992-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-58">{</span><span class="p" data-group-id="8013342992-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8013342992-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8013342992-60">}</span><span class="p" data-group-id="8013342992-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8013342992-61">(</span><span class="p" data-group-id="8013342992-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8013342992-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8013342992-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8013342992-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8013342992-64">]</span><span class="w">
        </span><span class="p" data-group-id="8013342992-63">)</span><span class="w">
    </span><span class="p" data-group-id="8013342992-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8013342992-65">(</span><span class="p" data-group-id="8013342992-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8013342992-66">(</span><span class="p" data-group-id="8013342992-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8013342992-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8013342992-68">]</span><span class="p" data-group-id="8013342992-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8013342992-69">(</span><span class="p" data-group-id="8013342992-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8013342992-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8013342992-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8013342992-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8013342992-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8013342992-72">(</span><span class="p" data-group-id="8013342992-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8013342992-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8013342992-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8013342992-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8013342992-76">]</span><span class="p" data-group-id="8013342992-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8013342992-78">(</span><span class="n">H</span><span class="p" data-group-id="8013342992-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8013342992-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8013342992-79">)</span><span class="p" data-group-id="8013342992-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8013342992-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013342992-81">[</span><span class="p" data-group-id="8013342992-81">]</span><span class="p" data-group-id="8013342992-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8013342992-82">[</span><span class="p" data-group-id="8013342992-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8013342992-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8013342992-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8013342992-84">(</span><span class="p" data-group-id="8013342992-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8013342992-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8013342992-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8013342992-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8013342992-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8013342992-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8013342992-89">(</span><span class="p" data-group-id="8013342992-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8013342992-90">{</span><span class="nf">self</span><span class="p" data-group-id="8013342992-91">(</span><span class="p" data-group-id="8013342992-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8013342992-92">(</span><span class="n">X</span><span class="p" data-group-id="8013342992-92">)</span><span class="p" data-group-id="8013342992-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8013342992-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8013342992-87">]</span><span class="w">
    </span><span class="p" data-group-id="8013342992-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rainbow_dash">
    RainbowDash Style (rainbow_dash)<a class="headerlink" href="#rainbow_dash" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rainbow_dash"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rainbow_dash_style</span><span class="p" data-group-id="6191265044-1">(</span><span class="p" data-group-id="6191265044-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="rainbow_dash-example.erl">
      example.erl<a class="headerlink" href="#rainbow_dash-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rainbow_dash"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4926813165-1">(</span><span class="ss">test</span><span class="p" data-group-id="4926813165-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4926813165-2">(</span><span class="p" data-group-id="4926813165-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4926813165-3">]</span><span class="p" data-group-id="4926813165-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4926813165-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4926813165-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4926813165-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4926813165-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4926813165-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4926813165-9">}</span><span class="p" data-group-id="4926813165-6">]</span><span class="p" data-group-id="4926813165-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4926813165-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4926813165-11">}</span><span class="p" data-group-id="4926813165-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4926813165-12">(</span><span class="n">Port</span><span class="p" data-group-id="4926813165-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4926813165-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4926813165-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4926813165-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4926813165-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4926813165-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-17">[</span><span class="p" data-group-id="4926813165-18">[</span><span class="p" data-group-id="4926813165-18">]</span><span class="p" data-group-id="4926813165-17">]</span><span class="p" data-group-id="4926813165-16">)</span><span class="p" data-group-id="4926813165-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4926813165-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4926813165-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4926813165-20">(</span><span class="n">Players</span><span class="p" data-group-id="4926813165-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4926813165-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-22">[</span><span class="p" data-group-id="4926813165-22">]</span><span class="p" data-group-id="4926813165-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4926813165-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4926813165-24">(</span><span class="n">P</span><span class="p" data-group-id="4926813165-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4926813165-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-26">[</span><span class="n">P</span><span class="p" data-group-id="4926813165-26">]</span><span class="p" data-group-id="4926813165-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4926813165-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4926813165-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4926813165-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4926813165-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4926813165-29">(</span><span class="n">Player</span><span class="p" data-group-id="4926813165-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4926813165-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-31">[</span><span class="n">Player</span><span class="p" data-group-id="4926813165-31">]</span><span class="p" data-group-id="4926813165-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4926813165-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4926813165-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4926813165-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4926813165-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4926813165-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-36">[</span><span class="n">Player</span><span class="p" data-group-id="4926813165-36">]</span><span class="p" data-group-id="4926813165-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4926813165-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4926813165-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4926813165-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4926813165-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4926813165-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4926813165-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4926813165-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4926813165-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4926813165-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4926813165-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4926813165-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4926813165-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4926813165-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4926813165-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4926813165-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4926813165-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4926813165-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4926813165-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4926813165-49">(</span><span class="n">Player</span><span class="p" data-group-id="4926813165-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4926813165-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4926813165-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4926813165-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4926813165-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4926813165-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4926813165-53">(</span><span class="n">P</span><span class="p" data-group-id="4926813165-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4926813165-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4926813165-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4926813165-55">(</span><span class="n">P</span><span class="p" data-group-id="4926813165-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4926813165-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4926813165-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4926813165-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4926813165-57">(</span><span class="p" data-group-id="4926813165-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-58">{</span><span class="p" data-group-id="4926813165-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4926813165-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4926813165-60">}</span><span class="p" data-group-id="4926813165-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4926813165-61">(</span><span class="p" data-group-id="4926813165-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4926813165-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4926813165-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4926813165-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4926813165-64">]</span><span class="w">
        </span><span class="p" data-group-id="4926813165-63">)</span><span class="w">
    </span><span class="p" data-group-id="4926813165-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4926813165-65">(</span><span class="p" data-group-id="4926813165-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4926813165-66">(</span><span class="p" data-group-id="4926813165-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4926813165-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4926813165-68">]</span><span class="p" data-group-id="4926813165-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4926813165-69">(</span><span class="p" data-group-id="4926813165-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4926813165-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4926813165-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4926813165-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4926813165-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4926813165-72">(</span><span class="p" data-group-id="4926813165-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4926813165-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4926813165-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4926813165-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4926813165-76">]</span><span class="p" data-group-id="4926813165-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4926813165-78">(</span><span class="n">H</span><span class="p" data-group-id="4926813165-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4926813165-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4926813165-79">)</span><span class="p" data-group-id="4926813165-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4926813165-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4926813165-81">[</span><span class="p" data-group-id="4926813165-81">]</span><span class="p" data-group-id="4926813165-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4926813165-82">[</span><span class="p" data-group-id="4926813165-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4926813165-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4926813165-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4926813165-84">(</span><span class="p" data-group-id="4926813165-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4926813165-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4926813165-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4926813165-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4926813165-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4926813165-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4926813165-89">(</span><span class="p" data-group-id="4926813165-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4926813165-90">{</span><span class="nf">self</span><span class="p" data-group-id="4926813165-91">(</span><span class="p" data-group-id="4926813165-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4926813165-92">(</span><span class="n">X</span><span class="p" data-group-id="4926813165-92">)</span><span class="p" data-group-id="4926813165-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4926813165-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4926813165-87">]</span><span class="w">
    </span><span class="p" data-group-id="4926813165-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rrt">
    Rrt Style (rrt)<a class="headerlink" href="#rrt" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rrt"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rrt_style</span><span class="p" data-group-id="6189376405-1">(</span><span class="p" data-group-id="6189376405-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="rrt-example.erl">
      example.erl<a class="headerlink" href="#rrt-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rrt"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4570307451-1">(</span><span class="ss">test</span><span class="p" data-group-id="4570307451-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4570307451-2">(</span><span class="p" data-group-id="4570307451-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4570307451-3">]</span><span class="p" data-group-id="4570307451-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4570307451-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4570307451-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4570307451-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4570307451-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4570307451-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4570307451-9">}</span><span class="p" data-group-id="4570307451-6">]</span><span class="p" data-group-id="4570307451-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4570307451-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4570307451-11">}</span><span class="p" data-group-id="4570307451-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4570307451-12">(</span><span class="n">Port</span><span class="p" data-group-id="4570307451-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4570307451-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4570307451-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4570307451-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4570307451-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4570307451-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-17">[</span><span class="p" data-group-id="4570307451-18">[</span><span class="p" data-group-id="4570307451-18">]</span><span class="p" data-group-id="4570307451-17">]</span><span class="p" data-group-id="4570307451-16">)</span><span class="p" data-group-id="4570307451-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4570307451-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4570307451-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4570307451-20">(</span><span class="n">Players</span><span class="p" data-group-id="4570307451-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4570307451-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-22">[</span><span class="p" data-group-id="4570307451-22">]</span><span class="p" data-group-id="4570307451-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4570307451-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4570307451-24">(</span><span class="n">P</span><span class="p" data-group-id="4570307451-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4570307451-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-26">[</span><span class="n">P</span><span class="p" data-group-id="4570307451-26">]</span><span class="p" data-group-id="4570307451-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4570307451-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4570307451-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4570307451-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4570307451-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4570307451-29">(</span><span class="n">Player</span><span class="p" data-group-id="4570307451-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4570307451-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-31">[</span><span class="n">Player</span><span class="p" data-group-id="4570307451-31">]</span><span class="p" data-group-id="4570307451-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4570307451-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4570307451-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4570307451-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4570307451-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4570307451-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-36">[</span><span class="n">Player</span><span class="p" data-group-id="4570307451-36">]</span><span class="p" data-group-id="4570307451-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4570307451-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4570307451-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4570307451-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4570307451-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4570307451-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4570307451-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4570307451-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4570307451-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4570307451-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4570307451-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4570307451-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4570307451-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4570307451-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4570307451-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4570307451-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4570307451-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4570307451-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4570307451-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4570307451-49">(</span><span class="n">Player</span><span class="p" data-group-id="4570307451-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4570307451-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4570307451-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4570307451-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4570307451-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4570307451-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4570307451-53">(</span><span class="n">P</span><span class="p" data-group-id="4570307451-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4570307451-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4570307451-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4570307451-55">(</span><span class="n">P</span><span class="p" data-group-id="4570307451-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4570307451-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4570307451-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4570307451-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4570307451-57">(</span><span class="p" data-group-id="4570307451-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-58">{</span><span class="p" data-group-id="4570307451-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4570307451-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4570307451-60">}</span><span class="p" data-group-id="4570307451-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4570307451-61">(</span><span class="p" data-group-id="4570307451-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4570307451-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4570307451-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4570307451-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4570307451-64">]</span><span class="w">
        </span><span class="p" data-group-id="4570307451-63">)</span><span class="w">
    </span><span class="p" data-group-id="4570307451-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4570307451-65">(</span><span class="p" data-group-id="4570307451-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4570307451-66">(</span><span class="p" data-group-id="4570307451-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4570307451-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4570307451-68">]</span><span class="p" data-group-id="4570307451-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4570307451-69">(</span><span class="p" data-group-id="4570307451-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4570307451-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4570307451-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4570307451-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4570307451-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4570307451-72">(</span><span class="p" data-group-id="4570307451-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4570307451-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4570307451-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4570307451-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4570307451-76">]</span><span class="p" data-group-id="4570307451-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4570307451-78">(</span><span class="n">H</span><span class="p" data-group-id="4570307451-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4570307451-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4570307451-79">)</span><span class="p" data-group-id="4570307451-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4570307451-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4570307451-81">[</span><span class="p" data-group-id="4570307451-81">]</span><span class="p" data-group-id="4570307451-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4570307451-82">[</span><span class="p" data-group-id="4570307451-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4570307451-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4570307451-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4570307451-84">(</span><span class="p" data-group-id="4570307451-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4570307451-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4570307451-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4570307451-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4570307451-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4570307451-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4570307451-89">(</span><span class="p" data-group-id="4570307451-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4570307451-90">{</span><span class="nf">self</span><span class="p" data-group-id="4570307451-91">(</span><span class="p" data-group-id="4570307451-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4570307451-92">(</span><span class="n">X</span><span class="p" data-group-id="4570307451-92">)</span><span class="p" data-group-id="4570307451-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4570307451-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4570307451-87">]</span><span class="w">
    </span><span class="p" data-group-id="4570307451-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="tango">
    Tango Style (tango)<a class="headerlink" href="#tango" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-tango"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">tango_style</span><span class="p" data-group-id="8394590618-1">(</span><span class="p" data-group-id="8394590618-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="tango-example.erl">
      example.erl<a class="headerlink" href="#tango-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-tango"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6450838524-1">(</span><span class="ss">test</span><span class="p" data-group-id="6450838524-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6450838524-2">(</span><span class="p" data-group-id="6450838524-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6450838524-3">]</span><span class="p" data-group-id="6450838524-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6450838524-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6450838524-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6450838524-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6450838524-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6450838524-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6450838524-9">}</span><span class="p" data-group-id="6450838524-6">]</span><span class="p" data-group-id="6450838524-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6450838524-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6450838524-11">}</span><span class="p" data-group-id="6450838524-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6450838524-12">(</span><span class="n">Port</span><span class="p" data-group-id="6450838524-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6450838524-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6450838524-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6450838524-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6450838524-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6450838524-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-17">[</span><span class="p" data-group-id="6450838524-18">[</span><span class="p" data-group-id="6450838524-18">]</span><span class="p" data-group-id="6450838524-17">]</span><span class="p" data-group-id="6450838524-16">)</span><span class="p" data-group-id="6450838524-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6450838524-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6450838524-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6450838524-20">(</span><span class="n">Players</span><span class="p" data-group-id="6450838524-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6450838524-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-22">[</span><span class="p" data-group-id="6450838524-22">]</span><span class="p" data-group-id="6450838524-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6450838524-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6450838524-24">(</span><span class="n">P</span><span class="p" data-group-id="6450838524-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6450838524-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-26">[</span><span class="n">P</span><span class="p" data-group-id="6450838524-26">]</span><span class="p" data-group-id="6450838524-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6450838524-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6450838524-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6450838524-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6450838524-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6450838524-29">(</span><span class="n">Player</span><span class="p" data-group-id="6450838524-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6450838524-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-31">[</span><span class="n">Player</span><span class="p" data-group-id="6450838524-31">]</span><span class="p" data-group-id="6450838524-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6450838524-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6450838524-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6450838524-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6450838524-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6450838524-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-36">[</span><span class="n">Player</span><span class="p" data-group-id="6450838524-36">]</span><span class="p" data-group-id="6450838524-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6450838524-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6450838524-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6450838524-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6450838524-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6450838524-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6450838524-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6450838524-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6450838524-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6450838524-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6450838524-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6450838524-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6450838524-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6450838524-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6450838524-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6450838524-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6450838524-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6450838524-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6450838524-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6450838524-49">(</span><span class="n">Player</span><span class="p" data-group-id="6450838524-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6450838524-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6450838524-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6450838524-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6450838524-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6450838524-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6450838524-53">(</span><span class="n">P</span><span class="p" data-group-id="6450838524-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6450838524-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6450838524-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6450838524-55">(</span><span class="n">P</span><span class="p" data-group-id="6450838524-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6450838524-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6450838524-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6450838524-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6450838524-57">(</span><span class="p" data-group-id="6450838524-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-58">{</span><span class="p" data-group-id="6450838524-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6450838524-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6450838524-60">}</span><span class="p" data-group-id="6450838524-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6450838524-61">(</span><span class="p" data-group-id="6450838524-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6450838524-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6450838524-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6450838524-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6450838524-64">]</span><span class="w">
        </span><span class="p" data-group-id="6450838524-63">)</span><span class="w">
    </span><span class="p" data-group-id="6450838524-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6450838524-65">(</span><span class="p" data-group-id="6450838524-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6450838524-66">(</span><span class="p" data-group-id="6450838524-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6450838524-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6450838524-68">]</span><span class="p" data-group-id="6450838524-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6450838524-69">(</span><span class="p" data-group-id="6450838524-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6450838524-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6450838524-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6450838524-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6450838524-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6450838524-72">(</span><span class="p" data-group-id="6450838524-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6450838524-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6450838524-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6450838524-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6450838524-76">]</span><span class="p" data-group-id="6450838524-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6450838524-78">(</span><span class="n">H</span><span class="p" data-group-id="6450838524-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6450838524-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6450838524-79">)</span><span class="p" data-group-id="6450838524-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6450838524-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6450838524-81">[</span><span class="p" data-group-id="6450838524-81">]</span><span class="p" data-group-id="6450838524-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6450838524-82">[</span><span class="p" data-group-id="6450838524-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6450838524-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6450838524-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6450838524-84">(</span><span class="p" data-group-id="6450838524-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6450838524-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6450838524-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6450838524-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6450838524-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6450838524-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6450838524-89">(</span><span class="p" data-group-id="6450838524-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6450838524-90">{</span><span class="nf">self</span><span class="p" data-group-id="6450838524-91">(</span><span class="p" data-group-id="6450838524-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6450838524-92">(</span><span class="n">X</span><span class="p" data-group-id="6450838524-92">)</span><span class="p" data-group-id="6450838524-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6450838524-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6450838524-87">]</span><span class="w">
    </span><span class="p" data-group-id="6450838524-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="trac">
    Trac Style (trac)<a class="headerlink" href="#trac" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-trac"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">trac_style</span><span class="p" data-group-id="3170784055-1">(</span><span class="p" data-group-id="3170784055-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="trac-example.erl">
      example.erl<a class="headerlink" href="#trac-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-trac"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7620898349-1">(</span><span class="ss">test</span><span class="p" data-group-id="7620898349-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7620898349-2">(</span><span class="p" data-group-id="7620898349-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7620898349-3">]</span><span class="p" data-group-id="7620898349-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7620898349-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7620898349-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7620898349-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7620898349-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7620898349-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7620898349-9">}</span><span class="p" data-group-id="7620898349-6">]</span><span class="p" data-group-id="7620898349-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7620898349-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7620898349-11">}</span><span class="p" data-group-id="7620898349-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7620898349-12">(</span><span class="n">Port</span><span class="p" data-group-id="7620898349-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7620898349-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7620898349-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7620898349-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7620898349-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7620898349-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-17">[</span><span class="p" data-group-id="7620898349-18">[</span><span class="p" data-group-id="7620898349-18">]</span><span class="p" data-group-id="7620898349-17">]</span><span class="p" data-group-id="7620898349-16">)</span><span class="p" data-group-id="7620898349-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7620898349-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7620898349-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7620898349-20">(</span><span class="n">Players</span><span class="p" data-group-id="7620898349-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7620898349-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-22">[</span><span class="p" data-group-id="7620898349-22">]</span><span class="p" data-group-id="7620898349-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7620898349-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7620898349-24">(</span><span class="n">P</span><span class="p" data-group-id="7620898349-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7620898349-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-26">[</span><span class="n">P</span><span class="p" data-group-id="7620898349-26">]</span><span class="p" data-group-id="7620898349-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7620898349-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7620898349-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7620898349-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7620898349-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7620898349-29">(</span><span class="n">Player</span><span class="p" data-group-id="7620898349-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7620898349-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-31">[</span><span class="n">Player</span><span class="p" data-group-id="7620898349-31">]</span><span class="p" data-group-id="7620898349-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7620898349-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7620898349-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7620898349-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7620898349-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7620898349-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-36">[</span><span class="n">Player</span><span class="p" data-group-id="7620898349-36">]</span><span class="p" data-group-id="7620898349-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7620898349-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7620898349-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7620898349-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7620898349-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7620898349-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7620898349-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7620898349-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7620898349-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7620898349-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7620898349-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7620898349-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7620898349-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7620898349-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7620898349-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7620898349-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7620898349-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7620898349-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7620898349-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7620898349-49">(</span><span class="n">Player</span><span class="p" data-group-id="7620898349-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7620898349-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7620898349-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7620898349-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7620898349-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7620898349-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7620898349-53">(</span><span class="n">P</span><span class="p" data-group-id="7620898349-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7620898349-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7620898349-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7620898349-55">(</span><span class="n">P</span><span class="p" data-group-id="7620898349-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7620898349-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7620898349-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7620898349-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7620898349-57">(</span><span class="p" data-group-id="7620898349-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-58">{</span><span class="p" data-group-id="7620898349-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7620898349-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7620898349-60">}</span><span class="p" data-group-id="7620898349-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7620898349-61">(</span><span class="p" data-group-id="7620898349-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7620898349-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7620898349-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7620898349-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7620898349-64">]</span><span class="w">
        </span><span class="p" data-group-id="7620898349-63">)</span><span class="w">
    </span><span class="p" data-group-id="7620898349-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7620898349-65">(</span><span class="p" data-group-id="7620898349-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7620898349-66">(</span><span class="p" data-group-id="7620898349-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7620898349-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7620898349-68">]</span><span class="p" data-group-id="7620898349-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7620898349-69">(</span><span class="p" data-group-id="7620898349-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7620898349-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7620898349-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7620898349-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7620898349-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7620898349-72">(</span><span class="p" data-group-id="7620898349-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7620898349-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7620898349-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7620898349-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7620898349-76">]</span><span class="p" data-group-id="7620898349-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7620898349-78">(</span><span class="n">H</span><span class="p" data-group-id="7620898349-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7620898349-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7620898349-79">)</span><span class="p" data-group-id="7620898349-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7620898349-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7620898349-81">[</span><span class="p" data-group-id="7620898349-81">]</span><span class="p" data-group-id="7620898349-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7620898349-82">[</span><span class="p" data-group-id="7620898349-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7620898349-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7620898349-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7620898349-84">(</span><span class="p" data-group-id="7620898349-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7620898349-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7620898349-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7620898349-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7620898349-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7620898349-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7620898349-89">(</span><span class="p" data-group-id="7620898349-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7620898349-90">{</span><span class="nf">self</span><span class="p" data-group-id="7620898349-91">(</span><span class="p" data-group-id="7620898349-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7620898349-92">(</span><span class="n">X</span><span class="p" data-group-id="7620898349-92">)</span><span class="p" data-group-id="7620898349-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7620898349-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7620898349-87">]</span><span class="w">
    </span><span class="p" data-group-id="7620898349-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vim">
    Vim Style (vim)<a class="headerlink" href="#vim" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vim"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vim_style</span><span class="p" data-group-id="4568226603-1">(</span><span class="p" data-group-id="4568226603-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="vim-example.erl">
      example.erl<a class="headerlink" href="#vim-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vim"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1535270769-1">(</span><span class="ss">test</span><span class="p" data-group-id="1535270769-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1535270769-2">(</span><span class="p" data-group-id="1535270769-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1535270769-3">]</span><span class="p" data-group-id="1535270769-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1535270769-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1535270769-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1535270769-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1535270769-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1535270769-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1535270769-9">}</span><span class="p" data-group-id="1535270769-6">]</span><span class="p" data-group-id="1535270769-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1535270769-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1535270769-11">}</span><span class="p" data-group-id="1535270769-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1535270769-12">(</span><span class="n">Port</span><span class="p" data-group-id="1535270769-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1535270769-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1535270769-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1535270769-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1535270769-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1535270769-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-17">[</span><span class="p" data-group-id="1535270769-18">[</span><span class="p" data-group-id="1535270769-18">]</span><span class="p" data-group-id="1535270769-17">]</span><span class="p" data-group-id="1535270769-16">)</span><span class="p" data-group-id="1535270769-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1535270769-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1535270769-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1535270769-20">(</span><span class="n">Players</span><span class="p" data-group-id="1535270769-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1535270769-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-22">[</span><span class="p" data-group-id="1535270769-22">]</span><span class="p" data-group-id="1535270769-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1535270769-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1535270769-24">(</span><span class="n">P</span><span class="p" data-group-id="1535270769-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1535270769-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-26">[</span><span class="n">P</span><span class="p" data-group-id="1535270769-26">]</span><span class="p" data-group-id="1535270769-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1535270769-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1535270769-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1535270769-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1535270769-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1535270769-29">(</span><span class="n">Player</span><span class="p" data-group-id="1535270769-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1535270769-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-31">[</span><span class="n">Player</span><span class="p" data-group-id="1535270769-31">]</span><span class="p" data-group-id="1535270769-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1535270769-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1535270769-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1535270769-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1535270769-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1535270769-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-36">[</span><span class="n">Player</span><span class="p" data-group-id="1535270769-36">]</span><span class="p" data-group-id="1535270769-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1535270769-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1535270769-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1535270769-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1535270769-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1535270769-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1535270769-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1535270769-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1535270769-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1535270769-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1535270769-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1535270769-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1535270769-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1535270769-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1535270769-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1535270769-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1535270769-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1535270769-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1535270769-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1535270769-49">(</span><span class="n">Player</span><span class="p" data-group-id="1535270769-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1535270769-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1535270769-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1535270769-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1535270769-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1535270769-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1535270769-53">(</span><span class="n">P</span><span class="p" data-group-id="1535270769-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1535270769-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1535270769-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1535270769-55">(</span><span class="n">P</span><span class="p" data-group-id="1535270769-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1535270769-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1535270769-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1535270769-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1535270769-57">(</span><span class="p" data-group-id="1535270769-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-58">{</span><span class="p" data-group-id="1535270769-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1535270769-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1535270769-60">}</span><span class="p" data-group-id="1535270769-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1535270769-61">(</span><span class="p" data-group-id="1535270769-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1535270769-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1535270769-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1535270769-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1535270769-64">]</span><span class="w">
        </span><span class="p" data-group-id="1535270769-63">)</span><span class="w">
    </span><span class="p" data-group-id="1535270769-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1535270769-65">(</span><span class="p" data-group-id="1535270769-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1535270769-66">(</span><span class="p" data-group-id="1535270769-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1535270769-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1535270769-68">]</span><span class="p" data-group-id="1535270769-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1535270769-69">(</span><span class="p" data-group-id="1535270769-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1535270769-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1535270769-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1535270769-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1535270769-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1535270769-72">(</span><span class="p" data-group-id="1535270769-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1535270769-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1535270769-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1535270769-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1535270769-76">]</span><span class="p" data-group-id="1535270769-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1535270769-78">(</span><span class="n">H</span><span class="p" data-group-id="1535270769-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1535270769-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1535270769-79">)</span><span class="p" data-group-id="1535270769-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1535270769-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1535270769-81">[</span><span class="p" data-group-id="1535270769-81">]</span><span class="p" data-group-id="1535270769-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1535270769-82">[</span><span class="p" data-group-id="1535270769-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1535270769-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1535270769-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1535270769-84">(</span><span class="p" data-group-id="1535270769-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1535270769-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1535270769-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1535270769-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1535270769-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1535270769-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1535270769-89">(</span><span class="p" data-group-id="1535270769-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1535270769-90">{</span><span class="nf">self</span><span class="p" data-group-id="1535270769-91">(</span><span class="p" data-group-id="1535270769-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1535270769-92">(</span><span class="n">X</span><span class="p" data-group-id="1535270769-92">)</span><span class="p" data-group-id="1535270769-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1535270769-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1535270769-87">]</span><span class="w">
    </span><span class="p" data-group-id="1535270769-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vs">
    VisualStudio Style (vs)<a class="headerlink" href="#vs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vs_style</span><span class="p" data-group-id="5303317188-1">(</span><span class="p" data-group-id="5303317188-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="vs-example.erl">
      example.erl<a class="headerlink" href="#vs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6639733461-1">(</span><span class="ss">test</span><span class="p" data-group-id="6639733461-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6639733461-2">(</span><span class="p" data-group-id="6639733461-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6639733461-3">]</span><span class="p" data-group-id="6639733461-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6639733461-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6639733461-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6639733461-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6639733461-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6639733461-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6639733461-9">}</span><span class="p" data-group-id="6639733461-6">]</span><span class="p" data-group-id="6639733461-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6639733461-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6639733461-11">}</span><span class="p" data-group-id="6639733461-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6639733461-12">(</span><span class="n">Port</span><span class="p" data-group-id="6639733461-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6639733461-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6639733461-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6639733461-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6639733461-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6639733461-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-17">[</span><span class="p" data-group-id="6639733461-18">[</span><span class="p" data-group-id="6639733461-18">]</span><span class="p" data-group-id="6639733461-17">]</span><span class="p" data-group-id="6639733461-16">)</span><span class="p" data-group-id="6639733461-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6639733461-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6639733461-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6639733461-20">(</span><span class="n">Players</span><span class="p" data-group-id="6639733461-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6639733461-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-22">[</span><span class="p" data-group-id="6639733461-22">]</span><span class="p" data-group-id="6639733461-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6639733461-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6639733461-24">(</span><span class="n">P</span><span class="p" data-group-id="6639733461-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6639733461-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-26">[</span><span class="n">P</span><span class="p" data-group-id="6639733461-26">]</span><span class="p" data-group-id="6639733461-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6639733461-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6639733461-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6639733461-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6639733461-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6639733461-29">(</span><span class="n">Player</span><span class="p" data-group-id="6639733461-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6639733461-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-31">[</span><span class="n">Player</span><span class="p" data-group-id="6639733461-31">]</span><span class="p" data-group-id="6639733461-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6639733461-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6639733461-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6639733461-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6639733461-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6639733461-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-36">[</span><span class="n">Player</span><span class="p" data-group-id="6639733461-36">]</span><span class="p" data-group-id="6639733461-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6639733461-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6639733461-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6639733461-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6639733461-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6639733461-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6639733461-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6639733461-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6639733461-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6639733461-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6639733461-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6639733461-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6639733461-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6639733461-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6639733461-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6639733461-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6639733461-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6639733461-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6639733461-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6639733461-49">(</span><span class="n">Player</span><span class="p" data-group-id="6639733461-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6639733461-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6639733461-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6639733461-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6639733461-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6639733461-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6639733461-53">(</span><span class="n">P</span><span class="p" data-group-id="6639733461-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6639733461-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6639733461-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6639733461-55">(</span><span class="n">P</span><span class="p" data-group-id="6639733461-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6639733461-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6639733461-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6639733461-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6639733461-57">(</span><span class="p" data-group-id="6639733461-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-58">{</span><span class="p" data-group-id="6639733461-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6639733461-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6639733461-60">}</span><span class="p" data-group-id="6639733461-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6639733461-61">(</span><span class="p" data-group-id="6639733461-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6639733461-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6639733461-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6639733461-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6639733461-64">]</span><span class="w">
        </span><span class="p" data-group-id="6639733461-63">)</span><span class="w">
    </span><span class="p" data-group-id="6639733461-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6639733461-65">(</span><span class="p" data-group-id="6639733461-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6639733461-66">(</span><span class="p" data-group-id="6639733461-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6639733461-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6639733461-68">]</span><span class="p" data-group-id="6639733461-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6639733461-69">(</span><span class="p" data-group-id="6639733461-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6639733461-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6639733461-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6639733461-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6639733461-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6639733461-72">(</span><span class="p" data-group-id="6639733461-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6639733461-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6639733461-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6639733461-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6639733461-76">]</span><span class="p" data-group-id="6639733461-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6639733461-78">(</span><span class="n">H</span><span class="p" data-group-id="6639733461-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6639733461-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6639733461-79">)</span><span class="p" data-group-id="6639733461-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6639733461-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6639733461-81">[</span><span class="p" data-group-id="6639733461-81">]</span><span class="p" data-group-id="6639733461-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6639733461-82">[</span><span class="p" data-group-id="6639733461-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6639733461-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6639733461-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6639733461-84">(</span><span class="p" data-group-id="6639733461-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6639733461-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6639733461-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6639733461-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6639733461-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6639733461-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6639733461-89">(</span><span class="p" data-group-id="6639733461-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6639733461-90">{</span><span class="nf">self</span><span class="p" data-group-id="6639733461-91">(</span><span class="p" data-group-id="6639733461-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6639733461-92">(</span><span class="n">X</span><span class="p" data-group-id="6639733461-92">)</span><span class="p" data-group-id="6639733461-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6639733461-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6639733461-87">]</span><span class="w">
    </span><span class="p" data-group-id="6639733461-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="xcode">
    Xcode Style (xcode)<a class="headerlink" href="#xcode" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-xcode"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">xcode_style</span><span class="p" data-group-id="0145802257-1">(</span><span class="p" data-group-id="0145802257-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="xcode-example.erl">
      example.erl<a class="headerlink" href="#xcode-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-xcode"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2952454846-1">(</span><span class="ss">test</span><span class="p" data-group-id="2952454846-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2952454846-2">(</span><span class="p" data-group-id="2952454846-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2952454846-3">]</span><span class="p" data-group-id="2952454846-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2952454846-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2952454846-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2952454846-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2952454846-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2952454846-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2952454846-9">}</span><span class="p" data-group-id="2952454846-6">]</span><span class="p" data-group-id="2952454846-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2952454846-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2952454846-11">}</span><span class="p" data-group-id="2952454846-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2952454846-12">(</span><span class="n">Port</span><span class="p" data-group-id="2952454846-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2952454846-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2952454846-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2952454846-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2952454846-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2952454846-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-17">[</span><span class="p" data-group-id="2952454846-18">[</span><span class="p" data-group-id="2952454846-18">]</span><span class="p" data-group-id="2952454846-17">]</span><span class="p" data-group-id="2952454846-16">)</span><span class="p" data-group-id="2952454846-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2952454846-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2952454846-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2952454846-20">(</span><span class="n">Players</span><span class="p" data-group-id="2952454846-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2952454846-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-22">[</span><span class="p" data-group-id="2952454846-22">]</span><span class="p" data-group-id="2952454846-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2952454846-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2952454846-24">(</span><span class="n">P</span><span class="p" data-group-id="2952454846-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2952454846-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-26">[</span><span class="n">P</span><span class="p" data-group-id="2952454846-26">]</span><span class="p" data-group-id="2952454846-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2952454846-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2952454846-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2952454846-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2952454846-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2952454846-29">(</span><span class="n">Player</span><span class="p" data-group-id="2952454846-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2952454846-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-31">[</span><span class="n">Player</span><span class="p" data-group-id="2952454846-31">]</span><span class="p" data-group-id="2952454846-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2952454846-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2952454846-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2952454846-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2952454846-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2952454846-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-36">[</span><span class="n">Player</span><span class="p" data-group-id="2952454846-36">]</span><span class="p" data-group-id="2952454846-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2952454846-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2952454846-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2952454846-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2952454846-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2952454846-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2952454846-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2952454846-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2952454846-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2952454846-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2952454846-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2952454846-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2952454846-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2952454846-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2952454846-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2952454846-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2952454846-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2952454846-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2952454846-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2952454846-49">(</span><span class="n">Player</span><span class="p" data-group-id="2952454846-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2952454846-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2952454846-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2952454846-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2952454846-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2952454846-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2952454846-53">(</span><span class="n">P</span><span class="p" data-group-id="2952454846-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2952454846-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2952454846-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2952454846-55">(</span><span class="n">P</span><span class="p" data-group-id="2952454846-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2952454846-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2952454846-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2952454846-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2952454846-57">(</span><span class="p" data-group-id="2952454846-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-58">{</span><span class="p" data-group-id="2952454846-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2952454846-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2952454846-60">}</span><span class="p" data-group-id="2952454846-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2952454846-61">(</span><span class="p" data-group-id="2952454846-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2952454846-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2952454846-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2952454846-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2952454846-64">]</span><span class="w">
        </span><span class="p" data-group-id="2952454846-63">)</span><span class="w">
    </span><span class="p" data-group-id="2952454846-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2952454846-65">(</span><span class="p" data-group-id="2952454846-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2952454846-66">(</span><span class="p" data-group-id="2952454846-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2952454846-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2952454846-68">]</span><span class="p" data-group-id="2952454846-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2952454846-69">(</span><span class="p" data-group-id="2952454846-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2952454846-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2952454846-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2952454846-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2952454846-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2952454846-72">(</span><span class="p" data-group-id="2952454846-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2952454846-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2952454846-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2952454846-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2952454846-76">]</span><span class="p" data-group-id="2952454846-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2952454846-78">(</span><span class="n">H</span><span class="p" data-group-id="2952454846-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2952454846-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2952454846-79">)</span><span class="p" data-group-id="2952454846-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2952454846-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2952454846-81">[</span><span class="p" data-group-id="2952454846-81">]</span><span class="p" data-group-id="2952454846-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2952454846-82">[</span><span class="p" data-group-id="2952454846-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2952454846-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2952454846-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2952454846-84">(</span><span class="p" data-group-id="2952454846-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2952454846-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2952454846-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2952454846-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2952454846-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2952454846-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2952454846-89">(</span><span class="p" data-group-id="2952454846-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2952454846-90">{</span><span class="nf">self</span><span class="p" data-group-id="2952454846-91">(</span><span class="p" data-group-id="2952454846-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2952454846-92">(</span><span class="n">X</span><span class="p" data-group-id="2952454846-92">)</span><span class="p" data-group-id="2952454846-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2952454846-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2952454846-87">]</span><span class="w">
    </span><span class="p" data-group-id="2952454846-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  


          </div>


        </div>
        
        <div class="clearer"></div>

      </div>

      <div class="clearfix"></div>
    </div>

    <script type="text/javascript">
      document.querySelector(".menu-btn").addEventListener("click", () => { 
        document.querySelector(".left-column").classList.toggle("left-column--active");
      });
    </script>
  </body>
</html>