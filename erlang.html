<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- Licensed under the Apache 2.0 License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/open-sans/stylesheet.css" />
    <!-- Licensed under the SIL Open Font License -->
    <link rel="stylesheet" type="text/css" href="static/fonts/source-serif-pro/source-serif-pro.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Makeup Demo</title>

    <!--Bootstrap 5-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

    <link rel="stylesheet" href="static/css/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="static/css/makeup.css" type="text/css" />
  </head>

  <body role="document">
    <div class="container-wrapper">
      <div id="mobile-toggle">
        <a class="text-logo--mobile"  href="index.html">
          <span>Makeup Demo</span>
        </a>
        <button class="menu-btn" area-label="Menu">
          <img class="menu-icon" src="static/img/menu-line.svg">
        </button>
      </div>

      <div id="left-column" class="left-column">
        <div class="makeupsidebar"><a href="index.html" class="text-logo">Makeup Demo</a>

          
            <div class="sidebar-block">
              <div class="sidebar-wrapper">
                <h2>Styles</h2>
              </div>
              <div class="sidebar-toc">
                <ul>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#abap">
                        Abap Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol">
                        Algol Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#algol_nu">
                        Algol_Nu Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#arduino">
                        Arduino Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#autumn">
                        Autumn Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#borland">
                        Borland Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#bw">
                        BlackWhite Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#colorful">
                        Colorful Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#default">
                        Default Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#emacs">
                        Emacs Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#friendly">
                        Friendly Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#fruity">
                        Fruity Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#igor">
                        Igor Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#lovelace">
                        Lovelace Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#manni">
                        Manni Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#monokai">
                        Monokai Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#murphy">
                        Murphy Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#native">
                        Native Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_dark">
                        ParaisoDark Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#paraiso_light">
                        ParaisoLight Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#pastie">
                        Pastie Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#perldoc">
                        Perldoc Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rainbow_dash">
                        RainbowDash Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#rrt">
                        Rrt Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#tango">
                        Tango Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#trac">
                        Trac Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vim">
                        Vim Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#vs">
                        VisualStudio Style</a></li>
                  
                    <li class="toctree-l1">
                      <a class="reference internal" href="#xcode">
                        Xcode Style</a></li>
                  
                </ul>
              </div>
            </div>
          

          <div class="sidebar-block">
            <div class="sidebar-wrapper">
              <h2>Languages</h2>
            </div>
            <div class="sidebar-toc">
              <ul>
                
                <li class="toctree-l1"><a class="reference internal" href="c.html">C</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="diff.html">Diff</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="eex.html">EEx</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="elixir.html">Elixir</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="erlang.html">Erlang</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="heex.html">HEEx</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="json.html">JSON</a></li>
                
                <li class="toctree-l1"><a class="reference internal" href="rust.html">Rust</a></li>
                
              </ul>
            </div>
          </div>

        </div>
      </div>

      <div id="right-column">

        <div class="document clearer body">

          <div class="section">
            <h1 id="heading">
  Erlang Language<a class="headerlink" href="#heading" title="Permalink">¶</a>
</h1>

<p>
  A lexer for the Erlang language.
</p>


<p>
  This page shows examples of source files lexed by the same lexer,
  but rendered into HTML using different styles.
</p>

<p>
  Some styles are richer than others in that they define more different token categories.

  Examples of such richer styles are the <a href="#default">Default</a> style,
  the <a href="#tango">Tango</a> style and the <a href="#colorful">Colorful</a> style.
</p>

<p>
  In all cases the lexer is the same, and the only difference is the colors defined by the styles.
</p>


  <h2 id="abap">
    Abap Style (abap)<a class="headerlink" href="#abap" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-abap"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">abap_style</span><span class="p" data-group-id="1708412174-1">(</span><span class="p" data-group-id="1708412174-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="abap-example.erl">
      example.erl<a class="headerlink" href="#abap-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-abap"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9300747518-1">(</span><span class="ss">test</span><span class="p" data-group-id="9300747518-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9300747518-2">(</span><span class="p" data-group-id="9300747518-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9300747518-3">]</span><span class="p" data-group-id="9300747518-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9300747518-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9300747518-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9300747518-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9300747518-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9300747518-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9300747518-9">}</span><span class="p" data-group-id="9300747518-6">]</span><span class="p" data-group-id="9300747518-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9300747518-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9300747518-11">}</span><span class="p" data-group-id="9300747518-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9300747518-12">(</span><span class="n">Port</span><span class="p" data-group-id="9300747518-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9300747518-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9300747518-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9300747518-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9300747518-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9300747518-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-17">[</span><span class="p" data-group-id="9300747518-18">[</span><span class="p" data-group-id="9300747518-18">]</span><span class="p" data-group-id="9300747518-17">]</span><span class="p" data-group-id="9300747518-16">)</span><span class="p" data-group-id="9300747518-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9300747518-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9300747518-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9300747518-20">(</span><span class="n">Players</span><span class="p" data-group-id="9300747518-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9300747518-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-22">[</span><span class="p" data-group-id="9300747518-22">]</span><span class="p" data-group-id="9300747518-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9300747518-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9300747518-24">(</span><span class="n">P</span><span class="p" data-group-id="9300747518-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9300747518-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-26">[</span><span class="n">P</span><span class="p" data-group-id="9300747518-26">]</span><span class="p" data-group-id="9300747518-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9300747518-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9300747518-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9300747518-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9300747518-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9300747518-29">(</span><span class="n">Player</span><span class="p" data-group-id="9300747518-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9300747518-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-31">[</span><span class="n">Player</span><span class="p" data-group-id="9300747518-31">]</span><span class="p" data-group-id="9300747518-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9300747518-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9300747518-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9300747518-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9300747518-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9300747518-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-36">[</span><span class="n">Player</span><span class="p" data-group-id="9300747518-36">]</span><span class="p" data-group-id="9300747518-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9300747518-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9300747518-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9300747518-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9300747518-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9300747518-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9300747518-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9300747518-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9300747518-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9300747518-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9300747518-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9300747518-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9300747518-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9300747518-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9300747518-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9300747518-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9300747518-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9300747518-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9300747518-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9300747518-49">(</span><span class="n">Player</span><span class="p" data-group-id="9300747518-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9300747518-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9300747518-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9300747518-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9300747518-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9300747518-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9300747518-53">(</span><span class="n">P</span><span class="p" data-group-id="9300747518-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9300747518-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9300747518-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9300747518-55">(</span><span class="n">P</span><span class="p" data-group-id="9300747518-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9300747518-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9300747518-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9300747518-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9300747518-57">(</span><span class="p" data-group-id="9300747518-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-58">{</span><span class="p" data-group-id="9300747518-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9300747518-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9300747518-60">}</span><span class="p" data-group-id="9300747518-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9300747518-61">(</span><span class="p" data-group-id="9300747518-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9300747518-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9300747518-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9300747518-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9300747518-64">]</span><span class="w">
        </span><span class="p" data-group-id="9300747518-63">)</span><span class="w">
    </span><span class="p" data-group-id="9300747518-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9300747518-65">(</span><span class="p" data-group-id="9300747518-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9300747518-66">(</span><span class="p" data-group-id="9300747518-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9300747518-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9300747518-68">]</span><span class="p" data-group-id="9300747518-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9300747518-69">(</span><span class="p" data-group-id="9300747518-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9300747518-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9300747518-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9300747518-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9300747518-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9300747518-72">(</span><span class="p" data-group-id="9300747518-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9300747518-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9300747518-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9300747518-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9300747518-76">]</span><span class="p" data-group-id="9300747518-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9300747518-78">(</span><span class="n">H</span><span class="p" data-group-id="9300747518-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9300747518-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9300747518-79">)</span><span class="p" data-group-id="9300747518-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9300747518-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9300747518-81">[</span><span class="p" data-group-id="9300747518-81">]</span><span class="p" data-group-id="9300747518-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9300747518-82">[</span><span class="p" data-group-id="9300747518-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9300747518-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9300747518-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9300747518-84">(</span><span class="p" data-group-id="9300747518-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9300747518-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9300747518-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9300747518-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9300747518-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9300747518-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9300747518-89">(</span><span class="p" data-group-id="9300747518-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9300747518-90">{</span><span class="nf">self</span><span class="p" data-group-id="9300747518-91">(</span><span class="p" data-group-id="9300747518-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9300747518-92">(</span><span class="n">X</span><span class="p" data-group-id="9300747518-92">)</span><span class="p" data-group-id="9300747518-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9300747518-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9300747518-87">]</span><span class="w">
    </span><span class="p" data-group-id="9300747518-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol">
    Algol Style (algol)<a class="headerlink" href="#algol" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_style</span><span class="p" data-group-id="6742815084-1">(</span><span class="p" data-group-id="6742815084-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="algol-example.erl">
      example.erl<a class="headerlink" href="#algol-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0030706155-1">(</span><span class="ss">test</span><span class="p" data-group-id="0030706155-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0030706155-2">(</span><span class="p" data-group-id="0030706155-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0030706155-3">]</span><span class="p" data-group-id="0030706155-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0030706155-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0030706155-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0030706155-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0030706155-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0030706155-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0030706155-9">}</span><span class="p" data-group-id="0030706155-6">]</span><span class="p" data-group-id="0030706155-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0030706155-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0030706155-11">}</span><span class="p" data-group-id="0030706155-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0030706155-12">(</span><span class="n">Port</span><span class="p" data-group-id="0030706155-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0030706155-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0030706155-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0030706155-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0030706155-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0030706155-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-17">[</span><span class="p" data-group-id="0030706155-18">[</span><span class="p" data-group-id="0030706155-18">]</span><span class="p" data-group-id="0030706155-17">]</span><span class="p" data-group-id="0030706155-16">)</span><span class="p" data-group-id="0030706155-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0030706155-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0030706155-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0030706155-20">(</span><span class="n">Players</span><span class="p" data-group-id="0030706155-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0030706155-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-22">[</span><span class="p" data-group-id="0030706155-22">]</span><span class="p" data-group-id="0030706155-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0030706155-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0030706155-24">(</span><span class="n">P</span><span class="p" data-group-id="0030706155-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0030706155-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-26">[</span><span class="n">P</span><span class="p" data-group-id="0030706155-26">]</span><span class="p" data-group-id="0030706155-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0030706155-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0030706155-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0030706155-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0030706155-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0030706155-29">(</span><span class="n">Player</span><span class="p" data-group-id="0030706155-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0030706155-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-31">[</span><span class="n">Player</span><span class="p" data-group-id="0030706155-31">]</span><span class="p" data-group-id="0030706155-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0030706155-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0030706155-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0030706155-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0030706155-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0030706155-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-36">[</span><span class="n">Player</span><span class="p" data-group-id="0030706155-36">]</span><span class="p" data-group-id="0030706155-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0030706155-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0030706155-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0030706155-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0030706155-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0030706155-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0030706155-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0030706155-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0030706155-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0030706155-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0030706155-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0030706155-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0030706155-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0030706155-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0030706155-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0030706155-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0030706155-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0030706155-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0030706155-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0030706155-49">(</span><span class="n">Player</span><span class="p" data-group-id="0030706155-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0030706155-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0030706155-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0030706155-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0030706155-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0030706155-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0030706155-53">(</span><span class="n">P</span><span class="p" data-group-id="0030706155-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0030706155-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0030706155-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0030706155-55">(</span><span class="n">P</span><span class="p" data-group-id="0030706155-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0030706155-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0030706155-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0030706155-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0030706155-57">(</span><span class="p" data-group-id="0030706155-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-58">{</span><span class="p" data-group-id="0030706155-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0030706155-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0030706155-60">}</span><span class="p" data-group-id="0030706155-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0030706155-61">(</span><span class="p" data-group-id="0030706155-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0030706155-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0030706155-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0030706155-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0030706155-64">]</span><span class="w">
        </span><span class="p" data-group-id="0030706155-63">)</span><span class="w">
    </span><span class="p" data-group-id="0030706155-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0030706155-65">(</span><span class="p" data-group-id="0030706155-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0030706155-66">(</span><span class="p" data-group-id="0030706155-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0030706155-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0030706155-68">]</span><span class="p" data-group-id="0030706155-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0030706155-69">(</span><span class="p" data-group-id="0030706155-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0030706155-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0030706155-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0030706155-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0030706155-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0030706155-72">(</span><span class="p" data-group-id="0030706155-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0030706155-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0030706155-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0030706155-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0030706155-76">]</span><span class="p" data-group-id="0030706155-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0030706155-78">(</span><span class="n">H</span><span class="p" data-group-id="0030706155-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0030706155-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0030706155-79">)</span><span class="p" data-group-id="0030706155-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0030706155-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0030706155-81">[</span><span class="p" data-group-id="0030706155-81">]</span><span class="p" data-group-id="0030706155-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0030706155-82">[</span><span class="p" data-group-id="0030706155-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0030706155-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0030706155-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0030706155-84">(</span><span class="p" data-group-id="0030706155-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0030706155-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0030706155-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0030706155-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0030706155-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0030706155-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0030706155-89">(</span><span class="p" data-group-id="0030706155-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0030706155-90">{</span><span class="nf">self</span><span class="p" data-group-id="0030706155-91">(</span><span class="p" data-group-id="0030706155-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0030706155-92">(</span><span class="n">X</span><span class="p" data-group-id="0030706155-92">)</span><span class="p" data-group-id="0030706155-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0030706155-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0030706155-87">]</span><span class="w">
    </span><span class="p" data-group-id="0030706155-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="algol_nu">
    Algol_Nu Style (algol_nu)<a class="headerlink" href="#algol_nu" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-algol_nu"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">algol_nu_style</span><span class="p" data-group-id="4842128365-1">(</span><span class="p" data-group-id="4842128365-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="algol_nu-example.erl">
      example.erl<a class="headerlink" href="#algol_nu-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-algol_nu"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8911406816-1">(</span><span class="ss">test</span><span class="p" data-group-id="8911406816-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8911406816-2">(</span><span class="p" data-group-id="8911406816-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8911406816-3">]</span><span class="p" data-group-id="8911406816-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8911406816-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8911406816-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8911406816-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8911406816-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8911406816-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8911406816-9">}</span><span class="p" data-group-id="8911406816-6">]</span><span class="p" data-group-id="8911406816-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8911406816-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8911406816-11">}</span><span class="p" data-group-id="8911406816-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8911406816-12">(</span><span class="n">Port</span><span class="p" data-group-id="8911406816-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8911406816-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8911406816-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8911406816-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8911406816-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8911406816-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-17">[</span><span class="p" data-group-id="8911406816-18">[</span><span class="p" data-group-id="8911406816-18">]</span><span class="p" data-group-id="8911406816-17">]</span><span class="p" data-group-id="8911406816-16">)</span><span class="p" data-group-id="8911406816-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8911406816-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8911406816-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8911406816-20">(</span><span class="n">Players</span><span class="p" data-group-id="8911406816-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8911406816-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-22">[</span><span class="p" data-group-id="8911406816-22">]</span><span class="p" data-group-id="8911406816-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8911406816-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8911406816-24">(</span><span class="n">P</span><span class="p" data-group-id="8911406816-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8911406816-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-26">[</span><span class="n">P</span><span class="p" data-group-id="8911406816-26">]</span><span class="p" data-group-id="8911406816-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8911406816-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8911406816-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8911406816-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8911406816-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8911406816-29">(</span><span class="n">Player</span><span class="p" data-group-id="8911406816-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8911406816-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-31">[</span><span class="n">Player</span><span class="p" data-group-id="8911406816-31">]</span><span class="p" data-group-id="8911406816-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8911406816-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8911406816-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8911406816-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8911406816-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8911406816-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-36">[</span><span class="n">Player</span><span class="p" data-group-id="8911406816-36">]</span><span class="p" data-group-id="8911406816-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8911406816-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8911406816-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8911406816-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8911406816-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8911406816-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8911406816-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8911406816-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8911406816-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8911406816-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8911406816-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8911406816-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8911406816-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8911406816-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8911406816-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8911406816-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8911406816-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8911406816-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8911406816-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8911406816-49">(</span><span class="n">Player</span><span class="p" data-group-id="8911406816-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8911406816-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8911406816-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8911406816-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8911406816-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8911406816-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8911406816-53">(</span><span class="n">P</span><span class="p" data-group-id="8911406816-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8911406816-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8911406816-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8911406816-55">(</span><span class="n">P</span><span class="p" data-group-id="8911406816-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8911406816-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8911406816-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8911406816-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8911406816-57">(</span><span class="p" data-group-id="8911406816-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-58">{</span><span class="p" data-group-id="8911406816-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8911406816-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8911406816-60">}</span><span class="p" data-group-id="8911406816-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8911406816-61">(</span><span class="p" data-group-id="8911406816-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8911406816-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8911406816-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8911406816-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8911406816-64">]</span><span class="w">
        </span><span class="p" data-group-id="8911406816-63">)</span><span class="w">
    </span><span class="p" data-group-id="8911406816-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8911406816-65">(</span><span class="p" data-group-id="8911406816-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8911406816-66">(</span><span class="p" data-group-id="8911406816-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8911406816-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8911406816-68">]</span><span class="p" data-group-id="8911406816-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8911406816-69">(</span><span class="p" data-group-id="8911406816-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8911406816-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8911406816-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8911406816-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8911406816-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8911406816-72">(</span><span class="p" data-group-id="8911406816-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8911406816-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8911406816-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8911406816-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8911406816-76">]</span><span class="p" data-group-id="8911406816-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8911406816-78">(</span><span class="n">H</span><span class="p" data-group-id="8911406816-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8911406816-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8911406816-79">)</span><span class="p" data-group-id="8911406816-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8911406816-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8911406816-81">[</span><span class="p" data-group-id="8911406816-81">]</span><span class="p" data-group-id="8911406816-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8911406816-82">[</span><span class="p" data-group-id="8911406816-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8911406816-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8911406816-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8911406816-84">(</span><span class="p" data-group-id="8911406816-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8911406816-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8911406816-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8911406816-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8911406816-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8911406816-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8911406816-89">(</span><span class="p" data-group-id="8911406816-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8911406816-90">{</span><span class="nf">self</span><span class="p" data-group-id="8911406816-91">(</span><span class="p" data-group-id="8911406816-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8911406816-92">(</span><span class="n">X</span><span class="p" data-group-id="8911406816-92">)</span><span class="p" data-group-id="8911406816-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8911406816-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8911406816-87">]</span><span class="w">
    </span><span class="p" data-group-id="8911406816-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="arduino">
    Arduino Style (arduino)<a class="headerlink" href="#arduino" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-arduino"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">arduino_style</span><span class="p" data-group-id="4244039020-1">(</span><span class="p" data-group-id="4244039020-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="arduino-example.erl">
      example.erl<a class="headerlink" href="#arduino-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-arduino"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8597051852-1">(</span><span class="ss">test</span><span class="p" data-group-id="8597051852-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8597051852-2">(</span><span class="p" data-group-id="8597051852-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8597051852-3">]</span><span class="p" data-group-id="8597051852-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8597051852-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8597051852-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8597051852-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8597051852-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8597051852-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8597051852-9">}</span><span class="p" data-group-id="8597051852-6">]</span><span class="p" data-group-id="8597051852-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8597051852-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8597051852-11">}</span><span class="p" data-group-id="8597051852-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8597051852-12">(</span><span class="n">Port</span><span class="p" data-group-id="8597051852-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8597051852-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8597051852-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8597051852-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8597051852-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8597051852-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-17">[</span><span class="p" data-group-id="8597051852-18">[</span><span class="p" data-group-id="8597051852-18">]</span><span class="p" data-group-id="8597051852-17">]</span><span class="p" data-group-id="8597051852-16">)</span><span class="p" data-group-id="8597051852-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8597051852-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8597051852-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8597051852-20">(</span><span class="n">Players</span><span class="p" data-group-id="8597051852-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8597051852-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-22">[</span><span class="p" data-group-id="8597051852-22">]</span><span class="p" data-group-id="8597051852-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8597051852-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8597051852-24">(</span><span class="n">P</span><span class="p" data-group-id="8597051852-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8597051852-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-26">[</span><span class="n">P</span><span class="p" data-group-id="8597051852-26">]</span><span class="p" data-group-id="8597051852-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8597051852-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8597051852-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8597051852-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8597051852-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8597051852-29">(</span><span class="n">Player</span><span class="p" data-group-id="8597051852-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8597051852-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-31">[</span><span class="n">Player</span><span class="p" data-group-id="8597051852-31">]</span><span class="p" data-group-id="8597051852-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8597051852-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8597051852-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8597051852-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8597051852-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8597051852-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-36">[</span><span class="n">Player</span><span class="p" data-group-id="8597051852-36">]</span><span class="p" data-group-id="8597051852-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8597051852-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8597051852-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8597051852-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8597051852-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8597051852-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8597051852-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8597051852-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8597051852-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8597051852-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8597051852-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8597051852-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8597051852-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8597051852-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8597051852-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8597051852-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8597051852-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8597051852-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8597051852-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8597051852-49">(</span><span class="n">Player</span><span class="p" data-group-id="8597051852-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8597051852-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8597051852-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8597051852-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8597051852-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8597051852-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8597051852-53">(</span><span class="n">P</span><span class="p" data-group-id="8597051852-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8597051852-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8597051852-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8597051852-55">(</span><span class="n">P</span><span class="p" data-group-id="8597051852-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8597051852-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8597051852-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8597051852-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8597051852-57">(</span><span class="p" data-group-id="8597051852-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-58">{</span><span class="p" data-group-id="8597051852-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8597051852-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8597051852-60">}</span><span class="p" data-group-id="8597051852-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8597051852-61">(</span><span class="p" data-group-id="8597051852-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8597051852-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8597051852-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8597051852-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8597051852-64">]</span><span class="w">
        </span><span class="p" data-group-id="8597051852-63">)</span><span class="w">
    </span><span class="p" data-group-id="8597051852-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8597051852-65">(</span><span class="p" data-group-id="8597051852-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8597051852-66">(</span><span class="p" data-group-id="8597051852-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8597051852-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8597051852-68">]</span><span class="p" data-group-id="8597051852-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8597051852-69">(</span><span class="p" data-group-id="8597051852-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8597051852-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8597051852-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8597051852-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8597051852-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8597051852-72">(</span><span class="p" data-group-id="8597051852-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8597051852-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8597051852-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8597051852-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8597051852-76">]</span><span class="p" data-group-id="8597051852-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8597051852-78">(</span><span class="n">H</span><span class="p" data-group-id="8597051852-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8597051852-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8597051852-79">)</span><span class="p" data-group-id="8597051852-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8597051852-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8597051852-81">[</span><span class="p" data-group-id="8597051852-81">]</span><span class="p" data-group-id="8597051852-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8597051852-82">[</span><span class="p" data-group-id="8597051852-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8597051852-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8597051852-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8597051852-84">(</span><span class="p" data-group-id="8597051852-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8597051852-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8597051852-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8597051852-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8597051852-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8597051852-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8597051852-89">(</span><span class="p" data-group-id="8597051852-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8597051852-90">{</span><span class="nf">self</span><span class="p" data-group-id="8597051852-91">(</span><span class="p" data-group-id="8597051852-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8597051852-92">(</span><span class="n">X</span><span class="p" data-group-id="8597051852-92">)</span><span class="p" data-group-id="8597051852-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8597051852-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8597051852-87">]</span><span class="w">
    </span><span class="p" data-group-id="8597051852-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="autumn">
    Autumn Style (autumn)<a class="headerlink" href="#autumn" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-autumn"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">autumn_style</span><span class="p" data-group-id="2793397183-1">(</span><span class="p" data-group-id="2793397183-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="autumn-example.erl">
      example.erl<a class="headerlink" href="#autumn-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-autumn"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="5508947238-1">(</span><span class="ss">test</span><span class="p" data-group-id="5508947238-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="5508947238-2">(</span><span class="p" data-group-id="5508947238-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="5508947238-3">]</span><span class="p" data-group-id="5508947238-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="5508947238-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="5508947238-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="5508947238-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5508947238-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="5508947238-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5508947238-9">}</span><span class="p" data-group-id="5508947238-6">]</span><span class="p" data-group-id="5508947238-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="5508947238-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="5508947238-11">}</span><span class="p" data-group-id="5508947238-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="5508947238-12">(</span><span class="n">Port</span><span class="p" data-group-id="5508947238-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="5508947238-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="5508947238-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="5508947238-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="5508947238-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="5508947238-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-17">[</span><span class="p" data-group-id="5508947238-18">[</span><span class="p" data-group-id="5508947238-18">]</span><span class="p" data-group-id="5508947238-17">]</span><span class="p" data-group-id="5508947238-16">)</span><span class="p" data-group-id="5508947238-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="5508947238-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="5508947238-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="5508947238-20">(</span><span class="n">Players</span><span class="p" data-group-id="5508947238-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5508947238-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-22">[</span><span class="p" data-group-id="5508947238-22">]</span><span class="p" data-group-id="5508947238-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5508947238-23">(</span><span class="nf">fun</span><span class="p" data-group-id="5508947238-24">(</span><span class="n">P</span><span class="p" data-group-id="5508947238-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5508947238-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-26">[</span><span class="n">P</span><span class="p" data-group-id="5508947238-26">]</span><span class="p" data-group-id="5508947238-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="5508947238-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5508947238-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="5508947238-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="5508947238-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5508947238-29">(</span><span class="n">Player</span><span class="p" data-group-id="5508947238-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5508947238-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-31">[</span><span class="n">Player</span><span class="p" data-group-id="5508947238-31">]</span><span class="p" data-group-id="5508947238-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5508947238-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5508947238-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="5508947238-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5508947238-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5508947238-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-36">[</span><span class="n">Player</span><span class="p" data-group-id="5508947238-36">]</span><span class="p" data-group-id="5508947238-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="5508947238-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="5508947238-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5508947238-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5508947238-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="5508947238-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5508947238-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="5508947238-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="5508947238-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="5508947238-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="5508947238-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="5508947238-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="5508947238-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="5508947238-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="5508947238-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="5508947238-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="5508947238-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="5508947238-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="5508947238-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="5508947238-49">(</span><span class="n">Player</span><span class="p" data-group-id="5508947238-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5508947238-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="5508947238-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="5508947238-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5508947238-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="5508947238-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5508947238-53">(</span><span class="n">P</span><span class="p" data-group-id="5508947238-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="5508947238-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="5508947238-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="5508947238-55">(</span><span class="n">P</span><span class="p" data-group-id="5508947238-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="5508947238-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="5508947238-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="5508947238-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="5508947238-57">(</span><span class="p" data-group-id="5508947238-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-58">{</span><span class="p" data-group-id="5508947238-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="5508947238-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5508947238-60">}</span><span class="p" data-group-id="5508947238-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="5508947238-61">(</span><span class="p" data-group-id="5508947238-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="5508947238-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="5508947238-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="5508947238-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="5508947238-64">]</span><span class="w">
        </span><span class="p" data-group-id="5508947238-63">)</span><span class="w">
    </span><span class="p" data-group-id="5508947238-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="5508947238-65">(</span><span class="p" data-group-id="5508947238-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="5508947238-66">(</span><span class="p" data-group-id="5508947238-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5508947238-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="5508947238-68">]</span><span class="p" data-group-id="5508947238-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="5508947238-69">(</span><span class="p" data-group-id="5508947238-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5508947238-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5508947238-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="5508947238-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="5508947238-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="5508947238-72">(</span><span class="p" data-group-id="5508947238-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="5508947238-74">{</span><span class="ss">fff</span><span class="p" data-group-id="5508947238-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="5508947238-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5508947238-76">]</span><span class="p" data-group-id="5508947238-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-77">[</span><span class="n">Fun</span><span class="p" data-group-id="5508947238-78">(</span><span class="n">H</span><span class="p" data-group-id="5508947238-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="5508947238-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="5508947238-79">)</span><span class="p" data-group-id="5508947238-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="5508947238-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5508947238-81">[</span><span class="p" data-group-id="5508947238-81">]</span><span class="p" data-group-id="5508947238-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="5508947238-82">[</span><span class="p" data-group-id="5508947238-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="5508947238-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="5508947238-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="5508947238-84">(</span><span class="p" data-group-id="5508947238-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5508947238-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="5508947238-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="5508947238-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="5508947238-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="5508947238-88">(</span><span class="nf">fun</span><span class="p" data-group-id="5508947238-89">(</span><span class="p" data-group-id="5508947238-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="5508947238-90">{</span><span class="nf">self</span><span class="p" data-group-id="5508947238-91">(</span><span class="p" data-group-id="5508947238-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="5508947238-92">(</span><span class="n">X</span><span class="p" data-group-id="5508947238-92">)</span><span class="p" data-group-id="5508947238-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="5508947238-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="5508947238-87">]</span><span class="w">
    </span><span class="p" data-group-id="5508947238-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="borland">
    Borland Style (borland)<a class="headerlink" href="#borland" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-borland"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">borland_style</span><span class="p" data-group-id="0489127175-1">(</span><span class="p" data-group-id="0489127175-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="borland-example.erl">
      example.erl<a class="headerlink" href="#borland-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-borland"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4952482512-1">(</span><span class="ss">test</span><span class="p" data-group-id="4952482512-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4952482512-2">(</span><span class="p" data-group-id="4952482512-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4952482512-3">]</span><span class="p" data-group-id="4952482512-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4952482512-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4952482512-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4952482512-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4952482512-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4952482512-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4952482512-9">}</span><span class="p" data-group-id="4952482512-6">]</span><span class="p" data-group-id="4952482512-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4952482512-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4952482512-11">}</span><span class="p" data-group-id="4952482512-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4952482512-12">(</span><span class="n">Port</span><span class="p" data-group-id="4952482512-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4952482512-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4952482512-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4952482512-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4952482512-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4952482512-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-17">[</span><span class="p" data-group-id="4952482512-18">[</span><span class="p" data-group-id="4952482512-18">]</span><span class="p" data-group-id="4952482512-17">]</span><span class="p" data-group-id="4952482512-16">)</span><span class="p" data-group-id="4952482512-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4952482512-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4952482512-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4952482512-20">(</span><span class="n">Players</span><span class="p" data-group-id="4952482512-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4952482512-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-22">[</span><span class="p" data-group-id="4952482512-22">]</span><span class="p" data-group-id="4952482512-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4952482512-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4952482512-24">(</span><span class="n">P</span><span class="p" data-group-id="4952482512-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4952482512-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-26">[</span><span class="n">P</span><span class="p" data-group-id="4952482512-26">]</span><span class="p" data-group-id="4952482512-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4952482512-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4952482512-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4952482512-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4952482512-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4952482512-29">(</span><span class="n">Player</span><span class="p" data-group-id="4952482512-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4952482512-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-31">[</span><span class="n">Player</span><span class="p" data-group-id="4952482512-31">]</span><span class="p" data-group-id="4952482512-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4952482512-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4952482512-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4952482512-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4952482512-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4952482512-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-36">[</span><span class="n">Player</span><span class="p" data-group-id="4952482512-36">]</span><span class="p" data-group-id="4952482512-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4952482512-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4952482512-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4952482512-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4952482512-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4952482512-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4952482512-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4952482512-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4952482512-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4952482512-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4952482512-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4952482512-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4952482512-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4952482512-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4952482512-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4952482512-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4952482512-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4952482512-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4952482512-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4952482512-49">(</span><span class="n">Player</span><span class="p" data-group-id="4952482512-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4952482512-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4952482512-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4952482512-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4952482512-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4952482512-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4952482512-53">(</span><span class="n">P</span><span class="p" data-group-id="4952482512-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4952482512-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4952482512-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4952482512-55">(</span><span class="n">P</span><span class="p" data-group-id="4952482512-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4952482512-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4952482512-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4952482512-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4952482512-57">(</span><span class="p" data-group-id="4952482512-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-58">{</span><span class="p" data-group-id="4952482512-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4952482512-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4952482512-60">}</span><span class="p" data-group-id="4952482512-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4952482512-61">(</span><span class="p" data-group-id="4952482512-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4952482512-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4952482512-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4952482512-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4952482512-64">]</span><span class="w">
        </span><span class="p" data-group-id="4952482512-63">)</span><span class="w">
    </span><span class="p" data-group-id="4952482512-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4952482512-65">(</span><span class="p" data-group-id="4952482512-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4952482512-66">(</span><span class="p" data-group-id="4952482512-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4952482512-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4952482512-68">]</span><span class="p" data-group-id="4952482512-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4952482512-69">(</span><span class="p" data-group-id="4952482512-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4952482512-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4952482512-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4952482512-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4952482512-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4952482512-72">(</span><span class="p" data-group-id="4952482512-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4952482512-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4952482512-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4952482512-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4952482512-76">]</span><span class="p" data-group-id="4952482512-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4952482512-78">(</span><span class="n">H</span><span class="p" data-group-id="4952482512-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4952482512-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4952482512-79">)</span><span class="p" data-group-id="4952482512-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4952482512-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4952482512-81">[</span><span class="p" data-group-id="4952482512-81">]</span><span class="p" data-group-id="4952482512-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4952482512-82">[</span><span class="p" data-group-id="4952482512-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4952482512-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4952482512-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4952482512-84">(</span><span class="p" data-group-id="4952482512-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4952482512-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4952482512-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4952482512-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4952482512-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4952482512-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4952482512-89">(</span><span class="p" data-group-id="4952482512-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4952482512-90">{</span><span class="nf">self</span><span class="p" data-group-id="4952482512-91">(</span><span class="p" data-group-id="4952482512-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4952482512-92">(</span><span class="n">X</span><span class="p" data-group-id="4952482512-92">)</span><span class="p" data-group-id="4952482512-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4952482512-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4952482512-87">]</span><span class="w">
    </span><span class="p" data-group-id="4952482512-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="bw">
    BlackWhite Style (bw)<a class="headerlink" href="#bw" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-bw"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">bw_style</span><span class="p" data-group-id="1852797748-1">(</span><span class="p" data-group-id="1852797748-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="bw-example.erl">
      example.erl<a class="headerlink" href="#bw-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-bw"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1576621160-1">(</span><span class="ss">test</span><span class="p" data-group-id="1576621160-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1576621160-2">(</span><span class="p" data-group-id="1576621160-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1576621160-3">]</span><span class="p" data-group-id="1576621160-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1576621160-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1576621160-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1576621160-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1576621160-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1576621160-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1576621160-9">}</span><span class="p" data-group-id="1576621160-6">]</span><span class="p" data-group-id="1576621160-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1576621160-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1576621160-11">}</span><span class="p" data-group-id="1576621160-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1576621160-12">(</span><span class="n">Port</span><span class="p" data-group-id="1576621160-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1576621160-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1576621160-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1576621160-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1576621160-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1576621160-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-17">[</span><span class="p" data-group-id="1576621160-18">[</span><span class="p" data-group-id="1576621160-18">]</span><span class="p" data-group-id="1576621160-17">]</span><span class="p" data-group-id="1576621160-16">)</span><span class="p" data-group-id="1576621160-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1576621160-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1576621160-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1576621160-20">(</span><span class="n">Players</span><span class="p" data-group-id="1576621160-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1576621160-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-22">[</span><span class="p" data-group-id="1576621160-22">]</span><span class="p" data-group-id="1576621160-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1576621160-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1576621160-24">(</span><span class="n">P</span><span class="p" data-group-id="1576621160-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1576621160-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-26">[</span><span class="n">P</span><span class="p" data-group-id="1576621160-26">]</span><span class="p" data-group-id="1576621160-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1576621160-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1576621160-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1576621160-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1576621160-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1576621160-29">(</span><span class="n">Player</span><span class="p" data-group-id="1576621160-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1576621160-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-31">[</span><span class="n">Player</span><span class="p" data-group-id="1576621160-31">]</span><span class="p" data-group-id="1576621160-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1576621160-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1576621160-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1576621160-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1576621160-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1576621160-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-36">[</span><span class="n">Player</span><span class="p" data-group-id="1576621160-36">]</span><span class="p" data-group-id="1576621160-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1576621160-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1576621160-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1576621160-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1576621160-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1576621160-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1576621160-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1576621160-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1576621160-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1576621160-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1576621160-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1576621160-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1576621160-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1576621160-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1576621160-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1576621160-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1576621160-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1576621160-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1576621160-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1576621160-49">(</span><span class="n">Player</span><span class="p" data-group-id="1576621160-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1576621160-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1576621160-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1576621160-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1576621160-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1576621160-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1576621160-53">(</span><span class="n">P</span><span class="p" data-group-id="1576621160-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1576621160-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1576621160-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1576621160-55">(</span><span class="n">P</span><span class="p" data-group-id="1576621160-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1576621160-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1576621160-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1576621160-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1576621160-57">(</span><span class="p" data-group-id="1576621160-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-58">{</span><span class="p" data-group-id="1576621160-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1576621160-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1576621160-60">}</span><span class="p" data-group-id="1576621160-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1576621160-61">(</span><span class="p" data-group-id="1576621160-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1576621160-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1576621160-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1576621160-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1576621160-64">]</span><span class="w">
        </span><span class="p" data-group-id="1576621160-63">)</span><span class="w">
    </span><span class="p" data-group-id="1576621160-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1576621160-65">(</span><span class="p" data-group-id="1576621160-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1576621160-66">(</span><span class="p" data-group-id="1576621160-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1576621160-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1576621160-68">]</span><span class="p" data-group-id="1576621160-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1576621160-69">(</span><span class="p" data-group-id="1576621160-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1576621160-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1576621160-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1576621160-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1576621160-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1576621160-72">(</span><span class="p" data-group-id="1576621160-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1576621160-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1576621160-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1576621160-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1576621160-76">]</span><span class="p" data-group-id="1576621160-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1576621160-78">(</span><span class="n">H</span><span class="p" data-group-id="1576621160-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1576621160-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1576621160-79">)</span><span class="p" data-group-id="1576621160-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1576621160-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1576621160-81">[</span><span class="p" data-group-id="1576621160-81">]</span><span class="p" data-group-id="1576621160-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1576621160-82">[</span><span class="p" data-group-id="1576621160-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1576621160-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1576621160-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1576621160-84">(</span><span class="p" data-group-id="1576621160-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1576621160-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1576621160-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1576621160-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1576621160-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1576621160-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1576621160-89">(</span><span class="p" data-group-id="1576621160-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1576621160-90">{</span><span class="nf">self</span><span class="p" data-group-id="1576621160-91">(</span><span class="p" data-group-id="1576621160-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1576621160-92">(</span><span class="n">X</span><span class="p" data-group-id="1576621160-92">)</span><span class="p" data-group-id="1576621160-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1576621160-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1576621160-87">]</span><span class="w">
    </span><span class="p" data-group-id="1576621160-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="colorful">
    Colorful Style (colorful)<a class="headerlink" href="#colorful" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-colorful"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">colorful_style</span><span class="p" data-group-id="0178573609-1">(</span><span class="p" data-group-id="0178573609-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="colorful-example.erl">
      example.erl<a class="headerlink" href="#colorful-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-colorful"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9362708050-1">(</span><span class="ss">test</span><span class="p" data-group-id="9362708050-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9362708050-2">(</span><span class="p" data-group-id="9362708050-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9362708050-3">]</span><span class="p" data-group-id="9362708050-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9362708050-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9362708050-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9362708050-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9362708050-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9362708050-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9362708050-9">}</span><span class="p" data-group-id="9362708050-6">]</span><span class="p" data-group-id="9362708050-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9362708050-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9362708050-11">}</span><span class="p" data-group-id="9362708050-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9362708050-12">(</span><span class="n">Port</span><span class="p" data-group-id="9362708050-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9362708050-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9362708050-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9362708050-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9362708050-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9362708050-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-17">[</span><span class="p" data-group-id="9362708050-18">[</span><span class="p" data-group-id="9362708050-18">]</span><span class="p" data-group-id="9362708050-17">]</span><span class="p" data-group-id="9362708050-16">)</span><span class="p" data-group-id="9362708050-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9362708050-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9362708050-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9362708050-20">(</span><span class="n">Players</span><span class="p" data-group-id="9362708050-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9362708050-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-22">[</span><span class="p" data-group-id="9362708050-22">]</span><span class="p" data-group-id="9362708050-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9362708050-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9362708050-24">(</span><span class="n">P</span><span class="p" data-group-id="9362708050-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9362708050-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-26">[</span><span class="n">P</span><span class="p" data-group-id="9362708050-26">]</span><span class="p" data-group-id="9362708050-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9362708050-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9362708050-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9362708050-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9362708050-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9362708050-29">(</span><span class="n">Player</span><span class="p" data-group-id="9362708050-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9362708050-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-31">[</span><span class="n">Player</span><span class="p" data-group-id="9362708050-31">]</span><span class="p" data-group-id="9362708050-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9362708050-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9362708050-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9362708050-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9362708050-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9362708050-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-36">[</span><span class="n">Player</span><span class="p" data-group-id="9362708050-36">]</span><span class="p" data-group-id="9362708050-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9362708050-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9362708050-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9362708050-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9362708050-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9362708050-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9362708050-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9362708050-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9362708050-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9362708050-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9362708050-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9362708050-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9362708050-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9362708050-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9362708050-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9362708050-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9362708050-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9362708050-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9362708050-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9362708050-49">(</span><span class="n">Player</span><span class="p" data-group-id="9362708050-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9362708050-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9362708050-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9362708050-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9362708050-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9362708050-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9362708050-53">(</span><span class="n">P</span><span class="p" data-group-id="9362708050-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9362708050-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9362708050-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9362708050-55">(</span><span class="n">P</span><span class="p" data-group-id="9362708050-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9362708050-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9362708050-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9362708050-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9362708050-57">(</span><span class="p" data-group-id="9362708050-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-58">{</span><span class="p" data-group-id="9362708050-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9362708050-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9362708050-60">}</span><span class="p" data-group-id="9362708050-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9362708050-61">(</span><span class="p" data-group-id="9362708050-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9362708050-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9362708050-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9362708050-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9362708050-64">]</span><span class="w">
        </span><span class="p" data-group-id="9362708050-63">)</span><span class="w">
    </span><span class="p" data-group-id="9362708050-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9362708050-65">(</span><span class="p" data-group-id="9362708050-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9362708050-66">(</span><span class="p" data-group-id="9362708050-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9362708050-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9362708050-68">]</span><span class="p" data-group-id="9362708050-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9362708050-69">(</span><span class="p" data-group-id="9362708050-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9362708050-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9362708050-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9362708050-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9362708050-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9362708050-72">(</span><span class="p" data-group-id="9362708050-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9362708050-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9362708050-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9362708050-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9362708050-76">]</span><span class="p" data-group-id="9362708050-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9362708050-78">(</span><span class="n">H</span><span class="p" data-group-id="9362708050-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9362708050-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9362708050-79">)</span><span class="p" data-group-id="9362708050-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9362708050-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9362708050-81">[</span><span class="p" data-group-id="9362708050-81">]</span><span class="p" data-group-id="9362708050-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9362708050-82">[</span><span class="p" data-group-id="9362708050-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9362708050-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9362708050-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9362708050-84">(</span><span class="p" data-group-id="9362708050-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9362708050-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9362708050-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9362708050-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9362708050-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9362708050-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9362708050-89">(</span><span class="p" data-group-id="9362708050-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9362708050-90">{</span><span class="nf">self</span><span class="p" data-group-id="9362708050-91">(</span><span class="p" data-group-id="9362708050-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9362708050-92">(</span><span class="n">X</span><span class="p" data-group-id="9362708050-92">)</span><span class="p" data-group-id="9362708050-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9362708050-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9362708050-87">]</span><span class="w">
    </span><span class="p" data-group-id="9362708050-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="default">
    Default Style (default)<a class="headerlink" href="#default" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-default"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">default_style</span><span class="p" data-group-id="9118628400-1">(</span><span class="p" data-group-id="9118628400-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="default-example.erl">
      example.erl<a class="headerlink" href="#default-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-default"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7296557731-1">(</span><span class="ss">test</span><span class="p" data-group-id="7296557731-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7296557731-2">(</span><span class="p" data-group-id="7296557731-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7296557731-3">]</span><span class="p" data-group-id="7296557731-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7296557731-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7296557731-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7296557731-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7296557731-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7296557731-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7296557731-9">}</span><span class="p" data-group-id="7296557731-6">]</span><span class="p" data-group-id="7296557731-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7296557731-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7296557731-11">}</span><span class="p" data-group-id="7296557731-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7296557731-12">(</span><span class="n">Port</span><span class="p" data-group-id="7296557731-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7296557731-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7296557731-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7296557731-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7296557731-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7296557731-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-17">[</span><span class="p" data-group-id="7296557731-18">[</span><span class="p" data-group-id="7296557731-18">]</span><span class="p" data-group-id="7296557731-17">]</span><span class="p" data-group-id="7296557731-16">)</span><span class="p" data-group-id="7296557731-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7296557731-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7296557731-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7296557731-20">(</span><span class="n">Players</span><span class="p" data-group-id="7296557731-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7296557731-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-22">[</span><span class="p" data-group-id="7296557731-22">]</span><span class="p" data-group-id="7296557731-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7296557731-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7296557731-24">(</span><span class="n">P</span><span class="p" data-group-id="7296557731-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7296557731-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-26">[</span><span class="n">P</span><span class="p" data-group-id="7296557731-26">]</span><span class="p" data-group-id="7296557731-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7296557731-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7296557731-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7296557731-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7296557731-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7296557731-29">(</span><span class="n">Player</span><span class="p" data-group-id="7296557731-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7296557731-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-31">[</span><span class="n">Player</span><span class="p" data-group-id="7296557731-31">]</span><span class="p" data-group-id="7296557731-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7296557731-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7296557731-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7296557731-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7296557731-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7296557731-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-36">[</span><span class="n">Player</span><span class="p" data-group-id="7296557731-36">]</span><span class="p" data-group-id="7296557731-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7296557731-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7296557731-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7296557731-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7296557731-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7296557731-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7296557731-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7296557731-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7296557731-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7296557731-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7296557731-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7296557731-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7296557731-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7296557731-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7296557731-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7296557731-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7296557731-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7296557731-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7296557731-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7296557731-49">(</span><span class="n">Player</span><span class="p" data-group-id="7296557731-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7296557731-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7296557731-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7296557731-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7296557731-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7296557731-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7296557731-53">(</span><span class="n">P</span><span class="p" data-group-id="7296557731-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7296557731-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7296557731-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7296557731-55">(</span><span class="n">P</span><span class="p" data-group-id="7296557731-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7296557731-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7296557731-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7296557731-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7296557731-57">(</span><span class="p" data-group-id="7296557731-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-58">{</span><span class="p" data-group-id="7296557731-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7296557731-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7296557731-60">}</span><span class="p" data-group-id="7296557731-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7296557731-61">(</span><span class="p" data-group-id="7296557731-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7296557731-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7296557731-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7296557731-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7296557731-64">]</span><span class="w">
        </span><span class="p" data-group-id="7296557731-63">)</span><span class="w">
    </span><span class="p" data-group-id="7296557731-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7296557731-65">(</span><span class="p" data-group-id="7296557731-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7296557731-66">(</span><span class="p" data-group-id="7296557731-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7296557731-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7296557731-68">]</span><span class="p" data-group-id="7296557731-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7296557731-69">(</span><span class="p" data-group-id="7296557731-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7296557731-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7296557731-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7296557731-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7296557731-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7296557731-72">(</span><span class="p" data-group-id="7296557731-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7296557731-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7296557731-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7296557731-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7296557731-76">]</span><span class="p" data-group-id="7296557731-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7296557731-78">(</span><span class="n">H</span><span class="p" data-group-id="7296557731-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7296557731-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7296557731-79">)</span><span class="p" data-group-id="7296557731-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7296557731-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7296557731-81">[</span><span class="p" data-group-id="7296557731-81">]</span><span class="p" data-group-id="7296557731-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7296557731-82">[</span><span class="p" data-group-id="7296557731-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7296557731-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7296557731-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7296557731-84">(</span><span class="p" data-group-id="7296557731-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7296557731-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7296557731-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7296557731-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7296557731-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7296557731-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7296557731-89">(</span><span class="p" data-group-id="7296557731-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7296557731-90">{</span><span class="nf">self</span><span class="p" data-group-id="7296557731-91">(</span><span class="p" data-group-id="7296557731-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7296557731-92">(</span><span class="n">X</span><span class="p" data-group-id="7296557731-92">)</span><span class="p" data-group-id="7296557731-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7296557731-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7296557731-87">]</span><span class="w">
    </span><span class="p" data-group-id="7296557731-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="emacs">
    Emacs Style (emacs)<a class="headerlink" href="#emacs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-emacs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">emacs_style</span><span class="p" data-group-id="3306164864-1">(</span><span class="p" data-group-id="3306164864-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="emacs-example.erl">
      example.erl<a class="headerlink" href="#emacs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-emacs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4199567185-1">(</span><span class="ss">test</span><span class="p" data-group-id="4199567185-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4199567185-2">(</span><span class="p" data-group-id="4199567185-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4199567185-3">]</span><span class="p" data-group-id="4199567185-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4199567185-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4199567185-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4199567185-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4199567185-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4199567185-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4199567185-9">}</span><span class="p" data-group-id="4199567185-6">]</span><span class="p" data-group-id="4199567185-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4199567185-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4199567185-11">}</span><span class="p" data-group-id="4199567185-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4199567185-12">(</span><span class="n">Port</span><span class="p" data-group-id="4199567185-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4199567185-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4199567185-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4199567185-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4199567185-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4199567185-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-17">[</span><span class="p" data-group-id="4199567185-18">[</span><span class="p" data-group-id="4199567185-18">]</span><span class="p" data-group-id="4199567185-17">]</span><span class="p" data-group-id="4199567185-16">)</span><span class="p" data-group-id="4199567185-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4199567185-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4199567185-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4199567185-20">(</span><span class="n">Players</span><span class="p" data-group-id="4199567185-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4199567185-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-22">[</span><span class="p" data-group-id="4199567185-22">]</span><span class="p" data-group-id="4199567185-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4199567185-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4199567185-24">(</span><span class="n">P</span><span class="p" data-group-id="4199567185-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4199567185-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-26">[</span><span class="n">P</span><span class="p" data-group-id="4199567185-26">]</span><span class="p" data-group-id="4199567185-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4199567185-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4199567185-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4199567185-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4199567185-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4199567185-29">(</span><span class="n">Player</span><span class="p" data-group-id="4199567185-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4199567185-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-31">[</span><span class="n">Player</span><span class="p" data-group-id="4199567185-31">]</span><span class="p" data-group-id="4199567185-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4199567185-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4199567185-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4199567185-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4199567185-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4199567185-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-36">[</span><span class="n">Player</span><span class="p" data-group-id="4199567185-36">]</span><span class="p" data-group-id="4199567185-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4199567185-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4199567185-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4199567185-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4199567185-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4199567185-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4199567185-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4199567185-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4199567185-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4199567185-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4199567185-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4199567185-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4199567185-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4199567185-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4199567185-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4199567185-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4199567185-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4199567185-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4199567185-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4199567185-49">(</span><span class="n">Player</span><span class="p" data-group-id="4199567185-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4199567185-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4199567185-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4199567185-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4199567185-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4199567185-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4199567185-53">(</span><span class="n">P</span><span class="p" data-group-id="4199567185-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4199567185-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4199567185-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4199567185-55">(</span><span class="n">P</span><span class="p" data-group-id="4199567185-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4199567185-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4199567185-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4199567185-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4199567185-57">(</span><span class="p" data-group-id="4199567185-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-58">{</span><span class="p" data-group-id="4199567185-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4199567185-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4199567185-60">}</span><span class="p" data-group-id="4199567185-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4199567185-61">(</span><span class="p" data-group-id="4199567185-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4199567185-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4199567185-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4199567185-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4199567185-64">]</span><span class="w">
        </span><span class="p" data-group-id="4199567185-63">)</span><span class="w">
    </span><span class="p" data-group-id="4199567185-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4199567185-65">(</span><span class="p" data-group-id="4199567185-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4199567185-66">(</span><span class="p" data-group-id="4199567185-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4199567185-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4199567185-68">]</span><span class="p" data-group-id="4199567185-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4199567185-69">(</span><span class="p" data-group-id="4199567185-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4199567185-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4199567185-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4199567185-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4199567185-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4199567185-72">(</span><span class="p" data-group-id="4199567185-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4199567185-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4199567185-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4199567185-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4199567185-76">]</span><span class="p" data-group-id="4199567185-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4199567185-78">(</span><span class="n">H</span><span class="p" data-group-id="4199567185-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4199567185-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4199567185-79">)</span><span class="p" data-group-id="4199567185-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4199567185-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4199567185-81">[</span><span class="p" data-group-id="4199567185-81">]</span><span class="p" data-group-id="4199567185-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4199567185-82">[</span><span class="p" data-group-id="4199567185-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4199567185-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4199567185-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4199567185-84">(</span><span class="p" data-group-id="4199567185-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4199567185-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4199567185-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4199567185-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4199567185-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4199567185-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4199567185-89">(</span><span class="p" data-group-id="4199567185-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4199567185-90">{</span><span class="nf">self</span><span class="p" data-group-id="4199567185-91">(</span><span class="p" data-group-id="4199567185-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4199567185-92">(</span><span class="n">X</span><span class="p" data-group-id="4199567185-92">)</span><span class="p" data-group-id="4199567185-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4199567185-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4199567185-87">]</span><span class="w">
    </span><span class="p" data-group-id="4199567185-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="friendly">
    Friendly Style (friendly)<a class="headerlink" href="#friendly" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-friendly"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">friendly_style</span><span class="p" data-group-id="3255603117-1">(</span><span class="p" data-group-id="3255603117-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="friendly-example.erl">
      example.erl<a class="headerlink" href="#friendly-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-friendly"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1138080147-1">(</span><span class="ss">test</span><span class="p" data-group-id="1138080147-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1138080147-2">(</span><span class="p" data-group-id="1138080147-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1138080147-3">]</span><span class="p" data-group-id="1138080147-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1138080147-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1138080147-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1138080147-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1138080147-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1138080147-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1138080147-9">}</span><span class="p" data-group-id="1138080147-6">]</span><span class="p" data-group-id="1138080147-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1138080147-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1138080147-11">}</span><span class="p" data-group-id="1138080147-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1138080147-12">(</span><span class="n">Port</span><span class="p" data-group-id="1138080147-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1138080147-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1138080147-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1138080147-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1138080147-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1138080147-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-17">[</span><span class="p" data-group-id="1138080147-18">[</span><span class="p" data-group-id="1138080147-18">]</span><span class="p" data-group-id="1138080147-17">]</span><span class="p" data-group-id="1138080147-16">)</span><span class="p" data-group-id="1138080147-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1138080147-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1138080147-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1138080147-20">(</span><span class="n">Players</span><span class="p" data-group-id="1138080147-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1138080147-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-22">[</span><span class="p" data-group-id="1138080147-22">]</span><span class="p" data-group-id="1138080147-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1138080147-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1138080147-24">(</span><span class="n">P</span><span class="p" data-group-id="1138080147-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1138080147-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-26">[</span><span class="n">P</span><span class="p" data-group-id="1138080147-26">]</span><span class="p" data-group-id="1138080147-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1138080147-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1138080147-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1138080147-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1138080147-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1138080147-29">(</span><span class="n">Player</span><span class="p" data-group-id="1138080147-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1138080147-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-31">[</span><span class="n">Player</span><span class="p" data-group-id="1138080147-31">]</span><span class="p" data-group-id="1138080147-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1138080147-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1138080147-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1138080147-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1138080147-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1138080147-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-36">[</span><span class="n">Player</span><span class="p" data-group-id="1138080147-36">]</span><span class="p" data-group-id="1138080147-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1138080147-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1138080147-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1138080147-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1138080147-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1138080147-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1138080147-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1138080147-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1138080147-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1138080147-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1138080147-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1138080147-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1138080147-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1138080147-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1138080147-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1138080147-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1138080147-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1138080147-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1138080147-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1138080147-49">(</span><span class="n">Player</span><span class="p" data-group-id="1138080147-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1138080147-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1138080147-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1138080147-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1138080147-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1138080147-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1138080147-53">(</span><span class="n">P</span><span class="p" data-group-id="1138080147-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1138080147-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1138080147-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1138080147-55">(</span><span class="n">P</span><span class="p" data-group-id="1138080147-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1138080147-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1138080147-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1138080147-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1138080147-57">(</span><span class="p" data-group-id="1138080147-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-58">{</span><span class="p" data-group-id="1138080147-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1138080147-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1138080147-60">}</span><span class="p" data-group-id="1138080147-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1138080147-61">(</span><span class="p" data-group-id="1138080147-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1138080147-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1138080147-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1138080147-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1138080147-64">]</span><span class="w">
        </span><span class="p" data-group-id="1138080147-63">)</span><span class="w">
    </span><span class="p" data-group-id="1138080147-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1138080147-65">(</span><span class="p" data-group-id="1138080147-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1138080147-66">(</span><span class="p" data-group-id="1138080147-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1138080147-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1138080147-68">]</span><span class="p" data-group-id="1138080147-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1138080147-69">(</span><span class="p" data-group-id="1138080147-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1138080147-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1138080147-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1138080147-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1138080147-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1138080147-72">(</span><span class="p" data-group-id="1138080147-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1138080147-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1138080147-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1138080147-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1138080147-76">]</span><span class="p" data-group-id="1138080147-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1138080147-78">(</span><span class="n">H</span><span class="p" data-group-id="1138080147-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1138080147-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1138080147-79">)</span><span class="p" data-group-id="1138080147-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1138080147-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1138080147-81">[</span><span class="p" data-group-id="1138080147-81">]</span><span class="p" data-group-id="1138080147-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1138080147-82">[</span><span class="p" data-group-id="1138080147-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1138080147-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1138080147-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1138080147-84">(</span><span class="p" data-group-id="1138080147-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1138080147-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1138080147-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1138080147-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1138080147-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1138080147-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1138080147-89">(</span><span class="p" data-group-id="1138080147-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1138080147-90">{</span><span class="nf">self</span><span class="p" data-group-id="1138080147-91">(</span><span class="p" data-group-id="1138080147-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1138080147-92">(</span><span class="n">X</span><span class="p" data-group-id="1138080147-92">)</span><span class="p" data-group-id="1138080147-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1138080147-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1138080147-87">]</span><span class="w">
    </span><span class="p" data-group-id="1138080147-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="fruity">
    Fruity Style (fruity)<a class="headerlink" href="#fruity" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-fruity"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">fruity_style</span><span class="p" data-group-id="2920579928-1">(</span><span class="p" data-group-id="2920579928-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="fruity-example.erl">
      example.erl<a class="headerlink" href="#fruity-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-fruity"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0780663770-1">(</span><span class="ss">test</span><span class="p" data-group-id="0780663770-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0780663770-2">(</span><span class="p" data-group-id="0780663770-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0780663770-3">]</span><span class="p" data-group-id="0780663770-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0780663770-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0780663770-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0780663770-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0780663770-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0780663770-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0780663770-9">}</span><span class="p" data-group-id="0780663770-6">]</span><span class="p" data-group-id="0780663770-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0780663770-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0780663770-11">}</span><span class="p" data-group-id="0780663770-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0780663770-12">(</span><span class="n">Port</span><span class="p" data-group-id="0780663770-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0780663770-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0780663770-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0780663770-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0780663770-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0780663770-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-17">[</span><span class="p" data-group-id="0780663770-18">[</span><span class="p" data-group-id="0780663770-18">]</span><span class="p" data-group-id="0780663770-17">]</span><span class="p" data-group-id="0780663770-16">)</span><span class="p" data-group-id="0780663770-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0780663770-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0780663770-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0780663770-20">(</span><span class="n">Players</span><span class="p" data-group-id="0780663770-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0780663770-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-22">[</span><span class="p" data-group-id="0780663770-22">]</span><span class="p" data-group-id="0780663770-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0780663770-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0780663770-24">(</span><span class="n">P</span><span class="p" data-group-id="0780663770-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0780663770-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-26">[</span><span class="n">P</span><span class="p" data-group-id="0780663770-26">]</span><span class="p" data-group-id="0780663770-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0780663770-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0780663770-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0780663770-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0780663770-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0780663770-29">(</span><span class="n">Player</span><span class="p" data-group-id="0780663770-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0780663770-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-31">[</span><span class="n">Player</span><span class="p" data-group-id="0780663770-31">]</span><span class="p" data-group-id="0780663770-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0780663770-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0780663770-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0780663770-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0780663770-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0780663770-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-36">[</span><span class="n">Player</span><span class="p" data-group-id="0780663770-36">]</span><span class="p" data-group-id="0780663770-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0780663770-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0780663770-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0780663770-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0780663770-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0780663770-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0780663770-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0780663770-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0780663770-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0780663770-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0780663770-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0780663770-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0780663770-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0780663770-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0780663770-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0780663770-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0780663770-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0780663770-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0780663770-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0780663770-49">(</span><span class="n">Player</span><span class="p" data-group-id="0780663770-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0780663770-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0780663770-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0780663770-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0780663770-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0780663770-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0780663770-53">(</span><span class="n">P</span><span class="p" data-group-id="0780663770-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0780663770-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0780663770-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0780663770-55">(</span><span class="n">P</span><span class="p" data-group-id="0780663770-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0780663770-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0780663770-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0780663770-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0780663770-57">(</span><span class="p" data-group-id="0780663770-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-58">{</span><span class="p" data-group-id="0780663770-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0780663770-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0780663770-60">}</span><span class="p" data-group-id="0780663770-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0780663770-61">(</span><span class="p" data-group-id="0780663770-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0780663770-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0780663770-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0780663770-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0780663770-64">]</span><span class="w">
        </span><span class="p" data-group-id="0780663770-63">)</span><span class="w">
    </span><span class="p" data-group-id="0780663770-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0780663770-65">(</span><span class="p" data-group-id="0780663770-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0780663770-66">(</span><span class="p" data-group-id="0780663770-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0780663770-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0780663770-68">]</span><span class="p" data-group-id="0780663770-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0780663770-69">(</span><span class="p" data-group-id="0780663770-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0780663770-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0780663770-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0780663770-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0780663770-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0780663770-72">(</span><span class="p" data-group-id="0780663770-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0780663770-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0780663770-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0780663770-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0780663770-76">]</span><span class="p" data-group-id="0780663770-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0780663770-78">(</span><span class="n">H</span><span class="p" data-group-id="0780663770-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0780663770-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0780663770-79">)</span><span class="p" data-group-id="0780663770-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0780663770-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0780663770-81">[</span><span class="p" data-group-id="0780663770-81">]</span><span class="p" data-group-id="0780663770-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0780663770-82">[</span><span class="p" data-group-id="0780663770-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0780663770-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0780663770-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0780663770-84">(</span><span class="p" data-group-id="0780663770-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0780663770-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0780663770-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0780663770-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0780663770-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0780663770-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0780663770-89">(</span><span class="p" data-group-id="0780663770-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0780663770-90">{</span><span class="nf">self</span><span class="p" data-group-id="0780663770-91">(</span><span class="p" data-group-id="0780663770-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0780663770-92">(</span><span class="n">X</span><span class="p" data-group-id="0780663770-92">)</span><span class="p" data-group-id="0780663770-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0780663770-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0780663770-87">]</span><span class="w">
    </span><span class="p" data-group-id="0780663770-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="igor">
    Igor Style (igor)<a class="headerlink" href="#igor" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-igor"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">igor_style</span><span class="p" data-group-id="4815023860-1">(</span><span class="p" data-group-id="4815023860-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="igor-example.erl">
      example.erl<a class="headerlink" href="#igor-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-igor"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="8029180893-1">(</span><span class="ss">test</span><span class="p" data-group-id="8029180893-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="8029180893-2">(</span><span class="p" data-group-id="8029180893-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="8029180893-3">]</span><span class="p" data-group-id="8029180893-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="8029180893-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="8029180893-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="8029180893-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8029180893-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="8029180893-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8029180893-9">}</span><span class="p" data-group-id="8029180893-6">]</span><span class="p" data-group-id="8029180893-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="8029180893-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="8029180893-11">}</span><span class="p" data-group-id="8029180893-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="8029180893-12">(</span><span class="n">Port</span><span class="p" data-group-id="8029180893-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="8029180893-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="8029180893-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="8029180893-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="8029180893-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="8029180893-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-17">[</span><span class="p" data-group-id="8029180893-18">[</span><span class="p" data-group-id="8029180893-18">]</span><span class="p" data-group-id="8029180893-17">]</span><span class="p" data-group-id="8029180893-16">)</span><span class="p" data-group-id="8029180893-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="8029180893-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="8029180893-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="8029180893-20">(</span><span class="n">Players</span><span class="p" data-group-id="8029180893-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8029180893-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-22">[</span><span class="p" data-group-id="8029180893-22">]</span><span class="p" data-group-id="8029180893-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8029180893-23">(</span><span class="nf">fun</span><span class="p" data-group-id="8029180893-24">(</span><span class="n">P</span><span class="p" data-group-id="8029180893-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8029180893-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-26">[</span><span class="n">P</span><span class="p" data-group-id="8029180893-26">]</span><span class="p" data-group-id="8029180893-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="8029180893-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8029180893-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="8029180893-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="8029180893-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8029180893-29">(</span><span class="n">Player</span><span class="p" data-group-id="8029180893-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8029180893-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-31">[</span><span class="n">Player</span><span class="p" data-group-id="8029180893-31">]</span><span class="p" data-group-id="8029180893-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8029180893-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8029180893-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8029180893-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8029180893-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8029180893-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-36">[</span><span class="n">Player</span><span class="p" data-group-id="8029180893-36">]</span><span class="p" data-group-id="8029180893-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="8029180893-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="8029180893-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8029180893-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8029180893-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="8029180893-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8029180893-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="8029180893-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="8029180893-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="8029180893-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="8029180893-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="8029180893-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="8029180893-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="8029180893-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="8029180893-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="8029180893-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="8029180893-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="8029180893-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="8029180893-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="8029180893-49">(</span><span class="n">Player</span><span class="p" data-group-id="8029180893-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8029180893-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="8029180893-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="8029180893-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8029180893-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="8029180893-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8029180893-53">(</span><span class="n">P</span><span class="p" data-group-id="8029180893-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="8029180893-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="8029180893-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="8029180893-55">(</span><span class="n">P</span><span class="p" data-group-id="8029180893-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="8029180893-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="8029180893-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="8029180893-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="8029180893-57">(</span><span class="p" data-group-id="8029180893-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-58">{</span><span class="p" data-group-id="8029180893-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="8029180893-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8029180893-60">}</span><span class="p" data-group-id="8029180893-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="8029180893-61">(</span><span class="p" data-group-id="8029180893-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="8029180893-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="8029180893-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="8029180893-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="8029180893-64">]</span><span class="w">
        </span><span class="p" data-group-id="8029180893-63">)</span><span class="w">
    </span><span class="p" data-group-id="8029180893-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="8029180893-65">(</span><span class="p" data-group-id="8029180893-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="8029180893-66">(</span><span class="p" data-group-id="8029180893-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8029180893-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="8029180893-68">]</span><span class="p" data-group-id="8029180893-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="8029180893-69">(</span><span class="p" data-group-id="8029180893-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8029180893-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="8029180893-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="8029180893-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="8029180893-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="8029180893-72">(</span><span class="p" data-group-id="8029180893-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="8029180893-74">{</span><span class="ss">fff</span><span class="p" data-group-id="8029180893-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="8029180893-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8029180893-76">]</span><span class="p" data-group-id="8029180893-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-77">[</span><span class="n">Fun</span><span class="p" data-group-id="8029180893-78">(</span><span class="n">H</span><span class="p" data-group-id="8029180893-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="8029180893-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="8029180893-79">)</span><span class="p" data-group-id="8029180893-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="8029180893-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8029180893-81">[</span><span class="p" data-group-id="8029180893-81">]</span><span class="p" data-group-id="8029180893-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="8029180893-82">[</span><span class="p" data-group-id="8029180893-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="8029180893-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="8029180893-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="8029180893-84">(</span><span class="p" data-group-id="8029180893-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8029180893-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="8029180893-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="8029180893-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="8029180893-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="8029180893-88">(</span><span class="nf">fun</span><span class="p" data-group-id="8029180893-89">(</span><span class="p" data-group-id="8029180893-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="8029180893-90">{</span><span class="nf">self</span><span class="p" data-group-id="8029180893-91">(</span><span class="p" data-group-id="8029180893-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="8029180893-92">(</span><span class="n">X</span><span class="p" data-group-id="8029180893-92">)</span><span class="p" data-group-id="8029180893-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="8029180893-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="8029180893-87">]</span><span class="w">
    </span><span class="p" data-group-id="8029180893-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="lovelace">
    Lovelace Style (lovelace)<a class="headerlink" href="#lovelace" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-lovelace"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">lovelace_style</span><span class="p" data-group-id="6843182185-1">(</span><span class="p" data-group-id="6843182185-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="lovelace-example.erl">
      example.erl<a class="headerlink" href="#lovelace-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-lovelace"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7867954046-1">(</span><span class="ss">test</span><span class="p" data-group-id="7867954046-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7867954046-2">(</span><span class="p" data-group-id="7867954046-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7867954046-3">]</span><span class="p" data-group-id="7867954046-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7867954046-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7867954046-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7867954046-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7867954046-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7867954046-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7867954046-9">}</span><span class="p" data-group-id="7867954046-6">]</span><span class="p" data-group-id="7867954046-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7867954046-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7867954046-11">}</span><span class="p" data-group-id="7867954046-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7867954046-12">(</span><span class="n">Port</span><span class="p" data-group-id="7867954046-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7867954046-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7867954046-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7867954046-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7867954046-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7867954046-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-17">[</span><span class="p" data-group-id="7867954046-18">[</span><span class="p" data-group-id="7867954046-18">]</span><span class="p" data-group-id="7867954046-17">]</span><span class="p" data-group-id="7867954046-16">)</span><span class="p" data-group-id="7867954046-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7867954046-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7867954046-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7867954046-20">(</span><span class="n">Players</span><span class="p" data-group-id="7867954046-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7867954046-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-22">[</span><span class="p" data-group-id="7867954046-22">]</span><span class="p" data-group-id="7867954046-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7867954046-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7867954046-24">(</span><span class="n">P</span><span class="p" data-group-id="7867954046-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7867954046-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-26">[</span><span class="n">P</span><span class="p" data-group-id="7867954046-26">]</span><span class="p" data-group-id="7867954046-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7867954046-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7867954046-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7867954046-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7867954046-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7867954046-29">(</span><span class="n">Player</span><span class="p" data-group-id="7867954046-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7867954046-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-31">[</span><span class="n">Player</span><span class="p" data-group-id="7867954046-31">]</span><span class="p" data-group-id="7867954046-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7867954046-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7867954046-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7867954046-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7867954046-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7867954046-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-36">[</span><span class="n">Player</span><span class="p" data-group-id="7867954046-36">]</span><span class="p" data-group-id="7867954046-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7867954046-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7867954046-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7867954046-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7867954046-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7867954046-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7867954046-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7867954046-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7867954046-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7867954046-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7867954046-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7867954046-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7867954046-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7867954046-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7867954046-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7867954046-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7867954046-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7867954046-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7867954046-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7867954046-49">(</span><span class="n">Player</span><span class="p" data-group-id="7867954046-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7867954046-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7867954046-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7867954046-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7867954046-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7867954046-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7867954046-53">(</span><span class="n">P</span><span class="p" data-group-id="7867954046-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7867954046-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7867954046-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7867954046-55">(</span><span class="n">P</span><span class="p" data-group-id="7867954046-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7867954046-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7867954046-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7867954046-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7867954046-57">(</span><span class="p" data-group-id="7867954046-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-58">{</span><span class="p" data-group-id="7867954046-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7867954046-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7867954046-60">}</span><span class="p" data-group-id="7867954046-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7867954046-61">(</span><span class="p" data-group-id="7867954046-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7867954046-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7867954046-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7867954046-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7867954046-64">]</span><span class="w">
        </span><span class="p" data-group-id="7867954046-63">)</span><span class="w">
    </span><span class="p" data-group-id="7867954046-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7867954046-65">(</span><span class="p" data-group-id="7867954046-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7867954046-66">(</span><span class="p" data-group-id="7867954046-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7867954046-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7867954046-68">]</span><span class="p" data-group-id="7867954046-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7867954046-69">(</span><span class="p" data-group-id="7867954046-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7867954046-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7867954046-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7867954046-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7867954046-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7867954046-72">(</span><span class="p" data-group-id="7867954046-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7867954046-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7867954046-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7867954046-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7867954046-76">]</span><span class="p" data-group-id="7867954046-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7867954046-78">(</span><span class="n">H</span><span class="p" data-group-id="7867954046-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7867954046-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7867954046-79">)</span><span class="p" data-group-id="7867954046-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7867954046-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7867954046-81">[</span><span class="p" data-group-id="7867954046-81">]</span><span class="p" data-group-id="7867954046-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7867954046-82">[</span><span class="p" data-group-id="7867954046-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7867954046-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7867954046-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7867954046-84">(</span><span class="p" data-group-id="7867954046-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7867954046-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7867954046-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7867954046-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7867954046-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7867954046-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7867954046-89">(</span><span class="p" data-group-id="7867954046-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7867954046-90">{</span><span class="nf">self</span><span class="p" data-group-id="7867954046-91">(</span><span class="p" data-group-id="7867954046-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7867954046-92">(</span><span class="n">X</span><span class="p" data-group-id="7867954046-92">)</span><span class="p" data-group-id="7867954046-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7867954046-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7867954046-87">]</span><span class="w">
    </span><span class="p" data-group-id="7867954046-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="manni">
    Manni Style (manni)<a class="headerlink" href="#manni" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-manni"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">manni_style</span><span class="p" data-group-id="5072316862-1">(</span><span class="p" data-group-id="5072316862-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="manni-example.erl">
      example.erl<a class="headerlink" href="#manni-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-manni"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9997253739-1">(</span><span class="ss">test</span><span class="p" data-group-id="9997253739-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9997253739-2">(</span><span class="p" data-group-id="9997253739-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9997253739-3">]</span><span class="p" data-group-id="9997253739-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9997253739-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9997253739-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9997253739-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9997253739-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9997253739-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9997253739-9">}</span><span class="p" data-group-id="9997253739-6">]</span><span class="p" data-group-id="9997253739-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9997253739-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9997253739-11">}</span><span class="p" data-group-id="9997253739-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9997253739-12">(</span><span class="n">Port</span><span class="p" data-group-id="9997253739-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9997253739-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9997253739-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9997253739-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9997253739-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9997253739-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-17">[</span><span class="p" data-group-id="9997253739-18">[</span><span class="p" data-group-id="9997253739-18">]</span><span class="p" data-group-id="9997253739-17">]</span><span class="p" data-group-id="9997253739-16">)</span><span class="p" data-group-id="9997253739-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9997253739-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9997253739-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9997253739-20">(</span><span class="n">Players</span><span class="p" data-group-id="9997253739-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9997253739-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-22">[</span><span class="p" data-group-id="9997253739-22">]</span><span class="p" data-group-id="9997253739-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9997253739-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9997253739-24">(</span><span class="n">P</span><span class="p" data-group-id="9997253739-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9997253739-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-26">[</span><span class="n">P</span><span class="p" data-group-id="9997253739-26">]</span><span class="p" data-group-id="9997253739-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9997253739-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9997253739-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9997253739-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9997253739-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9997253739-29">(</span><span class="n">Player</span><span class="p" data-group-id="9997253739-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9997253739-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-31">[</span><span class="n">Player</span><span class="p" data-group-id="9997253739-31">]</span><span class="p" data-group-id="9997253739-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9997253739-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9997253739-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9997253739-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9997253739-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9997253739-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-36">[</span><span class="n">Player</span><span class="p" data-group-id="9997253739-36">]</span><span class="p" data-group-id="9997253739-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9997253739-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9997253739-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9997253739-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9997253739-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9997253739-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9997253739-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9997253739-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9997253739-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9997253739-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9997253739-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9997253739-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9997253739-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9997253739-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9997253739-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9997253739-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9997253739-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9997253739-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9997253739-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9997253739-49">(</span><span class="n">Player</span><span class="p" data-group-id="9997253739-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9997253739-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9997253739-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9997253739-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9997253739-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9997253739-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9997253739-53">(</span><span class="n">P</span><span class="p" data-group-id="9997253739-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9997253739-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9997253739-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9997253739-55">(</span><span class="n">P</span><span class="p" data-group-id="9997253739-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9997253739-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9997253739-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9997253739-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9997253739-57">(</span><span class="p" data-group-id="9997253739-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-58">{</span><span class="p" data-group-id="9997253739-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9997253739-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9997253739-60">}</span><span class="p" data-group-id="9997253739-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9997253739-61">(</span><span class="p" data-group-id="9997253739-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9997253739-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9997253739-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9997253739-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9997253739-64">]</span><span class="w">
        </span><span class="p" data-group-id="9997253739-63">)</span><span class="w">
    </span><span class="p" data-group-id="9997253739-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9997253739-65">(</span><span class="p" data-group-id="9997253739-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9997253739-66">(</span><span class="p" data-group-id="9997253739-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9997253739-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9997253739-68">]</span><span class="p" data-group-id="9997253739-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9997253739-69">(</span><span class="p" data-group-id="9997253739-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9997253739-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9997253739-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9997253739-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9997253739-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9997253739-72">(</span><span class="p" data-group-id="9997253739-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9997253739-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9997253739-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9997253739-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9997253739-76">]</span><span class="p" data-group-id="9997253739-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9997253739-78">(</span><span class="n">H</span><span class="p" data-group-id="9997253739-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9997253739-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9997253739-79">)</span><span class="p" data-group-id="9997253739-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9997253739-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9997253739-81">[</span><span class="p" data-group-id="9997253739-81">]</span><span class="p" data-group-id="9997253739-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9997253739-82">[</span><span class="p" data-group-id="9997253739-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9997253739-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9997253739-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9997253739-84">(</span><span class="p" data-group-id="9997253739-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9997253739-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9997253739-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9997253739-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9997253739-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9997253739-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9997253739-89">(</span><span class="p" data-group-id="9997253739-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9997253739-90">{</span><span class="nf">self</span><span class="p" data-group-id="9997253739-91">(</span><span class="p" data-group-id="9997253739-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9997253739-92">(</span><span class="n">X</span><span class="p" data-group-id="9997253739-92">)</span><span class="p" data-group-id="9997253739-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9997253739-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9997253739-87">]</span><span class="w">
    </span><span class="p" data-group-id="9997253739-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="monokai">
    Monokai Style (monokai)<a class="headerlink" href="#monokai" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-monokai"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">monokai_style</span><span class="p" data-group-id="4828704478-1">(</span><span class="p" data-group-id="4828704478-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="monokai-example.erl">
      example.erl<a class="headerlink" href="#monokai-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-monokai"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1048931873-1">(</span><span class="ss">test</span><span class="p" data-group-id="1048931873-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1048931873-2">(</span><span class="p" data-group-id="1048931873-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1048931873-3">]</span><span class="p" data-group-id="1048931873-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1048931873-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1048931873-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1048931873-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1048931873-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1048931873-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1048931873-9">}</span><span class="p" data-group-id="1048931873-6">]</span><span class="p" data-group-id="1048931873-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1048931873-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1048931873-11">}</span><span class="p" data-group-id="1048931873-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1048931873-12">(</span><span class="n">Port</span><span class="p" data-group-id="1048931873-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1048931873-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1048931873-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1048931873-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1048931873-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1048931873-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-17">[</span><span class="p" data-group-id="1048931873-18">[</span><span class="p" data-group-id="1048931873-18">]</span><span class="p" data-group-id="1048931873-17">]</span><span class="p" data-group-id="1048931873-16">)</span><span class="p" data-group-id="1048931873-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1048931873-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1048931873-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1048931873-20">(</span><span class="n">Players</span><span class="p" data-group-id="1048931873-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1048931873-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-22">[</span><span class="p" data-group-id="1048931873-22">]</span><span class="p" data-group-id="1048931873-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1048931873-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1048931873-24">(</span><span class="n">P</span><span class="p" data-group-id="1048931873-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1048931873-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-26">[</span><span class="n">P</span><span class="p" data-group-id="1048931873-26">]</span><span class="p" data-group-id="1048931873-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1048931873-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1048931873-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1048931873-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1048931873-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1048931873-29">(</span><span class="n">Player</span><span class="p" data-group-id="1048931873-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1048931873-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-31">[</span><span class="n">Player</span><span class="p" data-group-id="1048931873-31">]</span><span class="p" data-group-id="1048931873-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1048931873-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1048931873-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1048931873-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1048931873-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1048931873-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-36">[</span><span class="n">Player</span><span class="p" data-group-id="1048931873-36">]</span><span class="p" data-group-id="1048931873-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1048931873-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1048931873-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1048931873-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1048931873-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1048931873-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1048931873-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1048931873-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1048931873-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1048931873-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1048931873-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1048931873-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1048931873-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1048931873-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1048931873-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1048931873-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1048931873-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1048931873-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1048931873-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1048931873-49">(</span><span class="n">Player</span><span class="p" data-group-id="1048931873-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1048931873-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1048931873-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1048931873-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1048931873-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1048931873-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1048931873-53">(</span><span class="n">P</span><span class="p" data-group-id="1048931873-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1048931873-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1048931873-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1048931873-55">(</span><span class="n">P</span><span class="p" data-group-id="1048931873-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1048931873-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1048931873-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1048931873-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1048931873-57">(</span><span class="p" data-group-id="1048931873-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-58">{</span><span class="p" data-group-id="1048931873-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1048931873-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1048931873-60">}</span><span class="p" data-group-id="1048931873-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1048931873-61">(</span><span class="p" data-group-id="1048931873-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1048931873-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1048931873-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1048931873-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1048931873-64">]</span><span class="w">
        </span><span class="p" data-group-id="1048931873-63">)</span><span class="w">
    </span><span class="p" data-group-id="1048931873-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1048931873-65">(</span><span class="p" data-group-id="1048931873-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1048931873-66">(</span><span class="p" data-group-id="1048931873-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1048931873-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1048931873-68">]</span><span class="p" data-group-id="1048931873-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1048931873-69">(</span><span class="p" data-group-id="1048931873-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1048931873-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1048931873-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1048931873-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1048931873-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1048931873-72">(</span><span class="p" data-group-id="1048931873-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1048931873-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1048931873-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1048931873-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1048931873-76">]</span><span class="p" data-group-id="1048931873-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1048931873-78">(</span><span class="n">H</span><span class="p" data-group-id="1048931873-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1048931873-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1048931873-79">)</span><span class="p" data-group-id="1048931873-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1048931873-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1048931873-81">[</span><span class="p" data-group-id="1048931873-81">]</span><span class="p" data-group-id="1048931873-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1048931873-82">[</span><span class="p" data-group-id="1048931873-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1048931873-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1048931873-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1048931873-84">(</span><span class="p" data-group-id="1048931873-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1048931873-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1048931873-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1048931873-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1048931873-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1048931873-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1048931873-89">(</span><span class="p" data-group-id="1048931873-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1048931873-90">{</span><span class="nf">self</span><span class="p" data-group-id="1048931873-91">(</span><span class="p" data-group-id="1048931873-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1048931873-92">(</span><span class="n">X</span><span class="p" data-group-id="1048931873-92">)</span><span class="p" data-group-id="1048931873-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1048931873-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1048931873-87">]</span><span class="w">
    </span><span class="p" data-group-id="1048931873-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="murphy">
    Murphy Style (murphy)<a class="headerlink" href="#murphy" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-murphy"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">murphy_style</span><span class="p" data-group-id="8571970205-1">(</span><span class="p" data-group-id="8571970205-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="murphy-example.erl">
      example.erl<a class="headerlink" href="#murphy-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-murphy"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6888714341-1">(</span><span class="ss">test</span><span class="p" data-group-id="6888714341-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6888714341-2">(</span><span class="p" data-group-id="6888714341-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6888714341-3">]</span><span class="p" data-group-id="6888714341-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6888714341-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6888714341-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6888714341-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6888714341-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6888714341-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6888714341-9">}</span><span class="p" data-group-id="6888714341-6">]</span><span class="p" data-group-id="6888714341-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6888714341-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6888714341-11">}</span><span class="p" data-group-id="6888714341-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6888714341-12">(</span><span class="n">Port</span><span class="p" data-group-id="6888714341-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6888714341-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6888714341-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6888714341-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6888714341-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6888714341-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-17">[</span><span class="p" data-group-id="6888714341-18">[</span><span class="p" data-group-id="6888714341-18">]</span><span class="p" data-group-id="6888714341-17">]</span><span class="p" data-group-id="6888714341-16">)</span><span class="p" data-group-id="6888714341-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6888714341-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6888714341-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6888714341-20">(</span><span class="n">Players</span><span class="p" data-group-id="6888714341-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6888714341-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-22">[</span><span class="p" data-group-id="6888714341-22">]</span><span class="p" data-group-id="6888714341-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6888714341-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6888714341-24">(</span><span class="n">P</span><span class="p" data-group-id="6888714341-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6888714341-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-26">[</span><span class="n">P</span><span class="p" data-group-id="6888714341-26">]</span><span class="p" data-group-id="6888714341-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6888714341-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6888714341-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6888714341-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6888714341-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6888714341-29">(</span><span class="n">Player</span><span class="p" data-group-id="6888714341-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6888714341-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-31">[</span><span class="n">Player</span><span class="p" data-group-id="6888714341-31">]</span><span class="p" data-group-id="6888714341-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6888714341-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6888714341-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6888714341-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6888714341-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6888714341-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-36">[</span><span class="n">Player</span><span class="p" data-group-id="6888714341-36">]</span><span class="p" data-group-id="6888714341-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6888714341-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6888714341-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6888714341-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6888714341-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6888714341-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6888714341-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6888714341-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6888714341-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6888714341-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6888714341-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6888714341-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6888714341-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6888714341-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6888714341-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6888714341-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6888714341-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6888714341-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6888714341-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6888714341-49">(</span><span class="n">Player</span><span class="p" data-group-id="6888714341-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6888714341-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6888714341-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6888714341-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6888714341-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6888714341-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6888714341-53">(</span><span class="n">P</span><span class="p" data-group-id="6888714341-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6888714341-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6888714341-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6888714341-55">(</span><span class="n">P</span><span class="p" data-group-id="6888714341-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6888714341-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6888714341-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6888714341-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6888714341-57">(</span><span class="p" data-group-id="6888714341-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-58">{</span><span class="p" data-group-id="6888714341-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6888714341-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6888714341-60">}</span><span class="p" data-group-id="6888714341-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6888714341-61">(</span><span class="p" data-group-id="6888714341-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6888714341-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6888714341-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6888714341-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6888714341-64">]</span><span class="w">
        </span><span class="p" data-group-id="6888714341-63">)</span><span class="w">
    </span><span class="p" data-group-id="6888714341-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6888714341-65">(</span><span class="p" data-group-id="6888714341-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6888714341-66">(</span><span class="p" data-group-id="6888714341-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6888714341-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6888714341-68">]</span><span class="p" data-group-id="6888714341-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6888714341-69">(</span><span class="p" data-group-id="6888714341-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6888714341-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6888714341-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6888714341-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6888714341-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6888714341-72">(</span><span class="p" data-group-id="6888714341-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6888714341-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6888714341-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6888714341-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6888714341-76">]</span><span class="p" data-group-id="6888714341-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6888714341-78">(</span><span class="n">H</span><span class="p" data-group-id="6888714341-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6888714341-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6888714341-79">)</span><span class="p" data-group-id="6888714341-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6888714341-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6888714341-81">[</span><span class="p" data-group-id="6888714341-81">]</span><span class="p" data-group-id="6888714341-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6888714341-82">[</span><span class="p" data-group-id="6888714341-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6888714341-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6888714341-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6888714341-84">(</span><span class="p" data-group-id="6888714341-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6888714341-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6888714341-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6888714341-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6888714341-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6888714341-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6888714341-89">(</span><span class="p" data-group-id="6888714341-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6888714341-90">{</span><span class="nf">self</span><span class="p" data-group-id="6888714341-91">(</span><span class="p" data-group-id="6888714341-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6888714341-92">(</span><span class="n">X</span><span class="p" data-group-id="6888714341-92">)</span><span class="p" data-group-id="6888714341-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6888714341-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6888714341-87">]</span><span class="w">
    </span><span class="p" data-group-id="6888714341-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="native">
    Native Style (native)<a class="headerlink" href="#native" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-native"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">native_style</span><span class="p" data-group-id="4939208055-1">(</span><span class="p" data-group-id="4939208055-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="native-example.erl">
      example.erl<a class="headerlink" href="#native-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-native"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2563507603-1">(</span><span class="ss">test</span><span class="p" data-group-id="2563507603-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2563507603-2">(</span><span class="p" data-group-id="2563507603-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2563507603-3">]</span><span class="p" data-group-id="2563507603-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2563507603-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2563507603-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2563507603-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2563507603-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2563507603-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2563507603-9">}</span><span class="p" data-group-id="2563507603-6">]</span><span class="p" data-group-id="2563507603-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2563507603-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2563507603-11">}</span><span class="p" data-group-id="2563507603-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2563507603-12">(</span><span class="n">Port</span><span class="p" data-group-id="2563507603-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2563507603-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2563507603-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2563507603-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2563507603-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2563507603-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-17">[</span><span class="p" data-group-id="2563507603-18">[</span><span class="p" data-group-id="2563507603-18">]</span><span class="p" data-group-id="2563507603-17">]</span><span class="p" data-group-id="2563507603-16">)</span><span class="p" data-group-id="2563507603-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2563507603-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2563507603-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2563507603-20">(</span><span class="n">Players</span><span class="p" data-group-id="2563507603-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2563507603-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-22">[</span><span class="p" data-group-id="2563507603-22">]</span><span class="p" data-group-id="2563507603-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2563507603-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2563507603-24">(</span><span class="n">P</span><span class="p" data-group-id="2563507603-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2563507603-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-26">[</span><span class="n">P</span><span class="p" data-group-id="2563507603-26">]</span><span class="p" data-group-id="2563507603-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2563507603-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2563507603-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2563507603-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2563507603-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2563507603-29">(</span><span class="n">Player</span><span class="p" data-group-id="2563507603-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2563507603-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-31">[</span><span class="n">Player</span><span class="p" data-group-id="2563507603-31">]</span><span class="p" data-group-id="2563507603-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2563507603-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2563507603-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2563507603-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2563507603-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2563507603-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-36">[</span><span class="n">Player</span><span class="p" data-group-id="2563507603-36">]</span><span class="p" data-group-id="2563507603-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2563507603-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2563507603-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2563507603-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2563507603-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2563507603-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2563507603-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2563507603-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2563507603-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2563507603-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2563507603-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2563507603-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2563507603-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2563507603-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2563507603-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2563507603-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2563507603-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2563507603-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2563507603-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2563507603-49">(</span><span class="n">Player</span><span class="p" data-group-id="2563507603-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2563507603-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2563507603-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2563507603-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2563507603-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2563507603-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2563507603-53">(</span><span class="n">P</span><span class="p" data-group-id="2563507603-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2563507603-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2563507603-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2563507603-55">(</span><span class="n">P</span><span class="p" data-group-id="2563507603-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2563507603-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2563507603-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2563507603-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2563507603-57">(</span><span class="p" data-group-id="2563507603-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-58">{</span><span class="p" data-group-id="2563507603-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2563507603-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2563507603-60">}</span><span class="p" data-group-id="2563507603-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2563507603-61">(</span><span class="p" data-group-id="2563507603-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2563507603-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2563507603-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2563507603-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2563507603-64">]</span><span class="w">
        </span><span class="p" data-group-id="2563507603-63">)</span><span class="w">
    </span><span class="p" data-group-id="2563507603-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2563507603-65">(</span><span class="p" data-group-id="2563507603-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2563507603-66">(</span><span class="p" data-group-id="2563507603-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2563507603-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2563507603-68">]</span><span class="p" data-group-id="2563507603-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2563507603-69">(</span><span class="p" data-group-id="2563507603-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2563507603-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2563507603-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2563507603-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2563507603-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2563507603-72">(</span><span class="p" data-group-id="2563507603-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2563507603-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2563507603-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2563507603-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2563507603-76">]</span><span class="p" data-group-id="2563507603-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2563507603-78">(</span><span class="n">H</span><span class="p" data-group-id="2563507603-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2563507603-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2563507603-79">)</span><span class="p" data-group-id="2563507603-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2563507603-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2563507603-81">[</span><span class="p" data-group-id="2563507603-81">]</span><span class="p" data-group-id="2563507603-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2563507603-82">[</span><span class="p" data-group-id="2563507603-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2563507603-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2563507603-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2563507603-84">(</span><span class="p" data-group-id="2563507603-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2563507603-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2563507603-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2563507603-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2563507603-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2563507603-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2563507603-89">(</span><span class="p" data-group-id="2563507603-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2563507603-90">{</span><span class="nf">self</span><span class="p" data-group-id="2563507603-91">(</span><span class="p" data-group-id="2563507603-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2563507603-92">(</span><span class="n">X</span><span class="p" data-group-id="2563507603-92">)</span><span class="p" data-group-id="2563507603-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2563507603-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2563507603-87">]</span><span class="w">
    </span><span class="p" data-group-id="2563507603-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_dark">
    ParaisoDark Style (paraiso_dark)<a class="headerlink" href="#paraiso_dark" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_dark"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_dark_style</span><span class="p" data-group-id="4185585082-1">(</span><span class="p" data-group-id="4185585082-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_dark-example.erl">
      example.erl<a class="headerlink" href="#paraiso_dark-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_dark"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9654665753-1">(</span><span class="ss">test</span><span class="p" data-group-id="9654665753-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9654665753-2">(</span><span class="p" data-group-id="9654665753-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9654665753-3">]</span><span class="p" data-group-id="9654665753-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9654665753-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9654665753-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9654665753-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9654665753-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9654665753-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9654665753-9">}</span><span class="p" data-group-id="9654665753-6">]</span><span class="p" data-group-id="9654665753-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9654665753-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9654665753-11">}</span><span class="p" data-group-id="9654665753-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9654665753-12">(</span><span class="n">Port</span><span class="p" data-group-id="9654665753-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9654665753-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9654665753-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9654665753-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9654665753-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9654665753-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-17">[</span><span class="p" data-group-id="9654665753-18">[</span><span class="p" data-group-id="9654665753-18">]</span><span class="p" data-group-id="9654665753-17">]</span><span class="p" data-group-id="9654665753-16">)</span><span class="p" data-group-id="9654665753-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9654665753-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9654665753-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9654665753-20">(</span><span class="n">Players</span><span class="p" data-group-id="9654665753-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9654665753-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-22">[</span><span class="p" data-group-id="9654665753-22">]</span><span class="p" data-group-id="9654665753-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9654665753-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9654665753-24">(</span><span class="n">P</span><span class="p" data-group-id="9654665753-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9654665753-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-26">[</span><span class="n">P</span><span class="p" data-group-id="9654665753-26">]</span><span class="p" data-group-id="9654665753-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9654665753-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9654665753-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9654665753-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9654665753-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9654665753-29">(</span><span class="n">Player</span><span class="p" data-group-id="9654665753-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9654665753-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-31">[</span><span class="n">Player</span><span class="p" data-group-id="9654665753-31">]</span><span class="p" data-group-id="9654665753-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9654665753-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9654665753-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9654665753-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9654665753-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9654665753-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-36">[</span><span class="n">Player</span><span class="p" data-group-id="9654665753-36">]</span><span class="p" data-group-id="9654665753-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9654665753-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9654665753-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9654665753-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9654665753-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9654665753-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9654665753-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9654665753-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9654665753-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9654665753-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9654665753-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9654665753-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9654665753-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9654665753-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9654665753-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9654665753-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9654665753-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9654665753-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9654665753-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9654665753-49">(</span><span class="n">Player</span><span class="p" data-group-id="9654665753-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9654665753-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9654665753-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9654665753-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9654665753-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9654665753-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9654665753-53">(</span><span class="n">P</span><span class="p" data-group-id="9654665753-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9654665753-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9654665753-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9654665753-55">(</span><span class="n">P</span><span class="p" data-group-id="9654665753-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9654665753-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9654665753-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9654665753-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9654665753-57">(</span><span class="p" data-group-id="9654665753-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-58">{</span><span class="p" data-group-id="9654665753-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9654665753-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9654665753-60">}</span><span class="p" data-group-id="9654665753-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9654665753-61">(</span><span class="p" data-group-id="9654665753-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9654665753-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9654665753-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9654665753-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9654665753-64">]</span><span class="w">
        </span><span class="p" data-group-id="9654665753-63">)</span><span class="w">
    </span><span class="p" data-group-id="9654665753-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9654665753-65">(</span><span class="p" data-group-id="9654665753-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9654665753-66">(</span><span class="p" data-group-id="9654665753-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9654665753-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9654665753-68">]</span><span class="p" data-group-id="9654665753-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9654665753-69">(</span><span class="p" data-group-id="9654665753-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9654665753-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9654665753-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9654665753-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9654665753-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9654665753-72">(</span><span class="p" data-group-id="9654665753-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9654665753-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9654665753-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9654665753-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9654665753-76">]</span><span class="p" data-group-id="9654665753-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9654665753-78">(</span><span class="n">H</span><span class="p" data-group-id="9654665753-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9654665753-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9654665753-79">)</span><span class="p" data-group-id="9654665753-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9654665753-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9654665753-81">[</span><span class="p" data-group-id="9654665753-81">]</span><span class="p" data-group-id="9654665753-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9654665753-82">[</span><span class="p" data-group-id="9654665753-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9654665753-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9654665753-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9654665753-84">(</span><span class="p" data-group-id="9654665753-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9654665753-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9654665753-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9654665753-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9654665753-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9654665753-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9654665753-89">(</span><span class="p" data-group-id="9654665753-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9654665753-90">{</span><span class="nf">self</span><span class="p" data-group-id="9654665753-91">(</span><span class="p" data-group-id="9654665753-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9654665753-92">(</span><span class="n">X</span><span class="p" data-group-id="9654665753-92">)</span><span class="p" data-group-id="9654665753-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9654665753-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9654665753-87">]</span><span class="w">
    </span><span class="p" data-group-id="9654665753-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="paraiso_light">
    ParaisoLight Style (paraiso_light)<a class="headerlink" href="#paraiso_light" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-paraiso_light"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">paraiso_light_style</span><span class="p" data-group-id="1518900099-1">(</span><span class="p" data-group-id="1518900099-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="paraiso_light-example.erl">
      example.erl<a class="headerlink" href="#paraiso_light-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-paraiso_light"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6061320351-1">(</span><span class="ss">test</span><span class="p" data-group-id="6061320351-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6061320351-2">(</span><span class="p" data-group-id="6061320351-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6061320351-3">]</span><span class="p" data-group-id="6061320351-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6061320351-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6061320351-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6061320351-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6061320351-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6061320351-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6061320351-9">}</span><span class="p" data-group-id="6061320351-6">]</span><span class="p" data-group-id="6061320351-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6061320351-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6061320351-11">}</span><span class="p" data-group-id="6061320351-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6061320351-12">(</span><span class="n">Port</span><span class="p" data-group-id="6061320351-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6061320351-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6061320351-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6061320351-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6061320351-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6061320351-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-17">[</span><span class="p" data-group-id="6061320351-18">[</span><span class="p" data-group-id="6061320351-18">]</span><span class="p" data-group-id="6061320351-17">]</span><span class="p" data-group-id="6061320351-16">)</span><span class="p" data-group-id="6061320351-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6061320351-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6061320351-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6061320351-20">(</span><span class="n">Players</span><span class="p" data-group-id="6061320351-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6061320351-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-22">[</span><span class="p" data-group-id="6061320351-22">]</span><span class="p" data-group-id="6061320351-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6061320351-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6061320351-24">(</span><span class="n">P</span><span class="p" data-group-id="6061320351-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6061320351-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-26">[</span><span class="n">P</span><span class="p" data-group-id="6061320351-26">]</span><span class="p" data-group-id="6061320351-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6061320351-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6061320351-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6061320351-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6061320351-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6061320351-29">(</span><span class="n">Player</span><span class="p" data-group-id="6061320351-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6061320351-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-31">[</span><span class="n">Player</span><span class="p" data-group-id="6061320351-31">]</span><span class="p" data-group-id="6061320351-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6061320351-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6061320351-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6061320351-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6061320351-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6061320351-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-36">[</span><span class="n">Player</span><span class="p" data-group-id="6061320351-36">]</span><span class="p" data-group-id="6061320351-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6061320351-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6061320351-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6061320351-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6061320351-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6061320351-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6061320351-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6061320351-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6061320351-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6061320351-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6061320351-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6061320351-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6061320351-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6061320351-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6061320351-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6061320351-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6061320351-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6061320351-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6061320351-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6061320351-49">(</span><span class="n">Player</span><span class="p" data-group-id="6061320351-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6061320351-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6061320351-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6061320351-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6061320351-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6061320351-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6061320351-53">(</span><span class="n">P</span><span class="p" data-group-id="6061320351-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6061320351-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6061320351-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6061320351-55">(</span><span class="n">P</span><span class="p" data-group-id="6061320351-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6061320351-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6061320351-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6061320351-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6061320351-57">(</span><span class="p" data-group-id="6061320351-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-58">{</span><span class="p" data-group-id="6061320351-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6061320351-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6061320351-60">}</span><span class="p" data-group-id="6061320351-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6061320351-61">(</span><span class="p" data-group-id="6061320351-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6061320351-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6061320351-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6061320351-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6061320351-64">]</span><span class="w">
        </span><span class="p" data-group-id="6061320351-63">)</span><span class="w">
    </span><span class="p" data-group-id="6061320351-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6061320351-65">(</span><span class="p" data-group-id="6061320351-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6061320351-66">(</span><span class="p" data-group-id="6061320351-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6061320351-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6061320351-68">]</span><span class="p" data-group-id="6061320351-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6061320351-69">(</span><span class="p" data-group-id="6061320351-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6061320351-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6061320351-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6061320351-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6061320351-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6061320351-72">(</span><span class="p" data-group-id="6061320351-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6061320351-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6061320351-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6061320351-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6061320351-76">]</span><span class="p" data-group-id="6061320351-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6061320351-78">(</span><span class="n">H</span><span class="p" data-group-id="6061320351-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6061320351-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6061320351-79">)</span><span class="p" data-group-id="6061320351-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6061320351-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6061320351-81">[</span><span class="p" data-group-id="6061320351-81">]</span><span class="p" data-group-id="6061320351-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6061320351-82">[</span><span class="p" data-group-id="6061320351-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6061320351-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6061320351-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6061320351-84">(</span><span class="p" data-group-id="6061320351-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6061320351-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6061320351-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6061320351-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6061320351-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6061320351-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6061320351-89">(</span><span class="p" data-group-id="6061320351-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6061320351-90">{</span><span class="nf">self</span><span class="p" data-group-id="6061320351-91">(</span><span class="p" data-group-id="6061320351-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6061320351-92">(</span><span class="n">X</span><span class="p" data-group-id="6061320351-92">)</span><span class="p" data-group-id="6061320351-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6061320351-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6061320351-87">]</span><span class="w">
    </span><span class="p" data-group-id="6061320351-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="pastie">
    Pastie Style (pastie)<a class="headerlink" href="#pastie" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-pastie"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">pastie_style</span><span class="p" data-group-id="1276457501-1">(</span><span class="p" data-group-id="1276457501-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="pastie-example.erl">
      example.erl<a class="headerlink" href="#pastie-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-pastie"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7692424903-1">(</span><span class="ss">test</span><span class="p" data-group-id="7692424903-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7692424903-2">(</span><span class="p" data-group-id="7692424903-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="7692424903-3">]</span><span class="p" data-group-id="7692424903-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="7692424903-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="7692424903-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="7692424903-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7692424903-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="7692424903-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7692424903-9">}</span><span class="p" data-group-id="7692424903-6">]</span><span class="p" data-group-id="7692424903-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7692424903-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="7692424903-11">}</span><span class="p" data-group-id="7692424903-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="7692424903-12">(</span><span class="n">Port</span><span class="p" data-group-id="7692424903-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="7692424903-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7692424903-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="7692424903-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7692424903-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="7692424903-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-17">[</span><span class="p" data-group-id="7692424903-18">[</span><span class="p" data-group-id="7692424903-18">]</span><span class="p" data-group-id="7692424903-17">]</span><span class="p" data-group-id="7692424903-16">)</span><span class="p" data-group-id="7692424903-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="7692424903-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="7692424903-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="7692424903-20">(</span><span class="n">Players</span><span class="p" data-group-id="7692424903-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7692424903-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-22">[</span><span class="p" data-group-id="7692424903-22">]</span><span class="p" data-group-id="7692424903-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7692424903-23">(</span><span class="nf">fun</span><span class="p" data-group-id="7692424903-24">(</span><span class="n">P</span><span class="p" data-group-id="7692424903-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7692424903-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-26">[</span><span class="n">P</span><span class="p" data-group-id="7692424903-26">]</span><span class="p" data-group-id="7692424903-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="7692424903-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7692424903-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="7692424903-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="7692424903-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7692424903-29">(</span><span class="n">Player</span><span class="p" data-group-id="7692424903-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7692424903-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-31">[</span><span class="n">Player</span><span class="p" data-group-id="7692424903-31">]</span><span class="p" data-group-id="7692424903-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7692424903-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7692424903-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="7692424903-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7692424903-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7692424903-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-36">[</span><span class="n">Player</span><span class="p" data-group-id="7692424903-36">]</span><span class="p" data-group-id="7692424903-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="7692424903-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7692424903-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7692424903-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7692424903-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="7692424903-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7692424903-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="7692424903-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="7692424903-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="7692424903-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="7692424903-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="7692424903-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="7692424903-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="7692424903-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="7692424903-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="7692424903-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="7692424903-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="7692424903-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="7692424903-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="7692424903-49">(</span><span class="n">Player</span><span class="p" data-group-id="7692424903-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7692424903-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="7692424903-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="7692424903-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7692424903-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="7692424903-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7692424903-53">(</span><span class="n">P</span><span class="p" data-group-id="7692424903-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="7692424903-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="7692424903-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="7692424903-55">(</span><span class="n">P</span><span class="p" data-group-id="7692424903-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="7692424903-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="7692424903-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="7692424903-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="7692424903-57">(</span><span class="p" data-group-id="7692424903-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-58">{</span><span class="p" data-group-id="7692424903-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="7692424903-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7692424903-60">}</span><span class="p" data-group-id="7692424903-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="7692424903-61">(</span><span class="p" data-group-id="7692424903-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="7692424903-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="7692424903-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7692424903-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="7692424903-64">]</span><span class="w">
        </span><span class="p" data-group-id="7692424903-63">)</span><span class="w">
    </span><span class="p" data-group-id="7692424903-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="7692424903-65">(</span><span class="p" data-group-id="7692424903-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="7692424903-66">(</span><span class="p" data-group-id="7692424903-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7692424903-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="7692424903-68">]</span><span class="p" data-group-id="7692424903-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="7692424903-69">(</span><span class="p" data-group-id="7692424903-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7692424903-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7692424903-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="7692424903-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="7692424903-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="7692424903-72">(</span><span class="p" data-group-id="7692424903-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="7692424903-74">{</span><span class="ss">fff</span><span class="p" data-group-id="7692424903-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="7692424903-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7692424903-76">]</span><span class="p" data-group-id="7692424903-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-77">[</span><span class="n">Fun</span><span class="p" data-group-id="7692424903-78">(</span><span class="n">H</span><span class="p" data-group-id="7692424903-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="7692424903-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="7692424903-79">)</span><span class="p" data-group-id="7692424903-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="7692424903-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7692424903-81">[</span><span class="p" data-group-id="7692424903-81">]</span><span class="p" data-group-id="7692424903-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7692424903-82">[</span><span class="p" data-group-id="7692424903-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="7692424903-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="7692424903-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7692424903-84">(</span><span class="p" data-group-id="7692424903-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7692424903-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="7692424903-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="7692424903-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="7692424903-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="7692424903-88">(</span><span class="nf">fun</span><span class="p" data-group-id="7692424903-89">(</span><span class="p" data-group-id="7692424903-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="7692424903-90">{</span><span class="nf">self</span><span class="p" data-group-id="7692424903-91">(</span><span class="p" data-group-id="7692424903-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="7692424903-92">(</span><span class="n">X</span><span class="p" data-group-id="7692424903-92">)</span><span class="p" data-group-id="7692424903-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="7692424903-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="7692424903-87">]</span><span class="w">
    </span><span class="p" data-group-id="7692424903-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="perldoc">
    Perldoc Style (perldoc)<a class="headerlink" href="#perldoc" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-perldoc"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">perldoc_style</span><span class="p" data-group-id="4840623359-1">(</span><span class="p" data-group-id="4840623359-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="perldoc-example.erl">
      example.erl<a class="headerlink" href="#perldoc-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-perldoc"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0420943136-1">(</span><span class="ss">test</span><span class="p" data-group-id="0420943136-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0420943136-2">(</span><span class="p" data-group-id="0420943136-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="0420943136-3">]</span><span class="p" data-group-id="0420943136-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="0420943136-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="0420943136-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="0420943136-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0420943136-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="0420943136-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="0420943136-9">}</span><span class="p" data-group-id="0420943136-6">]</span><span class="p" data-group-id="0420943136-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="0420943136-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="0420943136-11">}</span><span class="p" data-group-id="0420943136-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="0420943136-12">(</span><span class="n">Port</span><span class="p" data-group-id="0420943136-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="0420943136-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="0420943136-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="0420943136-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="0420943136-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="0420943136-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-17">[</span><span class="p" data-group-id="0420943136-18">[</span><span class="p" data-group-id="0420943136-18">]</span><span class="p" data-group-id="0420943136-17">]</span><span class="p" data-group-id="0420943136-16">)</span><span class="p" data-group-id="0420943136-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="0420943136-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="0420943136-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="0420943136-20">(</span><span class="n">Players</span><span class="p" data-group-id="0420943136-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0420943136-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-22">[</span><span class="p" data-group-id="0420943136-22">]</span><span class="p" data-group-id="0420943136-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0420943136-23">(</span><span class="nf">fun</span><span class="p" data-group-id="0420943136-24">(</span><span class="n">P</span><span class="p" data-group-id="0420943136-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0420943136-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-26">[</span><span class="n">P</span><span class="p" data-group-id="0420943136-26">]</span><span class="p" data-group-id="0420943136-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="0420943136-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0420943136-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="0420943136-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="0420943136-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0420943136-29">(</span><span class="n">Player</span><span class="p" data-group-id="0420943136-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0420943136-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-31">[</span><span class="n">Player</span><span class="p" data-group-id="0420943136-31">]</span><span class="p" data-group-id="0420943136-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0420943136-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0420943136-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="0420943136-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0420943136-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0420943136-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-36">[</span><span class="n">Player</span><span class="p" data-group-id="0420943136-36">]</span><span class="p" data-group-id="0420943136-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="0420943136-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0420943136-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0420943136-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0420943136-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="0420943136-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0420943136-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="0420943136-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="0420943136-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="0420943136-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="0420943136-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="0420943136-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="0420943136-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="0420943136-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="0420943136-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="0420943136-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="0420943136-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="0420943136-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="0420943136-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="0420943136-49">(</span><span class="n">Player</span><span class="p" data-group-id="0420943136-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0420943136-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="0420943136-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="0420943136-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0420943136-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="0420943136-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0420943136-53">(</span><span class="n">P</span><span class="p" data-group-id="0420943136-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="0420943136-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="0420943136-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="0420943136-55">(</span><span class="n">P</span><span class="p" data-group-id="0420943136-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="0420943136-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0420943136-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="0420943136-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="0420943136-57">(</span><span class="p" data-group-id="0420943136-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-58">{</span><span class="p" data-group-id="0420943136-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="0420943136-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0420943136-60">}</span><span class="p" data-group-id="0420943136-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="0420943136-61">(</span><span class="p" data-group-id="0420943136-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="0420943136-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0420943136-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="0420943136-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="0420943136-64">]</span><span class="w">
        </span><span class="p" data-group-id="0420943136-63">)</span><span class="w">
    </span><span class="p" data-group-id="0420943136-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="0420943136-65">(</span><span class="p" data-group-id="0420943136-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="0420943136-66">(</span><span class="p" data-group-id="0420943136-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0420943136-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="0420943136-68">]</span><span class="p" data-group-id="0420943136-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="0420943136-69">(</span><span class="p" data-group-id="0420943136-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0420943136-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0420943136-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="0420943136-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="0420943136-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="0420943136-72">(</span><span class="p" data-group-id="0420943136-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="0420943136-74">{</span><span class="ss">fff</span><span class="p" data-group-id="0420943136-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="0420943136-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0420943136-76">]</span><span class="p" data-group-id="0420943136-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-77">[</span><span class="n">Fun</span><span class="p" data-group-id="0420943136-78">(</span><span class="n">H</span><span class="p" data-group-id="0420943136-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="0420943136-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="0420943136-79">)</span><span class="p" data-group-id="0420943136-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="0420943136-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0420943136-81">[</span><span class="p" data-group-id="0420943136-81">]</span><span class="p" data-group-id="0420943136-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0420943136-82">[</span><span class="p" data-group-id="0420943136-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="0420943136-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="0420943136-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="0420943136-84">(</span><span class="p" data-group-id="0420943136-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0420943136-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0420943136-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="0420943136-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="0420943136-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="0420943136-88">(</span><span class="nf">fun</span><span class="p" data-group-id="0420943136-89">(</span><span class="p" data-group-id="0420943136-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="0420943136-90">{</span><span class="nf">self</span><span class="p" data-group-id="0420943136-91">(</span><span class="p" data-group-id="0420943136-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="0420943136-92">(</span><span class="n">X</span><span class="p" data-group-id="0420943136-92">)</span><span class="p" data-group-id="0420943136-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="0420943136-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="0420943136-87">]</span><span class="w">
    </span><span class="p" data-group-id="0420943136-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rainbow_dash">
    RainbowDash Style (rainbow_dash)<a class="headerlink" href="#rainbow_dash" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rainbow_dash"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rainbow_dash_style</span><span class="p" data-group-id="3263855505-1">(</span><span class="p" data-group-id="3263855505-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="rainbow_dash-example.erl">
      example.erl<a class="headerlink" href="#rainbow_dash-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rainbow_dash"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4251112249-1">(</span><span class="ss">test</span><span class="p" data-group-id="4251112249-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4251112249-2">(</span><span class="p" data-group-id="4251112249-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4251112249-3">]</span><span class="p" data-group-id="4251112249-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4251112249-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4251112249-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4251112249-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4251112249-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4251112249-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4251112249-9">}</span><span class="p" data-group-id="4251112249-6">]</span><span class="p" data-group-id="4251112249-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4251112249-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4251112249-11">}</span><span class="p" data-group-id="4251112249-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4251112249-12">(</span><span class="n">Port</span><span class="p" data-group-id="4251112249-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4251112249-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4251112249-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4251112249-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4251112249-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4251112249-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-17">[</span><span class="p" data-group-id="4251112249-18">[</span><span class="p" data-group-id="4251112249-18">]</span><span class="p" data-group-id="4251112249-17">]</span><span class="p" data-group-id="4251112249-16">)</span><span class="p" data-group-id="4251112249-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4251112249-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4251112249-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4251112249-20">(</span><span class="n">Players</span><span class="p" data-group-id="4251112249-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4251112249-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-22">[</span><span class="p" data-group-id="4251112249-22">]</span><span class="p" data-group-id="4251112249-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4251112249-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4251112249-24">(</span><span class="n">P</span><span class="p" data-group-id="4251112249-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4251112249-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-26">[</span><span class="n">P</span><span class="p" data-group-id="4251112249-26">]</span><span class="p" data-group-id="4251112249-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4251112249-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4251112249-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4251112249-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4251112249-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4251112249-29">(</span><span class="n">Player</span><span class="p" data-group-id="4251112249-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4251112249-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-31">[</span><span class="n">Player</span><span class="p" data-group-id="4251112249-31">]</span><span class="p" data-group-id="4251112249-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4251112249-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4251112249-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4251112249-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4251112249-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4251112249-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-36">[</span><span class="n">Player</span><span class="p" data-group-id="4251112249-36">]</span><span class="p" data-group-id="4251112249-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4251112249-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4251112249-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4251112249-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4251112249-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4251112249-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4251112249-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4251112249-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4251112249-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4251112249-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4251112249-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4251112249-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4251112249-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4251112249-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4251112249-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4251112249-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4251112249-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4251112249-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4251112249-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4251112249-49">(</span><span class="n">Player</span><span class="p" data-group-id="4251112249-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4251112249-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4251112249-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4251112249-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4251112249-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4251112249-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4251112249-53">(</span><span class="n">P</span><span class="p" data-group-id="4251112249-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4251112249-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4251112249-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4251112249-55">(</span><span class="n">P</span><span class="p" data-group-id="4251112249-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4251112249-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4251112249-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4251112249-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4251112249-57">(</span><span class="p" data-group-id="4251112249-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-58">{</span><span class="p" data-group-id="4251112249-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4251112249-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4251112249-60">}</span><span class="p" data-group-id="4251112249-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4251112249-61">(</span><span class="p" data-group-id="4251112249-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4251112249-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4251112249-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4251112249-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4251112249-64">]</span><span class="w">
        </span><span class="p" data-group-id="4251112249-63">)</span><span class="w">
    </span><span class="p" data-group-id="4251112249-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4251112249-65">(</span><span class="p" data-group-id="4251112249-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4251112249-66">(</span><span class="p" data-group-id="4251112249-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4251112249-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4251112249-68">]</span><span class="p" data-group-id="4251112249-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4251112249-69">(</span><span class="p" data-group-id="4251112249-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4251112249-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4251112249-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4251112249-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4251112249-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4251112249-72">(</span><span class="p" data-group-id="4251112249-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4251112249-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4251112249-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4251112249-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4251112249-76">]</span><span class="p" data-group-id="4251112249-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4251112249-78">(</span><span class="n">H</span><span class="p" data-group-id="4251112249-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4251112249-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4251112249-79">)</span><span class="p" data-group-id="4251112249-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4251112249-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4251112249-81">[</span><span class="p" data-group-id="4251112249-81">]</span><span class="p" data-group-id="4251112249-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4251112249-82">[</span><span class="p" data-group-id="4251112249-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4251112249-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4251112249-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4251112249-84">(</span><span class="p" data-group-id="4251112249-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4251112249-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4251112249-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4251112249-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4251112249-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4251112249-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4251112249-89">(</span><span class="p" data-group-id="4251112249-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4251112249-90">{</span><span class="nf">self</span><span class="p" data-group-id="4251112249-91">(</span><span class="p" data-group-id="4251112249-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4251112249-92">(</span><span class="n">X</span><span class="p" data-group-id="4251112249-92">)</span><span class="p" data-group-id="4251112249-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4251112249-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4251112249-87">]</span><span class="w">
    </span><span class="p" data-group-id="4251112249-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="rrt">
    Rrt Style (rrt)<a class="headerlink" href="#rrt" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-rrt"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">rrt_style</span><span class="p" data-group-id="0344458181-1">(</span><span class="p" data-group-id="0344458181-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="rrt-example.erl">
      example.erl<a class="headerlink" href="#rrt-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-rrt"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2329206698-1">(</span><span class="ss">test</span><span class="p" data-group-id="2329206698-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2329206698-2">(</span><span class="p" data-group-id="2329206698-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2329206698-3">]</span><span class="p" data-group-id="2329206698-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2329206698-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2329206698-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2329206698-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2329206698-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2329206698-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2329206698-9">}</span><span class="p" data-group-id="2329206698-6">]</span><span class="p" data-group-id="2329206698-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2329206698-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2329206698-11">}</span><span class="p" data-group-id="2329206698-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2329206698-12">(</span><span class="n">Port</span><span class="p" data-group-id="2329206698-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2329206698-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2329206698-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2329206698-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2329206698-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2329206698-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-17">[</span><span class="p" data-group-id="2329206698-18">[</span><span class="p" data-group-id="2329206698-18">]</span><span class="p" data-group-id="2329206698-17">]</span><span class="p" data-group-id="2329206698-16">)</span><span class="p" data-group-id="2329206698-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2329206698-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2329206698-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2329206698-20">(</span><span class="n">Players</span><span class="p" data-group-id="2329206698-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2329206698-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-22">[</span><span class="p" data-group-id="2329206698-22">]</span><span class="p" data-group-id="2329206698-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2329206698-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2329206698-24">(</span><span class="n">P</span><span class="p" data-group-id="2329206698-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2329206698-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-26">[</span><span class="n">P</span><span class="p" data-group-id="2329206698-26">]</span><span class="p" data-group-id="2329206698-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2329206698-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2329206698-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2329206698-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2329206698-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2329206698-29">(</span><span class="n">Player</span><span class="p" data-group-id="2329206698-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2329206698-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-31">[</span><span class="n">Player</span><span class="p" data-group-id="2329206698-31">]</span><span class="p" data-group-id="2329206698-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2329206698-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2329206698-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2329206698-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2329206698-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2329206698-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-36">[</span><span class="n">Player</span><span class="p" data-group-id="2329206698-36">]</span><span class="p" data-group-id="2329206698-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2329206698-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2329206698-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2329206698-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2329206698-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2329206698-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2329206698-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2329206698-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2329206698-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2329206698-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2329206698-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2329206698-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2329206698-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2329206698-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2329206698-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2329206698-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2329206698-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2329206698-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2329206698-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2329206698-49">(</span><span class="n">Player</span><span class="p" data-group-id="2329206698-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2329206698-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2329206698-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2329206698-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2329206698-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2329206698-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2329206698-53">(</span><span class="n">P</span><span class="p" data-group-id="2329206698-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2329206698-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2329206698-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2329206698-55">(</span><span class="n">P</span><span class="p" data-group-id="2329206698-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2329206698-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2329206698-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2329206698-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2329206698-57">(</span><span class="p" data-group-id="2329206698-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-58">{</span><span class="p" data-group-id="2329206698-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2329206698-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2329206698-60">}</span><span class="p" data-group-id="2329206698-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2329206698-61">(</span><span class="p" data-group-id="2329206698-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2329206698-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2329206698-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2329206698-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2329206698-64">]</span><span class="w">
        </span><span class="p" data-group-id="2329206698-63">)</span><span class="w">
    </span><span class="p" data-group-id="2329206698-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2329206698-65">(</span><span class="p" data-group-id="2329206698-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2329206698-66">(</span><span class="p" data-group-id="2329206698-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2329206698-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2329206698-68">]</span><span class="p" data-group-id="2329206698-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2329206698-69">(</span><span class="p" data-group-id="2329206698-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2329206698-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2329206698-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2329206698-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2329206698-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2329206698-72">(</span><span class="p" data-group-id="2329206698-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2329206698-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2329206698-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2329206698-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2329206698-76">]</span><span class="p" data-group-id="2329206698-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2329206698-78">(</span><span class="n">H</span><span class="p" data-group-id="2329206698-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2329206698-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2329206698-79">)</span><span class="p" data-group-id="2329206698-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2329206698-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2329206698-81">[</span><span class="p" data-group-id="2329206698-81">]</span><span class="p" data-group-id="2329206698-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2329206698-82">[</span><span class="p" data-group-id="2329206698-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2329206698-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2329206698-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2329206698-84">(</span><span class="p" data-group-id="2329206698-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2329206698-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2329206698-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2329206698-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2329206698-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2329206698-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2329206698-89">(</span><span class="p" data-group-id="2329206698-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2329206698-90">{</span><span class="nf">self</span><span class="p" data-group-id="2329206698-91">(</span><span class="p" data-group-id="2329206698-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2329206698-92">(</span><span class="n">X</span><span class="p" data-group-id="2329206698-92">)</span><span class="p" data-group-id="2329206698-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2329206698-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2329206698-87">]</span><span class="w">
    </span><span class="p" data-group-id="2329206698-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="tango">
    Tango Style (tango)<a class="headerlink" href="#tango" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-tango"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">tango_style</span><span class="p" data-group-id="2053608966-1">(</span><span class="p" data-group-id="2053608966-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="tango-example.erl">
      example.erl<a class="headerlink" href="#tango-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-tango"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="1320055037-1">(</span><span class="ss">test</span><span class="p" data-group-id="1320055037-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="1320055037-2">(</span><span class="p" data-group-id="1320055037-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="1320055037-3">]</span><span class="p" data-group-id="1320055037-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="1320055037-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="1320055037-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1320055037-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1320055037-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="1320055037-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="1320055037-9">}</span><span class="p" data-group-id="1320055037-6">]</span><span class="p" data-group-id="1320055037-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1320055037-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="1320055037-11">}</span><span class="p" data-group-id="1320055037-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="1320055037-12">(</span><span class="n">Port</span><span class="p" data-group-id="1320055037-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="1320055037-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="1320055037-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="1320055037-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="1320055037-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="1320055037-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-17">[</span><span class="p" data-group-id="1320055037-18">[</span><span class="p" data-group-id="1320055037-18">]</span><span class="p" data-group-id="1320055037-17">]</span><span class="p" data-group-id="1320055037-16">)</span><span class="p" data-group-id="1320055037-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="1320055037-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="1320055037-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="1320055037-20">(</span><span class="n">Players</span><span class="p" data-group-id="1320055037-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1320055037-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-22">[</span><span class="p" data-group-id="1320055037-22">]</span><span class="p" data-group-id="1320055037-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1320055037-23">(</span><span class="nf">fun</span><span class="p" data-group-id="1320055037-24">(</span><span class="n">P</span><span class="p" data-group-id="1320055037-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1320055037-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-26">[</span><span class="n">P</span><span class="p" data-group-id="1320055037-26">]</span><span class="p" data-group-id="1320055037-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="1320055037-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1320055037-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="1320055037-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="1320055037-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1320055037-29">(</span><span class="n">Player</span><span class="p" data-group-id="1320055037-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1320055037-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-31">[</span><span class="n">Player</span><span class="p" data-group-id="1320055037-31">]</span><span class="p" data-group-id="1320055037-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1320055037-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1320055037-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="1320055037-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1320055037-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1320055037-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-36">[</span><span class="n">Player</span><span class="p" data-group-id="1320055037-36">]</span><span class="p" data-group-id="1320055037-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="1320055037-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="1320055037-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1320055037-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1320055037-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="1320055037-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1320055037-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="1320055037-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="1320055037-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="1320055037-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="1320055037-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="1320055037-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="1320055037-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="1320055037-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="1320055037-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="1320055037-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="1320055037-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="1320055037-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="1320055037-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="1320055037-49">(</span><span class="n">Player</span><span class="p" data-group-id="1320055037-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1320055037-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="1320055037-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="1320055037-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1320055037-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="1320055037-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1320055037-53">(</span><span class="n">P</span><span class="p" data-group-id="1320055037-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="1320055037-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="1320055037-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="1320055037-55">(</span><span class="n">P</span><span class="p" data-group-id="1320055037-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="1320055037-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="1320055037-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="1320055037-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="1320055037-57">(</span><span class="p" data-group-id="1320055037-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-58">{</span><span class="p" data-group-id="1320055037-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="1320055037-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1320055037-60">}</span><span class="p" data-group-id="1320055037-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="1320055037-61">(</span><span class="p" data-group-id="1320055037-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="1320055037-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="1320055037-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="1320055037-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="1320055037-64">]</span><span class="w">
        </span><span class="p" data-group-id="1320055037-63">)</span><span class="w">
    </span><span class="p" data-group-id="1320055037-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="1320055037-65">(</span><span class="p" data-group-id="1320055037-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="1320055037-66">(</span><span class="p" data-group-id="1320055037-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1320055037-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1320055037-68">]</span><span class="p" data-group-id="1320055037-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="1320055037-69">(</span><span class="p" data-group-id="1320055037-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1320055037-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="1320055037-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="1320055037-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="1320055037-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="1320055037-72">(</span><span class="p" data-group-id="1320055037-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="1320055037-74">{</span><span class="ss">fff</span><span class="p" data-group-id="1320055037-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="1320055037-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1320055037-76">]</span><span class="p" data-group-id="1320055037-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-77">[</span><span class="n">Fun</span><span class="p" data-group-id="1320055037-78">(</span><span class="n">H</span><span class="p" data-group-id="1320055037-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="1320055037-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="1320055037-79">)</span><span class="p" data-group-id="1320055037-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="1320055037-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1320055037-81">[</span><span class="p" data-group-id="1320055037-81">]</span><span class="p" data-group-id="1320055037-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1320055037-82">[</span><span class="p" data-group-id="1320055037-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="1320055037-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="1320055037-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="1320055037-84">(</span><span class="p" data-group-id="1320055037-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1320055037-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="1320055037-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="1320055037-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="1320055037-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="1320055037-88">(</span><span class="nf">fun</span><span class="p" data-group-id="1320055037-89">(</span><span class="p" data-group-id="1320055037-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="1320055037-90">{</span><span class="nf">self</span><span class="p" data-group-id="1320055037-91">(</span><span class="p" data-group-id="1320055037-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="1320055037-92">(</span><span class="n">X</span><span class="p" data-group-id="1320055037-92">)</span><span class="p" data-group-id="1320055037-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="1320055037-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="1320055037-87">]</span><span class="w">
    </span><span class="p" data-group-id="1320055037-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="trac">
    Trac Style (trac)<a class="headerlink" href="#trac" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-trac"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">trac_style</span><span class="p" data-group-id="9851203708-1">(</span><span class="p" data-group-id="9851203708-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="trac-example.erl">
      example.erl<a class="headerlink" href="#trac-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-trac"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4355855465-1">(</span><span class="ss">test</span><span class="p" data-group-id="4355855465-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4355855465-2">(</span><span class="p" data-group-id="4355855465-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="4355855465-3">]</span><span class="p" data-group-id="4355855465-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="4355855465-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="4355855465-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="4355855465-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="4355855465-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="4355855465-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4355855465-9">}</span><span class="p" data-group-id="4355855465-6">]</span><span class="p" data-group-id="4355855465-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="4355855465-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="4355855465-11">}</span><span class="p" data-group-id="4355855465-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="4355855465-12">(</span><span class="n">Port</span><span class="p" data-group-id="4355855465-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="4355855465-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="4355855465-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="4355855465-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="4355855465-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="4355855465-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-17">[</span><span class="p" data-group-id="4355855465-18">[</span><span class="p" data-group-id="4355855465-18">]</span><span class="p" data-group-id="4355855465-17">]</span><span class="p" data-group-id="4355855465-16">)</span><span class="p" data-group-id="4355855465-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="4355855465-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="4355855465-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="4355855465-20">(</span><span class="n">Players</span><span class="p" data-group-id="4355855465-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4355855465-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-22">[</span><span class="p" data-group-id="4355855465-22">]</span><span class="p" data-group-id="4355855465-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4355855465-23">(</span><span class="nf">fun</span><span class="p" data-group-id="4355855465-24">(</span><span class="n">P</span><span class="p" data-group-id="4355855465-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4355855465-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-26">[</span><span class="n">P</span><span class="p" data-group-id="4355855465-26">]</span><span class="p" data-group-id="4355855465-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="4355855465-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4355855465-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="4355855465-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="4355855465-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4355855465-29">(</span><span class="n">Player</span><span class="p" data-group-id="4355855465-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4355855465-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-31">[</span><span class="n">Player</span><span class="p" data-group-id="4355855465-31">]</span><span class="p" data-group-id="4355855465-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4355855465-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4355855465-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4355855465-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4355855465-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4355855465-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-36">[</span><span class="n">Player</span><span class="p" data-group-id="4355855465-36">]</span><span class="p" data-group-id="4355855465-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4355855465-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="4355855465-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4355855465-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4355855465-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="4355855465-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4355855465-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="4355855465-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="4355855465-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="4355855465-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="4355855465-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="4355855465-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="4355855465-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="4355855465-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="4355855465-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4355855465-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="4355855465-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="4355855465-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="4355855465-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="4355855465-49">(</span><span class="n">Player</span><span class="p" data-group-id="4355855465-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4355855465-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="4355855465-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="4355855465-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4355855465-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="4355855465-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4355855465-53">(</span><span class="n">P</span><span class="p" data-group-id="4355855465-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="4355855465-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="4355855465-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="4355855465-55">(</span><span class="n">P</span><span class="p" data-group-id="4355855465-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="4355855465-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="4355855465-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="4355855465-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="4355855465-57">(</span><span class="p" data-group-id="4355855465-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-58">{</span><span class="p" data-group-id="4355855465-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="4355855465-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4355855465-60">}</span><span class="p" data-group-id="4355855465-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="4355855465-61">(</span><span class="p" data-group-id="4355855465-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="4355855465-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="4355855465-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="4355855465-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="4355855465-64">]</span><span class="w">
        </span><span class="p" data-group-id="4355855465-63">)</span><span class="w">
    </span><span class="p" data-group-id="4355855465-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="4355855465-65">(</span><span class="p" data-group-id="4355855465-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="4355855465-66">(</span><span class="p" data-group-id="4355855465-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4355855465-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4355855465-68">]</span><span class="p" data-group-id="4355855465-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="4355855465-69">(</span><span class="p" data-group-id="4355855465-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4355855465-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4355855465-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="4355855465-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="4355855465-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="4355855465-72">(</span><span class="p" data-group-id="4355855465-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="4355855465-74">{</span><span class="ss">fff</span><span class="p" data-group-id="4355855465-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="4355855465-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4355855465-76">]</span><span class="p" data-group-id="4355855465-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-77">[</span><span class="n">Fun</span><span class="p" data-group-id="4355855465-78">(</span><span class="n">H</span><span class="p" data-group-id="4355855465-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="4355855465-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="4355855465-79">)</span><span class="p" data-group-id="4355855465-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="4355855465-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4355855465-81">[</span><span class="p" data-group-id="4355855465-81">]</span><span class="p" data-group-id="4355855465-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4355855465-82">[</span><span class="p" data-group-id="4355855465-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="4355855465-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="4355855465-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="4355855465-84">(</span><span class="p" data-group-id="4355855465-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4355855465-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="4355855465-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="4355855465-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4355855465-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="4355855465-88">(</span><span class="nf">fun</span><span class="p" data-group-id="4355855465-89">(</span><span class="p" data-group-id="4355855465-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="4355855465-90">{</span><span class="nf">self</span><span class="p" data-group-id="4355855465-91">(</span><span class="p" data-group-id="4355855465-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="4355855465-92">(</span><span class="n">X</span><span class="p" data-group-id="4355855465-92">)</span><span class="p" data-group-id="4355855465-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="4355855465-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="4355855465-87">]</span><span class="w">
    </span><span class="p" data-group-id="4355855465-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vim">
    Vim Style (vim)<a class="headerlink" href="#vim" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vim"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vim_style</span><span class="p" data-group-id="7915517978-1">(</span><span class="p" data-group-id="7915517978-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="vim-example.erl">
      example.erl<a class="headerlink" href="#vim-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vim"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9952463126-1">(</span><span class="ss">test</span><span class="p" data-group-id="9952463126-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9952463126-2">(</span><span class="p" data-group-id="9952463126-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="9952463126-3">]</span><span class="p" data-group-id="9952463126-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="9952463126-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="9952463126-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="9952463126-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9952463126-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9952463126-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9952463126-9">}</span><span class="p" data-group-id="9952463126-6">]</span><span class="p" data-group-id="9952463126-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="9952463126-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="9952463126-11">}</span><span class="p" data-group-id="9952463126-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="9952463126-12">(</span><span class="n">Port</span><span class="p" data-group-id="9952463126-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="9952463126-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9952463126-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="9952463126-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9952463126-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9952463126-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-17">[</span><span class="p" data-group-id="9952463126-18">[</span><span class="p" data-group-id="9952463126-18">]</span><span class="p" data-group-id="9952463126-17">]</span><span class="p" data-group-id="9952463126-16">)</span><span class="p" data-group-id="9952463126-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="9952463126-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="9952463126-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="9952463126-20">(</span><span class="n">Players</span><span class="p" data-group-id="9952463126-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9952463126-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-22">[</span><span class="p" data-group-id="9952463126-22">]</span><span class="p" data-group-id="9952463126-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9952463126-23">(</span><span class="nf">fun</span><span class="p" data-group-id="9952463126-24">(</span><span class="n">P</span><span class="p" data-group-id="9952463126-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9952463126-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-26">[</span><span class="n">P</span><span class="p" data-group-id="9952463126-26">]</span><span class="p" data-group-id="9952463126-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="9952463126-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9952463126-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="9952463126-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="9952463126-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9952463126-29">(</span><span class="n">Player</span><span class="p" data-group-id="9952463126-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9952463126-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-31">[</span><span class="n">Player</span><span class="p" data-group-id="9952463126-31">]</span><span class="p" data-group-id="9952463126-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9952463126-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9952463126-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="9952463126-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9952463126-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9952463126-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-36">[</span><span class="n">Player</span><span class="p" data-group-id="9952463126-36">]</span><span class="p" data-group-id="9952463126-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="9952463126-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9952463126-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9952463126-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9952463126-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="9952463126-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9952463126-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="9952463126-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="9952463126-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="9952463126-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="9952463126-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="9952463126-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="9952463126-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="9952463126-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="9952463126-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9952463126-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="9952463126-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9952463126-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="9952463126-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="9952463126-49">(</span><span class="n">Player</span><span class="p" data-group-id="9952463126-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9952463126-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="9952463126-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="9952463126-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9952463126-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="9952463126-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9952463126-53">(</span><span class="n">P</span><span class="p" data-group-id="9952463126-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="9952463126-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="9952463126-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="9952463126-55">(</span><span class="n">P</span><span class="p" data-group-id="9952463126-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9952463126-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9952463126-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="9952463126-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="9952463126-57">(</span><span class="p" data-group-id="9952463126-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-58">{</span><span class="p" data-group-id="9952463126-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="9952463126-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9952463126-60">}</span><span class="p" data-group-id="9952463126-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="9952463126-61">(</span><span class="p" data-group-id="9952463126-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="9952463126-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9952463126-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9952463126-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="9952463126-64">]</span><span class="w">
        </span><span class="p" data-group-id="9952463126-63">)</span><span class="w">
    </span><span class="p" data-group-id="9952463126-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="9952463126-65">(</span><span class="p" data-group-id="9952463126-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="9952463126-66">(</span><span class="p" data-group-id="9952463126-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9952463126-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9952463126-68">]</span><span class="p" data-group-id="9952463126-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="9952463126-69">(</span><span class="p" data-group-id="9952463126-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9952463126-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9952463126-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="9952463126-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="9952463126-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="9952463126-72">(</span><span class="p" data-group-id="9952463126-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="9952463126-74">{</span><span class="ss">fff</span><span class="p" data-group-id="9952463126-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="9952463126-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9952463126-76">]</span><span class="p" data-group-id="9952463126-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-77">[</span><span class="n">Fun</span><span class="p" data-group-id="9952463126-78">(</span><span class="n">H</span><span class="p" data-group-id="9952463126-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="9952463126-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="9952463126-79">)</span><span class="p" data-group-id="9952463126-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="9952463126-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9952463126-81">[</span><span class="p" data-group-id="9952463126-81">]</span><span class="p" data-group-id="9952463126-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="9952463126-82">[</span><span class="p" data-group-id="9952463126-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="9952463126-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="9952463126-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="9952463126-84">(</span><span class="p" data-group-id="9952463126-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="9952463126-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="9952463126-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="9952463126-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9952463126-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="9952463126-88">(</span><span class="nf">fun</span><span class="p" data-group-id="9952463126-89">(</span><span class="p" data-group-id="9952463126-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="9952463126-90">{</span><span class="nf">self</span><span class="p" data-group-id="9952463126-91">(</span><span class="p" data-group-id="9952463126-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="9952463126-92">(</span><span class="n">X</span><span class="p" data-group-id="9952463126-92">)</span><span class="p" data-group-id="9952463126-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="9952463126-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="9952463126-87">]</span><span class="w">
    </span><span class="p" data-group-id="9952463126-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="vs">
    VisualStudio Style (vs)<a class="headerlink" href="#vs" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-vs"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">vs_style</span><span class="p" data-group-id="6996563210-1">(</span><span class="p" data-group-id="6996563210-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="vs-example.erl">
      example.erl<a class="headerlink" href="#vs-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-vs"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2821126412-1">(</span><span class="ss">test</span><span class="p" data-group-id="2821126412-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2821126412-2">(</span><span class="p" data-group-id="2821126412-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="2821126412-3">]</span><span class="p" data-group-id="2821126412-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="2821126412-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="2821126412-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2821126412-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2821126412-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="2821126412-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="2821126412-9">}</span><span class="p" data-group-id="2821126412-6">]</span><span class="p" data-group-id="2821126412-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="2821126412-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="2821126412-11">}</span><span class="p" data-group-id="2821126412-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="2821126412-12">(</span><span class="n">Port</span><span class="p" data-group-id="2821126412-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="2821126412-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="2821126412-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="2821126412-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="2821126412-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="2821126412-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-17">[</span><span class="p" data-group-id="2821126412-18">[</span><span class="p" data-group-id="2821126412-18">]</span><span class="p" data-group-id="2821126412-17">]</span><span class="p" data-group-id="2821126412-16">)</span><span class="p" data-group-id="2821126412-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="2821126412-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="2821126412-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="2821126412-20">(</span><span class="n">Players</span><span class="p" data-group-id="2821126412-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2821126412-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-22">[</span><span class="p" data-group-id="2821126412-22">]</span><span class="p" data-group-id="2821126412-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2821126412-23">(</span><span class="nf">fun</span><span class="p" data-group-id="2821126412-24">(</span><span class="n">P</span><span class="p" data-group-id="2821126412-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2821126412-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-26">[</span><span class="n">P</span><span class="p" data-group-id="2821126412-26">]</span><span class="p" data-group-id="2821126412-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="2821126412-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2821126412-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="2821126412-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="2821126412-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2821126412-29">(</span><span class="n">Player</span><span class="p" data-group-id="2821126412-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2821126412-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-31">[</span><span class="n">Player</span><span class="p" data-group-id="2821126412-31">]</span><span class="p" data-group-id="2821126412-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2821126412-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2821126412-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="2821126412-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2821126412-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2821126412-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-36">[</span><span class="n">Player</span><span class="p" data-group-id="2821126412-36">]</span><span class="p" data-group-id="2821126412-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="2821126412-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="2821126412-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2821126412-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2821126412-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="2821126412-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2821126412-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="2821126412-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="2821126412-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="2821126412-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="2821126412-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="2821126412-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="2821126412-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="2821126412-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="2821126412-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="2821126412-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="2821126412-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="2821126412-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="2821126412-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="2821126412-49">(</span><span class="n">Player</span><span class="p" data-group-id="2821126412-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2821126412-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="2821126412-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="2821126412-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2821126412-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="2821126412-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2821126412-53">(</span><span class="n">P</span><span class="p" data-group-id="2821126412-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="2821126412-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="2821126412-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="2821126412-55">(</span><span class="n">P</span><span class="p" data-group-id="2821126412-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2821126412-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2821126412-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="2821126412-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="2821126412-57">(</span><span class="p" data-group-id="2821126412-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-58">{</span><span class="p" data-group-id="2821126412-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="2821126412-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2821126412-60">}</span><span class="p" data-group-id="2821126412-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="2821126412-61">(</span><span class="p" data-group-id="2821126412-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="2821126412-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="2821126412-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="2821126412-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="2821126412-64">]</span><span class="w">
        </span><span class="p" data-group-id="2821126412-63">)</span><span class="w">
    </span><span class="p" data-group-id="2821126412-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="2821126412-65">(</span><span class="p" data-group-id="2821126412-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="2821126412-66">(</span><span class="p" data-group-id="2821126412-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2821126412-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="2821126412-68">]</span><span class="p" data-group-id="2821126412-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="2821126412-69">(</span><span class="p" data-group-id="2821126412-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2821126412-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2821126412-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="2821126412-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="2821126412-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="2821126412-72">(</span><span class="p" data-group-id="2821126412-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="2821126412-74">{</span><span class="ss">fff</span><span class="p" data-group-id="2821126412-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="2821126412-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2821126412-76">]</span><span class="p" data-group-id="2821126412-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-77">[</span><span class="n">Fun</span><span class="p" data-group-id="2821126412-78">(</span><span class="n">H</span><span class="p" data-group-id="2821126412-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="2821126412-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="2821126412-79">)</span><span class="p" data-group-id="2821126412-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="2821126412-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2821126412-81">[</span><span class="p" data-group-id="2821126412-81">]</span><span class="p" data-group-id="2821126412-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2821126412-82">[</span><span class="p" data-group-id="2821126412-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="2821126412-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="2821126412-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="2821126412-84">(</span><span class="p" data-group-id="2821126412-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2821126412-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="2821126412-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="2821126412-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="2821126412-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="2821126412-88">(</span><span class="nf">fun</span><span class="p" data-group-id="2821126412-89">(</span><span class="p" data-group-id="2821126412-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="2821126412-90">{</span><span class="nf">self</span><span class="p" data-group-id="2821126412-91">(</span><span class="p" data-group-id="2821126412-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="2821126412-92">(</span><span class="n">X</span><span class="p" data-group-id="2821126412-92">)</span><span class="p" data-group-id="2821126412-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="2821126412-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="2821126412-87">]</span><span class="w">
    </span><span class="p" data-group-id="2821126412-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  

  <h2 id="xcode">
    Xcode Style (xcode)<a class="headerlink" href="#xcode" title="Permalink">¶</a>
  </h2>

  <p>
    You can access this style as:
  </p>

  <pre class="highlight-xcode"><code><span class="nc">Makeup.Styles.HTML.StyleMap</span><span class="o">.</span><span class="n">xcode_style</span><span class="p" data-group-id="9592578970-1">(</span><span class="p" data-group-id="9592578970-1">)</span><span class="w">
</span></code></pre>

  <p>
    And invoke <code>Makeup.stylesheet(style)</code> to generate the appropriate stylesheets for you.
  </p>

  
    <h3 id="xcode-example.erl">
      example.erl<a class="headerlink" href="#xcode-example.erl" title="Permalink">¶</a>
    </h3>

    <pre class="highlight-xcode"><code><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="6338833654-1">(</span><span class="ss">test</span><span class="p" data-group-id="6338833654-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="6338833654-2">(</span><span class="p" data-group-id="6338833654-3">[</span><span class="w">
    </span><span class="ss">listen</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">handle_client</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">maintain_clients</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">start</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="ss">controller</span><span class="p">/</span><span class="mi">1</span><span class="w">
</span><span class="p" data-group-id="6338833654-3">]</span><span class="p" data-group-id="6338833654-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">author</span><span class="p" data-group-id="6338833654-4">(</span><span class="s">&quot;jerith&quot;</span><span class="p" data-group-id="6338833654-4">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="6338833654-5">(</span><span class="n">TCP_OPTIONS</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-6">[</span><span class="ss">list</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-7">{</span><span class="ss">packet</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6338833654-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-8">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="6338833654-8">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6338833654-9">}</span><span class="p" data-group-id="6338833654-6">]</span><span class="p" data-group-id="6338833654-5">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6338833654-10">(</span><span class="ss">player</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-11">{</span><span class="ss">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">none</span><span class="p">,</span><span class="w"> </span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="p" data-group-id="6338833654-11">}</span><span class="p" data-group-id="6338833654-10">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% To allow incoming connections, we need to listen on a TCP port.</span><span class="w">
</span><span class="c1">%% This is also the entry point for our server as a whole, so it</span><span class="w">
</span><span class="c1">%% starts the client_manager process and gives it a name so the rest</span><span class="w">
</span><span class="c1">%% of the code can get to it easily.</span><span class="w">

</span><span class="nf">listen</span><span class="p" data-group-id="6338833654-12">(</span><span class="n">Port</span><span class="p" data-group-id="6338833654-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSocket</span><span class="p" data-group-id="6338833654-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6338833654-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">TCP_OPTIONS</span><span class="p" data-group-id="6338833654-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="6338833654-15">(</span><span class="ss">client_manager</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="6338833654-16">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">maintain_clients</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-17">[</span><span class="p" data-group-id="6338833654-18">[</span><span class="p" data-group-id="6338833654-18">]</span><span class="p" data-group-id="6338833654-17">]</span><span class="p" data-group-id="6338833654-16">)</span><span class="p" data-group-id="6338833654-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">do_accept</span><span class="p" data-group-id="6338833654-19">(</span><span class="n">LSocket</span><span class="p" data-group-id="6338833654-19">)</span><span class="p">.</span><span class="w">

</span><span class="nf">maintain_clients</span><span class="p" data-group-id="6338833654-20">(</span><span class="n">Players</span><span class="p" data-group-id="6338833654-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6338833654-21">(</span><span class="s">&quot;Players:</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-22">[</span><span class="p" data-group-id="6338833654-22">]</span><span class="p" data-group-id="6338833654-21">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6338833654-23">(</span><span class="nf">fun</span><span class="p" data-group-id="6338833654-24">(</span><span class="n">P</span><span class="p" data-group-id="6338833654-24">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6338833654-25">(</span><span class="s">&quot;&gt;&gt;&gt; </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-26">[</span><span class="n">P</span><span class="p" data-group-id="6338833654-26">]</span><span class="p" data-group-id="6338833654-25">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-23">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="p" data-group-id="6338833654-27">{</span><span class="ss">connect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6338833654-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p" data-group-id="6338833654-28">{</span><span class="ss">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="ss">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">connect</span><span class="p" data-group-id="6338833654-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6338833654-29">(</span><span class="n">Player</span><span class="p" data-group-id="6338833654-29">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6338833654-30">(</span><span class="s">&quot;client connected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-31">[</span><span class="n">Player</span><span class="p" data-group-id="6338833654-31">]</span><span class="p" data-group-id="6338833654-30">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6338833654-32">[</span><span class="n">Player</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-32">]</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6338833654-33">{</span><span class="ss">disconnect</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6338833654-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6338833654-34">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-34">)</span><span class="p">,</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6338833654-35">(</span><span class="s">&quot;client disconnected: </span><span class="si">~w</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-36">[</span><span class="n">Player</span><span class="p" data-group-id="6338833654-36">]</span><span class="p" data-group-id="6338833654-35">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="6338833654-37">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-37">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="6338833654-38">{</span><span class="ss">data</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6338833654-38">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6338833654-39">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-39">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">parse_data</span><span class="p" data-group-id="6338833654-40">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6338833654-40">)</span><span class="p">,</span><span class="w">
            </span><span class="n">NewPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">find_player</span><span class="p" data-group-id="6338833654-41">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">NewPlayers</span><span class="p" data-group-id="6338833654-41">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">send_prompt</span><span class="p" data-group-id="6338833654-42">(</span><span class="n">NewPlayer</span><span class="p" data-group-id="6338833654-42">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">maintain_clients</span><span class="p" data-group-id="6338833654-43">(</span><span class="n">NewPlayers</span><span class="p" data-group-id="6338833654-43">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% find_player is a utility function to get a player record associated</span><span class="w">
</span><span class="c1">%% with a particular socket out of the player list.</span><span class="w">

</span><span class="nf">find_player</span><span class="p" data-group-id="6338833654-44">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-45">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="n">Player</span><span class="p" data-group-id="6338833654-45">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="6338833654-46">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-46">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Player</span><span class="p">.</span><span class="w">

</span><span class="c1">%% delete_player returns the player list without the given player.  It</span><span class="w">
</span><span class="c1">%% deletes the player from the list based on the socket rather than</span><span class="w">
</span><span class="c1">%% the whole record because the list might hold a different version.</span><span class="w">

</span><span class="nf">delete_player</span><span class="p" data-group-id="6338833654-47">(</span><span class="n">Player</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-47">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="6338833654-48">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p" data-group-id="6338833654-48">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends an appropriate prompt to the player.  Currently the only</span><span class="w">
</span><span class="c1">%% prompt we send is the initial &quot;Name: &quot; when the player connects.</span><span class="w">

</span><span class="nf">send_prompt</span><span class="p" data-group-id="6338833654-49">(</span><span class="n">Player</span><span class="p" data-group-id="6338833654-49">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">connect</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6338833654-50">(</span><span class="n">Player</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="p" data-group-id="6338833654-50">)</span><span class="p">;</span><span class="w">
        </span><span class="ss">active</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Sends the given data to all players in active mode.</span><span class="w">

</span><span class="nf">send_to_active</span><span class="p" data-group-id="6338833654-51">(</span><span class="n">Prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6338833654-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">ActivePlayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">filter</span><span class="p" data-group-id="6338833654-52">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6338833654-53">(</span><span class="n">P</span><span class="p" data-group-id="6338833654-53">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">active</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">Players</span><span class="w">
    </span><span class="p" data-group-id="6338833654-52">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">foreach</span><span class="p" data-group-id="6338833654-54">(</span><span class="w">
        </span><span class="nf">fun</span><span class="p" data-group-id="6338833654-55">(</span><span class="n">P</span><span class="p" data-group-id="6338833654-55">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="6338833654-56">(</span><span class="n">P</span><span class="o">#</span><span class="ss">player</span><span class="p">.</span><span class="ss">socket</span><span class="p">,</span><span class="w"> </span><span class="n">Prefix</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="6338833654-56">)</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w">
        </span><span class="n">ActivePlayers</span><span class="w">
    </span><span class="p" data-group-id="6338833654-54">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">ok</span><span class="p">.</span><span class="w">

</span><span class="nf">get_timestamp</span><span class="p" data-group-id="6338833654-57">(</span><span class="p" data-group-id="6338833654-57">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-58">{</span><span class="p" data-group-id="6338833654-59">{</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p" data-group-id="6338833654-59">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-60">{</span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6338833654-60">}</span><span class="p" data-group-id="6338833654-58">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">universaltime</span><span class="p" data-group-id="6338833654-61">(</span><span class="p" data-group-id="6338833654-61">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">flatten</span><span class="p" data-group-id="6338833654-62">(</span><span class="w">
        </span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6338833654-63">(</span><span class="w">
            </span><span class="s">&quot;</span><span class="si">~4.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">-</span><span class="si">~2.10.0B</span><span class="s">T</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">:</span><span class="si">~2.10.0B</span><span class="s">Z&quot;</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="6338833654-64">[</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">Day</span><span class="p">,</span><span class="w"> </span><span class="n">Hour</span><span class="p">,</span><span class="w"> </span><span class="n">Min</span><span class="p">,</span><span class="w"> </span><span class="n">Sec</span><span class="p" data-group-id="6338833654-64">]</span><span class="w">
        </span><span class="p" data-group-id="6338833654-63">)</span><span class="w">
    </span><span class="p" data-group-id="6338833654-62">)</span><span class="p">.</span><span class="w">

</span><span class="nf">a_binary</span><span class="p" data-group-id="6338833654-65">(</span><span class="p" data-group-id="6338833654-65">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p">&lt;&lt;</span><span class="mi">100</span><span class="p">:</span><span class="mi">16</span><span class="o">/</span><span class="ss">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">16#7f</span><span class="p">&gt;&gt;</span><span class="p">.</span><span class="w">

</span><span class="nf">a_list_comprehension</span><span class="p" data-group-id="6338833654-66">(</span><span class="p" data-group-id="6338833654-66">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-67">[</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6338833654-68">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6338833654-68">]</span><span class="p" data-group-id="6338833654-67">]</span><span class="p">.</span><span class="w">

</span><span class="nf">a_map</span><span class="p" data-group-id="6338833654-69">(</span><span class="p" data-group-id="6338833654-69">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">M0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6338833654-70">#{</span><span class="ss">a</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6338833654-70">}</span><span class="p">,</span><span class="w">
    </span><span class="n">M1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M0</span><span class="p" data-group-id="6338833654-71">#{</span><span class="ss">b</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">200</span><span class="p" data-group-id="6338833654-71">}</span><span class="p">.</span><span class="w">

</span><span class="nf">escape_sequences</span><span class="p" data-group-id="6338833654-72">(</span><span class="p" data-group-id="6338833654-72">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-73">[</span><span class="w">
        </span><span class="s">&quot;\b\d\e\f\n\r\s\t\v\&#39;\&quot;\\&quot;,
        % octal
        &quot;</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">12</span><span class="err">\</span><span class="mi">123</span><span class="s">&quot;,
        % short hex
        &quot;</span><span class="err">\</span><span class="ss">x01</span><span class="s">&quot;,
        % long hex
        &quot;</span><span class="err">\</span><span class="ss">x</span><span class="p" data-group-id="6338833654-74">{</span><span class="ss">fff</span><span class="p" data-group-id="6338833654-74">}</span><span class="s">&quot;,
        % control characters
        &quot;</span><span class="err">\</span><span class="err">^</span><span class="ss">a</span><span class="err">\</span><span class="err">^</span><span class="n">A</span><span class="p">&quot;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-73">]</span><span class="p">.</span><span class="w">

</span><span class="nf">map</span><span class="p" data-group-id="6338833654-75">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-76">[</span><span class="n">H</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6338833654-76">]</span><span class="p" data-group-id="6338833654-75">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-77">[</span><span class="n">Fun</span><span class="p" data-group-id="6338833654-78">(</span><span class="n">H</span><span class="p" data-group-id="6338833654-78">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">map</span><span class="p" data-group-id="6338833654-79">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p" data-group-id="6338833654-79">)</span><span class="p" data-group-id="6338833654-77">]</span><span class="p">;</span><span class="w">
</span><span class="nf">map</span><span class="p" data-group-id="6338833654-80">(</span><span class="n">Fun</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6338833654-81">[</span><span class="p" data-group-id="6338833654-81">]</span><span class="p" data-group-id="6338833654-80">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="6338833654-82">[</span><span class="p" data-group-id="6338833654-82">]</span><span class="p">.</span><span class="w">

</span><span class="c1">%% pmap, just because it&#39;s cool.</span><span class="w">

</span><span class="nf">pmap</span><span class="p" data-group-id="6338833654-83">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p" data-group-id="6338833654-83">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="6338833654-84">(</span><span class="p" data-group-id="6338833654-84">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6338833654-85">[</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="6338833654-86">{</span><span class="n">Pid</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="p" data-group-id="6338833654-86">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Result</span><span class="w">
        </span><span class="k">end</span><span class="w">
     </span><span class="p">||</span><span class="w"> </span><span class="n">Pid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6338833654-87">[</span><span class="w">
            </span><span class="nf">spawn</span><span class="p" data-group-id="6338833654-88">(</span><span class="nf">fun</span><span class="p" data-group-id="6338833654-89">(</span><span class="p" data-group-id="6338833654-89">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Parent</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p" data-group-id="6338833654-90">{</span><span class="nf">self</span><span class="p" data-group-id="6338833654-91">(</span><span class="p" data-group-id="6338833654-91">)</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p" data-group-id="6338833654-92">(</span><span class="n">X</span><span class="p" data-group-id="6338833654-92">)</span><span class="p" data-group-id="6338833654-90">}</span><span class="w">
            </span><span class="k">end</span><span class="p" data-group-id="6338833654-88">)</span><span class="w">
         </span><span class="p">||</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">L</span><span class="w">
        </span><span class="p" data-group-id="6338833654-87">]</span><span class="w">
    </span><span class="p" data-group-id="6338833654-85">]</span><span class="p">.</span><span class="w">
</span></code></pre>
  


          </div>


        </div>

        <div class="clearer"></div>

      </div>

      <div class="clearfix"></div>
    </div>

    <script src="static/js/matching_groups_highlighter.js"></script>

    <script type="text/javascript">
      document.querySelector(".menu-btn").addEventListener("click", () => {
        document.querySelector(".left-column").classList.toggle("left-column--active");
      });
    </script>
  </body>
</html>
